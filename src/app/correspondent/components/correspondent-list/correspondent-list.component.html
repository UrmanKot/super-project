<div class="page">
  <div class="page__header">
    <div class="page__title">
      <pek-module-icon [module]="'correspondents'" [isActive]="true"></pek-module-icon>
      <h1>
        {{type === types.INCOMING ? 'Incoming' : 'Outgoing'}}
        Correspondent</h1>
    </div>
    <div class="page__tools">
      <button pButton type="button" icon="pi pi-plus" label="New Correspondent" (click)="add()"></button>
    </div>
  </div>

  <div class="page__content">
    <div class="page__card">
      <div class="page__table">
        <p-table
          #dt
          class="table-full-loading adaptive-table adaptive-table_filters"
          [rows]="10"
          [value]="correspondents"
          scrollHeight="calc(100vh - 450px)"
          [globalFilterFields]="['name']"
          selectionMode="single"
          [(selection)]="selectedNode"
        >
          <ng-template pTemplate="caption">
            <form [formGroup]="searchForm">
              <div class="row pl-3 pt-3 pr-3 pb-0">
                <div class="col-4">
                  <label>Date Received From</label>
<!--                  <p-calendar-->
<!--                    firstDayOfWeek="1"-->
<!--                    showButtonBar="true"-->
<!--                    inputId="basic"-->
<!--                    dateFormat="dd/mm/yy"-->
<!--                    formControlName="date_received_after"-->
<!--                    (ngModelChange)="changeCorrespondentStart($event)"-->
<!--                    [readonlyInput]="true"-->
<!--                  ></p-calendar>-->
                </div>
                <div class="col-4">
                  <label>Date Received To</label>
<!--                  <p-calendar-->
<!--                    firstDayOfWeek="1"-->
<!--                    showButtonBar="true"-->
<!--                    inputId="basic"-->
<!--                    dateFormat="dd/mm/yy"-->
<!--                    formControlName="date_received_before"-->
<!--                    (ngModelChange)="changeCorrespondentEnd($event)"-->
<!--                    [readonlyInput]="true"-->
<!--                  ></p-calendar>-->
                </div>
                <div class="col-4">
                  <div class="form-group">
                    <label>ID</label>
                    <input pInputText formControlName="id" type="number" class="form-control" (ngModelChange)="search()" #searchBoxName>
                  </div>
                </div>
                <div *ngIf="type === types.INCOMING" class="col-4" >
                  <div class="form-group">
                    <label>External ID</label>
                    <input pInputText formControlName="externalId" class="form-control" (ngModelChange)="search()" #searchBoxName>
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group">
                    <label>Correspondent Categories</label>
<!--                    <app-correspondent-category-filter [type]="type" (onChange)="searchByCategories($event)"></app-correspondent-category-filter>-->
                  </div>
                </div>
              </div>
            </form>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
              <th class="index-header text-center" style="width: 5%">ID</th>
              <th *ngIf="type === types.INCOMING" style="width: 25%">
                ExternalID
              </th>
              <th style="width: 20%">Date Received</th>
              <th style="width: 20%">Category</th>
              <th style="width: 30%">Files</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-correspondent let-i="rowIndex">
            <tr [pSelectableRow]="correspondent">
              <td style="width: 5%" class="text-center">
                {{ correspondent.id}}
              </td>
              <td *ngIf="type === types.INCOMING"  style="width: 25%">
                {{ correspondent.external_id}}
              </td>
              <td style="width: 20%">
                {{ correspondent.date_received | date: "dd/MM/yyyy" }}
              </td>
              <td style="width: 20%">
                {{ correspondent.category ? correspondent.category.name : null }}
              </td>
              <td class="files-cont" style="width: 30%">
                <span *ngIf="correspondent.files.length > 1">
                  <a href="javascript:void(0)" (click)="downloadFile(correspondent.files[0])">
                     {{ getName(correspondent.files[0].file) }} (F {{correspondent.files.length}})
                  </a>
                </span>

                <span *ngIf="correspondent.files.length === 1">
                  <a href="javascript:void(0)" (click)="downloadFile(correspondent.files[0])">
                     {{ getName(correspondent.files[0].file) }}
                  </a>
                </span>

                <div *ngIf="correspondent.files.length > 1" class="files-list">
                  <span *ngFor="let file of correspondent.files">
                     <a href="javascript:void(0)" (click)="downloadFile(file)">
                       {{ getName(file.file) }}
                     </a>
                     <br>
                  </span>
                </div>
              </td>
            </tr>
            <tr class="table-pagination-preloader" *ngIf="isLoading">
              <div>
                <i class="fas fa-circle-notch fa-spin fa-3x"></i>
              </div>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage" let-columns>
            <tr class="no-content">
              <td style="width: 100%;" class="text-center p-4" [attr.colspan]="type === types.INCOMING ? 5 : 4">
                <i *ngIf="isLoading" class="fas fa-circle-notch fa-spin fa-3x "></i>
                <span *ngIf="!isLoading">
              No Records Found
            </span>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="paginatorright">
            <p-button
              type="button"
              (click)="dt.paginator = false; dt.scrollable = true"
              pTooltip="Remove Pagination"
              styleClass="p-button-text"
            >All
            </p-button
            >
          </ng-template>
          <ng-template pTemplate="paginatorleft"></ng-template>
        </p-table>
        <div *ngIf="!isShowAll" [class.paginator-wrap]="isLoading" class="pagination-wrap">
          <p-paginator
            #paginator
            [rows]="10"
            [totalRecords]="countCorrespondents"
            (onPageChange)="paginate($event)">
          </p-paginator>
        </div>
      </div>
    </div>
  </div>

</div>
