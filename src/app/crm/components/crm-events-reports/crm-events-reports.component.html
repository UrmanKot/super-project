<div class="page">
  <div class="page__header">
    <div class="page__title">
      <pek-module-icon [module]="'contacts-events'" [isActive]="true"></pek-module-icon>
      <h1>Events Reports Date: {{today | date: "dd.MM"}} Time: {{today | date: "HH:mm"}}</h1>
    </div>
  </div>
</div>

<div class="page__content" [class.is-all-active]="isShowAll">
  <div class="page__card">
    <div class="filters-visibility" [class.filters-visibility_hide]="isHideFilters">
      <div class="filters-visibility__header">
        <div class="action-buttons"></div>
      </div>
      <button
        class="icon pi"
        [class.pi-angle-double-up]="!isHideFilters"
        [class.pi-angle-double-down]="isHideFilters"
        (click)="toggleFilterVisibility()"
        [pTooltip]="isHideFilters ? 'Expand Filters' : 'Collapse Filters'"
        tooltipPosition="left"
      ></button>
      <form [formGroup]="searchForm" class="pb-2">
        <div class="row mt-4">
          <div class="col-3">
            <div class="form-group">
              <label>Company</label>
              <pek-company-picker (selectCompany)="onSelectCompany($event)"></pek-company-picker>
            </div>
          </div>
          <div class="col-3">
            <div class="form-group">
              <label>Event Types</label>
              <pek-crm-multi-event-types-picker
                (selectEventTypes)="onSelectEventTypes($event)"></pek-crm-multi-event-types-picker>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label>Sales Chain Statuses</label>
              <pek-multi-sales-status-picker
                (selectStatuses)="onSelectStatuses($event)"></pek-multi-sales-status-picker>
            </div>
          </div>
          <div class="col-2">
            <div class="event-row-filters">
              <div class="form-group mr-3">
                <label>Employees</label>
                <pek-crm-employee-picker (selectEmployees)="onSelectEmployees($event)"></pek-crm-employee-picker>
              </div>
              <!--              <div class="form-group mr-3">-->
              <!--                <label>Hide Status Events</label>-->
              <!--                <p-checkbox-->
              <!--                  class="checkbox-big"-->
              <!--                  name="group1"-->
              <!--                  [binary]="true"-->
              <!--                  inputId="auto-events"-->
              <!--                  (onChange)="search()"-->
              <!--                  formControlName="autoEvents"-->
              <!--                >-->
              <!--                </p-checkbox>-->
              <!--              </div>-->
              <!--              <div class="form-group">-->
              <!--                <label>Group Linked Events</label>-->
              <!--                <p-checkbox-->
              <!--                  class="checkbox-big"-->
              <!--                  name="group2"-->
              <!--                  [binary]="true"-->
              <!--                  inputId="group-linked-events"-->
              <!--                  formControlName="groupView"-->
              <!--                >-->
              <!--                </p-checkbox>-->
              <!--              </div>-->
            </div>
          </div>
          <div class="col-1">
            <div class="form-group">
              <label>Hide Status Events</label>
              <p-checkbox
                class="checkbox-big"
                name="group1"
                [binary]="true"
                inputId="auto-events"
                (onChange)="search()"
                formControlName="autoEvents"
              >
              </p-checkbox>
            </div>
          </div>
          <div class="col-1">
            <div class="form-group">
              <label>Group Linked Events</label>
              <p-checkbox
                class="checkbox-big"
                name="group2"
                [binary]="true"
                inputId="group-linked-events"
                formControlName="groupView"
              >
              </p-checkbox>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-3">
            <div class="form-group">
              <label>Company Category</label>
              <pek-multi-company-category-picker
                (selectCompanyCategoriesIds)="onSelectCompanyCategory($event)"></pek-multi-company-category-picker>
            </div>
          </div>
          <div class="col-3">
            <div class="form-group">
              <label>Country</label>
              <pek-multi-countries-picker [showClear]="true"
                                          (selectCountries)="onSelectCountry($event)"></pek-multi-countries-picker>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label>Region</label>
              <pek-crm-multi-region-picker
                [isDisabled]="!searchForm.get('countries').value || searchForm.get('countries').value.length === 0"
                [countrySelected]="searchForm.get('countries').value"
                (regionsSelected)="onSelectRegion($event)"></pek-crm-multi-region-picker>
            </div>
          </div>
          <div class="col-2">
            <div class="form-group">
              <label>Sub Region</label>
              <pek-crm-multi-region-tree-picker
                [isDisabled]="!searchForm.get('regions').value || searchForm.get('regions').value.length === 0"
                [regionsSelected]="searchForm.get('regions').value"
                (subRegionsSelected)="regionSubSelected($event)"
              ></pek-crm-multi-region-tree-picker>
            </div>
          </div>
          <div class="col-1">
            <div class="form-group">
              <label>Enable Status Of Result</label>
              <p-checkbox
                class="checkbox-big"
                name="group1"
                [binary]="true"
                inputId="enableColors"
                formControlName="enableColors"
              >
              </p-checkbox>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-3">
            <div class="form-group">
              <label>Event Date Filter</label>
              <p-multiSelect
                [options]="dateFilters"
                [(ngModel)]="selectedFilters"
                [ngModelOptions]="{standalone: true}"
                placeholder="Select Date Filters Types"
                (ngModelChange)="updated($event)"
                optionLabel="name"
                optionValue="value"></p-multiSelect>
            </div>
          </div>
          <div class="col-3">

            <div *ngIf="isLastEventStartFilterOpen" class="form-group">
              <label>Last Events Date Start From</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                dateFormat="dd/mm/yy"
                formControlName="last_events_date_start_after"
                (ngModelChange)="filterByLastStartDate()"
                [readonlyInput]="true"
                [maxDate]="lastBeforeStartDateSelected ? lastBeforeStartDateSelected : dateRangeLimit"
              ></p-calendar>
            </div>
            <div *ngIf="isLastEventEndFilterOpen" class="form-group">
              <label>Last Events Date End From</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                dateFormat="dd/mm/yy"
                formControlName="last_events_date_end_after"
                (ngModelChange)="filterByLastEndDate()"
                [readonlyInput]="true"
                [maxDate]="lastBeforeEndDateSelected ? lastBeforeEndDateSelected : dateRangeLimit"
              ></p-calendar>
            </div>
            <div *ngIf="isFeatureEventStartFilterOpen" class="form-group">
              <label>Feature Events Date Start From</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                formControlName="next_events_date_start_after"
                (ngModelChange)="filterByFeatureStartDate()"
                dateFormat="dd/mm/yy"
                [readonlyInput]="true"
                [minDate]="dateRangeLimit"
                [maxDate]="featureBeforeStartDateSelected ? featureBeforeStartDateSelected : null"
              ></p-calendar>
            </div>
            <div *ngIf="isFeatureEventEndFilterOpen" class="form-group">
              <label>Feature Events Date End From</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                formControlName="next_events_date_end_after"
                (ngModelChange)="filterByFeatureEndDate()"
                dateFormat="dd/mm/yy"
                [readonlyInput]="true"
                [minDate]="dateRangeLimit"
                [maxDate]="featureBeforeEndDateSelected ? featureBeforeEndDateSelected : null"
              ></p-calendar>
            </div>
          </div>
          <!--   UNTIL     -->
          <div class="col-3">
            <div *ngIf="isLastEventStartFilterOpen" class="form-group">
              <label>Last Events Date Start To</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                formControlName="last_events_date_start_before"
                (ngModelChange)="filterByLastStartDate()"
                dateFormat="dd/mm/yy"
                [readonlyInput]="true"
                [maxDate]="dateRangeLimit"
                [minDate]="lastAfterStartDateSelected ? lastAfterStartDateSelected : lastAfterStartDateSelected"
              ></p-calendar>
            </div>
            <div *ngIf="isLastEventEndFilterOpen" class="form-group">
              <label>Last Events Date End To</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                formControlName="last_events_date_end_before"
                (ngModelChange)="filterByLastEndDate()"
                dateFormat="dd/mm/yy"
                [readonlyInput]="true"
                [maxDate]="dateRangeLimit"
                [minDate]="lastAfterEndDateSelected ? lastAfterEndDateSelected : dateRangeLimit"
              ></p-calendar>
            </div>
            <div *ngIf="isFeatureEventStartFilterOpen" class="form-group">
              <label>Feature Events Date Start To</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                formControlName="next_events_date_start_before"
                (ngModelChange)="filterByFeatureStartDate()"
                dateFormat="dd/mm/yy"
                [readonlyInput]="true"
                [minDate]="featureAfterStartDateSelected ? featureAfterStartDateSelected : dateRangeLimit"
              ></p-calendar>
            </div>
            <div *ngIf="isFeatureEventEndFilterOpen" class="form-group">
              <label>Feature Events Date End To</label>
              <p-calendar
                [firstDayOfWeek]="1"
                [showButtonBar]="true"
                inputId="basic"
                formControlName="next_events_date_end_before"
                (ngModelChange)="filterByFeatureEndDate()"
                dateFormat="dd/mm/yy"
                [readonlyInput]="true"
                [minDate]="featureAfterEndDateSelected ? featureAfterEndDateSelected : dateRangeLimit"
              ></p-calendar>
            </div>
          </div>
          <!--   CHECK BOX    -->
          <div class="col-3">
            <div class="form-group" *ngIf="isLastEventStartFilterOpen && isLastEventEndFilterOpen">
              <label>Intersections Last Events Dates</label>
              <p-checkbox
                class="checkbox-big"
                name="group1"
                [binary]="true"
                inputId="auto-events"
                (onChange)="search()"
                formControlName="intersect_last_event"
              >
              </p-checkbox>
            </div>
            <div class="form-group" *ngIf="isLastEventStartFilterOpen && isLastEventEndFilterOpen ||
           isFeatureEventStartFilterOpen && isFeatureEventEndFilterOpen &&
            (!isLastEventStartFilterOpen && isLastEventEndFilterOpen ||
             isLastEventStartFilterOpen && !isLastEventEndFilterOpen )">
              <label>&nbsp;</label>
              <div style="height: 33px"></div>
            </div>
            <div class="form-group" *ngIf="isFeatureEventStartFilterOpen && isFeatureEventEndFilterOpen">
              <label>Intersections Last Feature Dates</label>
              <p-checkbox
                class="checkbox-big"
                name="group1"
                [binary]="true"
                inputId="auto-events"
                (onChange)="search()"
                formControlName="intersect_next_event"
              >
              </p-checkbox>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="page__table" *ngIf="!searchForm.get('groupView').value else groupedView">
      <div class="table-pagination-preloader">
          <!--
          [scrollable]="true"
          scrollHeight="100vh"
          -->
        <p-table
          #dt
          class="table-full-loading events-reports"

          [rows]="10"
          [value]="eventsReports"
          [globalFilterFields]="['name']"
          selectionMode="single"
          [(selection)]="selectedEventsReport"
        >
          <ng-template pTemplate="header">
            <tr class="bord-all">
              <th rowspan="3" style="width: 5%" class="text-center bord-top bord-left bord-dark">#</th>
              <th rowspan="3" style="width: 15%;" class="bord-dark bord-top sort-label"
                  (click)="sorting(searchForm.get('order_by_name').value, 'order_by_name')">
                Company
                <pek-sort-icon [value]="searchForm.get('order_by_name').value"></pek-sort-icon>
              </th>
            </tr>
            <tr class="bord-all">
              <th colspan="5" class="bord text-center dark-two bord-top" style="width: 40%">Last Event
                <span *ngIf="isLastDateDefaultFilterSelected">(By Default: Last 10 days)</span></th>
              <th colspan="3" class="bord text-center bord-top dark" style="width: 40%">Future Event
                <span *ngIf="isNextDateDefaultFilterSelected">(By Default: Next 1 Year)</span>
              </th>
            </tr>
            <tr>
              <th class="bord text-center dark-two" style="width: 10%">Name</th>
              <th
                class="text-center dark-two sort-label"
                style="width: 10%"
                (click)="sorting(searchForm.get('order_by_date').value, 'order_by_date', false); removeSoring('order_by_date_end')"
              >
                Start Date
                <pek-sort-icon [value]="searchForm.get('order_by_date').value"></pek-sort-icon>
              </th>
              <th
                (click)="sorting(searchForm.get('order_by_date_end').value, 'order_by_date_end', false); removeSoring('order_by_date')"
                class="text-center dark-two sort-label"
                style="width: 10%"
              >
                End Date
                <pek-sort-icon [value]="searchForm.get('order_by_date_end').value"></pek-sort-icon>
              </th>
              <th class="text-center dark-two" style="width: 10%">Comment</th>
              <th class="text-center dark-two" style="width: 10%">Status</th>
              <th class="bord text-center dark" style="width: 10%">Name</th>
              <th
                class="text-center dark sort-label"
                style="width: 10%"
                (click)="sorting(searchForm.get('order_by_next_event_date').value, 'order_by_next_event_date', false); removeSoring('order_by_next_event_date_end')"
              >
                Start Date
                <pek-sort-icon [value]="searchForm.get('order_by_next_event_date').value"></pek-sort-icon>
              </th>
              <th
                class="text-center dark border-right  sort-label"
                style="width: 10%"
                (click)="sorting(searchForm.get('order_by_next_event_date_end').value, 'order_by_next_event_date_end', false); removeSoring('order_by_next_event_date')"
              >
                End Date
                <pek-sort-icon [value]="searchForm.get('order_by_next_event_date_end').value"></pek-sort-icon>
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-report let-i="rowIndex">
            <tr>
              <td style="width: 5%" class="text-center bord-dark">
                <div class="event-item justify-content-center"
                     [class.impression-neutral-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEUTRAL"
                     [class.impression-positive-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.POSITIVE"
                     [class.impression-negative-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEGATIVE">
                  {{(this.searchForm.get('page').value - 1) * 10 + i + 1}}
                </div>
              </td>
              <td style="width: 15%" class="table-comment small-comment bord-dark">
                <div class="event-item justify-content-center hovered-info">
                        <span
                          [class.impression-neutral-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEUTRAL"
                          [class.impression-positive-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.POSITIVE"
                          [class.impression-negative-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEGATIVE">
                          <a
                            [routerLink]="'/crm/business-partners/company-page/' + report.id"
                            target="_blank"
                          >
                            {{ report.name }}
                          </a>
                        </span>
                  <pek-hover-detailed-info-component>
                    <div class="full-comment full-comment_big">
                      <div class="row">
                        <div class="col-md-5">
                          <h4>Name: <i>{{ report.name }}</i></h4>
                          <h4>
                            Category:
                            <i>
                              <ng-container *ngFor="let item of report.categories"
                              >{{ item.name }},
                              </ng-container>
                            </i>
                          </h4>
                          <h4>Address: <i>{{ report.address }}</i></h4>
                          <h4>Email: <i>{{ report.email }}</i></h4>
                          <h4>Phone Number: <i>{{ report.phone_number }}</i></h4>
                          <h4>Website: <i><a [href]="report.website" target="_blank">{{ report.website }}</a></i></h4>
                          <h4>Tax Number: <i>{{ report.tax_number }}</i></h4>
                          <h4>Register Number: <i>{{ report.registration_number }}</i></h4>
                        </div>
                        <div class="col-md-7">
                          <h4>Nomenclature: <i>{{ report.supplier_nomenclature }}</i></h4>
                          <h4>Description: <i>{{ report.comment }}</i></h4>
                          <h4>
                            Country:
                            <span *ngIf="report.country">{{report.country.name}}</span>
                          </h4>

                          <h4>
                            Region:
                            <span *ngIf="report.region">{{report.region.name}}</span>
                          </h4>

                          <h4>
                            Sub Region:
                            <span *ngIf="report.sub_region">{{report.sub_region.name}}</span>
                          </h4>
                          <h4>Connected Companies</h4>
                          <p *ngFor="let linked_company of report.linked_companies">
                            <i>{{ linked_company.name }}</i>
                          </p>
                          <h4>Dont have VAT:
                            <i class="pi pi-check text-success" *ngIf="report.has_not_vat"></i>
                            <i class="pi pi-times text-danger" *ngIf="!report.has_not_vat"></i>
                          </h4>
                        </div>
                      </div>
                    </div>
                  </pek-hover-detailed-info-component>
                </div>
              </td>

              <td style="width: 10%" class="text-center bord dark-two no-padding">
                <div class="event-item event-type-name"
                     [class.event-item-col]="report.last_events.length > 1"
                >
                  <div *ngIf="report.last_events && report.last_events.length > 0">
                    <div class="report-event" *ngFor="let event of report.last_events"
                         [pTooltip]="event ? event.description : 'No Description'"
                         tooltipStyleClass="white-tool-tip"
                         tooltipPosition="right"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      <a [routerLink]="'/crm/events/' + event?.id"
                         target="_blank">{{ event?.event_name }}</a>
                    </div>
                  </div>
                </div>
              </td>

              <td style="width: 10%" class="text-center dark-two no-padding">
                <div class="event-item" [class.event-item-col]="report.last_events.length > 1">
                  <div *ngIf="report.last_events && report.last_events.length > 0">
                    <div class="report-event" *ngFor="let event of report.last_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      {{ event?.start | date: "dd/MM/yyyy, HH:mm" }}
                    </div>
                  </div>
                </div>
              </td>

              <td style="width: 10%" class="text-center dark-two no-padding">
                <div class="event-item" [class.event-item-col]="report.last_events.length > 1">
                  <div *ngIf="report.last_events && report.last_events.length > 0">
                    <div class="report-event" *ngFor="let event of report.last_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      {{ event?.end | date: "dd/MM/yyyy, HH:mm" }}
                    </div>
                  </div>
                </div>
              </td>

              <td style="width: 10%" class="table-comment  text-center dark-two no-padding">
                <div class="event-item" [class.event-item-col]="report.last_events.length > 1">
                  <div *ngIf="report.last_events && report.last_events.length > 0">
                    <div class="report-event" *ngFor="let event of report.last_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      <div class="small-comment hovered-info">
                              <span>
                                {{getSmallComment(event?.event_comment)}}
                              </span>
                        <pek-hover-detailed-info-component
                          [moveLeft]="20"
                          *ngIf="getSmallComment(event?.event_comment)"
                        >
                          <span class="full-comment description-modal">
                            {{event?.event_comment}}
                          </span>
                        </pek-hover-detailed-info-component>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
              <td style="width: 10%" class="text-center dark-two no-padding">
                <div class="event-item" [class.event-item-col]="report.last_events.length > 1">
                  <div *ngIf="report.last_events && report.last_events.length > 0">
                    <div class="report-event" *ngFor="let event of report.last_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                            <span [ngSwitch]="event?.is_done">
                              <ng-container *ngSwitchCase="true">Done</ng-container>
                              <ng-container *ngSwitchCase="false">Not Done</ng-container>
                            </span>
                    </div>
                  </div>
                </div>
              </td>
              <!-- FutureEvents -->
              <td style="width: 10%" class="text-center bord dark no-padding">
                <div class="event-item event-type-name" [class.event-item-col]="report.next_events.length > 1">
                  <div>
                    <div class="report-event tesdt" *ngFor="let event of report.next_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      <a [routerLink]="'/crm/events/' + event?.id"
                         target="_blank"
                         [pTooltip]="event ? event.description : 'No Description'"
                         tooltipStyleClass="white-tool-tip"
                         tooltipPosition="right">
                        {{ event?.event_name }}
                      </a>
                    </div>
                  </div>
                </div>
              </td>
              <td style="width: 10%" class="text-center dark no-padding">
                <div class="event-item">
                  <div>
                    <div class="report-event" *ngFor="let event of report.next_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      {{ event?.start | date: "dd/MM/yyyy, HH:mm" }}
                    </div>
                  </div>
                </div>
              </td>
              <td style="width: 10%" class="text-center dark border-right no-padding">
                <div class="event-item">
                  <div>
                    <div class="report-event" *ngFor="let event of report.next_events"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      {{ event?.end | date: "dd/MM/yyyy, HH:mm" }}
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td class="text-center p-4" [attr.colspan]="12">
                <i *ngIf="isLoading" class="pi pi-spin pi-spinner" style="font-size: 2.25rem"></i>
                <span *ngIf="!isLoading">No Records Found</span>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <div class="pagination-preloader pagination-preloader_bord" *ngIf="isLoading">
          <i class="pi pi-spin pi-spinner" style="font-size: 2.25rem"></i>
        </div>
      </div>
      <div
        class="paginator-wrapper"
        *ngIf="!isShowAll"
        [class.hidden]="eventsReports.length === 0"
      >
        <p-paginator
          #paginator
          [rows]="10"
          [totalRecords]="reportsCount"
          (onPageChange)="paginate($event)"
        >
        </p-paginator>
        <p-button
          (click)="onShowAll()"
          class="paginator-all"
          type="button"
          styleClass="p-button-text"
        >
          All
        </p-button>
      </div>

      <div *ngIf="isShowAll" class="paginator-return-pagination">
        <p-button
          type="button"
          (click)="onShowPartial()"
          styleClass="p-button-text"
        >
          Return pagination
        </p-button>
      </div>
    </div>
  </div>
</div>


<ng-template #groupedView>
  <div class="page__table">
    <div class="table-pagination-preloader">
      <p-table
        #dt
        class="table-full-loading events-reports"
        [rows]="10"
        [value]="eventsReports"
        [globalFilterFields]="['name']"
        selectionMode="single"
        [(selection)]="selectedEventsReport"
      >
        <ng-template pTemplate="header">
          <tr class="bord-all">
            <th rowspan="3" style="width: 5%" class="text-center bord-top bord-left bord-dark">#</th>
            <th rowspan="3" style="width: 15%;" class="bord-dark bord-top sort-label"
                (click)="sorting(searchForm.get('order_by_name').value, 'order_by_name')">
              Company
              <pek-sort-icon [value]="searchForm.get('order_by_name').value"></pek-sort-icon>
            </th>
          </tr>
          <tr class="bord-all">
            <th colspan="5" class="bord text-center dark-two bord-top" style="width: 40%">Last Event</th>
            <th colspan="3" class="bord text-center bord-top dark" style="width: 40%">Future
              Event
            </th>
          </tr>
          <tr>
            <th class="bord text-center dark-two" style="width: 10%">Name</th>
            <th
              class="text-center dark-two sort-label"
              style="width: 10%"
              (click)="sorting(searchForm.get('order_by_date').value, 'order_by_date', false); removeSoring('order_by_date_end')"
            >
              Start Date
              <pek-sort-icon [value]="searchForm.get('order_by_date').value"></pek-sort-icon>
            </th>
            <th
              (click)="sorting(searchForm.get('order_by_date_end').value, 'order_by_date_end', false); removeSoring('order_by_date')"
              class="text-center dark-two sort-label"
              style="width: 10%"
            >
              End Date
              <pek-sort-icon [value]="searchForm.get('order_by_date_end').value"></pek-sort-icon>
            </th>
            <th class="text-center dark-two" style="width: 10%">Comment</th>
            <th class="text-center dark-two" style="width: 10%">Status</th>
            <th class="bord text-center dark" style="width: 10%">Name</th>
            <th
              class="text-center dark sort-label"
              style="width: 10%"
              (click)="sorting(searchForm.get('order_by_next_event_date').value, 'order_by_next_event_date', false); removeSoring('order_by_next_event_date_end')"
            >
              Start Date
              <pek-sort-icon [value]="searchForm.get('order_by_next_event_date').value"></pek-sort-icon>
            </th>
            <th
              class="text-center dark border-right  sort-label"
              style="width: 10%"
              (click)="sorting(searchForm.get('order_by_next_event_date_end').value, 'order_by_next_event_date_end', false); removeSoring('order_by_next_event_date')"
            >
              End Date
              <pek-sort-icon [value]="searchForm.get('order_by_next_event_date_end').value"></pek-sort-icon>
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-report let-i="rowIndex">
          <tr>
            <td style="width: 5%" class="text-center bord-dark">
              <div class="event-item justify-content-center"
                   [class.impression-neutral-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEUTRAL"
                   [class.impression-positive-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.POSITIVE"
                   [class.impression-negative-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEGATIVE">
                {{(this.searchForm.get('page').value - 1) * 10 + i + 1}}
              </div>
            </td>
            <td style="width: 15%" class="table-comment small-comment bord-dark">
              <div class="event-item justify-content-center hovered-info">
                <span
                  [class.impression-neutral-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEUTRAL"
                  [class.impression-positive-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.POSITIVE"
                  [class.impression-negative-text]="searchForm.get('enableColors').value &&
                           report?.lastEventImpressionByFilter === Impression.NEGATIVE">
                  <a [routerLink]="'/crm/business-partners/company-page/' + report.id"
                     target="_blank">{{ report.name }}</a>
                </span>
                <pek-hover-detailed-info-component>
                  <div class="full-comment full-comment_big">
                    <div class="row">
                      <div class="col-md-5">
                        <h4>Name: <i>{{ report.name }}</i></h4>
                        <h4>
                          Category:
                          <i>
                            <ng-container *ngFor="let item of report.categories"
                            >{{ item.name }},
                            </ng-container>
                          </i>
                        </h4>
                        <h4>Address: <i>{{ report.address }}</i></h4>
                        <h4>Email: <i>{{ report.email }}</i></h4>
                        <h4>Phone Number: <i>{{ report.phone_number }}</i></h4>
                        <h4>Website: <i><a [href]="report.website" target="_blank">{{ report.website }}</a></i></h4>
                        <h4>Tax Number: <i>{{ report.tax_number }}</i></h4>
                        <h4>Register Number: <i>{{ report.registration_number }}</i></h4>
                      </div>
                      <div class="col-md-7">
                        <h4>Nomenclature: <i>{{ report.supplier_nomenclature }}</i></h4>
                        <h4>Description: <i>{{ report.comment }}</i></h4>
                        <h4>
                          Country:
                          <span *ngIf="report.country">{{report.country.name}}</span>
                        </h4>

                        <h4>
                          Region:
                          <span *ngIf="report.region">{{report.region.name}}</span>
                        </h4>

                        <h4>
                          Sub Region:
                          <span *ngIf="report.sub_region">{{report.sub_region.name}}</span>
                        </h4>
                        <h4>Connected Companies</h4>
                        <p *ngFor="let linked_company of report.linked_companies">
                          <i>{{ linked_company.name }}</i>
                        </p>
                        <h4>Dont have VAT:
                          <i class="pi pi-check text-success" *ngIf="report.has_not_vat"></i>
                          <i class="pi pi-times text-danger" *ngIf="!report.has_not_vat"></i>
                        </h4>
                      </div>
                    </div>
                  </div>
                </pek-hover-detailed-info-component>
              </div>
            </td>

            <td style="width: 10%" class="text-center bord dark-two no-padding">
              <div class="event-item event-type-name">
                <div class="report-event-group" *ngIf="report.groupedLastEvents && report.groupedLastEvents.length > 0">
                  <div *ngFor="let eventGroup of report.groupedLastEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event pl-1 unhide">
                        <span *ngIf="eventGroup.root_id > -1">
                           <b>
                             <a [routerLink]="'/crm/events/' + eventGroup.root_id"
                                target="_blank">
                               {{eventGroup.label}}
                               {{eventGroup.root_id}}</a>
                          </b>
                        </span>
                      <span *ngIf="eventGroup.root_id === -1">
                          <b>
                               {{eventGroup.label}}
                          </b>
                        </span>

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event hide"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      <a *ngIf="event" class="pl-2" [routerLink]="'/crm/events/' + event.id"
                         target="_blank"
                         [pTooltip]="event ? event.description : 'No Description'"
                         tooltipStyleClass="white-tool-tip"
                         tooltipPosition="right">{{event.event_name}}</a>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td style="width: 10%" class="text-center dark-two no-padding">
              <div class="event-item">
                <div class="report-event-group" *ngIf="report.groupedLastEvents && report.groupedLastEvents.length > 0">
                  <div *ngFor="let eventGroup of report.groupedLastEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event">

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      {{ event?.start | date: "dd/MM/yyyy, HH:mm" }}
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td style="width: 10%" class="text-center dark-two no-padding">
              <div class="event-item">
                <div class="report-event-group" *ngIf="report.groupedLastEvents && report.groupedLastEvents.length > 0">
                  <div *ngFor="let eventGroup of report.groupedLastEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event">

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      {{ event?.end | date: "dd/MM/yyyy, HH:mm" }}
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td style="width: 10%" class="table-comment  text-center dark-two no-padding">
              <div class="event-item">
                <div class="report-event-group" *ngIf="report.groupedLastEvents && report.groupedLastEvents.length > 0">
                  <div *ngFor="let eventGroup of report.groupedLastEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event">

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event hovered-info"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                      <div class="small-comment">
                        <span>
                          {{getSmallComment(event?.event_comment)}}
                        </span>
                        <pek-hover-detailed-info-component
                          [moveLeft]="20"
                          *ngIf="getSmallComment(event?.event_comment)"
                        >
                          <span class="full-comment description-modal">
                            {{event?.event_comment}}
                          </span>
                        </pek-hover-detailed-info-component>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </td>
            <td style="width: 10%" class="text-center dark-two no-padding">
              <div class="event-item">
                <div class="report-event-group" *ngIf="report.groupedLastEvents && report.groupedLastEvents.length > 0">
                  <div *ngFor="let eventGroup of report.groupedLastEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event">

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event"
                         [class.impression-neutral]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEUTRAL"
                         [class.impression-positive]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.POSITIVE"
                         [class.impression-negative]="searchForm.get('enableColors').value && event.is_done
                          && event.impression === Impression.NEGATIVE">
                            <span [ngSwitch]="event?.is_done">
                              <ng-container *ngSwitchCase="true">Done</ng-container>
                              <ng-container *ngSwitchCase="false">Not Done</ng-container>
                            </span>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <!-- FutureEvents -->
            <td style="width: 10%" class="bord text-center dark no-padding">
              <div class="event-item event-type-name">
                <div class="report-event-group">
                  <div *ngFor="let eventGroup of report.groupedNextEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event pl-1 unhide">
                      <!--                          <b>-->
                      <!--                            {{eventGroup.label}}-->
                      <!--                            <a *ngIf="eventGroup.root_id > -1" [routerLink]="'/dash/crm/events-list/event-card/' + eventGroup.root_id"-->
                      <!--                               target="_blank">{{eventGroup.root_id}}-->
                      <!--                            </a>-->
                      <!--                          </b>-->
                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event hide">
                      <a *ngIf="event" class="pl-2" [routerLink]="'/crm/events/' + event.id"
                         target="_blank"
                         [pTooltip]="event ? event.description : 'No Description'"
                         tooltipStyleClass="white-tool-tip"
                         tooltipPosition="right">{{event.event_name}}</a>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td style="width: 10%" class="text-center dark no-padding">
              <div class="event-item">
                <div class="report-event-group">
                  <div *ngFor="let eventGroup of report.groupedNextEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event">

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event">
                        <span *ngIf="event">
                            {{ event?.start | date: "dd/MM/yyyy, HH:mm" }}
                        </span>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            <td style="width: 10%" class="text-center dark border-right no-padding">
              <div class="event-item">
                <div class="report-event-group">
                  <div *ngFor="let eventGroup of report.groupedNextEvents; let index=index"
                       [class]="eventGroup.root_id > -1 ?'row-' + index : ''">
                    <div class="report-event">

                    </div>
                    <div *ngFor="let event of eventGroup.events" class="report-event">
                        <span *ngIf="event">
                          {{ event?.end | date: "dd/MM/yyyy, HH:mm" }}
                        </span>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td class="text-center p-4" [attr.colspan]="12">
              <i *ngIf="isLoading" class="pi pi-spin pi-spinner" style="font-size: 2.25rem"></i>
              <span *ngIf="!isLoading">No Records Found</span>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div class="pagination-preloader pagination-preloader_bord" *ngIf="isLoading">
        <i class="pi pi-spin pi-spinner" style="font-size: 2.25rem"></i>
      </div>
    </div>
    <div
      class="paginator-wrapper"
      *ngIf="!isShowAll"
      [class.hidden]="eventsReports.length === 0"
    >
      <p-paginator
        #paginator
        [rows]="10"
        [totalRecords]="reportsCount"
        (onPageChange)="paginate($event)"
      >
      </p-paginator>
      <p-button
        (click)="onShowAll()"
        class="paginator-all"
        type="button"
        styleClass="p-button-text"
      >
        All
      </p-button>
    </div>

    <div *ngIf="isShowAll" class="paginator-return-pagination">
      <p-button
        type="button"
        (click)="onShowPartial()"
        styleClass="p-button-text"
      >
        Return pagination
      </p-button>
    </div>
  </div>
</ng-template>
