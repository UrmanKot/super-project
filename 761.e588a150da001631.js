"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[761],{761:(St,Y,a)=>{a.r(Y),a.d(Y,{AdministrationModule:()=>Zt});var f=a(6895),R=a(4269),I=a(655),E=a(1135),T=a(3900),F=a(8382),d=a(8505),u=a(4004),z=a(8372),b=a(9300),m=a(9933),e=a(4650),l=a(4006),Q=a(6767),h=a(2340),c=a(6319),C=a(5593),M=a(1740);function K(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"*"),e.qZA())}let D=(()=>{class i{constructor(t,s,o,r){this.fb=t,this.userService=s,this.dialogRef=o,this.data=r,this.isSaving=!1,this.form=this.fb.group({username:["",l.kI.required],email:[""],first_name:[""],last_name:[""]})}ngOnInit(){"edit"===this.data.type?(this.form.addControl("password",this.fb.control("")),this.form.addControl("id",new l.NI(this.data.user.id)),this.form.patchValue(this.data.user),this.form.get("username").disable()):this.form.addControl("password",this.fb.control(null,l.kI.required))}onSave(){switch(this.isSaving=!0,this.data.type){case"create":this.createUser();break;case"edit":this.editUser()}}createUser(){this.userService.createUser(this.form.value).subscribe({next:s=>this.dialogRef.close(!0),error:()=>this.isSaving=!1})}editUser(){const t=this.form.value;t.password||delete t.password,!t.first_name&&!this.data.user.first_name&&delete t.first_name,!t.email&&!this.data.user.email&&delete t.email,!t.last_name&&!this.data.user.last_name&&delete t.last_name,this.userService.editUser(t).subscribe({next:s=>this.dialogRef.close(!0),error:()=>this.isSaving=!1})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.qu),e.Y36(q),e.Y36(c.so),e.Y36(c.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["pek-create-edit-user"]],decls:29,vars:7,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"form-group"],["for","username"],["type","text","id","username","pInputText","","formControlName","username"],["for","password"],[4,"ngIf"],["type","text","id","password","pInputText","","formControlName","password"],["for","email"],["type","text","id","email","pInputText","","formControlName","email"],["for","first_name"],["type","text","id","first_name","pInputText","","formControlName","first_name"],["for","last_name"],["type","text","id","last_name","pInputText","","formControlName","last_name"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.qZA()(),e.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"label",4),e._uU(7,"Username*"),e.qZA(),e._UZ(8,"input",5),e.qZA(),e.TgZ(9,"div",3)(10,"label",6),e._uU(11,"Password"),e.YNc(12,K,2,0,"span",7),e.qZA(),e._UZ(13,"input",8),e.qZA(),e.TgZ(14,"div",3)(15,"label",9),e._uU(16,"E-mail"),e.qZA(),e._UZ(17,"input",10),e.qZA(),e.TgZ(18,"div",3)(19,"label",11),e._uU(20,"First Name"),e.qZA(),e._UZ(21,"input",12),e.qZA(),e.TgZ(22,"div",3)(23,"label",13),e._uU(24,"Last Name"),e.qZA(),e._UZ(25,"input",14),e.qZA()()(),e.TgZ(26,"mat-dialog-actions",15),e._UZ(27,"button",16),e.TgZ(28,"button",17),e.NdJ("click",function(){return s.onSave()}),e.qZA()()),2&t&&(e.xp6(2),e.hij(" ",s.data.type," User "),e.xp6(2),e.Q6J("formGroup",s.form),e.xp6(8),e.Q6J("ngIf","create"===s.data.type),e.xp6(15),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("label",s.data.type)("loading",s.isSaving)("disabled",s.form.invalid))},dependencies:[f.O5,C.Hq,M.o,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,c.ZT,c.xY,c.H8]}),i})();var N=a(8675),O=a(9646),X=a(8746),y=a(4047);let W=(()=>{class i{constructor(t,s,o,r){this.fb=t,this.roleService=s,this.dialogRef=o,this.data=r,this.isSaving=!1,this.form=this.fb.group({name:[null,l.kI.required]})}ngOnInit(){"edit"===this.data.type&&(this.form.addControl("id",new l.NI(this.data.role.id)),this.form.patchValue(this.data.role))}onSave(){switch(this.isSaving=!0,this.data.type){case"create":this.createRole();break;case"edit":this.editRole()}}createRole(){this.roleService.createRole(this.form.value).subscribe({next:s=>this.dialogRef.close(!0),error:()=>this.isSaving=!1})}editRole(){this.roleService.editRole(this.form.value).subscribe({next:s=>this.dialogRef.close(!0),error:()=>this.isSaving=!1})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.qu),e.Y36(P),e.Y36(c.so),e.Y36(c.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["pek-create-edit-role"]],decls:12,vars:6,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"form-group"],["for","name"],["type","text","id","name","pInputText","","formControlName","name"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.qZA()(),e.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"label",4),e._uU(7,"Name*"),e.qZA(),e._UZ(8,"input",5),e.qZA()()(),e.TgZ(9,"mat-dialog-actions",6),e._UZ(10,"button",7),e.TgZ(11,"button",8),e.NdJ("click",function(){return s.onSave()}),e.qZA()()),2&t&&(e.xp6(2),e.hij(" ",s.data.type," Role "),e.xp6(2),e.Q6J("formGroup",s.form),e.xp6(6),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("label",s.data.type)("loading",s.isSaving)("disabled",s.form.invalid))},dependencies:[C.Hq,M.o,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,c.ZT,c.xY,c.H8]}),i})();var ee=a(4128),U=a(529);let te=(()=>{class i{constructor(t){this.httpClient=t,this.API_URL=h.N.base_url+h.N.users_url,this.url="permissions/"}getModulePermissions(t=[]){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+"module_permissions/"+s).pipe((0,u.U)(o=>o.data))}getPermissionsForModules(t,s=[]){let o="";return s&&s.forEach((r,g)=>{o+=g>0?"&"+r.name+"="+r.value:"?"+r.name+"="+r.value}),this.httpClient.get(this.API_URL+"get_permissions_for_module/"+t+"/"+o).pipe((0,u.U)(r=>r.data))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(U.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ie=(()=>{class i{constructor(t){this.httpClient=t,this.API_URL=h.N.base_url+h.N.users_url,this.url="group_sub_module_permissions/"}get(t){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+this.url+s).pipe((0,u.U)(o=>o.data))}updateGroupSubModule(t){return this.httpClient.patch(this.API_URL+this.url+t.id+"/",t).pipe((0,u.U)(s=>s.data))}createGroupSubRole(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,u.U)(s=>s.data))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(U.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),se=(()=>{class i{constructor(t){this.httpClient=t,this.API_URL=h.N.base_url+h.N.users_url,this.url="sub_module_permissions/"}get(t){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+this.url+s).pipe((0,u.U)(o=>o.data))}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(U.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var S=a(805),oe=a(3608),k=a(1989),v=a(5390);function ne(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"Select the modules to be accessed"),e.qZA())}function re(i,n){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij('Edit Permissions of the Role "',t.role.name,'"')}}function ae(i,n){1&i&&(e.TgZ(0,"tr")(1,"th",11),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th",12),e._uU(4,"Name"),e.qZA(),e.TgZ(5,"th",13),e._uU(6,"Description"),e.qZA()())}function le(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",11),e._UZ(2,"p-tableCheckbox",14),e.qZA(),e.TgZ(3,"td",12),e._uU(4),e.qZA(),e.TgZ(5,"td",13),e._uU(6),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function pe(i,n){1&i&&e._UZ(0,"i",17)}function ce(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function de(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",15),e.YNc(2,pe,1,0,"i",16),e.YNc(3,ce,2,0,"span",2),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(1),e.uIk("colspan",3),e.xp6(1),e.Q6J("ngIf",t.isLoadingModulesPermissions),e.xp6(1),e.Q6J("ngIf",!t.isLoadingModulesPermissions)}}function ue(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"p-table",7),e.NdJ("selectionChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedModulesPermission=o)}),e.YNc(2,ae,7,0,"ng-template",8),e.YNc(3,le,7,3,"ng-template",9),e.YNc(4,de,4,3,"ng-template",10),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("value",t.modulesPermission)("selection",t.selectedModulesPermission)("scrollable",!0)}}function me(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",21)(1,"p-checkbox",22),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(3);return e.KtG(r.selectedModules=o)}),e.qZA(),e.TgZ(2,"label",23),e._uU(3),e.qZA()()}if(2&i){const t=n.$implicit,s=e.oxw(3);e.xp6(1),e.Q6J("value",t.id)("ngModel",s.selectedModules),e.xp6(1),e.Q6J("pTooltip",t.description),e.xp6(1),e.Oqu(t.name)}}function ge(i,n){if(1&i&&(e.TgZ(0,"div",19),e.YNc(1,me,4,4,"div",20),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.subModules)}}function he(i,n){1&i&&(e.TgZ(0,"tr")(1,"th",11),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th",24),e._uU(4,"Name"),e.qZA()())}function _e(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",11),e._UZ(2,"p-tableCheckbox",14),e.qZA(),e.TgZ(3,"td",24),e._uU(4),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Oqu(t.name)}}function fe(i,n){1&i&&e._UZ(0,"i",17)}function ve(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function Ce(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",25),e.YNc(2,fe,1,0,"i",16),e.YNc(3,ve,2,0,"span",2),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(1),e.uIk("colspan",6),e.xp6(1),e.Q6J("ngIf",t.isLoadingPermissions),e.xp6(1),e.Q6J("ngIf",!t.isLoadingPermissions)}}function be(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.YNc(1,ge,2,1,"ng-template",18),e.TgZ(2,"p-table",7),e.NdJ("selectionChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedPermissions=o)}),e.YNc(3,he,5,0,"ng-template",8),e.YNc(4,_e,5,2,"ng-template",9),e.YNc(5,Ce,4,3,"ng-template",10),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isQCModulePermissionSelected),e.xp6(1),e.Q6J("value",t.permissions)("selection",t.selectedPermissions)("scrollable",!0)}}function Te(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.goToSelectionPermissions())}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",0===t.selectedModulesPermission.length)("loading",t.isLoadingPermissions)}}function Ze(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveRolePermission())}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("loading",t.isSaving)}}let xe=(()=>{class i{constructor(t,s,o,r,g,p,_){this.fb=t,this.permissionsService=s,this.rolesService=o,this.dialogRef=r,this.groupSubModuleService=g,this.subModulePermissionService=p,this.data=_,this.subModules=[],this.selectedPermissions=[],this.countPermissions=0,this.searchForm=this.fb.group({offset:[0],limit:[1e3]}),this.selectedModulesPermission=[],this.isLoadingModulesPermissions=!0,this.isLoadingPermissions=!1,this.isSelectModulesMode=!0,this.query=[{name:"limit",value:this.searchForm.get("limit").value},{name:"offset",value:this.searchForm.get("offset").value}],this.selectedModules=[],this.isQCModulePermissionSelected=!1,this.isSaving=!1}ngOnInit(){this.role=this.data.role,this.getModules(),this.getSubModuleInfo()}getModules(){this.permissionsService.getModulePermissions([{name:"role_id",value:this.role.id}]).subscribe(s=>{this.modulesPermission=s,this.selectedModulesPermission=s.filter(o=>o?.is_module_permissions_selected_in_role),this.isQCModulePermissionSelected=this.selectedModulesPermission.findIndex(o=>5===o.id)>-1,this.isLoadingModulesPermissions=!1})}getGroupSubModuleInfo(){this.groupSubModuleService.get([{name:"role",value:this.role.id}]).subscribe(t=>{t.length>0&&(this.groupSubModule=t[0],t.forEach(s=>{this.selectedModules.push(...s.module_permission)}))})}getSubModuleInfo(){this.subModulePermissionService.get().subscribe(t=>{this.subModules=t,this.getGroupSubModuleInfo()})}goToSelectionPermissions(){this.isSelectModulesMode=!1,this.getPermissions()}getPermissions(){this.isLoadingPermissions=!0;let t="";this.selectedModulesPermission.forEach(s=>t+=s.id+","),t=t.slice(0,-1),this.isQCModulePermissionSelected=this.selectedModulesPermission.findIndex(s=>5===s.id)>-1,(0,ee.D)({modulesPermissions:this.permissionsService.getPermissionsForModules(t,this.query),rolePermissions:this.rolesService.getRolePermissions(this.role)}).subscribe(({modulesPermissions:s,rolePermissions:o})=>{this.permissions=s.data,this.rolePermissions=o.permissions,this.selectedPermissions=o.permissions,this.isLoadingPermissions=!1})}getModulesPermissions(){this.isLoadingPermissions=!0;let t="";this.selectedModulesPermission.forEach(s=>t+=s.id+","),t=t.slice(0,-1),this.permissionsService.getPermissionsForModules(t,this.query).subscribe(s=>{this.permissions=s.data,this.countPermissions=s.total,this.isLoadingPermissions=!1})}getRolePermissions(){this.rolesService.getRolePermissions(this.role).subscribe(t=>{this.selectedPermissions=t.permissions})}saveRolePermission(){const t=JSON.parse(JSON.stringify(this.rolePermissions));this.selectedPermissions.forEach(p=>{const _=t.findIndex(J=>J.id===p.id);-1!==_?t.splice(_,1):t.push(p)});const s={permissions_ids:"",modules_ids:""},o={permissions_ids:"",modules_ids:""};t.forEach(p=>{this.rolePermissions.find(_=>_.id===p.id)?o.permissions_ids+=p.id+",":s.permissions_ids+=p.id+","}),s.permissions_ids=s.permissions_ids.slice(0,-1),s.modules_ids=this.selectedModulesPermission.map(p=>p.id).join(","),o.permissions_ids=o.permissions_ids.slice(0,-1),o.modules_ids=this.selectedModulesPermission.map(p=>p.id).join(",");const r=[];this.permissions.forEach(p=>{this.selectedPermissions.find(_=>_.id===p.id)&&r.push(p)});const g={modules_ids:this.selectedModulesPermission.map(p=>p.id)};0===r.length&&this.rolesService.removeModuleFromRole(this.role.id,g).subscribe(),s.permissions_ids&&this.addPermissions(s),o.permissions_ids&&this.removePermissions(o),this.isQCModulePermissionSelected&&this.updateRoleSubModulePermission()}addPermissions(t){this.isSaving=!0,this.rolesService.setRolePermissions(this.role,t).subscribe(()=>{this.dialogRef.close(!0),this.isSaving=!1})}removePermissions(t){this.isSaving=!0,this.rolesService.removeRolePermissions(this.role,t).subscribe(()=>{this.dialogRef.close(!0),this.isSaving=!1})}searchPermissions(){this.query=[{name:"limit",value:this.searchForm.get("limit").value},{name:"offset",value:this.searchForm.get("offset").value}],this.permissions=[],this.getModulesPermissions()}paginate(t){this.searchForm.get("limit").patchValue(10*t.page),this.searchPermissions()}updateRoleSubModulePermission(){const t={id:null,role:this.role.id,module_permission:this.selectedModules};this.isSaving=!0,this.groupSubModule?(t.id=this.groupSubModule.id,this.groupSubModuleService.updateGroupSubModule(t).subscribe(()=>{this.isSaving=!1,this.dialogRef.close(!0)})):this.groupSubModuleService.createGroupSubRole(t).subscribe(()=>{this.dialogRef.close(!0),this.isSaving=!1})}onSave(){}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.qu),e.Y36(te),e.Y36(P),e.Y36(c.so),e.Y36(ie),e.Y36(se),e.Y36(c.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["pek-edit-role-permissions"]],decls:11,vars:7,consts:[[1,"modal-header"],[1,"modal-header__title"],[4,"ngIf"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","label","Further",3,"disabled","loading","click",4,"ngIf"],["pButton","","type","button","class","p-button-success","label","Save",3,"loading","click",4,"ngIf"],["dataKey","id","responsiveLayout","scroll","scrollHeight","calc(400px)",3,"value","selection","scrollable","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","6%"],[2,"width","44%"],[2,"width","50%"],[3,"value"],[1,"text-center","p-3",2,"width","100%"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[3,"ngIf"],[1,"sub-modules-view"],["class","field-checkbox sub-modules",4,"ngFor","ngForOf"],[1,"field-checkbox","sub-modules"],["name","subModules",3,"value","ngModel","ngModelChange"],[3,"pTooltip"],[2,"width","94%"],[1,"text-center","p-4"],["pButton","","label","Further",3,"disabled","loading","click"],["pButton","","type","button","label","Save",1,"p-button-success",3,"loading","click"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e.YNc(2,ne,2,0,"span",2),e.YNc(3,re,2,1,"span",2),e.qZA()(),e.TgZ(4,"mat-dialog-content"),e.YNc(5,ue,5,3,"div",2),e.YNc(6,be,6,4,"div",2),e.qZA(),e.TgZ(7,"mat-dialog-actions",3),e._UZ(8,"button",4),e.YNc(9,Te,1,2,"button",5),e.YNc(10,Ze,1,1,"button",6),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngIf",s.isSelectModulesMode),e.xp6(1),e.Q6J("ngIf",!s.isSelectModulesMode),e.xp6(2),e.Q6J("ngIf",s.isSelectModulesMode),e.xp6(1),e.Q6J("ngIf",!s.isSelectModulesMode),e.xp6(2),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("ngIf",s.isSelectModulesMode),e.xp6(1),e.Q6J("ngIf",!s.isSelectModulesMode))},dependencies:[f.sg,f.O5,C.Hq,S.jx,l.JJ,oe.u,c.ZT,c.xY,c.H8,l.On,k.XZ,v.iA,v.UA,v.Mo],styles:[".sub-modules-view[_ngcontent-%COMP%]{margin-bottom:1rem}.field-checkbox[_ngcontent-%COMP%]{margin-bottom:.75rem;display:flex;align-items:center}.field-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-left:.5rem}"]}),i})(),P=(()=>{class i{constructor(t,s){this.httpClient=t,this.dialog=s,this.API_URL=h.N.base_url+h.N.users_url,this.url="roles/"}getForPagination(t=[]){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+this.url+s).pipe((0,u.U)(o=>o.data))}getRoles(t=[]){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+this.url+s).pipe((0,u.U)(o=>o.data))}getRolePermissions(t){return this.httpClient.get(this.API_URL+"get_role_permissions/"+t.id+"/").pipe((0,u.U)(s=>s.data))}setRolePermissions(t,s){return this.httpClient.post(this.API_URL+"role_set_permissions/"+t.id+"/",s)}removeRolePermissions(t,s){return this.httpClient.post(this.API_URL+"role_remove_permissions/"+t.id+"/",s)}removeModuleFromRole(t,s){return this.httpClient.post(this.API_URL+`remove_module_from_role/${t}/`,s)}createRole(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,u.U)(s=>s.data))}editRole(t){return this.httpClient.patch(this.API_URL+this.url+t.id+"/",t).pipe((0,u.U)(s=>s.data))}deleteRole(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}createEditRoleModal(t,s){return this.dialog.open(W,{width:"30rem",height:"auto",data:{type:t,role:s},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}editRolePermissions(t){return this.dialog.open(xe,{width:"40rem",height:"auto",data:{role:t},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(U.eN),e.LFG(c.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ae=a(5151),Ue=a(6106),ye=a(7217),Se=a(7943);let Pe=(()=>{class i{constructor(t,s){this.httpClient=t,this.dialog=s,this.API_URL=h.N.base_url+h.N.business_trips_url,this.url="business-trips-permissions/"}get(t){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+this.url+s).pipe((0,u.U)(o=>o.data))}update(t,s){return this.httpClient.patch(this.API_URL+"update_business_trip_employee_permissions/"+t+"/",s)}update_verify_permission(t,s){return this.httpClient.patch(this.API_URL+"update_business_trip_verification_permissions/"+t+"/",s)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(U.eN),e.LFG(c.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Re=a(9038),Ie=a(2899),L=a(1997),Ee=a(5722),B=a(6186);function Me(i,n){1&i&&(e.TgZ(0,"tr")(1,"th",25),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th",26),e._uU(4,"Name"),e.qZA()())}function Ne(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"p-tableCheckbox",27),e.qZA(),e.TgZ(3,"td",26),e._uU(4),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.Q6J("value",t),e.xp6(2),e.Oqu(t.name)}}function Le(i,n){1&i&&e._UZ(0,"i",31)}function qe(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function Je(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",28),e.YNc(2,Le,1,0,"i",29),e.YNc(3,qe,2,0,"span",30),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.uIk("colspan",10),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function we(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"p-paginator",32,33),e.NdJ("onPageChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.paginate(o))}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("rows",10)("totalRecords",t.count)}}function Ye(i,n){if(1&i&&e._UZ(0,"p-multiSelect",34),2&i){const t=e.oxw();e.Q6J("options",t.categories)}}function Fe(i,n){if(1&i&&e._UZ(0,"p-multiSelect",35),2&i){const t=e.oxw();e.Q6J("options",t.eventTypes)}}function Qe(i,n){if(1&i&&e._UZ(0,"p-multiSelect",36),2&i){const t=e.oxw();e.Q6J("options",t.externalEventTypes)}}function Oe(i,n){if(1&i&&(e.TgZ(0,"div",39)(1,"div"),e._uU(2),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.AsE("",t.first_name," ",t.last_name,"")}}function ke(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"p-multiSelect",37),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.businessTripEmployeesIds=o)}),e.YNc(1,Oe,3,2,"ng-template",38),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("options",t.employees)("ngModel",t.businessTripEmployeesIds)}}function Ge(i,n){if(1&i&&e._UZ(0,"p-treeSelect",40),2&i){const t=e.oxw();e.Q6J("options",t.incomingCategoriesTree)}}function Be(i,n){if(1&i&&e._UZ(0,"p-treeSelect",41),2&i){const t=e.oxw();e.Q6J("options",t.outgoingCategoriesTree)}}function $e(i,n){1&i&&(e.TgZ(0,"div",42),e._UZ(1,"i",43),e.qZA())}const $=function(){return{standalone:!0}};let Z=class{constructor(n,t,s,o,r,g,p,_,J,xt,At,Ut,yt){this.fb=n,this.userService=t,this.roleService=s,this.eventTypesService=o,this.treeService=r,this.companyCategoryService=g,this.categoryService=p,this.businessTripPermissionService=_,this.crmEmployeeService=J,this.correspondentsCategoriesService=xt,this.adapterService=At,this.dialogRef=Ut,this.data=yt,this.isSaving=!1,this.isLoading=!1,this.selectedRoles=[],this.form=this.fb.group({categories:[[]],eventTypes:[[]],externalEventTypes:[[]],incomingCorrespondentCategoryPermissions:[[]],outgoingCorrespondentCategoryPermissions:[[]]}),this.currentPage=1,this.count=0,this.search$=new E.X(null),this.query=[],this.isLoadingEventTypes=!0,this.isLoadingExternalEventTypes=!0,this.isLoadingCategories=!0,this.isLoadingPermissions=!0,this.isLoadingEmployees=!0,this.isLoadingIncomingCategories=!0,this.isLoadingOutgoingCategories=!0,this.incomingCategoriesTree=[],this.outgoingCategoriesTree=[],this.incomingIds=[],this.outgoingIds=[],this.roles$=this.search$.pipe((0,d.b)(()=>this.isLoading=!0),(0,T.w)(()=>this.roleService.getForPagination([{name:"page",value:this.currentPage}]).pipe((0,d.b)(w=>this.count=w.count),(0,u.U)(w=>w.results),(0,d.b)(()=>this.isLoading=!1),(0,N.O)([]),(0,m.t)(this))),(0,m.t)(this)),this.employees=[],this.canVerifyTripExpenses=!1,this.canAcceptChangesOnImport=!1}ngOnInit(){this.canVerifyTripExpenses=this.data.user.can_verify_expenses,this.canAcceptChangesOnImport=this.data.user.can_accept_changes_on_import,this.data.user.groups.forEach(n=>this.selectedRoles.push({id:n.id})),this.form.get("categories").patchValue(this.data.user.company_categories.map(n=>n.id)),this.getEventTypes(),this.getExternalEventTypes(),this.getCategories(),this.getPermissions(),this.getEmployees(),this.getIncomingCategories(),this.getOutgoingCategories(),this.prepareCorrespondentCategories()}onSave(){const n={group_ids:[]};n.group_ids=this.selectedRoles.map(t=>t.id),this.isSaving=!0,this.userService.addRoleToUser(this.data.user.id,n).pipe((0,T.w)(()=>this.saveCategoriesPermissions()),(0,T.w)(()=>this.updateBusinessTripPermissions()),(0,T.w)(()=>this.updateBusinessTripVerifyPermissions()),(0,T.w)(()=>this.updateCanAcceptChangesOnImportPermissions()),(0,X.x)(()=>this.isSaving=!1)).subscribe(()=>{this.dialogRef.close(!0)})}updateBusinessTripVerifyPermissions(){return this.data.user.can_verify_expenses!==this.canVerifyTripExpenses?this.businessTripPermissionService.update_verify_permission(this.data.user.id,{can_verify:this.canVerifyTripExpenses}):(0,O.of)(!0)}updateCanAcceptChangesOnImportPermissions(){return this.data.user.can_accept_changes_on_import!==this.canAcceptChangesOnImport?this.userService.update_can_verify_import(this.data.user.id,{can_accept:this.canAcceptChangesOnImport}):(0,O.of)(!0)}saveCategoriesPermissions(){const s=[...this.form.get("eventTypes").value,...this.form.get("externalEventTypes").value],g=[...this.form.get("incomingCorrespondentCategoryPermissions").value,...this.form.get("outgoingCorrespondentCategoryPermissions").value],p={id:this.data.user.id,companycategory_set:this.form.get("categories").value,eventtype_set:s,correspondentcategory_set:g.map(_=>_.data.id)};return this.userService.editUserPermissions(p)}updateBusinessTripPermissions(){return this.businessTripPermissionService.update(this.data.user.id,{employees_ids:this.businessTripEmployeesIds?this.businessTripEmployeesIds:[]})}getIncomingCategories(){this.correspondentsCategoriesService.get([{name:"type",value:y.c.INCOMING}]).pipe((0,m.t)(this)).subscribe(n=>{const t=s=>{s.forEach(o=>{o.label=o.data.name,o.children?.length&&t(o.children)})};this.incomingCategoriesTree=this.adapterService.treeAdapter(n,!1,!1,!0),t(this.incomingCategoriesTree),this.choiceIncomingCategories(this.incomingIds),this.isLoadingIncomingCategories=!1})}getOutgoingCategories(){this.correspondentsCategoriesService.get([{name:"type",value:y.c.OUTGOING}]).pipe((0,m.t)(this)).subscribe(n=>{const t=s=>{s.forEach(o=>{o.label=o.data.name,o.children?.length&&t(o.children)})};this.outgoingCategoriesTree=this.adapterService.treeAdapter(n,!1,!1,!0),t(this.outgoingCategoriesTree),this.choiceOutgoingCategories(this.outgoingIds),this.isLoadingOutgoingCategories=!1})}choiceIncomingCategories(n){const t=[];function s(o,r){if(o.data.id===r)return t.push(o),o;if(o.children){let g=null;o.children.forEach(p=>{g=s(p,r)})}return null}n.forEach(o=>{this.incomingCategoriesTree.forEach(r=>{s(r,o)})}),this.incomingCategoriesTree=this.incomingCategoriesTree.map(o=>o),this.form.get("incomingCorrespondentCategoryPermissions").patchValue(t)}choiceOutgoingCategories(n){const t=[];function s(o,r){if(o.data.id===r)return t.push(o),o;if(o.children){let g=null;o.children.forEach(p=>{g=s(p,r)})}return null}n.forEach(o=>{this.outgoingCategoriesTree.forEach(r=>{s(r,o)})}),this.outgoingCategoriesTree=this.outgoingCategoriesTree.map(o=>o),this.form.get("outgoingCorrespondentCategoryPermissions").patchValue(t)}prepareCorrespondentCategories(){const n=this.data.user.correspondent_category_permissions.filter(s=>s.type===y.c.OUTGOING).map(s=>s.id),t=this.data.user.correspondent_category_permissions.filter(s=>s.type===y.c.INCOMING).map(s=>s.id);this.incomingIds=t,this.outgoingIds=n}getPermissions(){this.businessTripPermissionService.get([{name:"user_id",value:this.data.user.id}]).pipe((0,m.t)(this)).subscribe(n=>{this.businessTripEmployeesIds=n.map(t=>t.employee),this.isLoadingPermissions=!1})}getEmployees(){this.crmEmployeeService.get().pipe((0,m.t)(this)).subscribe(n=>{this.employees=n,this.isLoadingEmployees=!1})}getCategories(){this.companyCategoryService.get().pipe((0,m.t)(this)).subscribe(n=>{this.categories=n,this.isLoadingCategories=!1})}getEventTypes(){this.eventTypesService.getNoneCache([{name:"is_inner",value:!0}]).pipe((0,m.t)(this)).subscribe(n=>{this.eventTypes=n;const t=this.data.user.event_types.filter(s=>n.findIndex(o=>o.id===s.id)>=0);this.form.get("eventTypes").patchValue(t.map(s=>s.id)),this.isLoadingEventTypes=!1})}getExternalEventTypes(){this.eventTypesService.getNoneCache([{name:"is_inner",value:!1}]).pipe((0,m.t)(this)).subscribe(n=>{this.externalEventTypes=n;const t=this.data.user.event_types.filter(s=>n.findIndex(o=>o.id===s.id)>=0);this.form.get("externalEventTypes").patchValue(t.map(s=>s.id)),this.isLoadingExternalEventTypes=!1})}paginate(n){this.currentPage=n.page+1,this.search$.next()}};Z.\u0275fac=function(n){return new(n||Z)(e.Y36(l.qu),e.Y36(q),e.Y36(P),e.Y36(Ae.B),e.Y36(Ue.r),e.Y36(ye.v),e.Y36(Se.G),e.Y36(Pe),e.Y36(Re.R),e.Y36(Ie.n),e.Y36(Q.v),e.Y36(c.so),e.Y36(c.WI))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["pek-edit-user-roles"]],decls:65,vars:29,consts:[[1,"modal-header"],[1,"modal-header__title"],["dataKey","id","responsiveLayout","scroll",3,"value","selection","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"rows","totalRecords","onPageChange",4,"ngIf"],[3,"formGroup"],[1,"mt-4","mb-2"],[1,"row"],[1,"col-12"],[1,"form-group"],["optionLabel","name","optionValue","id","formControlName","categories","appendTo","body",3,"options",4,"ngIf","ngIfElse"],["appendTo","body","optionLabel","name","optionValue","id","formControlName","eventTypes",3,"options",4,"ngIf","ngIfElse"],["appendTo","body","optionLabel","name","optionValue","id","formControlName","externalEventTypes",3,"options",4,"ngIf","ngIfElse"],["optionValue","id","optionLabel","first_name","appendTo","body",3,"options","ngModel","ngModelChange",4,"ngIf","ngIfElse"],["for","other"],["id","other",3,"ngModel","binary","ngModelOptions","ngModelChange"],["appendTo","body","label","name","formControlName","incomingCorrespondentCategoryPermissions","selectionMode","checkbox","placeholder","Select Categories",3,"options",4,"ngIf","ngIfElse"],["appendTo","body","label","name","formControlName","outgoingCorrespondentCategoryPermissions","selectionMode","checkbox","placeholder","Select Categories",3,"options",4,"ngIf","ngIfElse"],["id","canAcceptChanges",3,"ngModel","binary","ngModelOptions","ngModelChange"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button","label","Save",1,"p-button-success",3,"loading","click"],["spinner",""],[2,"width","3rem"],[2,"width","100%"],[3,"value"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["optionLabel","name","optionValue","id","formControlName","categories","appendTo","body",3,"options"],["appendTo","body","optionLabel","name","optionValue","id","formControlName","eventTypes",3,"options"],["appendTo","body","optionLabel","name","optionValue","id","formControlName","externalEventTypes",3,"options"],["optionValue","id","optionLabel","first_name","appendTo","body",3,"options","ngModel","ngModelChange"],["pTemplate","item"],[1,"contact-item"],["appendTo","body","label","name","formControlName","incomingCorrespondentCategoryPermissions","selectionMode","checkbox","placeholder","Select Categories",3,"options"],["appendTo","body","label","name","formControlName","outgoingCorrespondentCategoryPermissions","selectionMode","checkbox","placeholder","Select Categories",3,"options"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2," Edit Roles "),e.qZA()(),e.TgZ(3,"mat-dialog-content")(4,"p-table",2),e.NdJ("selectionChange",function(o){return t.selectedRoles=o}),e.ALo(5,"async"),e.YNc(6,Me,5,0,"ng-template",3),e.YNc(7,Ne,5,2,"ng-template",4),e.YNc(8,Je,4,3,"ng-template",5),e.qZA(),e.YNc(9,we,2,2,"p-paginator",6),e.TgZ(10,"form",7)(11,"h3",8),e._uU(12,"Company Categories & Event Types Permissions"),e.qZA(),e.TgZ(13,"div",9)(14,"div",10)(15,"div",11)(16,"label"),e._uU(17,"Company Categories"),e.qZA(),e.YNc(18,Ye,1,1,"p-multiSelect",12),e.qZA()(),e.TgZ(19,"div",10)(20,"div",11)(21,"label"),e._uU(22,"Event Types"),e.qZA(),e.YNc(23,Fe,1,1,"p-multiSelect",13),e.qZA()(),e.TgZ(24,"div",10)(25,"div",11)(26,"label"),e._uU(27,"External Event Types"),e.qZA(),e.YNc(28,Qe,1,1,"p-multiSelect",14),e.qZA()()()(),e.TgZ(29,"h3",8),e._uU(30,"Business Trips Employee Permissions"),e.qZA(),e.TgZ(31,"div",9)(32,"div",10)(33,"div",11)(34,"label"),e._uU(35,"Employee Business Trips"),e.qZA(),e.YNc(36,ke,2,2,"p-multiSelect",15),e.qZA(),e.TgZ(37,"div",11)(38,"label",16),e._uU(39,"Allow Verify Expenses"),e.qZA(),e.TgZ(40,"p-checkbox",17),e.NdJ("ngModelChange",function(o){return t.canVerifyTripExpenses=o}),e.qZA()()()(),e.TgZ(41,"h3",8),e._uU(42,"Correspondent Incoming Categories"),e.qZA(),e.TgZ(43,"div",9)(44,"form",7)(45,"div",10)(46,"div",11)(47,"label"),e._uU(48,"Correspondent Incoming Categories"),e.qZA(),e.YNc(49,Ge,1,1,"p-treeSelect",18),e.qZA()(),e.TgZ(50,"div",10)(51,"div",11)(52,"label"),e._uU(53,"Correspondent Outgoing Categories"),e.qZA(),e.YNc(54,Be,1,1,"p-treeSelect",19),e.qZA()()(),e.TgZ(55,"div",10)(56,"div",11)(57,"label",16),e._uU(58,"Can Accept Changes On Import"),e.qZA(),e.TgZ(59,"p-checkbox",20),e.NdJ("ngModelChange",function(o){return t.canAcceptChangesOnImport=o}),e.qZA()()()()(),e.TgZ(60,"mat-dialog-actions",21),e._UZ(61,"button",22),e.TgZ(62,"button",23),e.NdJ("click",function(){return t.onSave()}),e.qZA()(),e.YNc(63,$e,2,0,"ng-template",null,24,e.W1O)),2&n){const s=e.MAs(64);e.xp6(4),e.Q6J("value",e.lcZ(5,25,t.roles$))("selection",t.selectedRoles),e.xp6(5),e.Q6J("ngIf",t.count),e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(8),e.Q6J("ngIf",!t.isLoadingCategories)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",!t.isLoadingEventTypes)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",!t.isLoadingExternalEventTypes)("ngIfElse",s),e.xp6(8),e.Q6J("ngIf",!t.isLoadingEmployees&&!t.isLoadingPermissions)("ngIfElse",s),e.xp6(4),e.Q6J("ngModel",t.canVerifyTripExpenses)("binary",!0)("ngModelOptions",e.DdM(27,$)),e.xp6(4),e.Q6J("formGroup",t.form),e.xp6(5),e.Q6J("ngIf",!t.isLoadingIncomingCategories)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",!t.isLoadingOutgoingCategories)("ngIfElse",s),e.xp6(5),e.Q6J("ngModel",t.canAcceptChangesOnImport)("binary",!0)("ngModelOptions",e.DdM(28,$)),e.xp6(2),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("loading",t.isSaving)}},dependencies:[f.O5,C.Hq,S.jx,l._Y,l.JJ,l.JL,l.sg,l.u,c.ZT,c.xY,c.H8,l.On,k.XZ,v.iA,v.UA,v.Mo,L.D,Ee.NU,B.mP,f.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500;font-size:1.125rem}"]}),Z=(0,I.gn)([(0,m.c)()],Z);let q=(()=>{class i{constructor(t,s){this.httpClient=t,this.dialog=s,this.API_URL=h.N.base_url+h.N.users_url,this.url="users/"}getForPagination(t=[]){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+"users_with_groups/"+s).pipe((0,u.U)(o=>o.data))}get(t=[]){let s="";return t&&t.forEach((o,r)=>{s+=r>0?"&"+o.name+"="+o.value:"?"+o.name+"="+o.value}),this.httpClient.get(this.API_URL+"users_with_groups/"+s).pipe((0,u.U)(o=>o.data))}createUser(t){return this.httpClient.post(this.API_URL+"user_registration/",t).pipe((0,u.U)(s=>s.data))}editUser(t){return this.httpClient.patch(this.API_URL+"user_update/"+t.id+"/",t).pipe((0,u.U)(s=>s.data))}editUserPermissions(t){return this.httpClient.patch(this.API_URL+"users/"+t.id+"/",t).pipe((0,u.U)(s=>s.data))}deleteUser(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}addRoleToUser(t,s){return this.httpClient.post(this.API_URL+"add_role_to_user/"+t+"/",s).pipe((0,u.U)(o=>o.data))}update_can_verify_import(t,s){return this.httpClient.patch(this.API_URL+"can_accept_changes_on_import/"+t+"/",s)}createEditUserModal(t,s){return this.dialog.open(D,{width:"30rem",height:"auto",data:{type:t,user:s},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}editUserRoles(t){return this.dialog.open(Z,{width:"40rem",height:"auto",data:{user:t},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(U.eN),e.LFG(c.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var H=a(7427),V=a(615),j=a(3237);const He=["paginator"];function Ve(i,n){1&i&&(e.TgZ(0,"p",33),e._uU(1,"Choose the Role to edit"),e.qZA())}function je(i,n){1&i&&(e.TgZ(0,"tr")(1,"th",34),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",35),e._uU(4,"Username"),e.qZA(),e.TgZ(5,"th",36),e._uU(6,"Email"),e.qZA(),e.TgZ(7,"th",36),e._uU(8,"First Name"),e.qZA(),e.TgZ(9,"th",36),e._uU(10,"Last Name"),e.qZA(),e.TgZ(11,"th",36),e._uU(12,"Roles"),e.qZA()())}function ze(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,","),e.qZA())}function Ke(i,n){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,ze,2,0,"span",39),e.qZA()),2&i){const t=n.$implicit,s=n.index,o=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.name,""),e.xp6(1),e.Q6J("ngIf",s!==o.groups.length-1)}}function De(i,n){if(1&i&&(e.TgZ(0,"tr",37)(1,"td",34),e._uU(2),e.qZA(),e.TgZ(3,"td",35),e._uU(4),e.qZA(),e.TgZ(5,"td",36),e._uU(6),e.qZA(),e.TgZ(7,"td",36),e._uU(8),e.qZA(),e.TgZ(9,"td",36),e._uU(10),e.qZA(),e.TgZ(11,"td",36),e.YNc(12,Ke,3,2,"span",38),e.qZA()()),2&i){const t=n.$implicit,s=n.rowIndex,o=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(10*(o.currentPage-1)+s+1),e.xp6(2),e.Oqu(t.username),e.xp6(2),e.Oqu(t.email),e.xp6(2),e.Oqu(t.first_name),e.xp6(2),e.Oqu(t.last_name),e.xp6(2),e.Q6J("ngForOf",t.groups)}}function Xe(i,n){1&i&&e._UZ(0,"i",42)}function We(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function et(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",40),e.YNc(2,Xe,1,0,"i",41),e.YNc(3,We,2,0,"span",39),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.uIk("colspan",10),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function tt(i,n){1&i&&(e.TgZ(0,"div",43),e._UZ(1,"i",42),e.qZA())}function it(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",44)(1,"p-paginator",45,46),e.NdJ("onPageChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.paginate(o))}),e.qZA(),e.TgZ(3,"p-button",47),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onShowAll(!0))}),e._uU(4," All "),e.qZA()()}if(2&i){const t=e.oxw();e.ekj("paginator-wrapper_hide",0===t.count),e.xp6(1),e.Q6J("rows",10)("totalRecords",t.count)}}function st(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",48)(1,"p-button",49),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onShowAll(!1))}),e._uU(2," Return pagination "),e.qZA()()}}let x=class{constructor(n,t,s,o){this.fb=n,this.adapterService=t,this.userService=s,this.modalService=o,this.searchForm=this.fb.group({username:[""],email:[""],first_name:[""],last_name:[""]}),this.menuItems=[{label:"Selected User",items:[{label:"Edit User",icon:"pi pi-user-edit",command:()=>this.editUser()},{label:"Edit Permissions",icon:"pi pi-pencil",command:()=>this.editUserPermissions()},{label:"Remove",icon:"pi pi-trash",command:()=>this.removeUser()}]}],this.currentPage=1,this.queryKey=this.adapterService.generateQueryKey(this.searchForm),this.isLoading=!0,this.count=0,this.isStartFirstPage=!1,this.isShowAll=!1,this.selectedUser=null,this.search$=new E.X(null),this.query=[],this.users$=this.search$.pipe((0,d.b)(()=>this.prepareForSearch()),(0,T.w)(()=>(0,F.s)(()=>!this.isShowAll,this.userService.getForPagination(this.query).pipe((0,d.b)(r=>this.count=r.count),(0,u.U)(r=>r.results)),this.userService.get(this.query).pipe((0,d.b)(r=>this.count=r.length)))),(0,d.b)(()=>this.paginateToFistPage()),(0,d.b)(()=>this.isLoading=!1),(0,m.t)(this))}ngOnInit(){this.searchForm.valueChanges.pipe((0,z.b)(150),(0,m.t)(this)).subscribe(()=>this.search$.next())}prepareForSearch(){this.isLoading=!0,this.selectedUser=null;const n=this.adapterService.generateQueryKey(this.searchForm);n!==this.queryKey&&(this.currentPage=1,this.queryKey=n,this.isStartFirstPage=!0),this.query=[{name:"page",value:this.currentPage}],this.isShowAll||this.query.push({name:"paginated",value:!0});for(const t in this.searchForm.controls)this.searchForm.controls[t].value&&this.query.push({name:t,value:this.searchForm.controls[t].value})}paginate(n){this.isStartFirstPage||(this.currentPage=n.page+1,this.search$.next())}paginateToFistPage(){this.isStartFirstPage&&this.paginator?.changePage(0),this.isStartFirstPage=!1}onShowAll(n){this.isShowAll=n,this.isShowAll||(this.currentPage=1),this.search$.next()}createUser(){this.userService.createEditUserModal("create").pipe((0,b.h)(Boolean),(0,d.b)(()=>this.search$.next())).subscribe()}editUser(){this.userService.createEditUserModal("edit",this.selectedUser).pipe((0,b.h)(Boolean),(0,d.b)(()=>this.search$.next())).subscribe()}editUserPermissions(){this.userService.editUserRoles(this.selectedUser).pipe((0,b.h)(Boolean),(0,d.b)(()=>this.search$.next())).subscribe()}removeUser(){this.modalService.confirm("danger").pipe((0,b.h)(Boolean)).subscribe(()=>{this.userService.deleteUser(this.selectedUser).pipe((0,d.b)(()=>this.search$.next())).subscribe()})}};x.\u0275fac=function(n){return new(n||x)(e.Y36(l.qu),e.Y36(Q.v),e.Y36(q),e.Y36(H.Z))},x.\u0275cmp=e.Xpm({type:x,selectors:[["pek-administration-user-list"]],viewQuery:function(n,t){if(1&n&&e.Gf(He,5),2&n){let s;e.iGM(s=e.CRH())&&(t.paginator=s.first)}},decls:46,vars:16,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-user-plus","label","Create User",3,"click"],[1,"page__content"],[1,"page__card"],[1,"form","mb-3",3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],["for","username"],["id","username","type","text","pInputText","","formControlName","username",1,"form-control"],["for","email"],["id","email","type","text","pInputText","","formControlName","email",1,"form-control"],["for","first_name"],["id","first_name","type","text","pInputText","","formControlName","first_name",1,"form-control"],["for","last_name"],["id","last_name","type","text","pInputText","","formControlName","last_name",1,"form-control"],[1,"col-12"],[1,"d-flex","mt-1"],["class","subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],[1,"table-pagination-preloader"],["selectionMode","single","scrollHeight","calc(100vh - 27rem)",3,"rows","scrollable","selection","value","selectionChange"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","pagination-preloader pagination-preloader_bord",4,"ngIf"],["class","paginator-wrapper",3,"paginator-wrapper_hide",4,"ngIf"],["class","paginator-return-pagination",4,"ngIf"],[1,"subtitle"],[1,"text-center",2,"width","5%"],[2,"width","15%"],[2,"width","20%"],[3,"pSelectableRow"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"pagination-preloader","pagination-preloader_bord"],[1,"paginator-wrapper"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["type","button","styleClass","p-button-text",1,"paginator-all",3,"click"],[1,"paginator-return-pagination"],["type","button","styleClass","p-button-text",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5,"Users List"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return t.createUser()}),e.qZA()()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"form",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"label",12),e._uU(15,"Username"),e.qZA(),e._UZ(16,"input",13),e.qZA()(),e.TgZ(17,"div",10)(18,"div",11)(19,"label",14),e._uU(20,"E-mail"),e.qZA(),e._UZ(21,"input",15),e.qZA()(),e.TgZ(22,"div",10)(23,"div",11)(24,"label",16),e._uU(25,"First Name"),e.qZA(),e._UZ(26,"input",17),e.qZA()(),e.TgZ(27,"div",10)(28,"div",11)(29,"label",18),e._uU(30,"Last Name"),e.qZA(),e._UZ(31,"input",19),e.qZA()(),e.TgZ(32,"div",20)(33,"div",21),e.YNc(34,Ve,2,0,"p",22),e._UZ(35,"p-menubar",23),e.qZA()()()(),e.TgZ(36,"div",24)(37,"p-table",25,26),e.NdJ("selectionChange",function(o){return t.selectedUser=o}),e.ALo(39,"async"),e.YNc(40,je,13,0,"ng-template",27),e.YNc(41,De,13,7,"ng-template",28),e.YNc(42,et,4,3,"ng-template",29),e.qZA(),e.YNc(43,tt,2,0,"div",30),e.YNc(44,it,5,4,"div",31),e.qZA(),e.YNc(45,st,3,0,"div",32),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("module","administration")("isActive",!0),e.xp6(7),e.Q6J("formGroup",t.searchForm),e.xp6(24),e.Q6J("ngIf",!t.selectedUser),e.xp6(1),e.ekj("disabled",!t.selectedUser),e.Q6J("model",t.menuItems),e.xp6(2),e.Q6J("rows",10)("scrollable",!0)("selection",t.selectedUser)("value",e.lcZ(39,14,t.users$)),e.xp6(6),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isShowAll),e.xp6(1),e.Q6J("ngIf",t.isShowAll))},dependencies:[f.sg,f.O5,C.Hq,C.zx,M.o,S.jx,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,V.nm,v.iA,v.Ei,j.D,L.D,f.Ov],styles:["form[_ngcontent-%COMP%]{margin-top:-.25rem}"]}),x=(0,I.gn)([(0,m.c)()],x);var ot=a(8234),nt=a(9293);let rt=(()=>{class i{constructor(t){this.productStructureCategoryService=t,this.routes=[{label:"User List",commands:["user-list"]},{label:"Roles",commands:["roles"]},{label:"Sales Chain",isClicked:!0}]}ngOnInit(){}onEditSalesChains(){this.productStructureCategoryService.editSalesChains()}edit(t){this.onEditSalesChains()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(ot.z))},i.\u0275cmp=e.Xpm({type:i,selectors:[["pek-administration-layout"]],decls:2,vars:2,consts:[[3,"module","routes","clickRoute"]],template:function(t,s){1&t&&(e.TgZ(0,"pek-header",0),e.NdJ("clickRoute",function(r){return s.edit(r)}),e.qZA(),e._UZ(1,"router-outlet")),2&t&&e.Q6J("module","Administration")("routes",s.routes)},dependencies:[R.lC,nt.G]}),i})();function at(i,n){1&i&&(e.TgZ(0,"p",19),e._uU(1,"Choose the Role to edit"),e.qZA())}function lt(i,n){if(1&i&&(e.TgZ(0,"div",16),e.YNc(1,at,2,0,"p",17),e._UZ(2,"p-menubar",18),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.selectedRole),e.xp6(1),e.ekj("disabled",!t.selectedRole),e.Q6J("model",t.menuItems)}}function pt(i,n){1&i&&(e.TgZ(0,"tr")(1,"th",20),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",21),e._uU(4,"Name"),e.qZA()())}function ct(i,n){if(1&i&&(e.TgZ(0,"tr",22)(1,"td",20),e._uU(2),e.qZA(),e.TgZ(3,"td",21),e._uU(4),e.qZA()()),2&i){const t=n.$implicit,s=n.rowIndex,o=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(10*(o.currentPage-1)+s+1),e.xp6(2),e.Oqu(t.name)}}function dt(i,n){1&i&&e._UZ(0,"i",26)}function ut(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function mt(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td",23),e.YNc(2,dt,1,0,"i",24),e.YNc(3,ut,2,0,"span",25),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.uIk("colspan",10),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function gt(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",27)(1,"p-paginator",28,29),e.NdJ("onPageChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.paginate(o))}),e.qZA(),e.TgZ(3,"p-button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onShowAll(!0))}),e._uU(4," All "),e.qZA()()}if(2&i){const t=e.oxw();e.ekj("paginator-wrapper_hide",0===t.count),e.xp6(1),e.Q6J("rows",10)("totalRecords",t.count)}}function ht(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",31)(1,"p-button",32),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onShowAll(!1))}),e._uU(2," Return pagination "),e.qZA()()}}let A=class{constructor(n,t){this.roleService=n,this.modalService=t,this.menuItems=[{label:"Selected Role",items:[{label:"Edit Role",icon:"pi pi-pencil",command:()=>this.editRole()},{label:"Edit Permissions",icon:"pi pi-pencil",command:()=>this.editPermissions()},{label:"Remove",icon:"pi pi-trash",command:()=>this.removeRole()}]}],this.isLoading=!0,this.currentPage=1,this.selectedRole=null,this.count=0,this.isShowAll=!1,this.search$=new E.X(null),this.query=[],this.roles$=this.search$.pipe((0,d.b)(()=>this.prepareForSearch()),(0,T.w)(()=>(0,F.s)(()=>!this.isShowAll,this.roleService.getForPagination(this.query).pipe((0,d.b)(s=>this.count=s.count),(0,u.U)(s=>s.results),(0,d.b)(()=>this.isLoading=!1),(0,N.O)([]),(0,m.t)(this)),this.roleService.getRoles(this.query).pipe((0,d.b)(s=>this.count=s.length),(0,d.b)(()=>this.isLoading=!1),(0,N.O)([]),(0,m.t)(this)))),(0,m.t)(this))}ngOnInit(){}prepareForSearch(){this.isLoading=!0,this.selectedRole=null,this.query=[],this.isShowAll||(this.query.push({name:"page",value:this.currentPage}),this.query.push({name:"paginated",value:!0}))}onShowAll(n){this.isShowAll=n,this.isShowAll||(this.currentPage=1),this.search$.next()}paginate(n){this.currentPage=n.page+1,this.search$.next()}createRole(){this.roleService.createEditRoleModal("create").pipe((0,b.h)(Boolean),(0,d.b)(()=>this.search$.next())).subscribe()}editRole(){this.roleService.createEditRoleModal("edit",this.selectedRole).pipe((0,b.h)(Boolean),(0,d.b)(()=>this.search$.next())).subscribe()}editPermissions(){this.roleService.editRolePermissions(this.selectedRole).pipe((0,b.h)(Boolean),(0,d.b)(()=>this.search$.next())).subscribe()}removeRole(){this.modalService.confirm("danger").pipe((0,b.h)(Boolean)).subscribe(()=>{this.roleService.deleteRole(this.selectedRole).pipe((0,d.b)(()=>this.search$.next())).subscribe()})}};A.\u0275fac=function(n){return new(n||A)(e.Y36(P),e.Y36(H.Z))},A.\u0275cmp=e.Xpm({type:A,selectors:[["pek-administration-roles"]],decls:19,vars:10,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","Create Role",3,"click"],[1,"page__content"],[1,"page__card"],["selectionMode","single","scrollHeight","calc(100vh - 27rem)",3,"rows","scrollable","selection","value","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","paginator-wrapper",3,"paginator-wrapper_hide",4,"ngIf"],["class","paginator-return-pagination",4,"ngIf"],[1,"d-flex"],["class","subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],[1,"subtitle"],[1,"text-center",2,"width","5%"],[2,"width","95%"],[3,"pSelectableRow"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"paginator-wrapper"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["type","button","styleClass","p-button-text",1,"paginator-all",3,"click"],[1,"paginator-return-pagination"],["type","button","styleClass","p-button-text",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5,"Roles"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return t.createRole()}),e.qZA()()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"p-table",8,9),e.NdJ("selectionChange",function(o){return t.selectedRole=o}),e.ALo(12,"async"),e.YNc(13,lt,3,4,"ng-template",10),e.YNc(14,pt,5,0,"ng-template",11),e.YNc(15,ct,5,3,"ng-template",12),e.YNc(16,mt,4,3,"ng-template",13),e.qZA(),e.YNc(17,gt,5,4,"div",14),e.YNc(18,ht,3,0,"div",15),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("module","administration")("isActive",!0),e.xp6(7),e.Q6J("rows",10)("scrollable",!0)("selection",t.selectedRole)("value",e.lcZ(12,8,t.roles$)),e.xp6(7),e.Q6J("ngIf",!t.isShowAll),e.xp6(1),e.Q6J("ngIf",t.isShowAll))},dependencies:[f.O5,C.Hq,C.zx,S.jx,V.nm,v.iA,v.Ei,j.D,L.D,f.Ov]}),A=(0,I.gn)([(0,m.c)()],A);const _t=[{path:"",component:rt,children:[{path:"",redirectTo:"user-list",pathMatch:"full"},{path:"user-list",component:x},{path:"roles",component:A}]}];let ft=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[R.Bz.forChild(_t),R.Bz]}),i})();var vt=a(7175),Ct=a(6984),bt=a(8226),Tt=a(9915);let Zt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.ez,ft,vt.x,C.hJ,Ct.m,bt.BusinessTripsModule,Tt.CrmModule,B.o6]}),i})()}}]);