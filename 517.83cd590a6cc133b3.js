"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[517],{1517:(is,ct,l)=>{l.r(ct),l.d(ct,{ManufacturingModule:()=>ns});var _=l(6895),Z=l(4269),t=l(4650),O=l(7579);let nt=(()=>{class i{constructor(){this.isCollapseSingleDisabled$=new O.x,this.expandCollapseSingle$=new O.x,this.expandCollapseAll$=new O.x}setIsCollapseSingleDisabled(e){console.log("setIsCollapseSingleDisabled",e),this.isCollapseSingleDisabled$.next(e)}setExpandCollapseSingle(e){this.expandCollapseSingle$.next(e)}setExpandCollapseAll(e){this.expandCollapseAll$.next(e)}get isCollapseSingleDisabled(){return this.isCollapseSingleDisabled$}get expandCollapseSingle(){return this.expandCollapseSingle$}get expandCollapseAll(){return this.expandCollapseAll$}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var f=l(5593),yt=l(9293);let kt=(()=>{class i{constructor(e){this.expandCollapseHeaderService=e,this.routes=[{label:"Plans",commands:["plans"]},{label:"Orders To Own Production",commands:["orders"]},{label:"Slice Tasks",commands:["slice-tasks"]}],this.settingsRoutes=[{label:"Employees",commands:["employees"]},{label:"Positions",commands:["positions"]},{label:"Machines",commands:["machines"]},{label:"Order Statuses",commands:["order-statuses"]}]}ngOnInit(){}expandCollapse(e=!0){this.expandCollapseHeaderService.setExpandCollapseSingle(e)}expandCollapseAll(e=!0){this.expandCollapseHeaderService.setExpandCollapseAll(e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(nt))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-layout"]],decls:9,vars:9,consts:[[3,"module","routes","settingsRoutes"],["additionalButtons",""],["pButton","","type","button","icon","pi pi-angle-down","label","Expand",1,"mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-angle-up","label","Collapse",1,"mr-2",3,"disabled","click"],["pButton","","type","button","label","Expand All","icon","pi pi-angle-down",1,"mr-2",3,"click"],["pButton","","type","button","label","Collapse All","icon","pi pi-angle-up",1,"mr-2",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"pek-header",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return o.expandCollapse()}),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return o.expandCollapse(!1)}),t.ALo(5,"async"),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return o.expandCollapseAll()}),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return o.expandCollapseAll(!1)}),t.qZA()()(),t._UZ(8,"router-outlet")),2&e&&(t.Q6J("module","Manufacturing")("routes",o.routes)("settingsRoutes",o.settingsRoutes),t.xp6(2),t.Q6J("disabled",t.lcZ(3,5,o.expandCollapseHeaderService.isCollapseSingleDisabled)),t.xp6(2),t.Q6J("disabled",t.lcZ(5,7,o.expandCollapseHeaderService.isCollapseSingleDisabled)))},dependencies:[f.Hq,Z.lC,yt.G,_.Ov]}),i})();var A=l(655),R=l(1135),q=l(3900),p=l(8505),M=l(4004),it=l(8372),ot=l(1884),x=l(9300),H=l(8746),C=l(9933),K=l(7896),u=l(4006),I=l(6767),P=l(7427),W=l(7679),wt=l(8234),V=l(1740),S=l(6237),U=l(805),$=l(666),v=l(5390),w=l(3237),lt=l(3031);let At=(()=>{class i{constructor(e){this.elementRef=e}ngOnInit(){(0,lt.ZP)(this.elementRef.nativeElement,{content:this.content,allowHTML:!0,interactive:!0,duration:0,placement:"right"})}ngOnDestroy(){(0,lt.ZP)(this.elementRef.nativeElement).destroy()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(t.SBq))},i.\u0275dir=t.lG2({type:i,selectors:[["","pekTippy",""]],inputs:{content:"content"}}),i})();const Ot=["paginator"],qt=["dt"];function It(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",30),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",31),t._uU(4,"Serial Numbers"),t.qZA(),t.TgZ(5,"th",32),t._uU(6,"List ID"),t.qZA(),t.TgZ(7,"th",33),t._uU(8," Code"),t.qZA(),t.TgZ(9,"th",34),t._uU(10,"Name"),t.qZA(),t.TgZ(11,"th",32),t._uU(12,"Created"),t.qZA(),t.TgZ(13,"th",32),t._uU(14,"Status"),t.qZA(),t.TgZ(15,"th",32),t._uU(16,"Quantity"),t.qZA()())}function St(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",35)(1,"button",36),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onSplitPlan())}),t.qZA(),t.TgZ(2,"button",37),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.goToSelectedPlans())}),t.qZA(),t.TgZ(3,"button",38),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onDeletePlan())}),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("disabled",1!==e.selectedTasks.length||1===(null==e.selectedTasks[0]?null:e.selectedTasks[0].required_quantity)),t.xp6(1),t.Q6J("disabled",0===e.selectedTasks.length),t.xp6(1),t.Q6J("loading",e.isDeleting)("disabled",1!==e.selectedTasks.length)}}function Ut(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"..."),t.qZA())}function Nt(i,n){if(1&i&&(t.ynx(0),t.TgZ(1,"div",42)(2,"span"),t._uU(3),t.qZA(),t.YNc(4,Ut,2,0,"span",20),t.qZA(),t.BQk()),2&i){const e=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("content",o.getTippyContent(e)),t.xp6(2),t.AsE("",1," . ",e.serials[0].type_with_number?e.serials[0].type_with_number:e.serials[0].id,""),t.xp6(1),t.Q6J("ngIf",e.serials.length>1)}}function Jt(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(RMA)"),t.qZA())}function Dt(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(S) "),t.qZA())}function Et(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(T) "),t.qZA())}const dt=function(i){return["/warehouse/production-lists",i]},ut=function(i){return["plan",i]};function Qt(i,n){if(1&i&&(t.TgZ(0,"tr",39)(1,"td",30),t._uU(2),t.qZA(),t.TgZ(3,"td",31),t.YNc(4,Nt,5,4,"ng-container",20),t.qZA(),t.TgZ(5,"td",32)(6,"a",40),t._uU(7),t.qZA()(),t.TgZ(8,"td",33)(9,"a",41),t._uU(10),t.YNc(11,Jt,2,0,"b",20),t.qZA()(),t.TgZ(12,"td",34),t.YNc(13,Dt,2,0,"b",20),t.YNc(14,Et,2,0,"b",20),t._uU(15),t.qZA(),t.TgZ(16,"td",32),t._uU(17),t.ALo(18,"date"),t.qZA(),t.TgZ(19,"td",32),t._uU(20),t.qZA(),t.TgZ(21,"td",32),t._uU(22),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Q6J("ngIf",e.serials.length>0),t.xp6(2),t.Q6J("routerLink",t.VKq(17,dt,e.production_list_id)),t.xp6(1),t.hij(" ",e.production_list_id," "),t.xp6(2),t.Q6J("routerLink",t.VKq(19,ut,e.id)),t.xp6(1),t.hij(" ",e.list_product.nomenclature.code," "),t.xp6(1),t.Q6J("ngIf",e.contains_refunded_positions),t.xp6(2),t.Q6J("ngIf","1"===e.list_product.nomenclature.bulk_or_serial),t.xp6(1),t.Q6J("ngIf",e.list_product.nomenclature.has_technical_equipment),t.xp6(1),t.hij(" ",e.list_product.nomenclature.name," "),t.xp6(2),t.hij(" ",t.xi3(18,14,e.created,"dd/MM/y")," "),t.xp6(3),t.hij(" ",e.status," "),t.xp6(2),t.hij(" ",e.required_quantity," ")}}function Lt(i,n){1&i&&t._UZ(0,"i",45)}function Yt(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function Ft(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",43),t.YNc(2,Lt,1,0,"i",44),t.YNc(3,Yt,2,0,"span",20),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(1),t.uIk("colspan",16),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function Rt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",46),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(3);return t.KtG(a.paginator=!1)}),t._uU(1," All "),t.qZA()}}function Ht(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",47)(1,"p-button",46),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(3);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}function zt(i,n){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",21)(2,"p-table",22,23),t.NdJ("selectionChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedTasks=a)})("firstChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.first=a)}),t.YNc(4,It,17,0,"ng-template",24),t.YNc(5,St,4,4,"ng-template",25),t.YNc(6,Qt,23,21,"ng-template",26),t.YNc(7,Ft,4,3,"ng-template",27),t.YNc(8,Rt,2,0,"ng-template",28),t.qZA()(),t.YNc(9,Ht,3,0,"div",29),t.BQk()}if(2&i){const e=t.MAs(3),o=t.oxw();t.xp6(2),t.Q6J("rows",10)("paginator",o.tasks.length>0)("scrollable",!0)("value",o.tasks)("selection",o.selectedTasks)("first",o.first),t.xp6(7),t.Q6J("ngIf",!e.paginator&&!o.isLoading&&o.tasks.length>0)}}function $t(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",49),t._uU(2,"Name"),t.qZA(),t.TgZ(3,"th",50),t._uU(4,"Code"),t.qZA(),t.TgZ(5,"th",31),t._uU(6,"Serial Numbers"),t.qZA(),t.TgZ(7,"th",51),t._uU(8,"List ID"),t.qZA(),t.TgZ(9,"th",52),t._uU(10,"Created"),t.qZA(),t.TgZ(11,"th",51),t._uU(12,"Status"),t.qZA(),t.TgZ(13,"th",52),t._uU(14,"Quantity"),t.qZA()())}function Bt(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",35)(1,"button",53),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.expandCollapse(a.selectedTasksNodes,!0))}),t.qZA(),t.TgZ(2,"button",54),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.expandCollapse(a.selectedTasksNodes,!1))}),t.qZA(),t.TgZ(3,"button",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onExpandAll())}),t.qZA(),t.TgZ(4,"button",56),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onCollapseAll())}),t.qZA(),t.TgZ(5,"button",57),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onSplitNodePlan())}),t.qZA(),t.TgZ(6,"button",37),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.goToSelectedNodesPlans())}),t.qZA(),t.TgZ(7,"button",38),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.onDeleteNodePlan())}),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("disabled",!e.selectedTasksNodes.length),t.xp6(1),t.Q6J("disabled",!e.selectedTasksNodes.length),t.xp6(1),t.Q6J("disabled",e.isLoading),t.xp6(1),t.Q6J("disabled",e.isLoading),t.xp6(1),t.Q6J("disabled",1!==e.selectedTasksNodes.length||e.disabled()||1===(null==e.selectedTasksNodes[0]||null==e.selectedTasksNodes[0].data||null==e.selectedTasksNodes[0].data.task?null:e.selectedTasksNodes[0].data.task.required_quantity)),t.xp6(1),t.Q6J("disabled",0===e.selectedTasksNodes.length||e.disabled()),t.xp6(1),t.Q6J("loading",e.isDeleting)("disabled",1!==e.selectedTasksNodes.length||e.disabled())}}function Gt(i,n){if(1&i&&(t.TgZ(0,"i",65),t._uU(1),t.qZA()),2&i){const e=t.oxw(3).rowData;t.xp6(1),t.hij("(L ",e.categories,")")}}function jt(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,Gt,2,1,"i",64),t.qZA()),2&i){const e=t.oxw(2).rowData;t.ekj("bold",!e.task),t.xp6(1),t.hij(" ",e.name," "),t.xp6(1),t.Q6J("ngIf",!e.task)}}function Kt(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(S)"),t.qZA())}function Wt(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(T)"),t.qZA())}function Vt(i,n){if(1&i&&(t.TgZ(0,"span"),t.YNc(1,Kt,2,0,"b",20),t.YNc(2,Wt,2,0,"b",20),t._uU(3),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Q6J("ngIf",e.task&&e.task.serial_numbers.length>0),t.xp6(1),t.Q6J("ngIf",e.task.list_product.nomenclature.has_technical_equipment),t.xp6(1),t.AsE(" ",e.task.list_product.nomenclature.name," (L ",e.task.required_quantity,") ")}}function Xt(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(RMA)"),t.qZA())}function te(i,n){if(1&i&&(t.TgZ(0,"span")(1,"a",66),t._uU(2),t.YNc(3,Xt,2,0,"b",20),t.qZA()()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Q6J("routerLink",t.VKq(3,ut,e.task.id)),t.xp6(1),t.hij(" ",e.task.list_product.nomenclature.code," "),t.xp6(1),t.Q6J("ngIf",e.task.contains_refunded_positions)}}function ee(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"..."),t.qZA())}function ne(i,n){if(1&i&&(t.ynx(0),t.TgZ(1,"div",42)(2,"span"),t._uU(3),t.qZA(),t.YNc(4,ee,2,0,"span",20),t.qZA(),t.BQk()),2&i){const e=t.oxw(2).rowData,o=t.oxw(2);t.xp6(1),t.Q6J("content",o.getTippyContent(e.task)),t.xp6(2),t.AsE("",1," . ",e.task.serials[0].type_with_number?e.task.serials[0].type_with_number:e.task.serials.serial.id,""),t.xp6(1),t.Q6J("ngIf",e.task.serials.length>1)}}function ie(i,n){if(1&i&&(t.TgZ(0,"span")(1,"a",40),t._uU(2),t.qZA()()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Q6J("routerLink",t.VKq(2,dt,e.task.production_list_id)),t.xp6(1),t.hij(" ",e.task.production_list_id," ")}}function oe(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij(" ",t.xi3(2,1,e.task.created,"dd/MM/y")," ")}}function ae(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij(" ",e.task.status," ")}}function re(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij(" ",e.task.required_quantity," ")}}function se(i,n){if(1&i&&(t.TgZ(0,"tr",59)(1,"td",60)(2,"div",61),t._UZ(3,"p-treeTableToggler",62),t.YNc(4,jt,3,4,"span",63),t.YNc(5,Vt,4,4,"span",20),t.qZA()(),t.TgZ(6,"td",50),t.YNc(7,te,4,5,"span",20),t.qZA(),t.TgZ(8,"td",31),t.YNc(9,ne,5,4,"ng-container",20),t.qZA(),t.TgZ(10,"td",51),t.YNc(11,ie,3,4,"span",20),t.qZA(),t.TgZ(12,"td",52),t.YNc(13,oe,3,4,"span",20),t.qZA(),t.TgZ(14,"td",51),t.YNc(15,ae,2,1,"span",20),t.qZA(),t.TgZ(16,"td",51),t.YNc(17,re,2,1,"span",20),t.qZA()()),2&i){const e=t.oxw(),o=e.$implicit,a=e.rowData;t.Q6J("ttRow",o)("ttSelectableRow",o),t.xp6(3),t.Q6J("rowNode",o),t.xp6(1),t.Q6J("ngIf",!a.task),t.xp6(1),t.Q6J("ngIf",a.task),t.xp6(2),t.Q6J("ngIf",a.task),t.xp6(2),t.Q6J("ngIf",(null==a.task||null==a.task.serials?null:a.task.serials.length)>0),t.xp6(2),t.Q6J("ngIf",a.task),t.xp6(2),t.Q6J("ngIf",a.task),t.xp6(2),t.Q6J("ngIf",a.task),t.xp6(2),t.Q6J("ngIf",a.task)}}function ce(i,n){1&i&&t.YNc(0,se,18,11,"tr",58),2&i&&t.Q6J("ngIf",!n.rowData.hideFromTable)}function le(i,n){1&i&&t._UZ(0,"i",45)}function de(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function ue(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",43),t.YNc(2,le,1,0,"i",44),t.YNc(3,de,2,0,"span",20),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(1),t.uIk("colspan",16),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function pe(i,n){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"p-treeTable",48),t.NdJ("selectionChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedTasksNodes=a)}),t.YNc(2,$t,15,0,"ng-template",24),t.YNc(3,Bt,8,8,"ng-template",25),t.YNc(4,ce,1,1,"ng-template",26),t.YNc(5,ue,4,3,"ng-template",27),t.qZA(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("value",e.ownProductionCategorizedList)("scrollable",!0)("selection",e.selectedTasksNodes)}}let N=class{constructor(n,e,o,a,s,r,c){this.fb=n,this.adapterService=e,this.modalService=o,this.taskService=a,this.categoryService=s,this.router=r,this.route=c,this.searchForm=this.fb.group({list_product__nomenclature__name:[null],list_product__nomenclature__code:[null],statuses:[null],type_with_number:[""]}),this.first=0,this.statuses=[{id:0,name:"Not processed",value:"0"},{id:1,name:"Deficit",value:"1"},{id:2,name:"Rework",value:"2"},{id:3,name:"Ordered",value:"3"},{id:4,name:"On stock",value:"4"}],this.mode="hierarchy",this.isDeleting=!1,this.tasks=[],this.categories=[],this.selectedTasksNodes=[],this.expanseMap={},this.currentPage=1,this.queryKey=this.adapterService.generateQueryKey(this.searchForm),this.query=[],this.isLoading=!0,this.selectedTasks=[],this.isStartFirstPage=!1,this.isShowAll=!1,this.search$=new R.X(null),this.name$=new O.x,this.code$=new O.x,this.serial$=new O.x,this.tasks$=this.search$.pipe((0,p.b)(()=>this.prepareForSearch()),(0,q.w)(()=>this.taskService.get(this.query)),(0,p.b)(d=>this.tasksCount=d.length),(0,M.U)(d=>this.filterTasks(d)),(0,p.b)(()=>this.paginateToFistPage()),(0,p.b)(()=>this.getCategories()),(0,p.b)(()=>this.fillCategorizedTree()),(0,p.b)(()=>this.isLoading=!1),(0,C.t)(this)),this.tasksCount=0}ngOnInit(){this.tasks$.subscribe(),this.name$.pipe((0,it.b)(150),(0,p.b)(()=>this.search$.next()),(0,ot.x)(),(0,C.t)(this)).subscribe(),this.code$.pipe((0,it.b)(150),(0,p.b)(()=>this.search$.next()),(0,ot.x)(),(0,C.t)(this)).subscribe(),this.serial$.pipe((0,it.b)(150),(0,p.b)(()=>this.search$.next()),(0,ot.x)(),(0,C.t)(this)).subscribe(),this.getStructureCategories()}getStructureCategories(){this.structureCategories&&this.mapExpansion(),this.categoryService.get().pipe((0,p.b)(n=>this.createStructureCategoriesTree(n))).subscribe()}createStructureCategoriesTree(n){const e=[];n.forEach(s=>{const r={data:s,expanded:!1};this.expanseMap&&(r.expanded=this.expanseMap[s.id]),e.push(r)});const o=[],a=e.reduce((s,r,c)=>(s[r.data.id]=c,s),{});e.forEach(s=>{if(null===s.data.parent)return void o.push(s);const r=e[a[s.data.parent]];r.children=[...r.children||[],s],0===r.children.length&&delete r.children}),this.structureCategories=o}mapExpansion(){this.structureCategories.forEach(n=>{this.createExpanseMap(n)})}createExpanseMap(n){this.expanseMap[n.data.id]=!!n.expanded&&n.expanded,n.children&&n.children.forEach(e=>{this.createExpanseMap(e)})}onSelectMode(n){this.mode=n}filterTasks(n){let e=[];return n.forEach(o=>{if(!e.find(a=>a.family_id===o.family_id&&a.list_product.nomenclature.id===o.list_product.nomenclature.id&&a.technology===o.technology)){const a=n.filter(r=>r.family_id===o.family_id&&r.list_product.nomenclature.id===o.list_product.nomenclature.id&&r.technology===o.technology),s=n.filter(r=>r.family_id===o.family_id&&r.list_product.nomenclature.id===o.list_product.nomenclature.id&&r.technology===o.technology).length;o.required_quantity=o.required_quantity*s,o.serials=[],o.production_list_id=a.at(-1).production_list_id,a.forEach(r=>{o.serial_numbers.length>0?r.serial_numbers.forEach(c=>{o.serials.push(c)}):o.serial_products.length>0&&r.serial_products.forEach(c=>{o.serials.push(c.serial_number)})}),o.ids=n.filter(r=>r.family_id===o.family_id&&r.list_product.nomenclature.id===o.list_product.nomenclature.id&&r.technology===o.technology).map(r=>r.id),e.push(o)}}),e.sort((o,a)=>new Date(o.created)>new Date(a.created)?-1:1),this.tasks=e,this.tasks=this.tasks.map(o=>o),e}paginateToFistPage(){this.isStartFirstPage&&(this.first=0,this.paginator?.changePage(0)),this.isStartFirstPage=!1}prepareForSearch(){this.isLoading=!0,this.selectedTasks=[],this.selectedTasksNodes=[],this.ownProductionCategorizedList=[],this.tasks=[];const n=this.adapterService.generateQueryKey(this.searchForm);n!==this.queryKey&&(this.currentPage=1,this.queryKey=n,this.isStartFirstPage=!0),this.query=[{name:"is_root",value:!0}],this.searchForm.get("statuses").value||this.query.push({name:"statuses",value:[0,1,2,3]});for(const e in this.searchForm.controls)null!==this.searchForm.controls[e].value&&(this.searchForm.controls[e].value instanceof Date?this.query.push({name:e,value:this.adapterService.dateAdapter(this.searchForm.controls[e].value)}):this.query.push({name:e,value:this.searchForm.controls[e].value}))}getStatus(n){switch(n){case"0":return"Not processed";case"1":return"Deficit";case"2":return"Rework";case"3":return"Ordered";case"4":return"On stock"}}paginate(n){}onShowAll(n){}getTippyContent(n){let e="";return n.serials.forEach((o,a)=>{e+=`\n          <li>${a+1}. ${o.type_with_number?o.type_with_number:o.id}</li>\n      `}),`<ul class="plan-row">${e}</ul>`}getCategories(){this.categories=this.tasks.filter(n=>n.root_nomenclature?.category).map(n=>n.root_nomenclature.category),this.categories=this.adapterService.removeDuplicates(this.categories,n=>n.id),this.categories.forEach(n=>{n.categories=this.adapterService.removeDuplicates(this.tasks.filter(e=>e.root_nomenclature?.category?.id===n.id).map(e=>e.root_nomenclature),e=>e.id),n.categories.forEach(e=>{e.tasks=this.adapterService.removeDuplicates(this.tasks.filter(o=>o.root_nomenclature?.id===e.id).map(o=>o),o=>o.list_product.nomenclature.id),e.tasks=e.tasks.map(o=>({...o})),e.tasks.map(o=>o).forEach(o=>{o.required_quantity=this.tasks.filter(a=>a.list_product.nomenclature.id===o.list_product.nomenclature.id).reduce((a,s)=>a+s.required_quantity,0),o.tasks=this.tasks.filter(a=>a.list_product.nomenclature.id===o.list_product.nomenclature.id)})})})}fillCategorizedTree(){const n=[];this.tasks.forEach(o=>{if(o.root_nomenclature&&o.root_nomenclature.root_category){const a=o.root_nomenclature.root_category.id,s=o.root_nomenclature.root_category.name,r=1,c=o.root_nomenclature.id,d=o.root_nomenclature.name,h=2;n.findIndex(T=>T.id===a&&r===T.level)<0&&n.push({id:a,level:r,name:s,parentId:null}),n.findIndex(T=>T.id===c&&h===T.level)<0&&n.push({id:c,level:h,name:d,parentId:a})}});const e=(0,K.Z)(this.structureCategories);e.forEach(o=>{this.appendCategories(o,n)}),e.forEach(o=>{this.fillWithTheData(o,this.tasks)}),e.forEach(o=>{this.removeUpdateEmptyCategories(o)}),this.ownProductionCategorizedList=[...e],this.ownProductionCategorizedList.every(o=>0===o.children.length)&&(this.ownProductionCategorizedList=[])}appendCategories(n,e){n.children||(n.children=[]),e.forEach(o=>{o.parentId===n.data.id&&n.children.push({data:{id:o.id,name:o.name,level:o.level,parentId:o.parentId,isCategory:!0,categories:0},expanded:!1,children:[]})}),n.children&&n.children.forEach(o=>{this.appendCategories(o,e)})}fillWithTheData(n,e){n.children||(n.children=[]),n.data.isCategory&&e.forEach(o=>{if(o.root_nomenclature&&n.data.id===o.root_nomenclature.id){const s=n.children.findIndex(r=>r.data.id===o.list_product.nomenclature.id);s<0?n.children.push({data:{id:o.list_product.nomenclature.id,name:o.list_product.nomenclature.name,level:3,categories:0},expanded:!1,children:[{data:{task:o,level:4},expanded:!1,children:[]}]}):n.children[s].children.push({data:{task:o,level:4},expanded:!1,children:[]})}}),n.children&&n.children.forEach(o=>{this.fillWithTheData(o,e)})}removeUpdateEmptyCategories(n){if(!n.data.isCategory&&!n.data.task){let e=!0;n.children.filter(a=>a.data.task).length>0&&(e=!1),n.children.forEach(a=>{e&&a.children.filter(r=>r.data.task).length>0&&(e=!1),a.children.forEach(s=>{e&&s.children.filter(c=>c.data.task).length>0&&(e=!1),s.children.forEach(r=>{e&&r.children.filter(d=>d.data.task).length>0&&(e=!1),r.children.forEach(c=>{e&&c.children.filter(h=>h.data.task).length>0&&(e=!1)})})})}),n.data.hideFromTable=e}n.data.categories=n.children.length,n.children&&n.children.forEach((e,o)=>{this.removeUpdateEmptyCategories(e)})}onExpandAll(){const n=(0,K.Z)(this.ownProductionCategorizedList);n.forEach(e=>{this.expandCollapseRecursive(e,!0)}),this.ownProductionCategorizedList=n}onCollapseAll(){const n=(0,K.Z)(this.ownProductionCategorizedList);n.forEach(e=>{this.expandCollapseRecursive(e,!1)}),this.ownProductionCategorizedList=n}expandCollapseRecursive(n,e){n.expanded=e,n.children&&n.children.forEach(o=>{this.expandCollapseRecursive(o,e)})}goToSelectedPlans(){const n=this.selectedTasks.map(o=>o.id).join(","),e=this.router.serializeUrl(this.router.createUrlTree(["plan",n],{relativeTo:this.route}));window.open(e,"_blank")}goToSelectedNodesPlans(){const n=this.selectedTasksNodes.map(e=>e.data.task.id).join(",");this.router.navigate(["plan",n],{relativeTo:this.route})}onSplitPlan(){this.taskService.splitTasksDialog(this.selectedTasks[0]).pipe((0,x.h)(n=>!!n),(0,p.b)(()=>this.search$.next())).subscribe()}onSplitNodePlan(){this.taskService.splitTasksDialog(this.selectedTasksNodes[0].data).pipe((0,x.h)(n=>!!n),(0,p.b)(()=>this.search$.next())).subscribe()}onDeletePlan(){this.modalService.confirm("danger").pipe((0,x.h)(n=>n)).subscribe(()=>{this.isDeleting=!0,this.taskService.deletePlans(this.selectedTasks[0].ids).pipe((0,H.x)(()=>this.isDeleting=!1)).subscribe(()=>{const n=this.tasks.findIndex(e=>e.id===this.selectedTasks[0].id);this.tasks.splice(n,1),this.fillCategorizedTree(),this.selectedTasks=[],this.selectedTasksNodes=[]})})}onDeleteNodePlan(){console.log(this.selectedTasksNodes),this.modalService.confirm("danger").pipe((0,x.h)(n=>n)).subscribe(()=>{this.isDeleting=!0,this.taskService.deletePlans(this.selectedTasksNodes[0].data.task.ids).pipe((0,H.x)(()=>this.isDeleting=!1)).subscribe(()=>{const n=this.tasks.findIndex(e=>e.id===this.selectedTasksNodes[0].data.task.id);this.tasks.splice(n,1),this.fillCategorizedTree(),this.selectedTasks=[],this.selectedTasksNodes=[]})})}goToAllPlans(){const n=this.router.serializeUrl(this.router.createUrlTree(["all"],{relativeTo:this.route}));window.open(n,"_blank")}disabled(){return this.selectedTasksNodes.some(n=>!n.data?.task)}expandCollapse(n,e){const o=(0,K.Z)(this.ownProductionCategorizedList);o.forEach(a=>{n.forEach(s=>{this.makeRow(a,s,e)})}),this.ownProductionCategorizedList=o}makeRow(n,e,o){n.data?.id===e.data?.id?this.expandCollapseRecursive(n,o):n.children&&n.children.forEach(a=>{this.makeRow(a,e,o)})}};N.\u0275fac=function(n){return new(n||N)(t.Y36(u.qu),t.Y36(I.v),t.Y36(P.Z),t.Y36(W.M),t.Y36(wt.z),t.Y36(Z.F0),t.Y36(Z.gz))},N.\u0275cmp=t.Xpm({type:N,selectors:[["pek-manufacturing-plan-list"]],viewQuery:function(n,e){if(1&n&&(t.Gf(Ot,5),t.Gf(qt,5)),2&n){let o;t.iGM(o=t.CRH())&&(e.paginator=o.first),t.iGM(o=t.CRH())&&(e.dt=o.first)}},decls:38,vars:9,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-calendar","routerLink","/manufacturing/production-calendar","label","Production Calendar",1,"mr-2"],["pButton","","type","button","icon","pi pi-chart-line","label","Workload",1,"mr-2"],["pButton","","type","button","icon","pi pi-sliders-v","label","All Plans",1,"mr-2",3,"click"],["pButton","","type","button","icon","pi pi-table","label","Hierarchy",1,"mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-list","label","List",3,"disabled","click"],[1,"page__content"],[1,"page__card"],[1,"form",3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],["formControlName","statuses","optionValue","value","optionLabel","name","placeholder","Choose Status",3,"showClear","options","ngModelChange"],["type","text","pInputText","","placeholder","Enter a Name","formControlName","list_product__nomenclature__name",3,"ngModelChange"],["type","text","placeholder","Enter a Code","pInputText","","formControlName","list_product__nomenclature__code",3,"ngModelChange"],["pInputText","","formControlName","type_with_number","type","text","id","type_with_number",1,"form-control",3,"ngModelChange"],[4,"ngIf"],[1,"table-pagination-preloader"],["selectionMode","multiple","scrollHeight","calc(100vh - 24.25rem)",3,"rows","paginator","scrollable","value","selection","first","selectionChange","firstChange"],["dt",""],["pTemplate","header"],["pTemplate","caption"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","paginatorright"],["class","paginator-return-pagination",4,"ngIf"],[1,"text-center",2,"width","5%"],[1,"text-center",2,"width","20%"],[1,"text-center",2,"width","10%"],[2,"width","15%"],[2,"width","25%"],[1,"d-flex","table-caption"],["pButton","","type","button","icon","pi pi-chart-pie","label","Add Split",1,"ml-auto","mr-2","p-button-icon",3,"disabled","click"],["pButton","","type","button","icon","pi pi-chart-bar","label","Selected Plans",1,"p-button-icon","mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-trash","label","Delete Plan",1,"p-button-icon","p-button-danger",3,"loading","disabled","click"],[3,"pSelectableRow"],["target","_blank",3,"routerLink"],["rel","noopener noreferrer","routerLinkActive","router-link-active","target","_blank",3,"routerLink"],["pekTippy","",1,"serials",3,"content"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],["type","button","styleClass","p-button-text",3,"click"],[1,"paginator-return-pagination"],["selectionMode","multiple","scrollHeight","calc(100vh - 24.5rem)",3,"value","scrollable","selection","selectionChange"],[2,"padding-left","48px","width","30%"],[2,"width","20%"],[1,"text-center",2,"width","7%"],[1,"text-center",2,"width","8%"],["pButton","","type","button","icon","pi pi-angle-down","label","Expand",1,"ml-auto","mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-angle-up","label","Collapse",1,"mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-angle-down","label","Expand All",1,"mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-angle-up","label","Collapse All",1,"mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-chart-pie","label","Add Split",1,"mr-2","p-button-icon",3,"disabled","click"],[3,"ttRow","ttSelectableRow",4,"ngIf"],[3,"ttRow","ttSelectableRow"],[1,"word-break",2,"width","30%"],[1,"toggle-row"],[3,"rowNode"],[3,"bold",4,"ngIf"],["style","font-style: normal",4,"ngIf"],[2,"font-style","normal"],["rel","noopener noreferrer","target","_blank",1,"plan-link",3,"routerLink"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t._uU(5,"Plans"),t.qZA()(),t.TgZ(6,"div",4),t._UZ(7,"button",5)(8,"button",6),t.TgZ(9,"button",7),t.NdJ("click",function(){return e.goToAllPlans()}),t.qZA(),t.TgZ(10,"button",8),t.NdJ("click",function(){return e.onSelectMode("hierarchy")}),t.qZA(),t.TgZ(11,"button",9),t.NdJ("click",function(){return e.onSelectMode("list")}),t.qZA()()()(),t.TgZ(12,"div",10)(13,"div",11)(14,"form",12)(15,"div",13)(16,"div",14)(17,"div",15)(18,"label"),t._uU(19,"Status"),t.qZA(),t.TgZ(20,"p-dropdown",16),t.NdJ("ngModelChange",function(){return e.search$.next()}),t.qZA()()(),t.TgZ(21,"div",14)(22,"div",15)(23,"label"),t._uU(24,"Name"),t.qZA(),t.TgZ(25,"input",17),t.NdJ("ngModelChange",function(){return e.name$.next()}),t.qZA()()(),t.TgZ(26,"div",14)(27,"div",15)(28,"label"),t._uU(29,"Code"),t.qZA(),t.TgZ(30,"input",18),t.NdJ("ngModelChange",function(){return e.code$.next()}),t.qZA()()(),t.TgZ(31,"div",14)(32,"div",15)(33,"label"),t._uU(34,"Serial Number"),t.qZA(),t.TgZ(35,"input",19),t.NdJ("ngModelChange",function(){return e.serial$.next()}),t.qZA()()()()(),t.YNc(36,zt,10,7,"ng-container",20),t.YNc(37,pe,6,3,"ng-container",20),t.qZA()()),2&n&&(t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(7),t.Q6J("disabled","hierarchy"===e.mode),t.xp6(1),t.Q6J("disabled","list"===e.mode),t.xp6(3),t.Q6J("formGroup",e.searchForm),t.xp6(6),t.Q6J("showClear",!0)("options",e.statuses),t.xp6(16),t.Q6J("ngIf","list"===e.mode),t.xp6(1),t.Q6J("ngIf","hierarchy"===e.mode))},dependencies:[f.Hq,f.zx,V.o,S.iw,U.jx,S.gc,S.V4,S.e2,u._Y,u.Fj,u.JJ,u.JL,u.sg,u.u,Z.rH,Z.yS,Z.Od,$.Lt,v.iA,v.Ei,w.D,At,_.O5,_.uU],styles:[".form[_ngcontent-%COMP%]{margin-top:-.25rem;margin-bottom:.25rem}.serials[_ngcontent-%COMP%]{display:flex;flex-direction:column}.toggle-row[_ngcontent-%COMP%]{display:flex;align-items:center;white-space:nowrap;font-weight:500}.plan-link[_ngcontent-%COMP%]:hover{text-decoration:underline}"]}),N=(0,A.gn)([(0,C.c)()],N);var _e=l(8457),pt=l(5722);const ge=["paginator"],he=["dt"];function me(i,n){if(1&i&&(t.ynx(0),t._uU(1),t.ALo(2,"date"),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.hij(" Slice of Tasks on ",t.xi3(2,1,e.currentDate,"dd/MM/yyyy")," ")}}function fe(i,n){if(1&i&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&i){const e=t.oxw();t.AsE(" Slice of tasks from ",t.xi3(1,2,e.startDate,"dd/MM/y")," to ",t.xi3(2,5,e.endDate,"dd/MM/y")," ")}}function xe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-multiSelect",27),t.NdJ("onChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.onSelectEmployees(a))})("onClear",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.onSelectEmployees(a))}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("options",e.employees)("showClear",!0)}}function Te(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-dropdown",28),t.NdJ("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.search$.next())}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("showClear",!0)("options",e.lists)}}function Ce(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",29),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",30),t._uU(4," Code"),t.qZA(),t.TgZ(5,"th",30),t._uU(6,"Name"),t.qZA(),t.TgZ(7,"th",31),t._uU(8,"Start Date"),t.qZA(),t.TgZ(9,"th",31),t._uU(10,"End Date"),t.qZA(),t.TgZ(11,"th",32),t._uU(12,"Technology"),t.qZA(),t.TgZ(13,"th",33),t._uU(14,"Qnty"),t.qZA(),t.TgZ(15,"th",34),t._uU(16,"Employees "),t._UZ(17,"p-sortIcon",35),t.qZA(),t.TgZ(18,"th",36),t._uU(19,"Machines"),t.qZA(),t.TgZ(20,"th",37),t._uU(21,"Status "),t._UZ(22,"p-sortIcon",38),t.qZA()())}function ve(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.employee.first_name+" "+e.employee.last_name," ")}}function Me(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.machine.name," ")}}function Ze(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",29),t._uU(2),t.qZA(),t.TgZ(3,"td",30),t._uU(4),t.qZA(),t.TgZ(5,"td",30),t._uU(6),t.qZA(),t.TgZ(7,"td",31),t._uU(8),t.ALo(9,"date"),t.qZA(),t.TgZ(10,"td",31),t._uU(11),t.ALo(12,"date"),t.qZA(),t.TgZ(13,"td",32),t._uU(14),t.qZA(),t.TgZ(15,"td",33),t._uU(16),t.qZA(),t.TgZ(17,"td",39),t.YNc(18,ve,2,1,"div",40),t.qZA(),t.TgZ(19,"td",36),t.YNc(20,Me,2,1,"div",40),t.qZA(),t.TgZ(21,"td",32),t._uU(22),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(e.list_product.nomenclature.code),t.xp6(2),t.Oqu(e.list_product.nomenclature.name),t.xp6(2),t.Oqu(t.xi3(9,10,e.start_date,"dd/MM/yyyy, HH:mm")),t.xp6(3),t.Oqu(t.xi3(12,13,e.end_date,"dd/MM/yyyy, HH:mm")),t.xp6(3),t.Oqu(e.technology?e.technology:"Purchased"),t.xp6(2),t.Oqu(e.list_product.required_quantity),t.xp6(2),t.Q6J("ngForOf",e.employees),t.xp6(2),t.Q6J("ngForOf",e.machines),t.xp6(2),t.Oqu(e.status)}}function be(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",41),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(37);return t.KtG(a.paginator=!1)}),t._uU(1," All "),t.qZA()}}function Pe(i,n){1&i&&t._UZ(0,"i",45)}function ye(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function ke(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",42),t.YNc(2,Pe,1,0,"i",43),t.YNc(3,ye,2,0,"span",44),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",16),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function we(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",46)(1,"p-button",41),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(37);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}function Ae(i,n){1&i&&(t.TgZ(0,"div",47),t._UZ(1,"i",48),t.qZA())}let J=class{constructor(n,e,o,a){this.fb=n,this.adapterService=e,this.taskService=o,this.modalService=a,this.taskStatuses=[{id:0,name:"Not processed"},{id:1,name:"Deficit"},{id:2,name:"Rework"},{id:3,name:"Ordered"},{id:4,name:"On Stock"}],this.employees=[],this.currentDate=new Date,this.lists=[],this.isStartFirstPage=!1,this.isPeriod=!1,this.searchForm=this.fb.group({employees_id:[null],status:[null],technology_id:[null],product_list_origin_id:[null]}),this.queryKey=this.adapterService.generateQueryKey(this.searchForm),this.query=[],this.tasks=[],this.tasksCount=0,this.isLoading=!0,this.search$=new R.X(null),this.tasks$=this.search$.pipe((0,p.b)(()=>this.prepareForSearch()),(0,q.w)(()=>this.taskService.get(this.query)),(0,p.b)(s=>this.tasksCount=s.length),(0,p.b)(s=>this.filterTasks(s)),(0,p.b)(()=>this.isLoading=!1),(0,C.t)(this)),this.isLoadingFilters=!1}ngOnInit(){this.tasks$.subscribe()}onChoiceDate(){this.modalService.openChoiceDateDialog("Select the day for which you want to view the tasks").pipe((0,x.h)(n=>!!n),(0,p.b)(()=>this.isLoadingFilters=!1),(0,p.b)(()=>this.isPeriod=!1),(0,p.b)(n=>this.currentDate=n),(0,p.b)(()=>this.search$.next())).subscribe()}onChoicePeriod(){this.modalService.openChoicePeriodDateDialog().pipe((0,x.h)(n=>!!n),(0,p.b)(()=>this.isLoadingFilters=!1),(0,p.b)(n=>{this.isPeriod=!0,this.startDate=n.startDate,this.endDate=n.endDate}),(0,p.b)(()=>this.search$.next())).subscribe()}prepareForSearch(){this.isLoading=!0,this.tasks=[];const n=this.adapterService.generateQueryKey(this.searchForm);n!==this.queryKey&&(this.queryKey=n),this.query=[],this.isPeriod?(this.query.push({name:"start_date__gte",value:this.adapterService.dateAdapter(this.startDate)}),this.query.push({name:"end_date__lte",value:this.adapterService.dateAdapter(this.endDate)})):this.query.push({name:"date",value:this.convertDate(this.currentDate)});for(const e in this.searchForm.controls)null!==this.searchForm.controls[e].value&&(this.searchForm.controls[e].value instanceof Date?this.query.push({name:e,value:this.adapterService.dateAdapter(this.searchForm.controls[e].value)}):this.query.push({name:e,value:this.searchForm.controls[e].value}))}convertDate(n){return n.toISOString().slice(0,10)}filterTasks(n){this.tasks=n.filter(e=>"0"!==e.list_product.nomenclature.type),this.isLoadingFilters||(this.generateTasksEmployees(),this.generateLists(),this.isLoadingFilters=!0)}generateTasksEmployees(){this.employees=[],this.tasks.forEach(n=>{n.employees.forEach(e=>{this.employees.find(o=>o.id===e.employee.id)||(e.employee.fullName=`${e.employee.first_name} ${e.employee.last_name}`,this.employees.push(e.employee))})})}onSelectEmployees(n){this.searchForm.get("employees_id").patchValue(n?.value?.join(",").length>0?n.value.join(","):null),this.search$.next()}generateLists(){this.lists=[],this.tasks.forEach(n=>{n.root_nomenclature&&!this.lists.find(e=>e.id===n.root_nomenclature.id)&&(n.root_nomenclature.fullName=`(${n.production_list_id}) ${n.root_nomenclature.name}`,n.root_nomenclature.production_list_id=n.production_list_id,this.lists.push(n.root_nomenclature))})}};J.\u0275fac=function(n){return new(n||J)(t.Y36(u.qu),t.Y36(I.v),t.Y36(W.M),t.Y36(P.Z))},J.\u0275cmp=t.Xpm({type:J,selectors:[["pek-manufacturing-slice-tasks"]],viewQuery:function(n,e){if(1&n&&(t.Gf(ge,5),t.Gf(he,5)),2&n){let o;t.iGM(o=t.CRH())&&(e.paginator=o.first),t.iGM(o=t.CRH())&&(e.table=o.first)}},decls:45,vars:16,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[4,"ngIf","ngIfElse"],["period",""],[1,"page__tools"],["pButton","","type","button","icon","pi pi-calendar","label","Choice Date",1,"mr-2",3,"click"],["pButton","","type","button","icon","pi pi-calendar","label","Choice Period",3,"click"],[1,"page__content"],[1,"page__card"],[1,"form","mb-3",3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],["optionValue","id","optionLabel","fullName","placeholder","Choose Employees",3,"options","showClear","onChange","onClear",4,"ngIf","ngIfElse"],["formControlName","status","optionValue","id","optionLabel","name","placeholder","Choose status",3,"showClear","options","ngModelChange"],["formControlName","product_list_origin_id","optionValue","production_list_id","optionLabel","fullName","placeholder","Choose List",3,"showClear","options","ngModelChange",4,"ngIf","ngIfElse"],[1,"table-pagination-preloader"],["selectionMode","multiple","scrollHeight","calc(100vh - 22rem)",3,"rows","paginator","scrollable","value"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","paginatorright"],["pTemplate","emptymessage"],["class","paginator-return-pagination",4,"ngIf"],["spinner",""],["optionValue","id","optionLabel","fullName","placeholder","Choose Employees",3,"options","showClear","onChange","onClear"],["formControlName","product_list_origin_id","optionValue","production_list_id","optionLabel","fullName","placeholder","Choose List",3,"showClear","options","ngModelChange"],[1,"text-center",2,"width","5%"],[2,"width","13%"],[1,"text-center",2,"width","12%"],[1,"text-center",2,"width","10%"],[1,"text-center",2,"width","7%"],["pSortableColumn","searchFieldEmployee",2,"width","10%"],["field","searchFieldEmployee"],[2,"width","8%"],["pSortableColumn","status",1,"text-center",2,"width","10%"],["field","status"],[2,"width","10%"],[4,"ngFor","ngForOf"],["type","button","styleClass","p-button-text",3,"click"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"paginator-return-pagination"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t.YNc(5,me,3,4,"ng-container",4),t.YNc(6,fe,3,8,"ng-template",null,5,t.W1O),t.qZA()(),t.TgZ(8,"div",6)(9,"button",7),t.NdJ("click",function(){return e.onChoiceDate()}),t.qZA(),t.TgZ(10,"button",8),t.NdJ("click",function(){return e.onChoicePeriod()}),t.qZA()()()(),t.TgZ(11,"div",9)(12,"div",10)(13,"form",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"label"),t._uU(18,"Employees"),t.qZA(),t.YNc(19,xe,1,2,"p-multiSelect",15),t.qZA()(),t.TgZ(20,"div",13)(21,"div",14)(22,"label"),t._uU(23,"Status"),t.qZA(),t.TgZ(24,"p-dropdown",16),t.NdJ("ngModelChange",function(){return e.search$.next()}),t.qZA()()(),t.TgZ(25,"div",13)(26,"div",14)(27,"label"),t._uU(28,"Technologies"),t.qZA(),t._UZ(29,"pek-technology-picker"),t.qZA()(),t.TgZ(30,"div",13)(31,"div",14)(32,"label"),t._uU(33,"Production List Origin"),t.qZA(),t.YNc(34,Te,1,2,"p-dropdown",17),t.qZA()()()(),t.TgZ(35,"div",18)(36,"p-table",19,20),t.YNc(38,Ce,23,0,"ng-template",21),t.YNc(39,Ze,23,16,"ng-template",22),t.YNc(40,be,2,0,"ng-template",23),t.YNc(41,ke,4,3,"ng-template",24),t.qZA()(),t.YNc(42,we,3,0,"div",25),t.qZA()(),t.YNc(43,Ae,2,0,"ng-template",null,26,t.W1O)),2&n){const o=t.MAs(7),a=t.MAs(37),s=t.MAs(44);t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(2),t.Q6J("ngIf",!e.isPeriod)("ngIfElse",o),t.xp6(8),t.Q6J("formGroup",e.searchForm),t.xp6(6),t.Q6J("ngIf",!e.isLoading||e.isLoadingFilters)("ngIfElse",s),t.xp6(5),t.Q6J("showClear",!0)("options",e.taskStatuses),t.xp6(10),t.Q6J("ngIf",!e.isLoading||e.isLoadingFilters)("ngIfElse",s),t.xp6(2),t.Q6J("rows",10)("paginator",e.tasks.length>0)("scrollable",!0)("value",e.tasks),t.xp6(6),t.Q6J("ngIf",!a.paginator&&!e.isLoading&&e.tasks.length>0)}},dependencies:[f.Hq,f.zx,U.jx,u._Y,u.JJ,u.JL,u.sg,u.u,$.Lt,v.iA,v.lQ,v.fz,w.D,_e.a,pt.NU,_.sg,_.O5,_.uU],styles:[".form[_ngcontent-%COMP%]{margin-top:-.25rem}"]}),J=(0,A.gn)([(0,C.c)()],J);var Oe=l(7894),B=l(615);function qe(i,n){1&i&&(t.TgZ(0,"p",20),t._uU(1,"Choose the Employee to edit"),t.qZA())}function Ie(i,n){if(1&i&&(t.TgZ(0,"div",17),t.YNc(1,qe,2,0,"p",18),t._UZ(2,"p-menubar",19),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.selectedEmployee),t.xp6(1),t.ekj("disabled",!e.selectedEmployee),t.Q6J("model",e.menuItems)}}function Se(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",21),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",22),t._uU(4,"First Name "),t.qZA(),t.TgZ(5,"th",22),t._uU(6,"Last Name"),t.qZA(),t.TgZ(7,"th",23),t._uU(8,"Start Time"),t.qZA(),t.TgZ(9,"th",22),t._uU(10,"Max Working Time"),t.qZA(),t.TgZ(11,"th",22),t._uU(12,"Position"),t.qZA()())}function Ue(i,n){if(1&i&&(t.TgZ(0,"tr",24)(1,"td",25),t._uU(2),t.qZA(),t.TgZ(3,"td",22),t._uU(4),t.qZA(),t.TgZ(5,"td",22),t._uU(6),t.qZA(),t.TgZ(7,"td",23),t._uU(8),t.qZA(),t.TgZ(9,"td",22),t._uU(10),t.qZA(),t.TgZ(11,"td",22),t._uU(12),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(e.first_name),t.xp6(2),t.Oqu(e.last_name),t.xp6(2),t.Oqu(e.start_time),t.xp6(2),t.Oqu(e.max_working_time),t.xp6(2),t.Oqu(null==e.position?null:e.position.title)}}function Ne(i,n){1&i&&t._UZ(0,"i",29)}function Je(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function De(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",26),t.YNc(2,Ne,1,0,"i",27),t.YNc(3,Je,2,0,"span",28),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function Ee(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",30),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(12);return t.KtG(a.paginator=!1)}),t._uU(1,"All "),t.qZA()}}function Qe(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",31)(1,"p-button",30),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(12);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}let D=class{constructor(n,e){this.employeeService=n,this.modalService=e,this.menuItems=[{label:"Selected Employee",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.onEditEmployee()},{label:"Remove",icon:"pi pi-trash",command:()=>this.onRemoveEmployee()}]}],this.employees=[],this.search$=new R.X(null),this.isLoading=!1,this.employees$=this.search$.pipe((0,p.b)(()=>this.prepareForSearch()),(0,q.w)(()=>this.employeeService.get()),(0,M.U)(o=>this.convertEmployees(o)),(0,p.b)(o=>this.employees=o),(0,p.b)(()=>this.isLoading=!1),(0,C.t)(this))}ngOnInit(){this.employees$.subscribe()}convertEmployees(n){return n.map(e=>({...e,start_time:e.start_time.split(":").splice(-3,2).join(":"),max_working_time:e.max_working_time.split(":").splice(-3,2).join(":")}))}convertEmployee(n){return{...n,start_time:n.start_time.split(":").splice(-3,2).join(":"),max_working_time:n.max_working_time.split(":").splice(-3,2).join(":")}}onAddEmployee(){this.employeeService.createEditEmployeeModal("create").pipe((0,x.h)(n=>!!n)).subscribe(n=>this.employees.unshift(this.convertEmployee(n)))}prepareForSearch(){this.isLoading=!0,this.selectedEmployee=null,this.employees=[]}onEditEmployee(){this.employeeService.createEditEmployeeModal("edit",this.selectedEmployee).pipe((0,x.h)(n=>!!n)).subscribe(n=>{const e=this.employees.findIndex(o=>o.id===this.selectedEmployee.id);this.employees[e]=this.convertEmployee(n),this.selectedEmployee=this.employees[e]})}onRemoveEmployee(){this.modalService.confirm("danger").pipe((0,x.h)(n=>n)).subscribe(n=>{this.employeeService.delete(this.selectedEmployee.id).subscribe(()=>{const e=this.employees.findIndex(o=>o.id===this.selectedEmployee.id);this.employees.splice(e,1),this.selectedEmployee=null})})}};D.\u0275fac=function(n){return new(n||D)(t.Y36(Oe.G),t.Y36(P.Z))},D.\u0275cmp=t.Xpm({type:D,selectors:[["pek-manufacturing-employees"]],decls:19,vars:8,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","New Employee",3,"click"],[1,"page__content"],[1,"page__card"],[1,"page__table"],["selectionMode","single","scrollHeight","calc(100vh - 18.8rem)",3,"scrollable","paginator","rows","selection","value","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","paginatorright"],["class","paginator-return-pagination",4,"ngIf"],[1,"d-flex"],["class","subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],[1,"subtitle"],[1,"index-header","text-center",2,"width","5%"],[1,"text-center",2,"width","20%"],[1,"text-center",2,"width","15%"],[3,"pSelectableRow"],[1,"text-center",2,"width","5%"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],["type","button","styleClass","p-button-text",3,"click"],[1,"paginator-return-pagination"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t._uU(5,"Employees"),t.qZA()(),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return e.onAddEmployee()}),t.qZA()()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-table",9,10),t.NdJ("selectionChange",function(a){return e.selectedEmployee=a}),t.YNc(13,Ie,3,4,"ng-template",11),t.YNc(14,Se,13,0,"ng-template",12),t.YNc(15,Ue,13,7,"ng-template",13),t.YNc(16,De,4,3,"ng-template",14),t.YNc(17,Ee,2,0,"ng-template",15),t.qZA()(),t.YNc(18,Qe,3,0,"div",16),t.qZA()()),2&n){const o=t.MAs(12);t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(8),t.Q6J("scrollable",!0)("paginator",e.employees.length>0)("rows",10)("selection",e.selectedEmployee)("value",e.employees),t.xp6(7),t.Q6J("ngIf",!o.paginator&&!e.isLoading&&e.employees.length>0)}},dependencies:[f.Hq,f.zx,U.jx,B.nm,v.iA,v.Ei,w.D,_.O5]}),D=(0,A.gn)([(0,C.c)()],D);var X=l(2340),b=l(6319);let Le=(()=>{class i{constructor(e,o,a,s,r){this.fb=e,this.adapterService=o,this.employeePositionService=a,this.dialogRef=s,this.data=r,this.isSaving=!1,this.form=this.fb.group({title:[null,[u.kI.required]],rate:[null,[u.kI.required,u.kI.min(0)]]})}ngOnInit(){"edit"===this.data.type&&(this.form.addControl("id",this.fb.control(this.data.position.id)),this.form.patchValue(this.data.position))}onSave(){this.isSaving=!0;const e={...this.form.value};switch(this.data.type){case"create":this.createPosition(e);break;case"edit":this.editPosition(e)}}createPosition(e){this.employeePositionService.create(e).subscribe({next:o=>this.dialogRef.close(o),error:()=>this.isSaving=!1})}editPosition(e){this.employeePositionService.update(e).subscribe({next:o=>this.dialogRef.close(o),error:()=>this.isSaving=!1})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.qu),t.Y36(I.v),t.Y36(at),t.Y36(b.so),t.Y36(b.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-create-edit-position"]],decls:16,vars:6,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"form-group"],["for","name"],["id","name","formControlName","title","type","text","pInputText",""],["for","rate"],["formControlName","rate","type","number","step","0.01","id","rate","required","required","pInputText","",1,"form-control"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2),t.qZA()(),t.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"label",4),t._uU(7," Name* "),t.qZA(),t._UZ(8,"input",5),t.qZA(),t.TgZ(9,"div",3)(10,"label",6),t._uU(11," Rate* "),t.qZA(),t._UZ(12,"input",7),t.qZA()()(),t.TgZ(13,"mat-dialog-actions",8),t._UZ(14,"button",9),t.TgZ(15,"button",10),t.NdJ("click",function(){return o.onSave()}),t.qZA()()),2&e&&(t.xp6(2),t.hij(" ",o.data.type," Employee "),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(10),t.Q6J("mat-dialog-close",!1),t.xp6(1),t.Q6J("label",o.data.type)("loading",o.isSaving)("disabled",o.form.invalid))},dependencies:[f.Hq,V.o,u._Y,u.Fj,u.wV,u.JJ,u.JL,u.Q7,u.sg,u.u,b.ZT,b.xY,b.H8]}),i})();var _t=l(529);let at=(()=>{class i{constructor(e,o){this.httpClient=e,this.dialog=o,this.API_URL=X.N.base_url+X.N.staff_url,this.url="positions/"}get(e){let o="";return e&&e.forEach((a,s)=>{o+=s>0?"&"+a.name+"="+a.value:"?"+a.name+"="+a.value}),this.httpClient.get(this.API_URL+this.url+o).pipe((0,M.U)(a=>a.data))}create(e){return this.httpClient.post(this.API_URL+this.url,e).pipe((0,M.U)(o=>o.data))}update(e){return this.httpClient.put(this.API_URL+this.url+e.id+"/",e).pipe((0,M.U)(o=>o.data))}delete(e){return this.httpClient.delete(this.API_URL+this.url+e+"/")}createEditPositionModal(e,o){return this.dialog.open(Le,{width:"35rem",height:"auto",data:{type:e,position:o},autoFocus:!1,enterAnimationDuration:"250ms",panelClass:"modal-overflow-visible"}).afterClosed()}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(_t.eN),t.LFG(b.uw))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Ye(i,n){1&i&&(t.TgZ(0,"p",20),t._uU(1,"Choose the Position to edit"),t.qZA())}function Fe(i,n){if(1&i&&(t.TgZ(0,"div",17),t.YNc(1,Ye,2,0,"p",18),t._UZ(2,"p-menubar",19),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.selectedPosition),t.xp6(1),t.ekj("disabled",!e.selectedPosition),t.Q6J("model",e.menuItems)}}function Re(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",21),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",22),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"th",23),t._uU(6,"Rate"),t.qZA()())}function He(i,n){if(1&i&&(t.TgZ(0,"tr",24)(1,"td",25),t._uU(2),t.qZA(),t.TgZ(3,"td",22),t._uU(4),t.qZA(),t.TgZ(5,"td",23),t._uU(6),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(e.title),t.xp6(2),t.Oqu(e.rate)}}function ze(i,n){1&i&&t._UZ(0,"i",29)}function $e(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function Be(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",26),t.YNc(2,ze,1,0,"i",27),t.YNc(3,$e,2,0,"span",28),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",3),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function Ge(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",30),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(12);return t.KtG(a.paginator=!1)}),t._uU(1,"All "),t.qZA()}}function je(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",31)(1,"p-button",30),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(12);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}let E=class{constructor(n,e){this.modalService=n,this.employeePositionService=e,this.menuItems=[{label:"Selected Position",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.onEditPosition()},{label:"Remove",icon:"pi pi-trash",command:()=>this.onRemovePosition()}]}],this.positions=[],this.search$=new R.X(null),this.isLoading=!1,this.positions$=this.search$.pipe((0,p.b)(()=>this.prepareForSearch()),(0,q.w)(()=>this.employeePositionService.get()),(0,p.b)(o=>this.positions=o),(0,p.b)(()=>this.isLoading=!1),(0,C.t)(this))}ngOnInit(){this.positions$.subscribe()}onAddPosition(){this.employeePositionService.createEditPositionModal("create").pipe((0,x.h)(n=>!!n)).subscribe(n=>this.positions.unshift(n))}prepareForSearch(){this.isLoading=!0,this.selectedPosition=null,this.positions=[]}onEditPosition(){this.employeePositionService.createEditPositionModal("edit",this.selectedPosition).pipe((0,x.h)(n=>!!n)).subscribe(n=>{const e=this.positions.findIndex(o=>o.id===this.selectedPosition.id);this.positions[e]=n,this.selectedPosition=this.positions[e]})}onRemovePosition(){this.modalService.confirm("danger").pipe((0,x.h)(n=>n)).subscribe(n=>{this.employeePositionService.delete(this.selectedPosition.id).subscribe(()=>{const e=this.positions.findIndex(o=>o.id===this.selectedPosition.id);this.positions.splice(e,1),this.selectedPosition=null})})}};E.\u0275fac=function(n){return new(n||E)(t.Y36(P.Z),t.Y36(at))},E.\u0275cmp=t.Xpm({type:E,selectors:[["pek-manufacturing-positions"]],decls:19,vars:8,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","New Position",3,"click"],[1,"page__content"],[1,"page__card"],[1,"page__table"],["selectionMode","single","scrollHeight","calc(100vh - 18.8rem)",3,"scrollable","paginator","rows","selection","value","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","paginatorright"],["class","paginator-return-pagination",4,"ngIf"],[1,"d-flex"],["class","subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],[1,"subtitle"],[1,"index-header","text-center",2,"width","5%"],[2,"width","50%"],[2,"width","45%"],[3,"pSelectableRow"],[1,"text-center",2,"width","5%"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],["type","button","styleClass","p-button-text",3,"click"],[1,"paginator-return-pagination"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t._uU(5,"Positions"),t.qZA()(),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return e.onAddPosition()}),t.qZA()()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-table",9,10),t.NdJ("selectionChange",function(a){return e.selectedPosition=a}),t.YNc(13,Fe,3,4,"ng-template",11),t.YNc(14,Re,7,0,"ng-template",12),t.YNc(15,He,7,4,"ng-template",13),t.YNc(16,Be,4,3,"ng-template",14),t.YNc(17,Ge,2,0,"ng-template",15),t.qZA()(),t.YNc(18,je,3,0,"div",16),t.qZA()()),2&n){const o=t.MAs(12);t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(8),t.Q6J("scrollable",!0)("paginator",e.positions.length>0)("rows",10)("selection",e.selectedPosition)("value",e.positions),t.xp6(7),t.Q6J("ngIf",!o.paginator&&!e.isLoading&&e.positions.length>0)}},dependencies:[f.Hq,f.zx,U.jx,B.nm,v.iA,v.Ei,w.D,_.O5]}),E=(0,A.gn)([(0,C.c)()],E);var Ke=l(7973);function We(i,n){1&i&&(t.TgZ(0,"p",20),t._uU(1,"Choose the Machine to edit"),t.qZA())}function Ve(i,n){if(1&i&&(t.TgZ(0,"div",17),t.YNc(1,We,2,0,"p",18),t._UZ(2,"p-menubar",19),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.selectedMachine),t.xp6(1),t.ekj("disabled",!e.selectedMachine),t.Q6J("model",e.menuItems)}}function Xe(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",21),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",22),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"th",22),t._uU(6,"Description"),t.qZA(),t.TgZ(7,"th",23),t._uU(8,"Max working time"),t.qZA()())}function tn(i,n){if(1&i&&(t.TgZ(0,"tr",24)(1,"td",25),t._uU(2),t.qZA(),t.TgZ(3,"td",22),t._uU(4),t.qZA(),t.TgZ(5,"td",22),t._uU(6),t.qZA(),t.TgZ(7,"td",23),t._uU(8),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.description),t.xp6(2),t.Oqu(e.max_working_time)}}function en(i,n){1&i&&t._UZ(0,"i",29)}function nn(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function on(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",26),t.YNc(2,en,1,0,"i",27),t.YNc(3,nn,2,0,"span",28),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",4),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function an(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",30),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(12);return t.KtG(a.paginator=!1)}),t._uU(1,"All "),t.qZA()}}function rn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",31)(1,"p-button",30),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(12);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}let Q=class{constructor(n,e){this.modalService=n,this.machineService=e,this.menuItems=[{label:"Selected Machine",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.onEditMachine()},{label:"Remove",icon:"pi pi-trash",command:()=>this.onRemoveMachine()}]}],this.machines=[],this.search$=new R.X(null),this.isLoading=!1,this.machines$=this.search$.pipe((0,p.b)(()=>this.prepareForSearch()),(0,q.w)(()=>this.machineService.get()),(0,p.b)(o=>this.machines=o),(0,p.b)(()=>this.isLoading=!1),(0,C.t)(this))}ngOnInit(){this.machines$.subscribe()}onAddMachine(){this.machineService.createEditMachineModal("create").pipe((0,x.h)(n=>!!n)).subscribe(n=>this.machines.unshift(n))}prepareForSearch(){this.isLoading=!0,this.selectedMachine=null,this.machines=[]}onEditMachine(){this.machineService.createEditMachineModal("edit",this.selectedMachine).pipe((0,x.h)(n=>!!n)).subscribe(n=>{const e=this.machines.findIndex(o=>o.id===this.selectedMachine.id);this.machines[e]=n,this.selectedMachine=this.machines[e]})}onRemoveMachine(){this.modalService.confirm("danger").pipe((0,x.h)(n=>n)).subscribe(()=>{this.machineService.delete(this.selectedMachine.id).subscribe(()=>{const n=this.machines.findIndex(e=>e.id===this.selectedMachine.id);this.machines.splice(n,1),this.selectedMachine=null})})}};Q.\u0275fac=function(n){return new(n||Q)(t.Y36(P.Z),t.Y36(Ke.x))},Q.\u0275cmp=t.Xpm({type:Q,selectors:[["pek-manufacturing-machines"]],decls:19,vars:8,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","New Machine",3,"click"],[1,"page__content"],[1,"page__card"],[1,"page__table"],["selectionMode","single","scrollHeight","calc(100vh - 18.8rem)",3,"scrollable","paginator","rows","selection","value","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","paginatorright"],["class","paginator-return-pagination",4,"ngIf"],[1,"d-flex"],["class","subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],[1,"subtitle"],[1,"index-header","text-center",2,"width","5%"],[2,"width","35%"],[1,"text-center",2,"width","25%"],[3,"pSelectableRow"],[1,"text-center",2,"width","5%"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],["type","button","styleClass","p-button-text",3,"click"],[1,"paginator-return-pagination"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t._uU(5,"Machines"),t.qZA()(),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return e.onAddMachine()}),t.qZA()()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-table",9,10),t.NdJ("selectionChange",function(a){return e.selectedMachine=a}),t.YNc(13,Ve,3,4,"ng-template",11),t.YNc(14,Xe,9,0,"ng-template",12),t.YNc(15,tn,9,5,"ng-template",13),t.YNc(16,on,4,3,"ng-template",14),t.YNc(17,an,2,0,"ng-template",15),t.qZA()(),t.YNc(18,rn,3,0,"div",16),t.qZA()()),2&n){const o=t.MAs(12);t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(8),t.Q6J("scrollable",!0)("paginator",e.machines.length>0)("rows",10)("selection",e.selectedMachine)("value",e.machines),t.xp6(7),t.Q6J("ngIf",!o.paginator&&!e.isLoading&&e.machines.length>0)}},dependencies:[f.Hq,f.zx,U.jx,B.nm,v.iA,v.Ei,w.D,_.O5]}),Q=(0,A.gn)([(0,C.c)()],Q);var sn=l(3817);let cn=(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-order-statuses"]],decls:17,vars:5,consts:[[1,"procurement-order-statuses"],[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],[1,"page__content"],[1,"mb-4"],[1,"page__card","mb-4"],[3,"statusType"],[1,"page__card"],[3,"statusType","isAutoStatus"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._UZ(4,"pek-module-icon",4),t.TgZ(5,"h1"),t._uU(6,"Order Statuses"),t.qZA()(),t._UZ(7,"div",5),t.qZA()(),t.TgZ(8,"div",6)(9,"h2",7),t._uU(10,"Manual Statuses"),t.qZA(),t.TgZ(11,"div",8),t._UZ(12,"pek-order-statuses",9),t.qZA(),t.TgZ(13,"h2",7),t._uU(14,"Automatic Statuses"),t.qZA(),t.TgZ(15,"div",10),t._UZ(16,"pek-order-statuses",11),t.qZA()()()),2&e&&(t.xp6(4),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(8),t.Q6J("statusType",3),t.xp6(4),t.Q6J("statusType",3)("isAutoStatus",!0))},dependencies:[w.D,sn.v],styles:["h2[_ngcontent-%COMP%]{font-size:1.1875rem;font-weight:600}"]}),i})();var ln=l(8382),gt=l(8789),dn=l(3426),un=l(1997),rt=l(585),pn=l(8695);function _n(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-dropdown",3),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedListId=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onSelectList())}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("options",e.lists)("ngModel",e.selectedListId)("showClear",!0)("filter",!0)}}function gn(i,n){1&i&&(t.TgZ(0,"div",4),t._UZ(1,"i",5),t.qZA())}let hn=(()=>{class i{constructor(e){this.listService=e,this.selectRootListId=new t.vpe,this.isLoading=!0,this.lists=[]}ngOnInit(){this.listService.get([{name:"list_order_accounting_type",value:this.accountingType}]).pipe().subscribe(e=>{this.lists=e,this.lists.forEach(o=>o.fullName=`(${o.id}) ${o.nomenclature.code}~${o.nomenclature.name}`),this.selectedListId&&(this.selectedListId=this.currentListId),this.isLoading=!1})}onSelectList(){this.selectRootListId.emit(this.selectedListId)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(pn.X))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-root-list-picker"]],inputs:{currentListId:"currentListId",accountingType:"accountingType"},outputs:{selectRootListId:"selectRootListId"},decls:4,vars:2,consts:[[1,"root-list-picker"],["placeholder","Select Root List","optionLabel","fullName","optionValue","id",3,"options","ngModel","showClear","filter","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["placeholder","Select Root List","optionLabel","fullName","optionValue","id",3,"options","ngModel","showClear","filter","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.YNc(1,_n,1,4,"p-dropdown",1),t.qZA(),t.YNc(2,gn,2,0,"ng-template",null,2,t.W1O)),2&e){const a=t.MAs(3);t.xp6(1),t.Q6J("ngIf",!o.isLoading)("ngIfElse",a)}},dependencies:[_.O5,u.JJ,$.Lt,u.On]}),i})();const mn=["paginator"];function fn(i,n){1&i&&(t.TgZ(0,"p",29),t._uU(1,"Choose the Order to edit"),t.qZA())}function xn(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",30),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",31),t._uU(4,"List ID's"),t.qZA(),t.TgZ(5,"th",32),t._uU(6,"Date"),t.qZA(),t.TgZ(7,"th",33),t._uU(8,"Order ID"),t.qZA(),t.TgZ(9,"th",34),t._uU(10,"Comment"),t.qZA(),t.TgZ(11,"th",35),t._uU(12,"Root Lists"),t.qZA(),t.TgZ(13,"th",32),t._uU(14,"Status"),t.qZA()())}function Tn(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,","),t.qZA())}function Cn(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,Tn,2,0,"span",39),t.qZA()),2&i){const e=n.$implicit,o=n.index,a=t.oxw().$implicit;t.xp6(1),t.hij(" ",e,""),t.xp6(1),t.Q6J("ngIf",o<a.list_ids.length-1)}}function vn(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(RMA)"),t.qZA())}function Mn(i,n){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.AsE(" ",e.root_production_list_products[0].nomenclature.code," ~",e.root_production_list_products[0].nomenclature.name," ")}}function Zn(i,n){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" (",null==e.root_production_list_products?null:e.root_production_list_products.length,") ")}}function bn(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.status.value," ")}}function Pn(i,n){if(1&i&&(t.TgZ(0,"div",43),t.YNc(1,bn,2,1,"div",39),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.is_active)}}function yn(i,n){1&i&&(t.TgZ(0,"tr",20)(1,"div"),t._UZ(2,"i",44),t.qZA()())}function kn(i,n){if(1&i&&(t.TgZ(0,"tr",36)(1,"td",37),t._uU(2),t.qZA(),t.TgZ(3,"td",33),t.YNc(4,Cn,3,2,"span",38),t.qZA(),t.TgZ(5,"td",32)(6,"div"),t._uU(7),t.ALo(8,"date"),t.qZA()(),t.TgZ(9,"td",33),t._uU(10),t.YNc(11,vn,2,0,"b",39),t.qZA(),t.TgZ(12,"td",34)(13,"div"),t._uU(14),t.qZA()(),t.TgZ(15,"td",35),t.YNc(16,Mn,2,2,"ng-container",39),t.YNc(17,Zn,2,1,"ng-container",39),t.qZA(),t.TgZ(18,"td",40),t.YNc(19,Pn,2,1,"div",41),t.qZA()(),t.YNc(20,yn,3,0,"tr",42)),2&i){const e=n.$implicit,o=n.rowIndex,a=t.oxw();t.ekj("time-overdue",e.isReceiptDateOverdue),t.Q6J("pSelectableRow",e),t.xp6(2),t.hij(" ",10*(a.currentPage-1)+o+1," "),t.xp6(2),t.Q6J("ngForOf",e.list_ids),t.xp6(3),t.Oqu(t.xi3(8,13,e.created,"dd/MM/yyyy HH:mm")),t.xp6(3),t.hij(" ",e.id," "),t.xp6(1),t.Q6J("ngIf",e.contains_rma_invoices),t.xp6(3),t.Oqu(e.comment),t.xp6(2),t.Q6J("ngIf",e.root_production_list_products.length>0),t.xp6(1),t.Q6J("ngIf",(null==e.root_production_list_products?null:e.root_production_list_products.length)>0),t.xp6(2),t.Q6J("ngForOf",e.statuses),t.xp6(1),t.Q6J("ngIf",a.isLoading)}}function wn(i,n){1&i&&t._UZ(0,"i",47)}function An(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function On(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",45),t.YNc(2,wn,1,0,"i",46),t.YNc(3,An,2,0,"span",39),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",7),t.xp6(1),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading)}}function qn(i,n){1&i&&(t.TgZ(0,"div",48),t._UZ(1,"i",47),t.qZA())}function In(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",49)(1,"p-paginator",50,51),t.NdJ("onPageChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.paginate(a))}),t.qZA(),t.TgZ(3,"p-button",52),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onShowAll(!0))}),t._uU(4," All "),t.qZA()()}if(2&i){const e=t.oxw();t.ekj("paginator-wrapper_hide",0===e.ordersCount),t.xp6(1),t.Q6J("rows",10)("totalRecords",e.ordersCount)}}function Sn(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",53)(1,"p-button",54),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onShowAll(!1))}),t._uU(2," Return pagination "),t.qZA()()}}let L=class{constructor(n,e,o,a,s){this.fb=n,this.orderService=e,this.adapterService=o,this.modalService=a,this.router=s,this.searchForm=this.fb.group({order_root_list_id:[null],active_status__in:[null],created_after:[null],created_before:[null]}),this.menuItems=[{label:"Selected Order",items:[{label:"Own Production Item",icon:"pi pi-pencil",command:()=>this.onGoToOderPage()},{label:"Remove",icon:"pi pi-trash",command:()=>this.onRemoveOrder()}]}],this.isStartFirstPage=!1,this.isShowAll=!1,this.finalStatusSelected=!1,this.currentPage=1,this.queryKey=this.adapterService.generateQueryKey(this.searchForm),this.query=[],this.isLoading=!0,this.ordersCount=0,this.selectedOrder=null,this.isCreating=!1,this.search$=new R.X(null),this.orders$=this.search$.pipe((0,p.b)(()=>this.prepareForSearch()),(0,q.w)(()=>(0,ln.s)(()=>!this.isShowAll,this.orderService.getForPagination(this.query).pipe((0,p.b)(r=>this.ordersCount=r.count),(0,M.U)(r=>r.results),(0,M.U)(r=>this.transformOrders(r))),this.orderService.get(this.query).pipe((0,p.b)(r=>this.ordersCount=r.length),(0,M.U)(r=>this.transformOrders(r))))),(0,p.b)(()=>this.paginateToFistPage()),(0,p.b)(()=>this.isLoading=!1),(0,C.t)(this))}ngOnInit(){}transformOrders(n){return n.forEach(e=>{e.order_products.forEach(o=>{o.is_task_date_overdue&&(e.isReceiptDateOverdue=!0)}),0===e.statuses.length&&(e.statuses=[{status:{value:"Empty"}}]),e.list_ids=[...new Set(e.list_ids)]}),n}prepareForSearch(){this.isLoading=!0,this.selectedOrder=null;const n=this.adapterService.generateQueryKey(this.searchForm);n!==this.queryKey&&(this.currentPage=1,this.queryKey=n,this.isStartFirstPage=!0),this.query=[{name:"accounting_type",value:3},{name:"exclude_with_active_final_status",value:!this.finalStatusSelected},{name:"page",value:this.currentPage}],this.isShowAll||this.query.push({name:"paginated",value:!0});for(const e in this.searchForm.controls)null!==this.searchForm.controls[e].value&&(this.searchForm.controls[e].value instanceof Date?this.query.push({name:e,value:this.adapterService.dateAdapter(this.searchForm.controls[e].value)}):this.query.push({name:e,value:this.searchForm.controls[e].value}))}paginate(n){this.isStartFirstPage||(this.currentPage=n.page+1,this.search$.next())}paginateToFistPage(){this.isStartFirstPage&&this.paginator?.changePage(0),this.isStartFirstPage=!1}onShowAll(n){this.isShowAll=n,this.isShowAll||(this.currentPage=1),this.search$.next()}onSelectStatuses(n){this.searchForm.get("active_status__in").patchValue(n?.join(",")||null),this.search$.next()}onSelectRootList(n){this.searchForm.get("order_root_list_id").patchValue(n),this.search$.next()}onCreateOrder(){this.modalService.confirm("success").subscribe(n=>{n&&(this.isCreating=!0,this.orderService.create({accounting_type:3,can_select_supplier:!1}).subscribe(e=>{this.isCreating=!1,this.router.navigate(["/manufacturing/orders/order/",e.id])}))})}onRemoveOrder(){this.modalService.confirm("danger").pipe((0,x.h)(n=>n),(0,p.b)(()=>this.isCreating=!0),(0,q.w)(()=>this.orderService.delete(this.selectedOrder.id)),(0,p.b)(()=>this.isCreating=!1),(0,p.b)(()=>this.search$.next())).subscribe()}onGoToOderPage(){window.open("/manufacturing/orders/order/"+this.selectedOrder?.id,"_blank")}};L.\u0275fac=function(n){return new(n||L)(t.Y36(u.qu),t.Y36(gt.p),t.Y36(I.v),t.Y36(P.Z),t.Y36(Z.F0))},L.\u0275cmp=t.Xpm({type:L,selectors:[["pek-manufacturing-orders"]],viewQuery:function(n,e){if(1&n&&t.Gf(mn,5),2&n){let o;t.iGM(o=t.CRH())&&(e.paginator=o.first)}},decls:48,vars:23,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","Create Order to Own Production",3,"loading","click"],[1,"page__content"],[1,"page__card"],[1,"form","mb-3",3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],["formControlName","created_after","dataType","date","dateFormat","dd/mm/yy",3,"showButtonBar","readonlyInput","ngModelChange"],["dataType","date","formControlName","created_before","dateFormat","dd/mm/yy",3,"showButtonBar","readonlyInput","ngModelChange"],[3,"accountingType","selectRootListId"],[3,"accountingType","selectStatuses","isFinalStatusSelected"],[1,"col-3","d-flex","align-items-center"],["class","subtitle",4,"ngIf"],[1,"col-3","d-flex"],[1,"ml-auto","menubar",3,"model"],[1,"table-pagination-preloader"],["selectionMode","single","scrollHeight","calc(100vh - 24.5rem)",3,"rows","scrollable","selection","value","selectionChange"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","pagination-preloader pagination-preloader_bord",4,"ngIf"],["class","paginator-wrapper",3,"paginator-wrapper_hide",4,"ngIf"],["class","paginator-return-pagination",4,"ngIf"],[1,"subtitle"],[1,"index-header","text-center",2,"width","5%"],[1,"index-header","text-center",2,"width","15%"],[1,"text-center",2,"width","15%"],[1,"text-center",2,"width","10%"],[2,"width","20%"],[2,"width","25%"],[3,"pSelectableRow"],[1,"text-center",2,"width","5%"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"width","15%"],["class","text-center",4,"ngFor","ngForOf"],["class","table-pagination-preloader",4,"ngIf"],[1,"text-center"],[1,"fas","fa-circle-notch","fa-spin","fa-3x"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"pagination-preloader","pagination-preloader_bord"],[1,"paginator-wrapper"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["type","button","styleClass","p-button-text",1,"paginator-all",3,"click"],[1,"paginator-return-pagination"],["type","button","styleClass","p-button-text",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t._uU(5,"Execution Orders"),t.qZA()(),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return e.onCreateOrder()}),t.qZA()()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"form",8)(11,"div",9)(12,"div",10)(13,"div",11)(14,"label"),t._uU(15,"From"),t.qZA(),t.TgZ(16,"p-calendar",12),t.NdJ("ngModelChange",function(){return e.search$.next()}),t.qZA()()(),t.TgZ(17,"div",10)(18,"div",11)(19,"label"),t._uU(20,"To"),t.qZA(),t.TgZ(21,"p-calendar",13),t.NdJ("ngModelChange",function(){return e.search$.next()}),t.qZA()()(),t.TgZ(22,"div",10)(23,"div",11)(24,"label"),t._uU(25,"Root List"),t.qZA(),t.TgZ(26,"pek-root-list-picker",14),t.NdJ("selectRootListId",function(a){return e.onSelectRootList(a)}),t.qZA()()(),t.TgZ(27,"div",10)(28,"div",11)(29,"label"),t._uU(30,"Status"),t.qZA(),t.TgZ(31,"pek-multi-statuses-picker",15),t.NdJ("selectStatuses",function(a){return e.onSelectStatuses(a)})("isFinalStatusSelected",function(a){return e.finalStatusSelected=a}),t.qZA()()(),t.TgZ(32,"div",16),t.YNc(33,fn,2,0,"p",17),t.qZA(),t._UZ(34,"div",10)(35,"div",10),t.TgZ(36,"div",18),t._UZ(37,"p-menubar",19),t.qZA()()(),t.TgZ(38,"div",20)(39,"p-table",21,22),t.NdJ("selectionChange",function(a){return e.selectedOrder=a}),t.ALo(41,"async"),t.YNc(42,xn,15,0,"ng-template",23),t.YNc(43,kn,21,16,"ng-template",24),t.YNc(44,On,4,3,"ng-template",25),t.qZA(),t.YNc(45,qn,2,0,"div",26),t.YNc(46,In,5,4,"div",27),t.qZA(),t.YNc(47,Sn,3,0,"div",28),t.qZA()()),2&n&&(t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(4),t.Q6J("loading",e.isCreating),t.xp6(3),t.Q6J("formGroup",e.searchForm),t.xp6(6),t.Q6J("showButtonBar",!0)("readonlyInput",!0),t.xp6(5),t.Q6J("showButtonBar",!0)("readonlyInput",!0),t.xp6(5),t.Q6J("accountingType",3),t.xp6(5),t.Q6J("accountingType",3),t.xp6(2),t.Q6J("ngIf",!e.selectedOrder),t.xp6(4),t.ekj("disabled",!e.selectedOrder),t.Q6J("model",e.menuItems),t.xp6(2),t.Q6J("rows",10)("scrollable",!0)("selection",e.selectedOrder)("value",t.lcZ(41,21,e.orders$)),t.xp6(6),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isShowAll),t.xp6(1),t.Q6J("ngIf",e.isShowAll))},dependencies:[dn.p,f.Hq,f.zx,U.jx,u._Y,u.JJ,u.JL,u.sg,u.u,B.nm,v.iA,v.Ei,w.D,un.D,rt.f,hn,_.sg,_.O5,_.Ov,_.uU],styles:[".form[_ngcontent-%COMP%]{margin-top:-.25rem}.time-overdue[_ngcontent-%COMP%]{background:#f5dfe1!important}.menubar[_ngcontent-%COMP%]{margin-top:.25rem}"]}),L=(0,A.gn)([(0,C.c)()],L);var Un=l(4351),Nn=l(4986),Jn=l(7272),tt=l(5698),Dn=l(4482),En=l(5403),Qn=l(5032),ht=l(9718),Yn=l(5577);function mt(i,n){return n?e=>(0,Jn.z)(n.pipe((0,tt.q)(1),function Ln(){return(0,Dn.e)((i,n)=>{i.subscribe((0,En.x)(n,Qn.Z))})}()),e.pipe(mt(i))):(0,Yn.z)((e,o)=>i(e,o).pipe((0,tt.q)(1),(0,ht.h)(e)))}var Fn=l(5963),Hn=l(2076),Y=(()=>{return(i=Y||(Y={}))[i.LIST=0]="LIST",i[i.HIERARCHY=1]="HIERARCHY",Y;var i})(),ft=l(5303),zn=l(733),$n=l(3691),Bn=l(439),Gn=l(428),xt=l(1989),jn=l(8666),Tt=l(384);function Kn(i,n){if(1&i&&(t.TgZ(0,"div",10)(1,"div",11)(2,"h4"),t._uU(3,"Code"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA()(),t.TgZ(6,"div",12)(7,"h4"),t._uU(8,"Name"),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.qZA()(),t.TgZ(11,"div",13)(12,"h4"),t._uU(13,"Id"),t.qZA(),t.TgZ(14,"p"),t._uU(15),t.qZA()(),t.TgZ(16,"div",14)(17,"h4"),t._uU(18,"Order Creation Date"),t.qZA(),t.TgZ(19,"p"),t._uU(20),t.ALo(21,"date"),t.qZA()()()),2&i){const e=t.oxw();t.xp6(5),t.Oqu(null==e.order.root_production_list_products[0]?null:e.order.root_production_list_products[0].nomenclature.code),t.xp6(5),t.Oqu(null==e.order.root_production_list_products[0]?null:e.order.root_production_list_products[0].nomenclature.name),t.xp6(5),t.Oqu(e.orderId),t.xp6(5),t.Oqu(t.xi3(21,4,e.order.created,"dd.MM.y"))}}function Wn(i,n){1&i&&(t.TgZ(0,"div",15),t._uU(1," No Records Found "),t.qZA())}function Vn(i,n){1&i&&t._UZ(0,"i",27)}function Xn(i,n){1&i&&(t.TgZ(0,"p"),t._uU(1,"X"),t.qZA())}function ti(i,n){1&i&&(t.TgZ(0,"p"),t._uU(1,"\u2014"),t.qZA())}function ei(i,n){1&i&&(t.TgZ(0,"p"),t._uU(1,"In QC"),t.qZA())}function ni(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Not passed)"),t.qZA())}function ii(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Passed)"),t.qZA())}function oi(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Partly passed)"),t.qZA())}function ai(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.YNc(2,ni,2,0,"span",26),t.YNc(3,ii,2,0,"span",26),t.YNc(4,oi,2,0,"span",26),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.AsE("",e.passed_quantity,"/",e.initial_quantity," "),t.xp6(1),t.Q6J("ngIf","0"===e.quality_control),t.xp6(1),t.Q6J("ngIf","1"===e.quality_control),t.xp6(1),t.Q6J("ngIf","2"===e.quality_control)}}function ri(i,n){if(1&i&&(t.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"h4"),t._uU(4,"#"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"div",21)(8,"h4"),t._uU(9,"Code"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.qZA()(),t.TgZ(12,"div",21)(13,"h4"),t._uU(14,"Name"),t.qZA(),t.TgZ(15,"p"),t._uU(16),t.qZA()(),t.TgZ(17,"div",22)(18,"h4"),t._uU(19,"Technology"),t.qZA(),t.TgZ(20,"p"),t._uU(21),t.qZA()(),t.TgZ(22,"div",23)(23,"h4"),t._uU(24,"Quantity"),t.qZA(),t._uU(25),t.qZA(),t.TgZ(26,"div",24)(27,"h4"),t._uU(28,"Employees"),t.qZA()(),t.TgZ(29,"div",21)(30,"h4"),t._uU(31,"Ready"),t.qZA(),t.YNc(32,Vn,1,0,"i",25),t.YNc(33,Xn,2,0,"p",26),t.qZA(),t.TgZ(34,"div",22)(35,"h4"),t._uU(36,"QC passed"),t.qZA(),t.YNc(37,ti,2,0,"p",26),t.YNc(38,ei,2,0,"p",26),t.YNc(39,ai,5,5,"p",26),t.qZA()()()),2&i){const e=n.$implicit,o=n.index;t.xp6(6),t.Oqu(o+1),t.xp6(5),t.Oqu(e.nomenclature.code),t.xp6(5),t.Oqu(e.nomenclature.name),t.xp6(5),t.Oqu(null==e.current_technology?null:e.current_technology.name),t.xp6(4),t.hij(" ",e.quantity," "),t.xp6(7),t.Q6J("ngIf",e.isReady),t.xp6(1),t.Q6J("ngIf",!e.isReady),t.xp6(4),t.Q6J("ngIf",!e.quality_control&&!e.is_technology_ready),t.xp6(1),t.Q6J("ngIf",e.is_technology_ready&&!e.quality_control),t.xp6(1),t.Q6J("ngIf",e.quality_control)}}function si(i,n){if(1&i&&(t.TgZ(0,"div",16),t.YNc(1,ri,40,10,"div",17),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.products)}}function ci(i,n){1&i&&(t.TgZ(0,"div",15),t._uU(1," No Records Found "),t.qZA())}function li(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.material_nomenclature.code," ")}}function di(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.order_product_nomenclature.code," ")}}function ui(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.list_product.nomenclature.code," ")}}function pi(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.material_nomenclature.name," ")}}function _i(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.order_product_nomenclature.name," ")}}function gi(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.list_product.nomenclature.name," ")}}function hi(i,n){if(1&i&&(t.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"h4"),t._uU(4,"#"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"div",21)(8,"h4"),t._uU(9,"Code"),t.qZA(),t.YNc(10,li,2,1,"p",26),t.YNc(11,di,2,1,"p",26),t.YNc(12,ui,2,1,"p",26),t.qZA(),t.TgZ(13,"div",29)(14,"h4"),t._uU(15,"Name"),t.qZA(),t.YNc(16,pi,2,1,"p",26),t.YNc(17,_i,2,1,"p",26),t.YNc(18,gi,2,1,"p",26),t.qZA(),t.TgZ(19,"div",22)(20,"h4"),t._uU(21,"Technology"),t.qZA(),t.TgZ(22,"p"),t._uU(23),t.qZA()(),t.TgZ(24,"div",22)(25,"h4"),t._uU(26,"Req Quantity"),t.qZA(),t._uU(27),t.qZA()()()),2&i){const e=n.$implicit,o=n.index;t.xp6(6),t.Oqu(o+1),t.xp6(4),t.Q6J("ngIf",e.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",e.list_product),t.xp6(4),t.Q6J("ngIf",e.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",e.list_product),t.xp6(5),t.Oqu(null==e?null:e.technology),t.xp6(4),t.hij(" ",null==e?null:e.totalInitialQuantity," ")}}function mi(i,n){if(1&i&&(t.TgZ(0,"div",28),t.YNc(1,hi,28,9,"div",17),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.materials)}}function fi(i,n){1&i&&(t.TgZ(0,"div",15),t._uU(1," No Records Found "),t.qZA())}function xi(i,n){if(1&i&&(t.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"h4"),t._uU(4,"#"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"div",30)(8,"h4"),t._uU(9,"Name"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.qZA()(),t.TgZ(12,"div",24)(13,"h4"),t._uU(14,"Description"),t.qZA(),t.TgZ(15,"p"),t._uU(16),t.qZA()(),t.TgZ(17,"div",22)(18,"h4"),t._uU(19,"Duration"),t.qZA(),t.TgZ(20,"p"),t._uU(21),t.qZA()()()()),2&i){const e=n.$implicit,o=n.index;t.xp6(6),t.Oqu(o+1),t.xp6(5),t.Oqu(e.machine.name),t.xp6(5),t.Oqu(e.machine.description),t.xp6(5),t.Oqu(e.duration)}}function Ti(i,n){if(1&i&&(t.TgZ(0,"div",28),t.YNc(1,xi,22,4,"div",17),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.machines)}}let Ci=(()=>{class i{constructor(e){this.auth=e,this.products=[],this.materials=[],this.machines=[],this.currentDate=new Date}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Tt.e8))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-order-page-print"]],inputs:{order:"order",orderId:"orderId",products:"products",materials:"materials",machines:"machines"},decls:46,vars:13,consts:[[1,"print-order","print-order_show"],[1,"print-content"],["class","print-content__header",4,"ngIf"],["class","table-empty",4,"ngIf"],["class","print-content__table print-content__table_items",4,"ngIf"],["class","print-content__table print-content__table_materials",4,"ngIf"],[1,"pagebreak"],[1,"user-info"],[1,"left"],[1,"right"],[1,"print-content__header"],[1,"print-content__header-col","print-content__header-col_code"],[1,"print-content__header-col","print-content__header-col_name"],[1,"print-content__header-col","print-content__header-col_id"],[1,"print-content__header-col","print-content__header-col_date"],[1,"table-empty"],[1,"print-content__table","print-content__table_items"],["class","print-content__table-row",4,"ngFor","ngForOf"],[1,"print-content__table-row"],[1,"print-content__table-inner"],[1,"print-content__table-col",2,"width","5%"],[1,"print-content__table-col",2,"width","30%"],[1,"print-content__table-col",2,"width","20%"],[1,"print-content__table-col",2,"width","15%"],[1,"print-content__table-col",2,"width","35%"],["class","fas fa-check text-success",4,"ngIf"],[4,"ngIf"],[1,"fas","fa-check","text-success"],[1,"print-content__table","print-content__table_materials"],[1,"print-content__table-col",2,"width","25%"],[1,"print-content__table-col",2,"width","40%"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2"),t._uU(3,"Execution Order Information"),t.qZA(),t.YNc(4,Kn,22,7,"div",2),t.TgZ(5,"h3"),t._uU(6,"Ordered Items"),t.qZA(),t.YNc(7,Wn,2,0,"div",3),t.YNc(8,si,2,1,"div",4),t.TgZ(9,"h3"),t._uU(10,"Materials"),t.qZA(),t.YNc(11,ci,2,0,"div",3),t.YNc(12,mi,2,1,"div",5),t.TgZ(13,"h3"),t._uU(14,"Machines"),t.qZA(),t.YNc(15,fi,2,0,"div",3),t.YNc(16,Ti,2,1,"div",5),t.qZA(),t._UZ(17,"div",6),t.TgZ(18,"div",7)(19,"div",8)(20,"div")(21,"h3"),t._uU(22,"Sent"),t.qZA(),t.TgZ(23,"p"),t._uU(24),t.qZA()(),t.TgZ(25,"div")(26,"h3"),t._uU(27,"Date"),t.qZA(),t.TgZ(28,"p"),t._uU(29),t.ALo(30,"date"),t.qZA()(),t.TgZ(31,"div")(32,"h3"),t._uU(33,"Signed"),t.qZA()()(),t.TgZ(34,"div",9)(35,"div")(36,"h3"),t._uU(37,"Retrieved"),t.qZA(),t._UZ(38,"p"),t.qZA(),t.TgZ(39,"div")(40,"h3"),t._uU(41,"Date"),t.qZA(),t._UZ(42,"p"),t.qZA(),t.TgZ(43,"div")(44,"h3"),t._uU(45,"Signed"),t.qZA()()()()()),2&e&&(t.xp6(4),t.Q6J("ngIf",o.order),t.xp6(3),t.Q6J("ngIf",0===o.products.length),t.xp6(1),t.Q6J("ngIf",o.products.length>0),t.xp6(3),t.Q6J("ngIf",0===o.materials.length),t.xp6(1),t.Q6J("ngIf",o.materials.length>0),t.xp6(3),t.Q6J("ngIf",0===o.machines.length),t.xp6(1),t.Q6J("ngIf",o.machines.length>0),t.xp6(8),t.AsE("",o.auth.user.first_name," ",o.auth.user.last_name,""),t.xp6(5),t.Oqu(t.xi3(30,10,o.currentDate,"dd.MM.y")))},dependencies:[_.sg,_.O5,_.uU],styles:["@media print{.print-order_hide[_ngcontent-%COMP%]{display:none}}.print-order_show[_ngcontent-%COMP%]{display:none;left:0;top:0;right:0}@media print{.print-order_show[_ngcontent-%COMP%]{display:block}}.print-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:500;font-size:1.5rem;line-height:1.2;margin-bottom:2rem}.print-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:500;font-size:1.3125rem;margin:0 0 1.25rem;line-height:1.2}.print-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:500;font-size:1.0625rem;margin:0 0 .625rem;line-height:1.2}.print-content__header[_ngcontent-%COMP%]{display:flex;margin-bottom:3rem}.print-content__header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1875rem}.print-content__header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;margin:0}.print-content__header-col[_ngcontent-%COMP%]{word-break:break-all}.print-content__header-col_code[_ngcontent-%COMP%]{width:30%}.print-content__header-col_name[_ngcontent-%COMP%]{width:32%}.print-content__header-col_id[_ngcontent-%COMP%]{width:13%}.print-content__header-col_date[_ngcontent-%COMP%]{width:25%}.print-content__table[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.0625rem;line-height:1.4;margin:0;word-wrap:break-word}.print-content__table[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem}.print-content__table_items[_ngcontent-%COMP%], .print-content__table_materials[_ngcontent-%COMP%], .print-content__table_machines[_ngcontent-%COMP%]{margin-bottom:3rem}.print-content__table-row[_ngcontent-%COMP%]{page-break-inside:avoid;padding:.5rem;display:block;border:1px solid #696767;border-bottom:none}.print-content__table-row[_ngcontent-%COMP%]:last-child{border-bottom:1px solid #696767}.print-content__table-col[_ngcontent-%COMP%]{padding:.5rem}.print-content__table-inner[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap}.user-info[_ngcontent-%COMP%]{font-size:1.125rem;display:flex;justify-content:space-between;margin-top:3.5rem}.user-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:500;margin-bottom:.375rem}.user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{height:1.25rem;line-height:1.25rem}.user-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:25%}.user-info[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:1.5rem}@media print{.print-content__table-row[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]{page-break-inside:avoid}}.table-empty[_ngcontent-%COMP%]{font-weight:500;font-size:1.125rem;font-style:italic;margin-bottom:3.5rem}"]}),i})();function vi(i,n){if(1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"h4"),t._uU(3,"Code"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA()(),t.TgZ(6,"div",11)(7,"h4"),t._uU(8,"Name"),t.qZA(),t.TgZ(9,"p"),t._uU(10),t.qZA()(),t.TgZ(11,"div",12)(12,"h4"),t._uU(13,"Id"),t.qZA(),t.TgZ(14,"p"),t._uU(15),t.qZA()(),t.TgZ(16,"div",13)(17,"h4"),t._uU(18,"Order Creation Date"),t.qZA(),t.TgZ(19,"p"),t._uU(20),t.ALo(21,"date"),t.qZA()()()),2&i){const e=t.oxw();t.xp6(5),t.Oqu(null==e.order.root_production_list_products[0]?null:e.order.root_production_list_products[0].nomenclature.code),t.xp6(5),t.Oqu(null==e.order.root_production_list_products[0]?null:e.order.root_production_list_products[0].nomenclature.name),t.xp6(5),t.Oqu(e.orderId),t.xp6(5),t.Oqu(t.xi3(21,4,e.order.created,"dd.MM.y"))}}function Mi(i,n){1&i&&(t.TgZ(0,"div",14),t._uU(1," No Records Found "),t.qZA())}function Zi(i,n){1&i&&t._UZ(0,"i",29)}function bi(i,n){1&i&&(t.TgZ(0,"p"),t._uU(1,"X"),t.qZA())}function Pi(i,n){1&i&&(t.TgZ(0,"p"),t._uU(1,"\u2014"),t.qZA())}function yi(i,n){1&i&&(t.TgZ(0,"p"),t._uU(1,"In QC"),t.qZA())}function ki(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Not passed)"),t.qZA())}function wi(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Passed)"),t.qZA())}function Ai(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Partly passed)"),t.qZA())}function Oi(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.YNc(2,ki,2,0,"span",26),t.YNc(3,wi,2,0,"span",26),t.YNc(4,Ai,2,0,"span",26),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.AsE("",e.orderProduct.passed_quantity,"/",e.orderProduct.initial_quantity," "),t.xp6(1),t.Q6J("ngIf","0"===e.orderProduct.quality_control),t.xp6(1),t.Q6J("ngIf","1"===e.orderProduct.quality_control),t.xp6(1),t.Q6J("ngIf","2"===e.orderProduct.quality_control)}}function qi(i,n){1&i&&(t.TgZ(0,"h5",17),t._uU(1,"Materials"),t.qZA())}function Ii(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.material_nomenclature.code," ")}}function Si(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.order_product_nomenclature.code," ")}}function Ui(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.list_product.nomenclature.code," ")}}function Ni(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.material_nomenclature.name," ")}}function Ji(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.order_product_nomenclature.name," ")}}function Di(i,n){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.list_product.nomenclature.name," ")}}function Ei(i,n){if(1&i&&(t.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"h4"),t._uU(4,"#"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"div",21)(8,"h4"),t._uU(9,"Code"),t.qZA(),t.YNc(10,Ii,2,1,"p",26),t.YNc(11,Si,2,1,"p",26),t.YNc(12,Ui,2,1,"p",26),t.qZA(),t.TgZ(13,"div",32)(14,"h4"),t._uU(15,"Name"),t.qZA(),t.YNc(16,Ni,2,1,"p",26),t.YNc(17,Ji,2,1,"p",26),t.YNc(18,Di,2,1,"p",26),t.qZA(),t.TgZ(19,"div",22)(20,"h4"),t._uU(21,"Technology"),t.qZA(),t.TgZ(22,"p"),t._uU(23),t.qZA()(),t.TgZ(24,"div",22)(25,"h4"),t._uU(26,"Req Quantity"),t.qZA(),t._uU(27),t.qZA()()()),2&i){const e=n.$implicit,o=n.index;t.xp6(6),t.Oqu(o+1),t.xp6(4),t.Q6J("ngIf",e.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",e.list_product),t.xp6(4),t.Q6J("ngIf",e.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",e.list_product),t.xp6(5),t.Oqu(null==e?null:e.technology),t.xp6(4),t.hij(" ",null==e?null:e.totalInitialQuantity," ")}}function Qi(i,n){if(1&i&&(t.TgZ(0,"div",30),t.YNc(1,Ei,28,9,"div",31),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngForOf",e.materials)}}function Li(i,n){if(1&i&&(t.TgZ(0,"h5",17),t._uU(1,"Ordered Product"),t.qZA(),t.TgZ(2,"div",18)(3,"div",19)(4,"div",20)(5,"h4"),t._uU(6,"#"),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA()(),t.TgZ(9,"div",21)(10,"h4"),t._uU(11,"Code"),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA()(),t.TgZ(14,"div",21)(15,"h4"),t._uU(16,"Name"),t.qZA(),t.TgZ(17,"p"),t._uU(18),t.qZA()(),t.TgZ(19,"div",22)(20,"h4"),t._uU(21,"Technology"),t.qZA(),t.TgZ(22,"p"),t._uU(23),t.qZA()(),t.TgZ(24,"div",23)(25,"h4"),t._uU(26,"Quantity"),t.qZA(),t._uU(27),t.qZA(),t.TgZ(28,"div",24)(29,"h4"),t._uU(30,"Employees"),t.qZA()(),t.TgZ(31,"div",21)(32,"h4"),t._uU(33,"Ready"),t.qZA(),t.YNc(34,Zi,1,0,"i",25),t.YNc(35,bi,2,0,"p",26),t.qZA(),t.TgZ(36,"div",22)(37,"h4"),t._uU(38,"QC passed"),t.qZA(),t.YNc(39,Pi,2,0,"p",26),t.YNc(40,yi,2,0,"p",26),t.YNc(41,Oi,5,5,"p",26),t.qZA()()(),t.YNc(42,qi,2,0,"h5",27),t.YNc(43,Qi,2,1,"div",28)),2&i){const e=n.$implicit,o=n.index;t.xp6(8),t.Oqu(o+1),t.xp6(5),t.Oqu(e.orderProduct.nomenclature.code),t.xp6(5),t.Oqu(e.orderProduct.nomenclature.name),t.xp6(5),t.Oqu(null==e.orderProduct.current_technology?null:e.orderProduct.current_technology.name),t.xp6(4),t.hij(" ",e.orderProduct.quantity," "),t.xp6(7),t.Q6J("ngIf",e.orderProduct.isReady),t.xp6(1),t.Q6J("ngIf",!e.orderProduct.isReady),t.xp6(4),t.Q6J("ngIf",!e.orderProduct.quality_control&&!e.orderProduct.is_technology_ready),t.xp6(1),t.Q6J("ngIf",e.orderProduct.is_technology_ready&&!e.orderProduct.quality_control),t.xp6(1),t.Q6J("ngIf",e.orderProduct.quality_control),t.xp6(1),t.Q6J("ngIf",e.materials.length>0),t.xp6(1),t.Q6J("ngIf",e.materials.length>0)}}function Yi(i,n){if(1&i&&(t.TgZ(0,"div",15),t.YNc(1,Li,44,12,"ng-template",16),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.preparedForPrintInfo)}}let Fi=(()=>{class i{constructor(e){this.auth=e,this.products=[],this.materials=[],this.preparedForPrintInfo=[],this.currentDate=new Date}ngOnInit(){this.products.sort((e,o)=>e.id-o.id).forEach(e=>{const o=this.materials.filter(a=>e.ids.findIndex(s=>s===a.for_order_product.id)>=0);this.preparedForPrintInfo.push({orderProduct:e,materials:o})})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Tt.e8))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-order-products-info-print"]],inputs:{order:"order",orderId:"orderId",products:"products",materials:"materials"},decls:36,vars:9,consts:[[1,"print-order","print-order_show"],[1,"print-content"],["class","print-content__header",4,"ngIf"],["class","table-empty",4,"ngIf"],["class","print-content__table print-content__table_items",4,"ngIf"],[1,"pagebreak"],[1,"user-info"],[1,"left"],[1,"right"],[1,"print-content__header"],[1,"print-content__header-col","print-content__header-col_code"],[1,"print-content__header-col","print-content__header-col_name"],[1,"print-content__header-col","print-content__header-col_id"],[1,"print-content__header-col","print-content__header-col_date"],[1,"table-empty"],[1,"print-content__table","print-content__table_items"],["ngFor","",3,"ngForOf"],[1,"mt-4"],[1,"print-content__table-row"],[1,"print-content__table-inner"],[1,"print-content__table-col",2,"width","5%"],[1,"print-content__table-col",2,"width","30%"],[1,"print-content__table-col",2,"width","20%"],[1,"print-content__table-col",2,"width","15%"],[1,"print-content__table-col",2,"width","35%"],["class","fas fa-check text-success",4,"ngIf"],[4,"ngIf"],["class","mt-4",4,"ngIf"],["class","print-content__table print-content__table_materials",4,"ngIf"],[1,"fas","fa-check","text-success"],[1,"print-content__table","print-content__table_materials"],["class","print-content__table-row",4,"ngFor","ngForOf"],[1,"print-content__table-col",2,"width","25%"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2"),t._uU(3,"Execution Ordered Products Information"),t.qZA(),t.YNc(4,vi,22,7,"div",2),t.YNc(5,Mi,2,0,"div",3),t.YNc(6,Yi,2,1,"div",4),t._UZ(7,"div",5),t.TgZ(8,"div",6)(9,"div",7)(10,"div")(11,"h3"),t._uU(12,"Sent"),t.qZA(),t.TgZ(13,"p"),t._uU(14),t.qZA()(),t.TgZ(15,"div")(16,"h3"),t._uU(17,"Date"),t.qZA(),t.TgZ(18,"p"),t._uU(19),t.ALo(20,"date"),t.qZA()(),t.TgZ(21,"div")(22,"h3"),t._uU(23,"Signed"),t.qZA()()(),t.TgZ(24,"div",8)(25,"div")(26,"h3"),t._uU(27,"Retrieved"),t.qZA(),t._UZ(28,"p"),t.qZA(),t.TgZ(29,"div")(30,"h3"),t._uU(31,"Date"),t.qZA(),t._UZ(32,"p"),t.qZA(),t.TgZ(33,"div")(34,"h3"),t._uU(35,"Signed"),t.qZA()()()()()()),2&e&&(t.xp6(4),t.Q6J("ngIf",o.order),t.xp6(1),t.Q6J("ngIf",0===o.preparedForPrintInfo.length),t.xp6(1),t.Q6J("ngIf",o.preparedForPrintInfo.length>0),t.xp6(8),t.AsE("",o.auth.user.first_name," ",o.auth.user.last_name,""),t.xp6(5),t.Oqu(t.xi3(20,6,o.currentDate,"dd.MM.y")))},dependencies:[_.sg,_.O5,_.uU],styles:["@media print{.print-order_hide[_ngcontent-%COMP%]{display:none}}.print-order_show[_ngcontent-%COMP%]{display:none;left:0;top:0;right:0}@media print{.print-order_show[_ngcontent-%COMP%]{display:block}}.print-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:500;font-size:1.5rem;line-height:1.2;margin-bottom:2rem}.print-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:500;font-size:1.3125rem;margin:0 0 1.25rem;line-height:1.2}.print-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:500;font-size:1.0625rem;margin:0 0 .625rem;line-height:1.2}.print-content__header[_ngcontent-%COMP%]{display:flex;margin-bottom:3rem}.print-content__header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1875rem}.print-content__header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;margin:0}.print-content__header-col[_ngcontent-%COMP%]{word-break:break-all}.print-content__header-col_code[_ngcontent-%COMP%]{width:30%}.print-content__header-col_name[_ngcontent-%COMP%]{width:32%}.print-content__header-col_id[_ngcontent-%COMP%]{width:13%}.print-content__header-col_date[_ngcontent-%COMP%]{width:25%}.print-content__table[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.0625rem;line-height:1.4;margin:0;word-wrap:break-word}.print-content__table[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem}.print-content__table_items[_ngcontent-%COMP%], .print-content__table_materials[_ngcontent-%COMP%], .print-content__table_machines[_ngcontent-%COMP%]{margin-bottom:3rem}.print-content__table-row[_ngcontent-%COMP%]{page-break-inside:avoid;padding:.5rem;display:block;border:1px solid #696767}.print-content__table-row[_ngcontent-%COMP%]:last-child{border-bottom:1px solid #696767}.print-content__table-col[_ngcontent-%COMP%]{padding:.5rem}.print-content__table-inner[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap}h5[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:500;margin-bottom:.375rem}.user-info[_ngcontent-%COMP%]{font-size:1.125rem;display:flex;justify-content:space-between;margin-top:3.5rem}.user-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:500;margin-bottom:.375rem}.user-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{height:1.25rem;line-height:1.25rem}.user-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:25%}.user-info[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:1.5rem}@media print{.print-content__table-row[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]{page-break-inside:avoid}}.table-empty[_ngcontent-%COMP%]{font-weight:500;font-size:1.125rem;font-style:italic;margin-bottom:3.5rem}"]}),i})();function Ri(i,n){1&i&&(t.ynx(0),t._uU(1,"(...)"),t.BQk())}function Hi(i,n){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.AsE(" (",e.order.root_production_list_products[0].nomenclature.code," ",e.order.root_production_list_products[0].nomenclature.name,") ")}}function zi(i,n){1&i&&(t.TgZ(0,"p",33),t._uU(1,"Choose the Item to edit"),t.qZA())}function $i(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",28),t.YNc(1,zi,2,0,"p",29),t._UZ(2,"p-menubar",30),t.TgZ(3,"button",31),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onAddProduct())}),t.qZA(),t.TgZ(4,"button",32),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onAddMaterial())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.selectedProduct),t.xp6(1),t.ekj("disabled",!e.selectedProduct),t.Q6J("model",e.productMenuItems),t.xp6(1),t.Q6J("disabled",e.isLoadingProducts),t.xp6(1),t.Q6J("disabled",!e.selectedProduct)}}function Bi(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"tr")(1,"th",34),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",35),t._uU(4,"Code"),t.qZA(),t.TgZ(5,"th",36),t._uU(6,"Name"),t.qZA(),t.TgZ(7,"th",37),t._uU(8,"Technology"),t.qZA(),t.TgZ(9,"th",38),t._uU(10,"Quantity"),t.qZA(),t.TgZ(11,"th",36),t._uU(12,"Employees"),t.qZA(),t.TgZ(13,"th",38)(14,"label",39)(15,"p-checkbox",40),t.NdJ("onChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.toggleAllReady(a))}),t.qZA(),t.TgZ(16,"span",41),t._uU(17,"Ready"),t.qZA()()(),t.TgZ(18,"th",38),t._uU(19,"QC Pass"),t.qZA()()}2&i&&(t.xp6(15),t.Q6J("binary",!0))}function Gi(i,n){if(1&i&&(t.TgZ(0,"div",28)(1,"span",47),t._uU(2),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()()),2&i){const e=n.$implicit;t.xp6(2),t.AsE("",e.employee.first_name," ",e.employee.last_name,""),t.xp6(2),t.hij("(",e.duration,")")}}function ji(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1,"\u2014"),t.qZA())}function Ki(i,n){1&i&&(t.TgZ(0,"div"),t._uU(1,"In QC"),t.qZA())}function Wi(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Not passed)"),t.qZA())}function Vi(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Passed)"),t.qZA())}function Xi(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"(Partly passed)"),t.qZA())}function to(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.YNc(2,Wi,2,0,"span",5),t.YNc(3,Vi,2,0,"span",5),t.YNc(4,Xi,2,0,"span",5),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.AsE("",e.passed_quantity,"/",e.initial_quantity," "),t.xp6(1),t.Q6J("ngIf","0"===e.quality_control),t.xp6(1),t.Q6J("ngIf","1"===e.quality_control),t.xp6(1),t.Q6J("ngIf","2"===e.quality_control)}}function eo(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"tr",42)(1,"td",43),t._uU(2),t.qZA(),t.TgZ(3,"td",35),t._uU(4),t.qZA(),t.TgZ(5,"td",36),t._uU(6),t.qZA(),t.TgZ(7,"td",37),t._uU(8),t.qZA(),t.TgZ(9,"td",38),t._uU(10),t.qZA(),t.TgZ(11,"td",36),t.YNc(12,Gi,5,3,"div",44),t.qZA(),t.TgZ(13,"td",37)(14,"div",45)(15,"p-checkbox",46),t.NdJ("ngModelChange",function(a){const r=t.CHM(e).$implicit;return t.KtG(r.isReady=a)}),t.qZA()()(),t.TgZ(16,"td",38),t.YNc(17,ji,2,0,"div",5),t.YNc(18,Ki,2,0,"div",5),t.YNc(19,to,5,5,"div",5),t.qZA()()}if(2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.hij("",e.nomenclature.code," "),t.xp6(2),t.hij("",e.nomenclature.name," "),t.xp6(2),t.hij(" ",null==e.current_technology?null:e.current_technology.name," "),t.xp6(2),t.Oqu(e.quantity),t.xp6(2),t.Q6J("ngForOf",null==e?null:e.task_employees),t.xp6(3),t.Q6J("ngModel",e.isReady)("disabled",e.quality_control||e.is_technology_ready)("binary",!0),t.xp6(2),t.Q6J("ngIf",!e.quality_control&&!e.is_technology_ready),t.xp6(1),t.Q6J("ngIf",e.is_technology_ready&&!e.quality_control),t.xp6(1),t.Q6J("ngIf",e.quality_control)}}function no(i,n){1&i&&t._UZ(0,"i",50)}function io(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function oo(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",48),t.YNc(2,no,1,0,"i",49),t.YNc(3,io,2,0,"span",5),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",10),t.xp6(1),t.Q6J("ngIf",e.isLoadingProducts),t.xp6(1),t.Q6J("ngIf",!e.isLoadingProducts)}}function ao(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(20);return t.KtG(a.paginator=!1)}),t._uU(1," All "),t.qZA()}}function ro(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",52)(1,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(20);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}function so(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",59),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.onCancelOrderMaterials())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("loading",e.isCancellation)}}function co(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.onDeleteOrderMaterial())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("disabled",!e.selectedOrderMaterial||0===(null==e.selectedOrderMaterial?null:e.selectedOrderMaterial.totalRequiredQuantity))("loading",e.isDeletingOrderMaterial)}}function lo(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",61),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.openHierarchyMode())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("loading",e.isCancellation)}}function uo(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",62),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.printOrderProductsInfo())}),t.qZA()}}function po(i,n){if(1&i&&(t.TgZ(0,"div",28),t.YNc(1,so,1,1,"button",55),t.YNc(2,co,1,2,"button",56),t.YNc(3,lo,1,1,"button",57),t.YNc(4,uo,1,0,"button",58),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.orderMaterials.length>0),t.xp6(1),t.Q6J("ngIf",e.orderMaterials.length>0),t.xp6(1),t.Q6J("ngIf",e.orderMaterials.length>0),t.xp6(1),t.Q6J("ngIf",e.orderMaterials.length>0)}}function _o(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",34),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",35),t._uU(4,"Code"),t.qZA(),t.TgZ(5,"th",63),t._uU(6,"Name"),t.qZA(),t.TgZ(7,"th",36),t._uU(8,"Technology"),t.qZA(),t.TgZ(9,"th",64),t._uU(10,"Required Quantity"),t.qZA(),t.TgZ(11,"th",38),t._uU(12,"Status"),t.qZA()())}function go(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.material_nomenclature.code," ")}}function ho(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.order_product_nomenclature.code," ")}}function mo(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.list_product.nomenclature.code," ")}}function fo(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.material_nomenclature.name," ")}}function xo(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.order_product_nomenclature.name," ")}}function To(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.list_product.nomenclature.name," ")}}function Co(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.technology)}}function vo(i,n){1&i&&t._UZ(0,"i",68)}function Mo(i,n){1&i&&t._UZ(0,"i",69)}function Zo(i,n){if(1&i&&(t.TgZ(0,"tr",65)(1,"td",43),t._uU(2),t.qZA(),t.TgZ(3,"td",35),t.YNc(4,go,2,1,"div",5),t.YNc(5,ho,2,1,"div",5),t.YNc(6,mo,2,1,"div",5),t.qZA(),t.TgZ(7,"td",63),t.YNc(8,fo,2,1,"div",5),t.YNc(9,xo,2,1,"div",5),t.YNc(10,To,2,1,"div",5),t.qZA(),t.TgZ(11,"td",36),t.YNc(12,Co,2,1,"span",5),t.qZA(),t.TgZ(13,"td",64),t._uU(14),t.qZA(),t.TgZ(15,"td",38),t.YNc(16,vo,1,0,"i",66),t.YNc(17,Mo,1,0,"i",67),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Q6J("ngIf",e.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",e.list_product),t.xp6(2),t.Q6J("ngIf",e.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",e.list_product),t.xp6(2),t.Q6J("ngIf",e.technology),t.xp6(2),t.hij(" ",null==e?null:e.totalInitialQuantity," "),t.xp6(2),t.Q6J("ngIf",0===(null==e?null:e.totalRequiredQuantity)),t.xp6(1),t.Q6J("ngIf",(null==e?null:e.totalRequiredQuantity)>0)}}function bo(i,n){1&i&&t._UZ(0,"i",50)}function Po(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function yo(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",48),t.YNc(2,bo,1,0,"i",49),t.YNc(3,Po,2,0,"span",5),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Q6J("ngIf",e.isLoadingProducts),t.xp6(1),t.Q6J("ngIf",!e.isLoadingProducts)}}function ko(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(3);return t.KtG(a.paginator=!1)}),t._uU(1," All "),t.qZA()}}function wo(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",52)(1,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(3);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}function Ao(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",12)(1,"div",13)(2,"p-table",53,54),t.NdJ("selectionChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedOrderMaterial=a)}),t.YNc(4,po,5,4,"ng-template",16),t.YNc(5,_o,13,0,"ng-template",17),t.YNc(6,Zo,18,12,"ng-template",18),t.YNc(7,yo,4,3,"ng-template",19),t.YNc(8,ko,2,0,"ng-template",20),t.qZA()(),t.YNc(9,wo,3,0,"div",21),t.qZA()}if(2&i){const e=t.MAs(3),o=t.oxw();t.xp6(2),t.Q6J("scrollable",!0)("paginator",o.orderMaterials.length>0)("rows",10)("value",o.orderMaterials)("selection",o.selectedOrderMaterial),t.xp6(7),t.Q6J("ngIf",!e.paginator&&!o.isLoadingProducts&&o.orderMaterials.length>0)}}function Oo(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",74),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.openListMode())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("loading",e.isCancellation)}}function qo(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",28)(1,"button",71),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.expandCollapseAllOrders())}),t.qZA(),t.TgZ(2,"button",72),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.expandCollapseAllOrders(!1))}),t.qZA(),t.YNc(3,Oo,1,1,"button",73),t.TgZ(4,"button",62),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.printOrderProductsInfo())}),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",e.orderMaterials.length>0)}}function Io(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",75),t._uU(2,"ID"),t.qZA(),t.TgZ(3,"th",35),t._uU(4,"Code"),t.qZA(),t.TgZ(5,"th",37),t._uU(6,"Name"),t.qZA(),t.TgZ(7,"th",38),t._uU(8,"Technology"),t.qZA(),t.TgZ(9,"th",76),t._uU(10,"Required Quantity"),t.qZA(),t.TgZ(11,"th",76),t._uU(12,"Status"),t.qZA()())}function So(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij("L(",null==e.request.allIds?null:e.request.allIds.length,")")}}function Uo(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e," ")}}function No(i,n){if(1&i&&(t.TgZ(0,"pek-hover-detailed-info-component",84)(1,"span",85),t.YNc(2,Uo,2,1,"div",86),t.qZA()()),2&i){const e=t.oxw(2).rowData;t.Q6J("moveLeft",0),t.xp6(2),t.Q6J("ngForOf",e.request.allIds)}}function Jo(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.YNc(2,So,2,1,"span",5),t.YNc(3,No,3,2,"pek-hover-detailed-info-component",83),t.qZA()),2&i){const e=t.oxw().rowData;t.xp6(1),t.hij(" ",e.request.id," "),t.xp6(1),t.Q6J("ngIf",(null==e.request.allIds?null:e.request.allIds.length)>0),t.xp6(1),t.Q6J("ngIf",(null==e.request.allIds?null:e.request.allIds.length)>0)}}function Do(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij(" ",e.request.material_nomenclature.code," ")}}function Eo(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij(" ",e.request.order_product_nomenclature.code," ")}}function Qo(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.hij(" ",e.request.list_product.nomenclature.code," ")}}function Lo(i,n){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Do,2,1,"div",5),t.YNc(2,Eo,2,1,"div",5),t.YNc(3,Qo,2,1,"div",5),t.qZA()),2&i){const e=t.oxw().rowData;t.xp6(1),t.Q6J("ngIf",e.request.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.request.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",!e.request.material_nomenclature&&!e.request.order_product_nomenclature)}}function Yo(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(S)"),t.qZA())}function Fo(i,n){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Yo,2,0,"b",5),t._uU(2),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Q6J("ngIf","1"===(null==e.request||null==e.request.list_product||null==e.request.list_product.nomenclature?null:e.request.list_product.nomenclature.bulk_or_serial)),t.xp6(1),t.hij(" ",e.request.material_nomenclature.name," ")}}function Ro(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(S)"),t.qZA())}function Ho(i,n){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Ro,2,0,"b",5),t._uU(2),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Q6J("ngIf","1"===(null==e.request||null==e.request.list_product||null==e.request.list_product.nomenclature?null:e.request.list_product.nomenclature.bulk_or_serial)),t.xp6(1),t.hij(" ",e.request.order_product_nomenclature.name," ")}}function zo(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(S)"),t.qZA())}function $o(i,n){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,zo,2,0,"b",5),t._uU(2),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Q6J("ngIf","1"===(null==e.request||null==e.request.list_product||null==e.request.list_product.nomenclature?null:e.request.list_product.nomenclature.bulk_or_serial)),t.xp6(1),t.hij(" ",e.request.list_product.nomenclature.name," ")}}function Bo(i,n){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Fo,3,2,"div",5),t.YNc(2,Ho,3,2,"div",5),t.YNc(3,$o,3,2,"div",5),t.qZA()),2&i){const e=t.oxw().rowData;t.xp6(1),t.Q6J("ngIf",e.request.material_nomenclature),t.xp6(1),t.Q6J("ngIf",e.request.order_product_nomenclature),t.xp6(1),t.Q6J("ngIf",!e.request.material_nomenclature&&!e.request.order_product_nomenclature)}}function Go(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2).rowData;t.xp6(1),t.Oqu(e.request.technology)}}function jo(i,n){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,Go,2,1,"span",5),t.qZA()),2&i){const e=t.oxw().rowData;t.xp6(1),t.Q6J("ngIf",e.request.technology)}}function Ko(i,n){if(1&i&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&i){const e=t.oxw().rowData;t.xp6(1),t.hij(" ",e.request.totalInitialQuantity," ")}}function Wo(i,n){1&i&&t._UZ(0,"i",68)}function Vo(i,n){1&i&&t._UZ(0,"i",69)}function Xo(i,n){if(1&i&&(t.TgZ(0,"tr",77)(1,"td",78)(2,"h3",79),t._uU(3,"ID"),t.qZA(),t.TgZ(4,"div",80),t._UZ(5,"p-treeTableToggler",81),t.TgZ(6,"span"),t._uU(7),t.qZA(),t.YNc(8,Jo,4,3,"span",5),t.qZA()(),t.TgZ(9,"td",35)(10,"h3",79),t._uU(11,"Code"),t.qZA(),t.YNc(12,Lo,4,3,"div",5),t.qZA(),t.TgZ(13,"td",82)(14,"h3",79),t._uU(15,"Name"),t.qZA(),t.YNc(16,Bo,4,3,"div",5),t.qZA(),t.TgZ(17,"td",38)(18,"h3",79),t._uU(19,"Technology"),t.qZA(),t.YNc(20,jo,2,1,"div",5),t.qZA(),t.TgZ(21,"td",76)(22,"h3",79),t._uU(23,"Required Quantity"),t.qZA(),t.YNc(24,Ko,2,1,"div",5),t.qZA(),t.TgZ(25,"td",76)(26,"h3",79),t._uU(27,"Status"),t.qZA(),t.YNc(28,Wo,1,0,"i",66),t.YNc(29,Vo,1,0,"i",67),t.qZA()()),2&i){const e=n.$implicit,o=n.rowData;t.ekj("is-added-after-order-creation",null==o.request?null:o.request.material_nomenclature)("tr-toggler",e.node.children.length>0),t.Q6J("ttRow",e)("id",o.request?"row-"+(null==o.request?null:o.request.id):null),t.xp6(5),t.Q6J("rowNode",e),t.xp6(1),t.ekj("bold",o.level<4),t.xp6(1),t.AsE(" ",o.name," ",o.listId?"("+o.listId+")":""," "),t.xp6(1),t.Q6J("ngIf",4===o.level),t.xp6(4),t.Q6J("ngIf",4===o.level),t.xp6(4),t.Q6J("ngIf",4===o.level),t.xp6(4),t.Q6J("ngIf",4===o.level),t.xp6(4),t.Q6J("ngIf",4===o.level),t.xp6(4),t.Q6J("ngIf",0===(null==o.request?null:o.request.totalRequiredQuantity)),t.xp6(1),t.Q6J("ngIf",(null==o.request?null:o.request.totalRequiredQuantity)>0)}}function ta(i,n){1&i&&(t.TgZ(0,"tr",87)(1,"td",48),t._UZ(2,"i",50),t.TgZ(3,"span"),t._uU(4,"No Records Found"),t.qZA()()()),2&i&&(t.xp6(1),t.uIk("colspan",8))}function ea(i,n){if(1&i&&(t.TgZ(0,"div",12)(1,"div",13)(2,"p-treeTable",70),t.YNc(3,qo,5,1,"ng-template",16),t.YNc(4,Io,13,0,"ng-template",17),t.YNc(5,Xo,30,18,"ng-template",18),t.YNc(6,ta,5,1,"ng-template",19),t.qZA()()()),2&i){const e=t.oxw();t.xp6(2),t.Q6J("value",e.requestTree)}}function na(i,n){}function ia(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",34),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",63),t._uU(4,"Name"),t.qZA(),t.TgZ(5,"th",88),t._uU(6,"Description"),t.qZA(),t.TgZ(7,"th",89),t._uU(8,"Duration"),t.qZA()())}function oa(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",90),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",90),t._uU(8),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(e.machine.name),t.xp6(2),t.Oqu(e.machine.description),t.xp6(2),t.Oqu(e.duration)}}function aa(i,n){1&i&&t._UZ(0,"i",50)}function ra(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function sa(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",48),t.YNc(2,aa,1,0,"i",49),t.YNc(3,ra,2,0,"span",5),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Q6J("ngIf",e.isLoadingProducts),t.xp6(1),t.Q6J("ngIf",!e.isLoadingProducts)}}function ca(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(36);return t.KtG(a.paginator=!1)}),t._uU(1," All "),t.qZA()}}function la(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",52)(1,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(36);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}function da(i,n){}function ua(i,n){1&i&&(t.TgZ(0,"tr")(1,"th",34),t._uU(2,"#"),t.qZA(),t.TgZ(3,"th",91),t._uU(4,"Code"),t.qZA(),t.TgZ(5,"th",91),t._uU(6,"Name"),t.qZA(),t.TgZ(7,"th",64),t._uU(8,"Locator"),t.qZA(),t.TgZ(9,"th",64),t._uU(10,"Quantity"),t.qZA(),t.TgZ(11,"th",64),t._uU(12,"Status"),t.qZA()())}function pa(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function _a(i,n){if(1&i&&(t.TgZ(0,"tr",42)(1,"td",90),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",90),t.YNc(8,pa,2,1,"span",86),t.qZA(),t.TgZ(9,"td",90),t._uU(10),t.qZA(),t.TgZ(11,"td",90),t._uU(12),t.qZA()()),2&i){const e=n.$implicit,o=n.rowIndex;t.Q6J("pSelectableRow",e),t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(e.nomenclature.code),t.xp6(2),t.Oqu(e.nomenclature.name),t.xp6(2),t.Q6J("ngForOf",e.locators),t.xp6(2),t.Oqu(e.max_initial_quantity),t.xp6(1),t.ekj("text-danger",!e.in_use||e.in_use&&e.locators.length<1)("text-success",e.in_use&&e.locators.length>0),t.xp6(1),t.Oqu(e.in_use&&e.locators.length>0?"Received":"Not Received")}}function ga(i,n){1&i&&t._UZ(0,"i",50)}function ha(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"No Records Found"),t.qZA())}function ma(i,n){if(1&i&&(t.TgZ(0,"tr")(1,"td",48),t.YNc(2,ga,1,0,"i",49),t.YNc(3,ha,2,0,"span",5),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.uIk("colspan",6),t.xp6(1),t.Q6J("ngIf",e.isLoadingTechnicalEquipments),t.xp6(1),t.Q6J("ngIf",!e.isLoadingTechnicalEquipments)}}function fa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(48);return t.KtG(a.paginator=!1)}),t._uU(1," All "),t.qZA()}}function xa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",52)(1,"p-button",51),t.NdJ("click",function(){t.CHM(e),t.oxw();const a=t.MAs(48);return t.KtG(a.paginator=!0)}),t._uU(2," Return pagination "),t.qZA()()}}function Ta(i,n){if(1&i&&(t.TgZ(0,"div",92),t._UZ(1,"pek-manufacturing-order-page-print",93),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("machines",e.machines)("materials",e.orderMaterials)("order",e.order)("orderId",e.orderId)("products",e.products)}}function Ca(i,n){if(1&i&&(t.TgZ(0,"div",92),t._UZ(1,"pek-manufacturing-order-products-info-print",94),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("order",e.order)("orderId",e.orderId)("products",e.products)("materials",e.orderMaterialsByOrderProduct)}}let F=class{constructor(n,e,o,a,s,r){this.route=n,this.orderService=e,this.orderProductService=o,this.orderTechnicalEquipmentService=a,this.modalService=s,this.requestService=r,this.productMenuItems=[{label:"Selected Item",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.onEditOrderProductQuantity()},{label:"Remove",icon:"pi pi-trash",command:()=>this.onRemoveOrderProduct()}]}],this.ViewMode=Y,this.viewMode=Y.LIST,this.isOrderLoading=!0,this.isMovingToQC=!1,this.isShowPrint=!1,this.isShowOrderProductsPrint=!1,this.isCancellation=!1,this.products=[],this.isLoadingProducts=!0,this.isLoadingTechnicalEquipments=!0,this.orderMaterials=[],this.orderMaterialsByOrderProduct=[],this.machines=[],this.technicalEquipments=[],this.requestTree=[],this.hierarchyRequests=[],this.isDeletingOrderMaterial=!1}ngOnInit(){this.route.paramMap.pipe((0,M.U)(n=>n.get("id")),(0,p.b)(n=>this.orderId=+n),(0,p.b)(()=>this.getOrder()),(0,p.b)(()=>this.getOrderTechnicalEquipments()),(0,p.b)(()=>this.getProducts())).subscribe()}getOrder(){this.orderService.getById(this.orderId).subscribe(n=>{n.statuses.map(e=>e.estimated_date_sort=new Date(e.estimated_date)),n.statuses.sort((e,o)=>e.estimated_date_sort-o.estimated_date_sort||e.is_active-o.is_active),this.order=n,this.isOrderLoading=!1})}onEditOrder(){this.orderService.openEditOrderModal(this.order,"manufacturing").subscribe(n=>{n&&this.getOrder()})}getProducts(){this.machines=[],this.orderMaterials=[],this.orderMaterialsByOrderProduct=[],this.products=[],this.isLoadingProducts=!0,this.orderProductService.getOrderProducts(this.orderId).subscribe(n=>{n.forEach((o,a)=>{o.isReady=!!o.is_technology_ready&&o.is_technology_ready,o.task_materials&&o.task_materials?.length>0&&((0,ft.p$)(o.task_materials).forEach(r=>{let c,d;r.material_nomenclature&&(c=r.material_nomenclature.id,d=r.technology),r.order_product_nomenclature&&(c=r.order_product_nomenclature.id,d=r.technology),r.list_product&&(c=r.list_product.nomenclature.id,d=r.technology);const h=o.current_technology?o.current_technology.id:null,m=this.orderMaterialsByOrderProduct.filter(g=>g.for_order_product.nomenclature.id===r.for_order_product.nomenclature.id&&g.orderProductTechnologyId===h).find(g=>g.material_nomenclature?g.material_nomenclature.id===c&&g.technology===d:g.order_product_nomenclature?g.order_product_nomenclature.id===c&&g.technology===d:g.list_product?g.list_product.nomenclature.id===c&&g.technology===d:void 0);m?(m.allIds.push(r.id),m.totalInitialQuantity+=r.initial_quantity,m.totalRequiredQuantity+=r.required_quantity):(r.allIds=[r.id],r.totalInitialQuantity=r.initial_quantity,r.totalRequiredQuantity=r.required_quantity,r.orderProductTechnologyId=h,this.orderMaterialsByOrderProduct.push(r))}),o.task_materials.forEach(r=>{let c,d;r.material_nomenclature&&(c=r.material_nomenclature.id,d=r.technology),r.order_product_nomenclature&&(c=r.order_product_nomenclature.id,d=r.technology),r.list_product&&(c=r.list_product.nomenclature.id,d=r.technology);const h=this.orderMaterials.find(m=>m.material_nomenclature?m.material_nomenclature.id===c&&m.technology===d:m.order_product_nomenclature?m.order_product_nomenclature.id===c&&m.technology===d:m.list_product?m.list_product.nomenclature.id===c&&m.technology===d:void 0);h?(h.allIds.push(r.id),h.totalInitialQuantity+=r.initial_quantity,h.totalRequiredQuantity+=r.required_quantity):(r.allIds=[r.id],r.totalInitialQuantity=r.initial_quantity,r.totalRequiredQuantity=r.required_quantity,this.orderMaterials.push(r))})),o?.task_machines&&o?.task_machines?.length>0&&o.task_machines.forEach(s=>{this.machines.push(s)})});const e=[];n.forEach(o=>{const a={...o};e.find(r=>r.nomenclature.id===o.nomenclature.id&&r.current_technology.id===o.current_technology.id)||(a.quantity=n.filter(r=>r.nomenclature.id===o.nomenclature.id&&r.current_technology.id===o.current_technology.id).reduce((r,c)=>r+c.quantity,0),a.ids=n.filter(r=>r.nomenclature.id===o.nomenclature.id&&r.current_technology.id===o.current_technology.id).map(r=>r.id),e.push(a))}),this.products=e.map(o=>o),this.machines=this.machines.map(o=>o),this.orderMaterials=[...this.orderMaterials],this.hierarchyRequests=(0,ft.p$)(this.orderMaterialsByOrderProduct),this.prepareTreeCategories(),this.isLoadingProducts=!1})}toggleAllReady(n){this.products.forEach(e=>{e.is_technology_ready||(e.isReady=n.checked)})}getOrderTechnicalEquipments(){this.orderTechnicalEquipmentService.get([{name:"order",value:this.orderId}]).subscribe(n=>{this.technicalEquipments=n,this.isLoadingTechnicalEquipments=!1})}onAddProduct(){this.orderProductService.openAddOutsourcingRequestModal(this.orderId).subscribe(n=>{n&&this.getProducts()})}onRemoveOrderProduct(){this.modalService.confirm("danger").subscribe(n=>{n&&this.orderProductService.removeFromOrder(this.selectedProduct).subscribe(()=>{this.products=this.products.filter(e=>e.id!==this.selectedProduct.id),this.selectedProduct=null})})}onEditOrderProductQuantity(){this.orderProductService.editOrderProductQuantity(this.selectedProduct).subscribe(n=>{n&&(this.selectedProduct.quantity=n.quantity)})}onCancelOrderMaterials(){this.modalService.confirm("danger","Confirm").subscribe(n=>{n&&(this.isCancellation=!0,this.requestService.cancel(this.orderId).pipe((0,H.x)(()=>this.isCancellation=!1)).subscribe(()=>{this.orderMaterials=[],this.products=[],this.machines=[],this.selectedProduct=null,this.isLoadingProducts=!0,this.getProducts()}))})}onPrintPage(){this.isShowPrint=!0,setTimeout(()=>{window.print()})}onWindowAfterPrint(){this.isShowPrint=!1}moveToQc(){this.isMovingToQC=!0,this.orderService.moveToQc({id:this.order.id,order:{completed:!0}}).subscribe(()=>{0===e.length&&(this.isMovingToQC=!1)});const e=[];this.products.forEach(o=>{o.isReady&&!o.is_technology_ready&&!o.quality_control&&o.ids.forEach(a=>{e.push({id:a,product:{is_technology_ready:!0}})})}),(0,Hn.D)(e).pipe((0,Un.b)(o=>this.makeRequest(o))).subscribe(o=>this.isMovingToQC=!1,o=>this.isMovingToQC=!1)}makeRequest(n){return this.orderProductService.moveToQc(n).pipe(function Rn(i,n=Nn.z){const e=(0,Fn.H)(i,n);return mt(()=>e)}(200),(0,p.b)(e=>{const o=this.products.find(a=>a.ids.findIndex(s=>s===e.id)>-1);o&&(o.is_technology_ready=!0)}))}onAddMaterial(){this.orderProductService.openAddPMaterialToOrder(this.selectedProduct.id).subscribe(n=>{n&&this.getProducts()})}openHierarchyMode(){this.viewMode=Y.HIERARCHY}openListMode(){this.viewMode=Y.LIST}prepareTreeCategories(){const n=[];this.hierarchyRequests.forEach(e=>{if(e.for_order_product){const o=e.for_order_product.nomenclature,a=e.list_product?e.list_product.list.id:null;n.findIndex(r=>r.id===o.id)<0&&n.push({name:o.code+" "+o.name,listId:a,id:o.id,level:0,parentId:null,for_order_product:e.for_order_product})}else if(e.list_product){const o=e.list_product.list;n.findIndex(s=>s.id===o.nomenclature.id)<0&&n.push({name:o.nomenclature.code+" "+o.nomenclature.name,listId:o.id,id:o.nomenclature.id,level:0,parentId:null,listProduct:e.list_product})}}),this.requestTree=[],n.forEach(e=>{this.requestTree.push({data:e,expanded:!1,parent:null})}),this.fillTree()}fillTree(){this.requestTree=this.requestTree.map(n=>({...n,children:[]})),this.hierarchyRequests.forEach(n=>{this.requestTree.forEach(e=>{let o;n.for_order_product?o=n.for_order_product.nomenclature:n.list_product&&(o=n.list_product.list.nomenclature),e.data.id===o.id&&e.children.push({data:{request:n,level:4},expanded:!1,children:[]})})}),this.requestTree.forEach(n=>{const e=n.children.filter(a=>a.data.request.material_nomenclature).sort((a,s)=>s.data.request.id-a.data.request.id),o=n.children.filter(a=>!a.data.request.material_nomenclature).sort((a,s)=>s.data.request.id-a.data.request.id);n.children=[...e,...o]})}expandCollapseAllOrders(n=!0){const e=zn(this.requestTree);e.forEach(o=>{this.expandCollapseRecursive(o,n)}),this.requestTree=e}expandCollapseRecursive(n,e){n.expanded=e,n.children&&n.children.forEach(o=>{this.expandCollapseRecursive(o,e)})}printOrderProductsInfo(){this.isShowOrderProductsPrint=!0,setTimeout(()=>{window.print()})}onDeleteOrderMaterial(){console.log(this.selectedOrderMaterial),this.modalService.confirm("danger").pipe((0,x.h)(Boolean)).subscribe(()=>{this.isDeletingOrderMaterial=!0,this.orderProductService.severalDeleteMaterial(this.selectedOrderMaterial.allIds).pipe((0,H.x)(()=>this.isDeletingOrderMaterial=!1)).subscribe(()=>{this.orderMaterials=this.orderMaterials.filter(n=>n.id!==this.selectedOrderMaterial.id),this.selectedOrderMaterial=null})})}};F.\u0275fac=function(n){return new(n||F)(t.Y36(Z.gz),t.Y36(gt.p),t.Y36($n.c),t.Y36(Bn.v),t.Y36(P.Z),t.Y36(Gn.s))},F.\u0275cmp=t.Xpm({type:F,selectors:[["pek-manufacturing-order-page"]],hostBindings:function(n,e){1&n&&t.NdJ("afterprint",function(){return e.onWindowAfterPrint()},!1,t.Jf7)},decls:57,vars:29,consts:[[1,"manufacturing-order-page"],[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[4,"ngIf"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-pencil","label","Lead Date & Status",1,"mr-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-angle-double-right","label","Move To QC",1,"mr-2","p-button-icon",3,"disabled","loading","click"],["pButton","","type","button","icon","pi pi-print","label","Print",3,"disabled","click"],[1,"page__content"],[1,"mb-4"],[1,"page__card","mb-4"],[1,"page__table"],["scrollHeight","calc(100vh - 24rem)","selectionMode","single",3,"scrollable","paginator","rows","selection","value","selectionChange"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","paginatorright"],["class","paginator-return-pagination",4,"ngIf"],["class","page__card mb-4",4,"ngIf"],["selectionMode","single","scrollHeight","calc(100vh - 24rem)",3,"scrollable","paginator","rows","value"],["ht",""],[1,"page__card"],["et",""],["class","manufacturing-order-page-print",4,"ngIf"],[1,"d-flex"],["class","subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],["pButton","","type","button","icon","pi pi-plus","label","Add Item",1,"ml-2",3,"disabled","click"],["pButton","","type","button","icon","pi pi-plus","label","Add Material",1,"ml-2",3,"disabled","click"],[1,"subtitle"],[1,"index-header","text-center",2,"width","5%"],[2,"width","15%"],[2,"width","20%"],[2,"width","10%"],[1,"text-center",2,"width","10%"],[1,"all-checked"],["inputId","ready",3,"binary","onChange"],[1,"ml-2"],[1,"table-row",3,"pSelectableRow"],[1,"text-center",2,"width","5%"],["class","d-flex",4,"ngFor","ngForOf"],[1,"d-flex","align-items-center","justify-content-center"],[3,"ngModel","disabled","binary","ngModelChange"],[1,"mr-2"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],["type","button","styleClass","p-button-text",3,"click"],[1,"paginator-return-pagination"],["selectionMode","single","scrollHeight","calc(100vh - 24rem)",3,"scrollable","paginator","rows","value","selection","selectionChange"],["mt",""],["pButton","","type","button","label","Cancelation","icon","pi pi-times","class","ml-auto p-button-danger p-button-icon",3,"loading","click",4,"ngIf"],["pButton","","type","button","label","Delete","icon","pi pi-trash","class","ml-2 p-button p-button-danger p-button-icon",3,"disabled","loading","click",4,"ngIf"],["pButton","","type","button","label","Hierarchy","icon","pi pi-table","class","ml-2 p-button p-button-icon",3,"loading","click",4,"ngIf"],["pButton","","type","button","class","ml-2","icon","pi pi-print","label","Print",3,"click",4,"ngIf"],["pButton","","type","button","label","Cancelation","icon","pi pi-times",1,"ml-auto","p-button-danger","p-button-icon",3,"loading","click"],["pButton","","type","button","label","Delete","icon","pi pi-trash",1,"ml-2","p-button","p-button-danger","p-button-icon",3,"disabled","loading","click"],["pButton","","type","button","label","Hierarchy","icon","pi pi-table",1,"ml-2","p-button","p-button-icon",3,"loading","click"],["pButton","","type","button","icon","pi pi-print","label","Print",1,"ml-2",3,"click"],[2,"width","35%"],[1,"text-center",2,"width","15%"],[3,"pSelectableRow"],["class","pi pi-check-circle",4,"ngIf"],["class","pi pi-times",4,"ngIf"],[1,"pi","pi-check-circle"],[1,"pi","pi-times"],["selectionMode","single","scrollHeight","calc(100vh - 16.5rem)",1,"orders-tree",3,"value"],["pButton","","type","button","icon","pi pi-angle-down","label","Expand all",1,"ml-auto",3,"click"],["pButton","","type","button","icon","pi pi-angle-up","label","Collapse all",1,"ml-2",3,"click"],["pButton","","type","button","label","List","icon","pi pi-list","class","p-button p-button-icon ml-2",3,"loading","click",4,"ngIf"],["pButton","","type","button","label","List","icon","pi pi-list",1,"p-button","p-button-icon","ml-2",3,"loading","click"],[2,"width","25%","padding-left","3.3125rem"],[1,"text-center",2,"width","20%"],[1,"pagebreak",3,"ttRow","id"],[1,"ids-container",2,"width","25%"],[1,"td-title"],[1,"toggle-row","hovered-info"],[3,"rowNode"],[1,"serial-numbers-container",2,"width","10%"],[3,"moveLeft",4,"ngIf"],[3,"moveLeft"],[1,"ids"],[4,"ngFor","ngForOf"],[1,"tr-spinner"],[2,"width","30%"],[1,"text-center",2,"width","30%"],[1,"text-center"],[2,"width","25%"],[1,"manufacturing-order-page-print"],[3,"machines","materials","order","orderId","products"],[3,"order","orderId","products","materials"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._UZ(4,"pek-module-icon",4),t.TgZ(5,"h1"),t._uU(6),t.YNc(7,Ri,2,0,"ng-container",5),t.YNc(8,Hi,2,2,"ng-container",5),t.qZA()(),t.TgZ(9,"div",6)(10,"div",6)(11,"button",7),t.NdJ("click",function(){return e.onEditOrder()}),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){return e.moveToQc()}),t.qZA(),t.TgZ(13,"button",9),t.NdJ("click",function(){return e.onPrintPage()}),t.qZA()()()()(),t.TgZ(14,"div",10)(15,"h2",11),t._uU(16,"Ordered Items"),t.qZA(),t.TgZ(17,"div",12)(18,"div",13)(19,"p-table",14,15),t.NdJ("selectionChange",function(a){return e.selectedProduct=a}),t.YNc(21,$i,5,6,"ng-template",16),t.YNc(22,Bi,20,1,"ng-template",17),t.YNc(23,eo,20,13,"ng-template",18),t.YNc(24,oo,4,3,"ng-template",19),t.YNc(25,ao,2,0,"ng-template",20),t.qZA()(),t.YNc(26,ro,3,0,"div",21),t.qZA(),t.TgZ(27,"h2",11),t._uU(28," Parts/Materials List "),t.qZA(),t.YNc(29,Ao,10,6,"div",22),t.YNc(30,ea,7,1,"div",22),t.TgZ(31,"h2",11),t._uU(32," Machines "),t.qZA(),t.TgZ(33,"div",12)(34,"div",13)(35,"p-table",23,24),t.YNc(37,na,0,0,"ng-template",16),t.YNc(38,ia,9,0,"ng-template",17),t.YNc(39,oa,9,4,"ng-template",18),t.YNc(40,sa,4,3,"ng-template",19),t.YNc(41,ca,2,0,"ng-template",20),t.qZA()(),t.YNc(42,la,3,0,"div",21),t.qZA(),t.TgZ(43,"h2",11),t._uU(44," Technical Equipments "),t.qZA(),t.TgZ(45,"div",25)(46,"div",13)(47,"p-table",23,26),t.YNc(49,da,0,0,"ng-template",16),t.YNc(50,ua,13,0,"ng-template",17),t.YNc(51,_a,13,11,"ng-template",18),t.YNc(52,ma,4,3,"ng-template",19),t.YNc(53,fa,2,0,"ng-template",20),t.qZA()(),t.YNc(54,xa,3,0,"div",21),t.qZA()()(),t.YNc(55,Ta,2,5,"div",27),t.YNc(56,Ca,2,4,"div",27)),2&n){const o=t.MAs(20),a=t.MAs(36),s=t.MAs(48);t.xp6(4),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(2),t.hij(" Order ",e.orderId," "),t.xp6(1),t.Q6J("ngIf",e.isOrderLoading),t.xp6(1),t.Q6J("ngIf",!e.isOrderLoading&&(null==e.order.root_production_list_products[0]?null:e.order.root_production_list_products[0].nomenclature)),t.xp6(3),t.Q6J("disabled",e.isOrderLoading),t.xp6(1),t.Q6J("disabled",e.isOrderLoading)("loading",e.isMovingToQC),t.xp6(1),t.Q6J("disabled",e.isOrderLoading||e.isLoadingProducts),t.xp6(6),t.Q6J("scrollable",!0)("paginator",e.products.length>0)("rows",10)("selection",e.selectedProduct)("value",e.products),t.xp6(7),t.Q6J("ngIf",!o.paginator&&!e.isLoadingProducts&&e.products.length>0),t.xp6(3),t.Q6J("ngIf",e.viewMode===e.ViewMode.LIST),t.xp6(1),t.Q6J("ngIf",e.viewMode===e.ViewMode.HIERARCHY),t.xp6(5),t.Q6J("scrollable",!0)("paginator",e.machines.length>0)("rows",10)("value",e.machines),t.xp6(7),t.Q6J("ngIf",!a.paginator&&!e.isLoadingProducts&&e.machines.length>0),t.xp6(5),t.Q6J("scrollable",!0)("paginator",e.technicalEquipments.length>0)("rows",10)("value",e.technicalEquipments),t.xp6(7),t.Q6J("ngIf",!s.paginator&&!e.isLoadingTechnicalEquipments&&e.technicalEquipments.length>0),t.xp6(1),t.Q6J("ngIf",e.isShowPrint),t.xp6(1),t.Q6J("ngIf",e.isShowOrderProductsPrint)}},dependencies:[f.Hq,f.zx,S.iw,U.jx,S.gc,S.V4,u.JJ,B.nm,u.On,xt.XZ,v.iA,v.Ei,w.D,jn.h,_.sg,_.O5,Ci,Fi],styles:["h2[_ngcontent-%COMP%]{font-size:1.1875rem;font-weight:600}.all-checked[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;justify-content:center}.all-checked[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer}.pi-times[_ngcontent-%COMP%]{color:var(--theme-color-danger);position:relative;top:2px}.pi-check-circle[_ngcontent-%COMP%]{color:var(--theme-color-success);position:relative;top:2px}@media print{.manufacturing-order-page[_ngcontent-%COMP%]{display:none}}.manufacturing-order-page-print[_ngcontent-%COMP%]{z-index:9999;background:#fff;position:absolute;left:0;top:0;right:0;display:none;height:100%}@media print{.manufacturing-order-page-print[_ngcontent-%COMP%]{position:unset;display:block}}"]}),F=(0,A.gn)([(0,C.c)()],F);var va=l(9075),Ma=l(4968),Ct=l(2722),vt=l(4128),Za=l(9751),ba=l(9646);class Pa{constructor(n){this.products=[],this.tasks=[],this.isFiltered=!0,this.isVisible=!0,this.isExpanded=!0,this.isHover=!1,this.isSelected=!0,this.isActive=!1,this.isRootProductionCompleted=!1,this.children=[],this.groups=[],n&&Object.assign(this,n)}get hasChildren(){return Boolean(this.children.length||!this.parent)}getChildrenEnd(){return new Date(Math.max(...this.children.map(n=>n.tasks).flat().map(n=>n.end_date.getTime())))}get isBlocked(){return this.tasks.map(n=>n.tasks).flat().some(n=>"On stock"===n.status)&&!this.isRootProductionCompleted&&this.tasks.some(n=>!n.created_orders.length)}getEnd(){return new Date(Math.max(...this.tasks.map(n=>n.tasks).flat().map(n=>n.end_date.getTime())))}updateGroups(){this.groups=[];for(const n of this.children){const e="1"===n.product.nomenclature.type?0:1;this.groups[e]=this.groups[e]??[],this.groups[e].push(n)}}}var y=l(3068),et=l(7601),z=l(3060),ya=l(176);let Mt=(()=>{class i{constructor(e){this.httpClient=e,this.API_URL=X.N.base_url+X.N.production_url,this.calendar=new Set,this.calendarWeekendDays=[0,6],this.getDates().subscribe(o=>{const a=o.map(s=>{const r=new Date(s.date).setHours(0,0,0,0);return{...s,date:new Date(r)}});this.calendar=new Set(a.map(s=>new Date(s.date).getTime()))})}saveDates(e){return this.httpClient.post(this.API_URL+"holidays/bulk_create/",e).pipe((0,M.U)(o=>o.data))}getDates(){return this.httpClient.get(this.API_URL+"holidays/").pipe((0,M.U)(e=>e.data))}deleteDates(e){return(0,vt.D)(...e.map(o=>this.httpClient.delete(this.API_URL+`holidays/${o.id}/`,o.id)))}isVac(e){const o=e.getDay();let a=this.calendarWeekendDays.includes(o);return this.calendar.has(e.getTime())&&(a=!a),a}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(_t.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const ka=["panelBorder"];function wa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",35)(1,"label",36),t._uU(2,"All"),t.qZA(),t.TgZ(3,"input",37),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.allProductsOnSelected=a)})("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleAllProductsSelected())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.allProductsOnSelected)}}function Aa(i,n){1&i&&t._UZ(0,"div",38,39)}function Oa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",44),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.confirmDateChanges(!0))}),t._uU(1," Confirm "),t.qZA()}}function qa(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",44),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.confirmDateChanges(!1))}),t._uU(1," Confirm "),t.qZA()}}function Ia(i,n){if(1&i&&(t.TgZ(0,"div",14),t._uU(1),t.YNc(2,Oa,2,0,"button",43),t.YNc(3,qa,2,0,"button",43),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.hasRootDeliveryDateChanges&&!e.hasChildDeliveryDateChanges?"Root":""," Dates Of Delivery Changed "),t.xp6(1),t.Q6J("ngIf",e.hasChildDeliveryDateChanges),t.xp6(1),t.Q6J("ngIf",e.hasRootDeliveryDateChanges&&!e.hasChildDeliveryDateChanges)}}function Sa(i,n){1&i&&(t.TgZ(0,"div",49),t._uU(1,"On Stock"),t.qZA())}function Ua(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",51),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(4);return t.KtG(a.sendPlanToCorrections())}),t._uU(1," Request for planing corrections "),t.qZA()}}function Na(i,n){if(1&i&&(t.TgZ(0,"div")(1,"span",49),t._uU(2,"Confirmed"),t.qZA(),t.YNc(3,Ua,2,0,"button",50),t._uU(4),t.qZA()),2&i){const e=t.oxw(3);t.xp6(3),t.Q6J("ngIf",!(null!=e.getLastTask&&e.getLastTask.change_request)),t.xp6(1),t.hij(" ",null!=e.getLastTask&&e.getLastTask.change_request?"(Requested For Planing Corrections)":""," ")}}function Ja(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"Waiting Confirmation"),t.qZA())}function Da(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",52),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.sendPlanToConfirmation())}),t._uU(1," Sent To Confirmation "),t.qZA()}}function Ea(i,n){if(1&i&&(t.TgZ(0,"div"),t.ynx(1,45),t.YNc(2,Sa,2,0,"div",46),t.YNc(3,Na,5,2,"div",47),t.YNc(4,Ja,2,0,"span",47),t.YNc(5,Da,2,0,"button",48),t.BQk(),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngSwitch",null==e.getLastTask?null:e.getLastTask.planning_status),t.xp6(1),t.Q6J("ngSwitchCase",e.PlanningStatus.ON_STOCK),t.xp6(1),t.Q6J("ngSwitchCase",e.PlanningStatus.PLANNED),t.xp6(1),t.Q6J("ngSwitchCase",e.PlanningStatus.WAITING_CONFIRMATION),t.xp6(1),t.Q6J("ngSwitchCase",e.PlanningStatus.REQUIRES_PLANNING)}}function Qa(i,n){if(1&i&&(t.TgZ(0,"div",40),t.YNc(1,Ia,4,3,"div",41),t.YNc(2,Ea,6,5,"div",42),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.hasDeliveryDateChanges&&!e.isPlan),t.xp6(1),t.Q6J("ngIf",(null==e.getLastTask?null:e.getLastTask.planning_status)&&!e.isPlan)}}function La(i,n){if(1&i&&t._UZ(0,"pek-manufacturing-list-product-production",53),2&i){const e=n.$implicit,o=t.oxw();t.Q6J("production",e)("productionNameWidth",o.productionNameWidth)("isRoot",!0)("isLeftPanel",!0)}}function Ya(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,null==e.value?null:e.value.date))}}function Fa(i,n){if(1&i&&(t.TgZ(0,"span",60),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.xi3(2,1,e.value.date,"d"))}}const Ra=function(i){return{middle:i}};function Ha(i,n){if(1&i&&t._UZ(0,"div",61),2&i){const e=n.$implicit,o=t.oxw(3);t.Udp("margin-left",o.marginTimeLeft+"px"),t.s9C("pTooltip",3*(e+1)+":00"),t.Q6J("ngClass",t.VKq(4,Ra,3==e))}}function za(i,n){if(1&i&&(t.TgZ(0,"div",55)(1,"div",56),t.YNc(2,Ya,3,3,"span",42),t.YNc(3,Fa,3,4,"span",57),t.qZA(),t.TgZ(4,"div",58),t.YNc(5,Ha,1,6,"div",59),t.qZA()()),2&i){const e=n.$implicit,o=n.index,a=t.oxw(2);t.Udp("width",(e.value.isVac?a.vacationCoords:a.weekdayCoords)+"px"),t.ekj("ml-3",0===o)("day-header_week",e.value.isVac),t.xp6(1),t.ekj("day-name_small",25===a.planScale),t.xp6(1),t.Q6J("ngIf",!e.value.isVac),t.xp6(1),t.Q6J("ngIf",e.value.isVac),t.xp6(2),t.Q6J("ngForOf",a.hours)}}function $a(i,n){if(1&i&&(t.TgZ(0,"div",7),t.YNc(1,za,6,11,"div",54),t.ALo(2,"keyvalue"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",t.lcZ(2,1,e.dates))}}function Ba(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.ALo(3,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,null==e.value?null:e.value.start)," - ",t.lcZ(3,4,null==e.value?null:e.value.end),"")}}function Ga(i,n){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,null==e.value?null:e.value.start))}}function ja(i,n){1&i&&t._UZ(0,"div",67)}function Ka(i,n){if(1&i&&t._UZ(0,"div",68),2&i){const e=t.oxw(4);t.Udp("right","-"+(e.dayWidth-2)+"px")}}function Wa(i,n){if(1&i&&(t.TgZ(0,"div",64),t.ALo(1,"date"),t.YNc(2,ja,1,0,"div",65),t.YNc(3,Ka,1,2,"div",66),t.qZA()),2&i){const e=n.$implicit,o=n.index,a=t.oxw(3);t.Udp("margin-left",a.dayWidth+"px"),t.ekj("hour-line-week",4===o||5===o),t.s9C("pTooltip",t.xi3(1,7,e.date,"MMMM d")),t.xp6(2),t.Q6J("ngIf",4===o),t.xp6(1),t.Q6J("ngIf",4===o||5===o)}}function Va(i,n){if(1&i&&(t.TgZ(0,"div",55)(1,"div",56),t.YNc(2,Ba,4,6,"span",42),t.YNc(3,Ga,3,3,"span",42),t.qZA(),t.TgZ(4,"div",58),t.YNc(5,Wa,4,10,"div",63),t.qZA()()),2&i){const e=n.$implicit,o=n.index,a=t.oxw(2);t.Udp("width",a.weekdayCoords+"px"),t.ekj("ml-3",0===o),t.xp6(1),t.ekj("day-name_small",25===a.planScale),t.xp6(1),t.Q6J("ngIf",25!==a.planScale),t.xp6(1),t.Q6J("ngIf",25===a.planScale),t.xp6(2),t.Q6J("ngForOf",a.getDays(null==e.value?null:e.value.days))}}function Xa(i,n){if(1&i&&(t.TgZ(0,"div",7),t.YNc(1,Va,6,9,"div",62),t.ALo(2,"keyvalue"),t.qZA()),2&i){const e=t.oxw();t.ekj("week-header",50===e.planScale),t.xp6(1),t.Q6J("ngForOf",t.lcZ(2,3,e.weekDates))}}function tr(i,n){1&i&&t._UZ(0,"pek-manufacturing-list-product-production",71),2&i&&t.Q6J("production",n.$implicit)}function er(i,n){if(1&i&&(t.TgZ(0,"div",69),t.YNc(1,tr,1,1,"pek-manufacturing-list-product-production",70),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.rootProductions)}}function nr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",72)(1,"button",73),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancelEditTasks())}),t.qZA(),t.TgZ(2,"div",74)(3,"p-multiSelect",75),t.NdJ("onChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectTasks())})("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedTechnologiesPlanning=a)}),t.qZA()(),t.TgZ(4,"p",76),t._uU(5),t.qZA(),t.TgZ(6,"button",77),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.editTasks())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("options",e.technologiesPlanning)("ngModel",e.selectedTechnologiesPlanning),t.xp6(2),t.hij("Selected ",e.selectedTasks.size," tasks"),t.xp6(1),t.Q6J("disabled",!e.selectedTasks.size)}}function ir(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",78)(1,"button",73),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancelMakeOrder())}),t.qZA(),t.TgZ(2,"div",79)(3,"p-multiSelect",75),t.NdJ("onChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.filterTasks())})("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedTechnologies=a)}),t.qZA()(),t.TgZ(4,"button",80),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.makeOrder())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("options",e.technologies)("ngModel",e.selectedTechnologies),t.xp6(1),t.Q6J("disabled",0===e.selectedTechnologies.length)}}function or(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",81)(1,"button",73),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.mode="planning")}),t.qZA(),t.TgZ(2,"div",7)(3,"div"),t._uU(4,"Click on the button"),t.qZA(),t.TgZ(5,"button",82),t._UZ(6,"i",83),t.qZA(),t.TgZ(7,"div"),t._uU(8,"to add items to the plan"),t.qZA()()()}}function ar(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",104)(1,"p-multiSelect",105),t.NdJ("onChange",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.filterTasksForStatus())})("ngModelChange",function(a){t.CHM(e);const s=t.oxw(2);return t.KtG(s.selectedProductions=a)}),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("options",e.chartRootTasks)("ngModel",e.selectedProductions)}}function rr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",84)(1,"div",14)(2,"p",85),t._uU(3,"Initialize:"),t.qZA(),t.TgZ(4,"button",86),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.mode="make-order")}),t.qZA(),t.TgZ(5,"button",87),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.mode="edit-tasks")}),t.qZA(),t.TgZ(6,"button",88),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.mode="add-items")}),t.qZA(),t.TgZ(7,"button",89),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleShowConfirmation())}),t.qZA(),t.TgZ(8,"div",90)(9,"button",91),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.togglePlanScale("minus"))}),t.qZA(),t.TgZ(10,"div",92),t._uU(11),t.qZA(),t.TgZ(12,"button",93),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.togglePlanScale("plus"))}),t.qZA()(),t.YNc(13,ar,2,2,"div",94),t.TgZ(14,"div",95)(15,"p-multiSelect",96),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedStatuses=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.filterTasksForStatus())}),t.qZA()(),t.TgZ(16,"div",97)(17,"p-multiSelect",98),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedFilterTechnologies=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.filterTasksForStatus())}),t.qZA()(),t.TgZ(18,"div",99)(19,"p-multiSelect",100),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedProductionTypes=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.filterTasksForStatus())}),t.qZA()(),t.TgZ(20,"div",101)(21,"p",102),t._uU(22,"Displaying: "),t.qZA(),t.TgZ(23,"p-dropdown",103),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedDisplay=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onSelectDisplay())}),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(7),t.Q6J("icon","pi "+(e.isShowConfirmationMenu?"pi-eye-slash":"pi-eye"))("label",(e.isShowConfirmationMenu?"Hide":"Show")+" Confirmation"),t.xp6(2),t.Q6J("disabled",25===e.planScale),t.xp6(2),t.hij("",e.planScale,"%"),t.xp6(1),t.Q6J("disabled",100===e.planScale),t.xp6(1),t.Q6J("ngIf",e.isPlan),t.xp6(2),t.Q6J("options",e.statuses)("ngModel",e.selectedStatuses)("showClear",!0),t.xp6(2),t.Q6J("options",e.technologiesPlanning)("ngModel",e.selectedFilterTechnologies)("showClear",!0),t.xp6(2),t.Q6J("options",e.productionsTypes)("ngModel",e.selectedProductionTypes)("showClear",!0),t.xp6(4),t.Q6J("options",e.displayOptions)("ngModel",e.selectedDisplay)}}function sr(i,n){1&i&&(t.TgZ(0,"div",106),t._UZ(1,"i",107),t.TgZ(2,"p"),t._uU(3,"Chart loading in progress"),t.qZA()())}const Zt=function(){return{left:12}},bt=function(){return{left:!0}};class cr extends va.mt{}let k=class{constructor(n,e,o,a,s,r,c,d,h){this.tasksService=n,this.technologiesService=e,this.modalService=o,this.cd=a,this.adapterService=s,this.router=r,this.route=c,this.calendar=d,this.expandCollapseHeaderService=h,this.PlanningStatus=z.U,this.planScale=100,this.nomenclaturesTypes={0:3,1:1,2:2},this.selectedStatuses=[],this.selectedFilterTechnologies=[],this.selectedProductionTypes=[],this.productionsTypes=[{value:"0",name:"Outsource"},{value:"1",name:"Own production"},{value:"2",name:"Purchased"}],this.statuses=[{value:"Not processed",label:"Not processed"},{value:"Deficit",label:"Deficit"},{value:"Rework",label:"Rework"},{value:"Ordered",label:"Ordered"},{value:"On stock",label:"On stock"},{value:"Reserved",label:"Reserved"}],this.selectedDisplay="days",this.displayOptions=[{option:"days",label:"Days"},{option:"weeks",label:"Weeks"}],this.isPlan=!1,this.isRoot=!1,this.isRootFiltered=!1,this.productionNameWidth=150,this.mode="planning",this.loadingTasks=[],this.chartRootTasks=[],this.tasks=[],this.selectedTasks=new Set,this.innerContentWidth=516,this.rootProductions=[],this.productions=[],this.marginTimeLeft=34,this.scaleHourVacationDay=1,this.scaleHourWeekdayDay=12,this.vacationCoords=24,this.weekdayCoords=288,this.weekWeekDayCoords=41.125,this.weekScaleHourDay=1.717,this.allTechnologies=[],this.technologies=[],this.technologiesPlanning=[],this.availableTechnologies=new Set,this.availableTechnologiesPlanning=new Set,this.filteredTasksSet=new Set,this.selectedTechnologies=[],this.selectedTechnologiesPlanning=[],this.selectedProductions=[],this.allProductsOnSelected=!0,this.isShowBorder=!1,this.frameBorderRight=0,this.reserveTasks=[],this.childrenEndHighlighted=!1,this.dates=new Map,this.weekDates=new Map,this.datesByCoords=[],this.colors=["#fbf8cc","#fde4cf","#ffcfd2","#f1c0e8","#cfbaf0","#a3c4f3","#e8e8e4","#d7e3fc","#dbfdd8","#f9f195","#bdd7d2","#ebf4ff","#ccd5ae","#e3d5ca","#e0d4ed"],this.isExpanded=!0,this.hasDeliveryDateChanges=!1,this.hasRootDeliveryDateChanges=!1,this.hasChildDeliveryDateChanges=!1,this.productionMap=new Map,this.uiTaskMap=new Map,this.destroy$=new O.x,this.isLoading=!0,this.isShowConfirmationMenu=!1,this.selectedListProductsGroupUIds=new Set,this.hours=Array(7).fill(0).map((m,g)=>g)}get startDate(){return this.dates.values().next().value}ngOnInit(){this.isPlan&&(this.isExpanded=!1,this.isRoot=!0),this.technologiesService.get().subscribe(n=>{this.technologies=n,this.allTechnologies=n,this.technologiesPlanning=n,this.getTasks().subscribe()}),document.body.style.overflow="hidden",this.taskDeleteSub=this.tasksService.delete$.subscribe(n=>this.onTaskDelete(n)),(0,Ma.R)(window,"keydown").pipe((0,Ct.R)(this.destroy$),(0,x.h)(n=>"Escape"===n.key),(0,x.h)(()=>"planning"!==this.mode)).subscribe(n=>this.mode="planning"),requestAnimationFrame(()=>{this.expandCollapseHeaderService.setIsCollapseSingleDisabled(!0)}),this.expandCollapseHeaderService.expandCollapseAll.pipe((0,Ct.R)(this.destroy$)).subscribe(n=>{this.isExpanded=n,this.expandCollapseAll(!1)})}updateTechnologies(){this.availableTechnologies.clear(),this.availableTechnologiesPlanning.clear(),this.tasks.filter(n=>!n.is_locked&&"Deficit"===n.status).forEach(n=>{this.availableTechnologies.add(n.technology||"1"!==n.list_product.nomenclature.type?n.technology:"Assembly")}),this.tasks.forEach(n=>{this.availableTechnologiesPlanning.add(n.technology||"1"!==n.list_product.nomenclature.type?n.technology:"Assembly")}),this.technologies=this.allTechnologies.filter(n=>this.availableTechnologies.has(n.name)),this.technologiesPlanning=this.allTechnologies.filter(n=>this.availableTechnologiesPlanning.has(n.name))}getTasks(n=null){this.rootId=n||this.rootId;let e=[{name:"for_root_id__in",value:this.rootId}];return this.isPlan&&!n&&(e=[{name:"is_root",value:!0},{name:"statuses",value:"0,1,2,3"}]),this.tasksService.get(e).pipe((0,M.U)(o=>((o=(o=o.filter(a=>!this.tasks.find(s=>a.id===s.id))).map(a=>({...a,status:a.refunded_orders.length>0&&!a.is_refunded?"Deficit":a.status,production_type:"0"===a.list_product.nomenclature.type?"2":a.production_type,start_date:new Date(a.start_date),end_date:new Date(a.end_date),unconfirmed_end_date:a.unconfirmed_end_date?new Date(a.unconfirmed_end_date):null}))).filter(a=>!a.is_locked&&"Deficit"===a.status).forEach(a=>{a.technology||"1"!==a.list_product.nomenclature.type?this.availableTechnologies.add(a.technology):(a.technology="Assembly",this.availableTechnologies.add("Assembly"))}),o.forEach(a=>{this.availableTechnologiesPlanning.add(a.technology||"1"!==a.list_product.nomenclature.type?a.technology:"Assembly"),a.list_product.task_required_quantity=a.required_quantity,a.groupId=""}),this.technologies=this.allTechnologies.filter(a=>this.availableTechnologies.has(a.name)),this.technologiesPlanning=this.allTechnologies.filter(a=>this.availableTechnologiesPlanning.has(a.name)),this.tasks.push(...o),this.loadingTasks=[...this.tasks],this.isPlan&&this.isRoot&&(this.chartRootTasks=[],this.tasks.forEach(a=>{this.chartRootTasks.find(s=>s.family_id===a.family_id&&s.list_product.id===a.list_product.id&&s.technology===a.technology&&a.list_product.tree_id===s.list_product.tree_id)||this.chartRootTasks.push(a)}),this.chartRootTasks.forEach(a=>a.label=`(${a.list_product.id}) ${a.list_product.nomenclature.name}`),this.chartRootTasks.sort((a,s)=>new Date(s.created).getTime()-new Date(a.created).getTime()||this.nomenclaturesTypes[a.list_product.nomenclature.type]-this.nomenclaturesTypes[s.list_product.nomenclature.type]||a.list_product.nomenclature.id-s.list_product.nomenclature.id),this.isRoot=!1),this.updateTimeline(),this.updateTree(),this.update(),this.paint(),this.isLoading=!1,this.clearSelectedListProductsGroupUIds(),o)),(0,C.t)(this))}generateTasksGroups(){this.tasks.forEach(n=>{if(0!==n.list_product.level){const o=this.tasks.filter(r=>r.list_product.nomenclature.id===n.list_product.nomenclature.id&&r.list_product.level===n.list_product.level&&r.family_id===n.family_id).filter(r=>!r.previous_task),a=[];let s=0;o.forEach(r=>{const c=r.list_product.id;s++;let d=r;for(;d?.next_task;)d.uiGroupId=s,d.uiParent=c,a.push(d),d=this.tasks.find(h=>h.id===d.next_task);d.uiGroupId=s,d.uiParent=c,a.push(d)}),a.filter(r=>r.uiGroupId===n.uiGroupId).forEach(r=>{n.groupId+=`${r.technology}/${r.status}/${r.list_product.nomenclature.id}/${r.list_product.level}/${r.created_orders.map(c=>c.id).join(",")}`})}})}updateTimeline(){const n=(r,c)=>{const d=new Date(r.getTime());return d.setDate(d.getDate()+c),d.setHours(0,0,0,0),d},e=new Date(Math.min(...this.tasks.filter(r=>r.start_date).map(r=>r.start_date.getTime())));let o=new Date(Math.max(...this.tasks.filter(r=>r.end_date).map(r=>r.end_date.getTime())));const a=new Date(Math.max(...this.tasks.filter(r=>r.unconfirmed_end_date).map(r=>r.unconfirmed_end_date.getTime())));a&&a>o&&(o=a);let s=0;if(this.dates.clear(),this.weekDates.clear(),"days"===this.selectedDisplay){let r=n(e,0);do{const c={date:new Date(r),isVac:this.calendar.isVac(r),x:s};c.date.setHours(0,0,0,0),this.dates.set(c.date.getTime(),c),r=n(r,1),s+=c.isVac?this.vacationCoords:this.weekdayCoords}while(r<=o)}else this.getWeeksBetween(e,o).forEach(c=>{let d=0;const h=[];for(;d<7;){const g=new Date(c.start.getTime()+864e5*d),T={date:new Date(g),isVac:this.calendar.isVac(g),x:s};h.push(T),s+=this.weekWeekDayCoords,d++}const m={start:c.start,end:c.end,days:h};this.weekDates.set(c.start.getTime(),m)});this.innerContentWidth=516,"days"===this.selectedDisplay?(this.dates.forEach(r=>{this.innerContentWidth+=r.isVac?this.vacationCoords:this.weekdayCoords}),this.datesByCoords=Array.from(this.dates.values()).reverse()):(this.innerContentWidth+=Array.from(this.weekDates.values()).map(r=>r.days).flat().reduce((r,c)=>r+this.weekWeekDayCoords,0),this.datesByCoords=Array.from(this.weekDates.values()).map(r=>r.days).flat().reverse())}getWeeksBetween(n,e){const o=[];let a=new Date(n.setHours(0,0,0,0)-864e5*(n.getDay()-1));for(a.setHours(0,0,0,0);a.getTime()<=e.getTime();){let r=new Date(a);r.setDate(a.getDate()+6),r>e&&(r=e),o.push({start:new Date(a),end:r}),a.setDate(a.getDate()+7)}const s={...o[o.length-1]};return o[o.length-1].end=new Date(s.end.setHours(0,0,0,0)+864e5*(7-s.end.getDay())),o}testWeek(){const n=new Date(Math.min(...this.tasks.filter(r=>r.start_date).map(r=>r.start_date.getTime())));let e=new Date(Math.max(...this.tasks.filter(r=>r.end_date).map(r=>r.end_date.getTime())));const o=new Date(Math.max(...this.tasks.filter(r=>r.unconfirmed_end_date).map(r=>r.unconfirmed_end_date.getTime())));o&&o>e&&(e=o);const a=this.getWeeksBetween(n,e);let s=0;a.forEach(r=>{let c=0;const d=[];for(;c<7;){const m=new Date(r.start.getTime()+864e5*c),g={date:new Date(m),isVac:this.calendar.isVac(m),x:s};d.push(g),s+=this.weekWeekDayCoords,c++}const h={start:r.start,end:r.end,days:d};this.weekDates.set(r.start.getTime(),h)}),this.datesByCoords=Array.from(this.weekDates.values()).map(r=>r.days).flat().reverse(),this.updateProductions()}updateProductions(){this.productions.forEach(n=>{n.tasks.forEach(e=>{e.left=this.getX(e.start_date),e.width=this.getX(e.end_date)-e.left,this.getTaskDays(e),this.updateTimeline(),this.updateMargins(n)})})}getX(n){const e=this.getDateInfo(n);let o;const a=e?.x;return o="days"===this.selectedDisplay?n.getHours()*(e?.isVac?this.scaleHourVacationDay:this.scaleHourWeekdayDay):n.getHours()*this.weekScaleHourDay,a+o}getDate(n){const e=this.getDateInfo(n),o=n-e.x;let a;a="days"===this.selectedDisplay?e.isVac?this.scaleHourVacationDay:this.scaleHourWeekdayDay:this.weekScaleHourDay;const s=new Date(e.date);return s.setHours(o/a),s}getDateInfo(n){if("days"===this.selectedDisplay){let e;if(n instanceof Date){const o=new Date(n);o.setHours(0,0,0,0),e=this.dates?.get(o.getTime())}else e=this.datesByCoords.find(o=>o.x<=n);return e}{let e;if(n instanceof Date){const o=new Date(n);o.setHours(0,0,0,0);for(let a of this.weekDates.values())e||(e=a.days.find(s=>s.date.getTime()===o.getTime()))}else e=this.datesByCoords.find(o=>o.x<=n);return e}}getTaskDays(n){const e=new Map,o=(r,c)=>{const d=new Date(r.getTime());return d.setDate(d.getDate()+c),d};e.clear();let a=o(n.start_date,0);a.setHours(0,0,0,0);const s=n.end_date;do{const r={date:new Date(a),isVac:this.calendar.isVac(a),x:this.getX(a)-n.left};r.date.setHours(0,0,0,0),e.set(r.date.getTime(),r),a=o(a,1)}while(a<=s);if(n.unconfirmed_end_date&&n.unconfirmed_end_date>n.end_date)do{const r={date:new Date(a),isVac:this.calendar.isVac(a),x:this.getX(a)-n.left};r.date.setHours(0,0,0,0),e.set(r.date.getTime(),r),a=o(a,1)}while(a<=n.unconfirmed_end_date);n.days=Array.from(e.values())}moveBorder(n){this.isShowBorder=!0,this.frameBorderRight!==n.edges.left&&(this.frameBorderRight<n.edges.left?this.frameBorderRight+=12:this.frameBorderRight-=12,this.panelBorder&&(this.panelBorder.nativeElement.style.right=-this.frameBorderRight+"px"))}resizePanel(n){const e=this.productionNameWidth+n.edges.left;this.productionNameWidth=e>70?e:70,this.frameBorderRight=0,this.isShowBorder=!1,this.panelBorder&&(this.panelBorder.nativeElement.style.right="0px")}filteredRoot(n){const e=this.selectedProductions.map(o=>o.family_id);e.length>0?(this.isRootFiltered=!0,this.productions.forEach(o=>{o.isVisible=!1,e.forEach(a=>{a===o.tasks[0].family_id&&(o.isVisible=!0)})})):(this.isRootFiltered=!1,this.productions.forEach(o=>o.isVisible=!0))}filterTasks(n){this.productions.forEach(e=>e.isVisible=!1),this.productions.forEach(e=>{if(e.isFiltered=Boolean(e.tasks.find(o=>!this.selectedTechnologies.length||(n?this.selectedTechnologies.includes(o.technology?o.technology:"Assembly"):this.isTaskMeetsFilterConditions(o)))),e.isFiltered){let o=e;for(;o;)o.isVisible=!0,o=o.parent}})}filterTasksForStatus(){const n=[];this.filteredTasksSet.clear(),this.selectedStatuses||(this.selectedStatuses=[]),this.selectedFilterTechnologies||(this.selectedFilterTechnologies=[]),this.selectedProductionTypes||(this.selectedProductionTypes=[]),this.productions.forEach(e=>e.isVisible=!1),this.productions.forEach(e=>{let o=e.tasks,a=[];if(this.isPlan&&this.selectedProductions.length&&this.selectedProductions.forEach((s,r)=>{const c=o.filter(d=>d.family_id===s);a=a.concat(c),r===this.selectedProductions.length-1&&(o=[...a],a=[])}),console.log(this.selectedStatuses),console.log(this.selectedFilterTechnologies),this.selectedStatuses.length&&this.selectedStatuses.forEach((s,r)=>{const c=o.filter(d=>d.status===s);a=a.concat(c),r===this.selectedStatuses.length-1&&(o=[...a],a=[])}),this.selectedFilterTechnologies.length&&this.selectedFilterTechnologies.forEach((s,r)=>{const c=o.filter(d=>d.technology===s);a=a.concat(c),r===this.selectedFilterTechnologies.length-1&&(o=[...a],a=[])}),this.selectedProductionTypes.length&&this.selectedProductionTypes.forEach((s,r)=>{const c=o.filter(d=>d.production_type===s);a=a.concat(c),r===this.selectedProductionTypes.length-1&&(o=[...a],a=[])}),o.forEach(s=>{this.filteredTasksSet.add(s.id),this.isPlan&&s.tasks.forEach(r=>n.push(r))}),e.isFiltered=Boolean(e.tasks.find(s=>this.test(s))),e.isFiltered){let s=e;for(;s;)s.isVisible=!0,this.isPlan&&(s.tasks[0].tasks.forEach(r=>n.push(r)),this.updateMargins(s)),s=s.parent}}),this.isPlan&&(this.reserveTasks=[...this.tasks],this.tasks=[...n],this.productions.filter(e=>e.isVisible).forEach(e=>{e.tasks.forEach(o=>{o.left=this.getX(o.start_date),o.width=this.getX(o.end_date)-o.left,this.updateTimeline(),this.getTaskDays(o),this.updateMargins(e)})}),this.updateTechnologies())}selectTasks(){this.selectedTasks.clear(),this.selectedTechnologiesPlanning.forEach(n=>{this.productions.forEach(e=>{e.tasks.forEach(o=>{o.production=e,(o.technology===n||"0"!==o.list_product.nomenclature.type&&!o.technology&&"Assembly"===n)&&this.selectedTasks.add(o)})})})}makeOrder(){const n=this.getSelectedTechnologies(),e=this.getSelectedProduction();n.length>0&&this.tasksService.makeOrderDialog(n).subscribe(o=>{if(o){this.filterTasks();const a=[];n.forEach(s=>{s.tasks.forEach(r=>{a.push(r)})}),(0,vt.D)(...a.map(s=>this.tasksService.getById(s.id))).subscribe(s=>{const r=s.flat();a.forEach(c=>{const d=this.tasks.find(h=>h.id===c.id);if(d){const h=r.find(m=>m.id===c.id);d.created_order=h.created_order,d.created_orders=h.created_orders,d.status=h.refunded_orders.length>0&&!h.is_refunded?"Deficit":h.status,d.start_date=new Date(h.start_date),d.end_date=new Date(h.end_date)}}),e.forEach(c=>{c.tasks.forEach(d=>{d.tasks.forEach(h=>{const m=a.find(g=>g.id===h.id);if(m){const g=r.find(T=>h.id===T.id);m.created_order=g.created_order,m.created_orders=g.created_orders,m.start_date=new Date(g.start_date),m.end_date=new Date(g.end_date),m.status=g.refunded_orders.length>0&&!g.is_refunded?"Deficit":g.status,d.created_order=g.created_order,d.created_orders=g.created_orders,d.status=g.refunded_orders.length>0&&!g.is_refunded?"Deficit":g.status,d.start_date=new Date(g.start_date),d.end_date=new Date(g.end_date)}})})})}),a.forEach(s=>{this.tasks.find(r=>r.id===s.id).is_locked=!0}),this.updateTechnologies()}})}editTasks(){if(this.selectedTasks.size>0){const n=Array.from(this.selectedTasks);this.tasksService.editTasksDialog(n).subscribe(e=>{e.start&&e.end&&n.forEach(o=>{this.applyPositionTask(o,o.production,e)}),e.shiftByAmount&&e.shiftByType&&this.updateIfShiftIsApplied(n,e)})}}updateIfShiftIsApplied(n,e){n.forEach(o=>{if(o.list_product.nomenclature.type!==y.BN.PURCHASED){const a=e.shiftByAmount,s=e.shiftByType;let r=new Date(o.start_date),c=new Date(o.end_date);s===et.D.DAYS&&(r=new Date(r.setDate(r.getDate()+a)),c=new Date(c.setDate(c.getDate()+a))),s===et.D.HOURS&&(r=new Date(r.setHours(r.getHours()+a)),c=new Date(c.setHours(c.getHours()+a))),s===et.D.WEEKS&&(r=new Date(r.setDate(r.getDate()+7*a)),c=new Date(c.setDate(c.getDate()+7*a))),s===et.D.MONTHS&&(r=new Date(r.setMonth(r.getMonth()+a)),c=new Date(c.setMonth(c.getMonth()+a))),this.applyPositionTask(o,o.production,{start:r,end:c})}})}getDuration(n){return(n.end_date.getTime()-n.start_date.getTime())/1e3/60/60}ngOnDestroy(){document.body.style.overflow="",this.destroy$.next(null),this.taskDeleteSub.unsubscribe()}onTaskDelete(n){n.production.parent?(this.tasks=this.tasks.filter(e=>!n.tasks.includes(e)),this.selectedTasks.delete(n),n.production.tasks=n.production.tasks.filter(e=>e!==n),this.updateTechnologies(),0===n.production.tasks.length&&(n.production.parent.children=n.production.parent.children.filter(e=>e!==n.production),this.productions=this.productions.filter(e=>e!==n.production),this.paint())):this.router.navigateByUrl("dash/production/plan").then()}updateTaskDates(n){const e={start_date:n.start_date,end_date:n.end_date},o=this.getLastTask;o&&o.list_product.id===n.list_product.id&&o.planning_status===z.U.PLANNED&&(o.planning_status=z.U.WAITING_CONFIRMATION),this.tasksService.update(n,e).pipe((0,tt.q)(1)).subscribe(()=>{n.isSaved=!0,setTimeout(()=>n.isSaved=!1,1e3)})}get getLastTask(){return this.rootProductions[0]?.tasks?.find(n=>!n.next_task&&!n.parent_task)}updateMargins(n){n.tasks.map(e=>(e.left=this.getX(e.start_date),e.width=this.getX(e.end_date)-e.left,n.product&&e.unconfirmed_end_date&&(e.unconfirmedLeft=null,e.unconfirmedSmallerWidth=null,e.unconfirmedBiggerWidth=null,e.unconfirmed_end_date>e.end_date&&(e.unconfirmedLeft=e.left,e.unconfirmedBiggerWidth=this.getX(e.unconfirmed_end_date)-e.left),e.unconfirmed_end_date<e.end_date&&(e.unconfirmedLeft=this.getX(e.unconfirmed_end_date),e.unconfirmedSmallerWidth=this.getX(e.end_date)-e.unconfirmedLeft),this.hasDeliveryDateChanges=!0,e.parent_task||e.next_task||0!==e.list_product.level?this.hasChildDeliveryDateChanges=!0:this.hasRootDeliveryDateChanges=!0),this.getTaskDays(e),e))}updateParentMargins(n,e=!0){let o=n;for(;o;){const a=o.getChildrenEnd();o.tasks.reduce((s,r)=>(r.start_date.getTime()<s.getTime()&&(r.duration=(r.end_date.getTime()-r.start_date.getTime())/1e3/60/60,r.start_date=s,r.end_date=new Date(r.start_date.getTime()+60*r.duration*6e4),r.apply(),this.updateTimeline(),r.left=this.getX(r.start_date),r.width=this.getX(r.end_date)-r.left,e&&this.updateTaskDates(r),this.getTaskDays(r)),r.end_date),a),o=o.parent}}toggle(){this.isExpanded=!this.isExpanded,this.expandCollapseAll()}expandCollapseAll(n=!0){let e=[];if(n&&(e=this.productions.filter(this.isPlan?o=>o.isActive&&o.isVisible&&!o.isBlocked:o=>o.isActive&&!o.isBlocked)),console.log("prods",e),this.isPlan){const o=a=>a.forEach(s=>{this.toggleProduction(s,this.isExpanded).subscribe(()=>{o(s.children)})});o(e.length>0?e:this.productions.filter(a=>a.isVisible&&!a.isBlocked))}else{const o=a=>a.filter(s=>!s.isBlocked).forEach(s=>{this.toggleProduction(s,this.isExpanded).subscribe(()=>o(s.children))});o(e.length>0?e:this.productions)}}toggleProduction(n,e){return new Za.y(o=>{n.isExpanded=void 0!==e?e:!n.isExpanded,n.isExpanded&&n.hasChildren&&!n.children.length?this.getTasks(n.tasks[0].tasks[0].id).subscribe(()=>{this.isRootFiltered&&this.updateTimeline(),n.updateGroups(),o.next(e),o.complete()},a=>o.error(a)):(o.next(n.isExpanded),o.complete())})}expandCollapseSelected(n,e){if(this.isPlan){const o=a=>a.forEach(s=>{this.toggleProduction(s,e).subscribe(()=>{o(s.children)})});o(n.filter(a=>a.isVisible&&!a.isBlocked))}else{const o=a=>a.filter(s=>!s.isBlocked).forEach(s=>{this.toggleProduction(s,e).subscribe(()=>{o(s.children)})});o(n)}}toggleProduction2(n,e){return n.isExpanded=void 0!==e?e:!n.isExpanded,n.isExpanded&&n.hasChildren&&!n.children.length?this.getTasks(n.product.tree_id).pipe((0,p.b)(()=>n.updateGroups()),(0,ht.h)(n.isExpanded)):(0,ba.of)(n.isExpanded)}toggleAllProductsSelected(){this.productions.map(this.allProductsOnSelected?n=>n.isSelected=!0:n=>n.isSelected=!1)}changeAllProductsOnSelected(){this.allProductsOnSelected=this.productions.every(n=>n.isSelected)}cancelEditTasks(){this.mode="planning",this.selectedTasks.clear(),this.productions.map(n=>n.isVisible=!0),this.selectedTechnologies=[],this.selectedTechnologiesPlanning=[]}cancelMakeOrder(){this.mode="planning",this.productions.map(n=>n.isVisible=!0),this.selectedTechnologies=[],this.filterTasksForStatus()}type(n){switch(n){case y.BN.PURCHASED:return"Purchased";case y.BN.ASSEMBLY:return"Assembly";case y.BN.MANUFACTURED:return"Manufactured"}}addTasks(n){this.tasksService.addTasks(n.tasks[0].tasks,this.rootId).pipe((0,M.U)(e=>e.filter(o=>!this.tasks.find(a=>o.id===a.id)))).subscribe(e=>{console.log(e),e.forEach(o=>{o.production_type="0"===o.list_product.nomenclature.type?"2":o.production_type,o.start_date=new Date(o.start_date),o.end_date=new Date(o.end_date),o.list_product.task_required_quantity=o.required_quantity}),this.tasks.push(...e),this.updateTimeline(),this.updateTree(),this.updateParentMargins(n),this.updateMargins(n),this.updateTree(),this.update(),this.paint(),this.updateTechnologies()})}highlightChildrenEnd(){this.childrenEndHighlighted=!0,setTimeout(()=>this.childrenEndHighlighted=!1,2500)}applyPositionTask(n,e,o){const a=e.tasks.filter(r=>r.start_date.getTime()<n.start_date.getTime());if(a.length)a.forEach(r=>{r.end_date.getTime()>o.start.getTime()&&(o.start.setTime(r.end_date.getTime()),o.end.getTime()<n.end_date.getTime()&&o.end.setTime(o.start.getTime()+60*n.duration*6e4))});else{const r=e.getChildrenEnd();r.getTime()>o.start.getTime()&&(this.highlightChildrenEnd(),o.start.setTime(r.getTime()),o.end.getTime()<n.end_date.getTime()&&o.end.setTime(o.start.getTime()+60*n.duration*6e4))}e.tasks.filter(r=>r.start_date.getTime()>n.start_date.getTime()).reduce((r,c)=>(c.start_date.getTime()<r.getTime()&&(c.duration=(c.end_date.getTime()-c.start_date.getTime())/60/1e3,c.start_date.setTime(r.getTime()),c.end_date.setTime(c.start_date.getTime()+6e4*c.duration),this.updateTaskDates(c)),c.end_date),o.end),n.start_date=o.start,n.end_date=o.end,n.duration=n.duration=this.getDuration(n),n.apply(),this.updateTimeline(),this.updateMargins(e),this.updateParentMargins(e.parent),this.updateTaskDates(n)}updateTree(){this.productionMap=new Map,this.uiTaskMap=new Map,this.productions=[],this.rootProductions=[],this.generateTasksGroups();const n=new Map;this.tasks.forEach(s=>{n.set(`${s.family_id}:${s.list_product.id}`,s)}),this.tasks.filter(s=>s.is_added_manually).forEach((s,r)=>s.technologyUid=r+1),this.tasks.forEach(s=>{const r=s.list_product.id,c=(s=>{let r="";do{r=`${s.family_id}:${s.list_product.nomenclature.id}:${s.groupId}:${s.list_product.level}/${r}`,s=n.get(`${s.family_id}:${s.list_product.parent}`)}while(s);return r})(s);if(!this.productionMap.has(c)){const T=new Pa({task:s,product:s.list_product,isExpanded:!this.isPlan,isGrouped:s.is_grouped});this.productions.push(T),this.productionMap.set(c,T)}const d=this.productionMap.get(c);this.productionMap.set(`${r}:${s.family_id}`,d),d.products.find(T=>T.id===s.list_product.id)||d.products.push(s.list_product),d.products.length>1&&(d.isGrouped=!0);const m=`${c}:${s.technology?s.technology:this.type(s.list_product.nomenclature.type)}`;if(!this.uiTaskMap.has(m)){const T=new cr(s);this.uiTaskMap.set(m,T),d.tasks.push(T)}const g=this.uiTaskMap.get(m);g.tasks.find(T=>T.id===s.id)||g.tasks.push(s)});let o=0;this.productionMap.forEach(s=>{s.index=o++,s.parent=this.productionMap.get(`${s.product.parent}:${s.tasks[0].family_id}`),s.isExpanded=0===s.task.list_product.level?!this.isPlan:!s.isBlocked,s.parent?s.parent.children.includes(s)||s.parent.children.push(s):this.rootProductions.includes(s)||this.rootProductions.push(s)});const a=s=>{s.isRootProductionCompleted=!0,s.isExpanded=!0,s.children.length&&s.children.forEach(r=>a(r))};this.rootProductions.forEach(s=>{"On stock"===s.task.status&&a(s)}),this.sortProductions(this.rootProductions)}sortProductions(n){n.sort((e,o)=>this.nomenclaturesTypes[e.task.list_product.nomenclature.type]-this.nomenclaturesTypes[o.task.list_product.nomenclature.type]||e.task.list_product.nomenclature.id-o.task.list_product.nomenclature.id),n.forEach(e=>{e.children.length>0&&this.sortProductions(e.children)})}update(){this.sortProductions(this.rootProductions),this.productionMap.forEach(n=>{this.updateMargins(n),n.updateGroups()})}paint(){const n=(e,o=0)=>("1"===e.product.nomenclature.type&&(e.color=this.colors[o++%this.colors.length]),e.children.reduce((a,s)=>n(s,a),o));this.rootProductions.reduce((e,o)=>n(o,e),0)}getSelectedTechnologies(){return this.productions.filter(n=>n.isFiltered).filter(n=>n.isSelected).map(n=>n.tasks).reduce((n,e)=>n.concat(e),[]).filter(n=>this.isTaskMeetsFilterConditions(n))}getSelectedProduction(){return this.productions.filter(n=>n.isFiltered).filter(n=>n.isSelected)}isTaskMeetsFilterConditions(n){return this.selectedTechnologies.includes(n.technology)&&!n.is_locked&&"Not processed"!==n.status&&"Ordered"!==n.status&&"On stock"!==n.status}test(n){return!!this.filteredTasksSet.has(n.id)}togglePlanScale(n){switch("minus"===n&&(this.planScale-=25),"plus"===n&&(this.planScale+=25),this.planScale<25&&(this.planScale=25),this.planScale>100&&(this.planScale=100),this.planScale){case 100:this.vacationCoords=24,this.weekdayCoords=288,this.marginTimeLeft=34,this.scaleHourVacationDay=1,this.scaleHourWeekdayDay=12,this.weekWeekDayCoords=41.125,this.weekScaleHourDay=1.717;break;case 75:this.vacationCoords=18,this.weekdayCoords=216,this.marginTimeLeft=25,this.scaleHourVacationDay=1,this.scaleHourWeekdayDay=9,this.weekWeekDayCoords=30.84375,this.weekScaleHourDay=1.2825;break;case 50:this.vacationCoords=12,this.weekdayCoords=144,this.marginTimeLeft=16,this.scaleHourVacationDay=1,this.scaleHourWeekdayDay=6,this.weekWeekDayCoords=21.0625,this.weekScaleHourDay=.855;break;case 25:this.vacationCoords=6,this.weekdayCoords=72,this.marginTimeLeft=7.125,this.scaleHourVacationDay=.5,this.scaleHourWeekdayDay=3,this.weekWeekDayCoords=10.28125,this.weekScaleHourDay=.4275}this.updateProductions()}confirmDateChanges(n=!1){this.modalService.confirm("success").pipe((0,tt.q)(1)).subscribe(e=>{e&&this.tasksService.confirmEndDates(+this.rootId,{is_unconfirmed_root_date:n}).subscribe(o=>{window.location.reload()})})}sendPlanToConfirmation(){const n=this.getLastTask;this.tasksService.sendToPlanningConfirmation({family_id:n.family_id}).subscribe(()=>{n.planning_status=z.U.WAITING_CONFIRMATION})}sendPlanToCorrections(){const n=this.getLastTask;this.tasksService.sendToPlanningCorrections({family_id:n.family_id,change_request:!0}).subscribe(()=>{n.change_request=!0})}toggleShowConfirmation(){this.isShowConfirmationMenu=!this.isShowConfirmationMenu}getDays(n){return n.filter((e,o)=>0!==o)}get dayWidth(){return(this.weekdayCoords-10)/7}onSelectDisplay(){switch(this.selectedDisplay){case"weeks":this.testWeek();break;case"days":this.togglePlanScale()}}toggleSelectedListProducts(n){this.selectedListProductsGroupUIds.has(n)?this.selectedListProductsGroupUIds.delete(n):this.selectedListProductsGroupUIds.add(n),requestAnimationFrame(()=>{this.expandCollapseHeaderService.setIsCollapseSingleDisabled(0===this.selectedListProductsGroupUIds.size)})}clearSelectedListProductsGroupUIds(){this.selectedListProductsGroupUIds.clear(),requestAnimationFrame(()=>{this.expandCollapseHeaderService.setIsCollapseSingleDisabled(0===this.selectedListProductsGroupUIds.size)})}};function lr(i,n){if(1&i&&t._UZ(0,"pek-manufacturing-chart",2),2&i){const e=t.oxw();t.Q6J("rootId",e.rootId)}}k.\u0275fac=function(n){return new(n||k)(t.Y36(W.M),t.Y36(ya.$),t.Y36(P.Z),t.Y36(t.sBO),t.Y36(I.v),t.Y36(Z.F0),t.Y36(Z.gz),t.Y36(Mt),t.Y36(nt))},k.\u0275cmp=t.Xpm({type:k,selectors:[["pek-manufacturing-chart"]],viewQuery:function(n,e){if(1&n&&t.Gf(ka,5,t.SBq),2&n){let o;t.iGM(o=t.CRH())&&(e.panelBorder=o.first)}},inputs:{isPlan:"isPlan",rootId:"rootId"},decls:43,vars:40,consts:[[1,"content"],[1,"card"],[1,"card-body"],[1,"chart-wrapper"],["class","all-selected",4,"ngIf"],[1,"tasks-container"],[1,"items-container"],[1,"d-flex"],[1,"left-panel-wrapper"],["mwlResizable","",1,"d-flex","task-header-name",3,"enableGhostResize","resizeSnapGrid","resizeEnd","resizing"],[1,"d-flex","header-items"],[1,"d-flex","align-items-center","justify-content-center","pl-0","task-toggle",2,"width","30px"],[1,"pi",3,"click"],[1,"d-flex","align-items-center",2,"width","190px"],[1,"d-flex","align-items-center"],[1,"d-flex","align-items-center","justify-content-center","pl-0",2,"width","80px"],[1,"d-flex","align-items-center","justify-content-center","pl-0",2,"width","50px"],["class","bord",4,"ngIf"],["class","info-container",4,"ngIf"],["mwlResizeHandle","",1,"resize-handle-right",3,"resizeEdges"],["cdkDragHandle","",1,"drag-handle"],["mwlResizable","",1,"production-panel-left",3,"enableGhostResize","resizeSnapGrid","resizeEnd","resizing"],[3,"production","productionNameWidth","isRoot","isLeftPanel",4,"ngFor","ngForOf"],[1,"right-panel-wrapper"],[1,"d-flex","days-header"],["class","d-flex",4,"ngIf"],["class","d-flex",3,"week-header",4,"ngIf"],["class","production-panel-right",4,"ngIf","ngIfElse"],[1,"filter","pl-5","pr-5"],[1,"plan-d",3,"ngSwitch"],["class","form-group edit-tasks d-flex align-items-center buttons",4,"ngSwitchCase"],["class","form-group d-flex align-items-start planning",4,"ngSwitchCase"],["class","form-group d-flex align-items-center add-tasks buttons",4,"ngSwitchCase"],["class","form-group d-flex align-items-center buttons",4,"ngSwitchDefault"],["loading",""],[1,"all-selected"],["for","all-selected"],["id","all-selected","type","checkbox",3,"ngModel","ngModelChange","change"],[1,"bord"],["panelBorder",""],[1,"info-container"],["class","d-flex align-items-center",4,"ngIf"],[4,"ngIf"],["pButton","","class","p-button-success ml-3 mr-3",3,"click",4,"ngIf"],["pButton","",1,"p-button-success","ml-3","mr-3",3,"click"],[3,"ngSwitch"],["class","text-success",4,"ngSwitchCase"],[4,"ngSwitchCase"],["pButton","","class","mr-3",3,"click",4,"ngSwitchCase"],[1,"text-success"],["pButton","","class","ml-3",3,"click",4,"ngIf"],["pButton","",1,"ml-3",3,"click"],["pButton","",1,"mr-3",3,"click"],[3,"production","productionNameWidth","isRoot","isLeftPanel"],["class","day-header",3,"ml-3","day-header_week","width",4,"ngFor","ngForOf"],[1,"day-header"],[1,"day-name"],["class","text-center","style","color: '#f1716d'; display: block",4,"ngIf"],[1,"d-flex","hour-container"],["class","hour-line","tooltipPosition","bottom",3,"marginLeft","ngClass","pTooltip",4,"ngFor","ngForOf"],[1,"text-center",2,"color","#f1716d","display","block"],["tooltipPosition","bottom",1,"hour-line",3,"ngClass","pTooltip"],["class","day-header",3,"ml-3","width",4,"ngFor","ngForOf"],["class","hour-line","tooltipPosition","bottom",3,"hour-line-week","marginLeft","pTooltip",4,"ngFor","ngForOf"],["tooltipPosition","bottom",1,"hour-line",3,"pTooltip"],["class","vac-bord vac-bord_left",4,"ngIf"],["class","vac-bord vac-bord_right",3,"right",4,"ngIf"],[1,"vac-bord","vac-bord_left"],[1,"vac-bord","vac-bord_right"],[1,"production-panel-right"],[3,"production",4,"ngFor","ngForOf"],[3,"production"],[1,"form-group","edit-tasks","d-flex","align-items-center","buttons"],["pButton","","type","button","icon","pi pi-times",1,"plan-close-btn","mr-2",3,"click"],[1,"unlocked-technologies","mr-3"],["optionValue","name","optionLabel","name","placeholder","Unlocked Technologies",3,"options","ngModel","onChange","ngModelChange"],[1,"mr-3"],["pButton","","type","button","label","Edit Tasks","icon","pi pi-pencil",3,"disabled","click"],[1,"form-group","d-flex","align-items-start","planning"],[1,"unlocked-technologies","mr-2"],["pButton","","type","button","label","CREATE ORDER","icon","pi pi-plus",3,"disabled","click"],[1,"form-group","d-flex","align-items-center","add-tasks","buttons"],[1,"ml-2","mr-2","task-btn","task-btn_icon","position-relative"],[1,"pi","pi-plus"],[1,"form-group","d-flex","align-items-center","buttons"],[1,"footer-text","mr-2"],["pButton","","type","button","label","Order Creation","icon","pi pi-database",1,"mr-2",3,"click"],["pButton","","type","button","label","Task Planning","icon","pi pi-sliders-h",1,"mr-2",3,"click"],["pButton","","type","button","icon","pi pi-plus","label","Add Items",1,"mr-2",3,"click"],["pButton","","type","button",3,"icon","label","click"],[1,"ml-4","mr-4","d-flex","align-items-center","chart-scale-btns"],["pButton","","type","button","icon","pi pi-search-minus",3,"disabled","click"],[1,"plan-scale"],["pButton","","type","button","icon","pi pi-search-plus",3,"disabled","click"],["class","prod-picker mr-2",4,"ngIf"],[1,"statuses-picker","mr-2"],["optionLabel","label","optionValue","value","placeholder","Statuses",3,"options","ngModel","showClear","ngModelChange"],[1,"technologies-picker","mr-2"],["optionLabel","name","optionValue","name","placeholder","Technologies",3,"options","ngModel","showClear","ngModelChange"],[1,"type-picker"],["optionLabel","name","optionValue","value","placeholder","Type",3,"options","ngModel","showClear","ngModelChange"],[1,"display-picker","ml-3"],[1,"mr-2"],["optionLabel","label","optionValue","option","placeholder","Displaying",3,"options","ngModel","ngModelChange"],[1,"prod-picker","mr-2"],["optionValue","family_id","optionLabel","label","placeholder","Production Lists",1,"plan-multi",3,"options","ngModel","onChange","ngModelChange"],[1,"loading"],[1,"pi","pi-spin","pi-spinner",2,"font-size","3rem"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t.YNc(4,wa,4,1,"div",4),t.TgZ(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"div",9),t.NdJ("resizeEnd",function(a){return e.resizePanel(a)})("resizing",function(a){return e.moveBorder(a)}),t.TgZ(10,"div",10)(11,"div",11)(12,"i",12),t.NdJ("click",function(){return e.toggle()}),t.qZA()(),t.TgZ(13,"div",13),t._uU(14,"Code"),t.qZA(),t.TgZ(15,"div",14),t._uU(16,"Name"),t.qZA(),t.TgZ(17,"div",15),t._uU(18,"Quantity "),t.qZA(),t.TgZ(19,"div",16),t._uU(20,"UOM"),t.qZA(),t.YNc(21,Aa,2,0,"div",17),t.YNc(22,Qa,3,2,"div",18),t.qZA(),t.TgZ(23,"div"),t._UZ(24,"div",19)(25,"div",20),t.qZA()(),t.TgZ(26,"div",21),t.NdJ("resizeEnd",function(a){return e.resizePanel(a)})("resizing",function(a){return e.moveBorder(a)}),t.YNc(27,La,1,4,"pek-manufacturing-list-product-production",22),t._UZ(28,"div",19)(29,"div",20),t.qZA()(),t.TgZ(30,"div",23)(31,"div",24),t.YNc(32,$a,3,3,"div",25),t.YNc(33,Xa,3,5,"div",26),t.qZA(),t.YNc(34,er,2,1,"div",27),t.qZA()()()()()(),t.TgZ(35,"div",28)(36,"div",29),t.YNc(37,nr,7,4,"div",30),t.YNc(38,ir,5,3,"div",31),t.YNc(39,or,9,0,"div",32),t.YNc(40,rr,24,17,"div",33),t.qZA()()()(),t.YNc(41,sr,4,0,"ng-template",null,34,t.W1O)),2&n){const o=t.MAs(42);t.xp6(3),t.ekj("pl-15","make-order"===e.mode),t.xp6(1),t.Q6J("ngIf",(null==e.selectedTechnologies?null:e.selectedTechnologies.length)&&"make-order"===e.mode),t.xp6(1),t.ekj("tasks-container_small",e.isPlan)("disabled-chart",e.isLoading),t.xp6(2),t.Udp("min-width",e.innerContentWidth,"px"),t.xp6(1),t.ekj("pl-33","make-order"===e.mode),t.xp6(1),t.Q6J("enableGhostResize",!1)("resizeSnapGrid",t.DdM(36,Zt)),t.xp6(3),t.ekj("pi-minus",e.isExpanded)("pi-plus",!e.isExpanded),t.xp6(3),t.Udp("width",e.productionNameWidth,"px"),t.xp6(6),t.Q6J("ngIf",e.isShowBorder),t.xp6(1),t.Q6J("ngIf",!e.isPlan&&e.isShowConfirmationMenu),t.xp6(2),t.Q6J("resizeEdges",t.DdM(37,bt)),t.xp6(2),t.Q6J("enableGhostResize",!1)("resizeSnapGrid",t.DdM(38,Zt)),t.xp6(1),t.Q6J("ngForOf",e.rootProductions),t.xp6(1),t.Q6J("resizeEdges",t.DdM(39,bt)),t.xp6(4),t.Q6J("ngIf","days"===e.selectedDisplay),t.xp6(1),t.Q6J("ngIf","weeks"===e.selectedDisplay),t.xp6(1),t.Q6J("ngIf",!e.isLoading)("ngIfElse",o),t.xp6(1),t.ekj("disabled-panel",e.isLoading),t.xp6(1),t.Q6J("ngSwitch",e.mode),t.xp6(1),t.Q6J("ngSwitchCase","edit-tasks"),t.xp6(1),t.Q6J("ngSwitchCase","make-order"),t.xp6(1),t.Q6J("ngSwitchCase","add-items")}},styles:['.border-danger[_ngcontent-%COMP%]{border:1px solid red}p-table[_ngcontent-%COMP%]{width:20%!important}.card[_ngcontent-%COMP%]{border-radius:0!important}.all-selected[_ngcontent-%COMP%]{position:absolute;left:6px;top:53px;display:flex;flex-direction:column;z-index:1004}.all-selected[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:0;cursor:pointer}.all-selected[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.border-black[_ngcontent-%COMP%]{border:1px solid black}.tasks-container[_ngcontent-%COMP%]{position:relative;overflow-y:auto;overflow-x:scroll;height:calc(100vh - 114px);border-top:1px solid #dddddd}.tasks-container_small[_ngcontent-%COMP%]{height:calc(100vh - 114px)}.items-container[_ngcontent-%COMP%]{margin-top:0}.timeline-tasks[_ngcontent-%COMP%]{position:relative;height:30px;align-items:center;margin-left:500px}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]{display:flex;justify-content:space-between;position:absolute;z-index:800;cursor:pointer}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]:hover{background:#ccc}.task-product-name[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding-left:10px;border-left:1px solid rgb(207,207,207);border-right:1px solid rgb(207,207,207);display:flex;align-items:center}.item-time[_ngcontent-%COMP%]{align-items:center}.item-time[_ngcontent-%COMP%]:hover{background:rgb(231,231,231)!important}.day-header[_ngcontent-%COMP%]{box-sizing:border-box}.day-header_week[_ngcontent-%COMP%]{box-sizing:border-box;position:relative}.day-header_week[_ngcontent-%COMP%]   .day-name[_ngcontent-%COMP%]{position:absolute;width:100%;left:0;text-align:center}.day-header_week[_ngcontent-%COMP%]:before, .day-header_week[_ngcontent-%COMP%]:after{content:"";background:#f1716d;height:calc(100vh - 132px);width:1px;position:absolute;top:0}.day-header_week[_ngcontent-%COMP%]:before{left:0}.day-header_week[_ngcontent-%COMP%]:after{right:-1px}.day-header_week[_ngcontent-%COMP%]   .hour-line[_ngcontent-%COMP%]{display:none;margin-left:0!important}.day-header[_ngcontent-%COMP%]   .hour-container[_ngcontent-%COMP%]{border-left:1px solid rgb(73,73,73);height:20px;align-items:flex-end}.day-header[_ngcontent-%COMP%]   .hour-line[_ngcontent-%COMP%]{position:relative;width:2px;height:15px;background:#dddddd}.day-header[_ngcontent-%COMP%]   .hour-line.middle[_ngcontent-%COMP%]{height:20px}.hour-line-week[_ngcontent-%COMP%]{background:transparent!important}.week-header[_ngcontent-%COMP%]   .day-name[_ngcontent-%COMP%]{font-size:.75rem}.pp-text-success[_ngcontent-%COMP%]{color:green}.pp-text-danger[_ngcontent-%COMP%]{color:red}.pp-text-warning[_ngcontent-%COMP%]{color:orange}.d-none-important[_ngcontent-%COMP%]{display:none!important}mwlResizable[_ngcontent-%COMP%]{box-sizing:border-box}.resize-handle-left[_ngcontent-%COMP%], .resize-handle-right[_ngcontent-%COMP%]{position:absolute;height:100%;cursor:col-resize;width:10px}.card[_ngcontent-%COMP%]{display:flex;flex-direction:column}.footer-text[_ngcontent-%COMP%]{font-weight:500}.filter[_ngcontent-%COMP%]{flex:0;z-index:1003;background:#fff;padding:0 1.75rem;transition:0s!important}.filter[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:0}.btn-edit[_ngcontent-%COMP%]{width:180px;font-size:15px;margin:0 10px}.statuses-pick[_ngcontent-%COMP%]{font-size:14px;margin-top:-33px}.statuses-pick[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{top:25px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-transform:uppercase}.day-name[_ngcontent-%COMP%]{min-height:20px;color:#ababab;font-weight:500;font-size:.875rem;display:flex;justify-content:center}.day-name_small[_ngcontent-%COMP%]{font-size:11px}.plan-d[_ngcontent-%COMP%]{display:flex}.planning[_ngcontent-%COMP%]{display:flex;flex-direction:row}.plan-close-btn[_ngcontent-%COMP%]{background:transparent;color:var(--theme-color-primary);padding:.625rem 1.125rem;width:2.5rem!important;border:none!important;position:relative;margin-left:-1rem}.plan-close-btn[_ngcontent-%COMP%]:hover{background:transparent;color:var(--theme-color-primary)}.plan-close-btn[_ngcontent-%COMP%]:focus, .plan-close-btn[_ngcontent-%COMP%]:active{box-shadow:none!important}.plan-close-btn[_ngcontent-%COMP%]  .p-button-icon{font-weight:700;position:relative;top:1px}.unlocked-technologies[_ngcontent-%COMP%]{width:15rem}.production-panel-left[_ngcontent-%COMP%]{position:sticky;left:0;border-right:1px solid rgba(0,0,0,.3);margin-right:-1px;z-index:1000}.production-panel-right[_ngcontent-%COMP%]{position:relative;z-index:2}.resize-handle-left[_ngcontent-%COMP%], .resize-handle-right[_ngcontent-%COMP%]{position:absolute;height:100%;cursor:col-resize;width:10px;z-index:1001}.resize-handle-left[_ngcontent-%COMP%]{left:0}.resize-handle-right[_ngcontent-%COMP%]{right:0}.left-panel-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:sticky;left:0;z-index:1002;background:#fff}.left-panel-wrapper[_ngcontent-%COMP%]   .task-header-name[_ngcontent-%COMP%]{height:40px;position:sticky;left:0;top:0;z-index:1001;background:#fff;border-bottom:1px solid #dddddd}.left-panel-wrapper[_ngcontent-%COMP%]   .task-header-name[_ngcontent-%COMP%]:before{content:"";position:absolute;right:-1px;top:0;height:40px;width:1px;background:rgba(0,0,0,.3)}.header-items[_ngcontent-%COMP%]{color:#ababab;font-weight:500;font-size:.875rem;text-transform:uppercase}.right-panel-wrapper[_ngcontent-%COMP%]{width:100%}.right-panel-wrapper[_ngcontent-%COMP%]   .days-header[_ngcontent-%COMP%]{height:40px;position:sticky;top:0;z-index:1000;background:#fff;border-bottom:1px solid #dddddd}.task-toggle[_ngcontent-%COMP%]{cursor:pointer;color:var(--text-color)}.task-toggle[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{width:30px;height:40px;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:700;position:relative;top:1px}.bord[_ngcontent-%COMP%]{position:absolute;right:0;height:calc(100vh - 114px);width:3px;border:none!important;padding:0!important;border-left:2px dashed #000!important}.add-items[_ngcontent-%COMP%]{margin-top:20px}.task-btn_icon[_ngcontent-%COMP%]{top:0!important;cursor:default;width:21px;height:21px;display:flex;align-items:center;justify-content:center;border:1px solid var(--text-color);background:#fff}.task-btn_icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--text-color);font-weight:700;font-size:.875rem}.technologies-filter[_ngcontent-%COMP%]{font-size:14px}.edit-tasks[_ngcontent-%COMP%]{flex-direction:row}.edit-tasks[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:500}.add-tasks[_ngcontent-%COMP%]{flex-direction:row;font-weight:500}.prod-picker[_ngcontent-%COMP%]{display:flex;align-items:center;width:15rem}.prod-picker[_ngcontent-%COMP%]   p-multiselect[_ngcontent-%COMP%]{width:100%}.chart-scale-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:.625rem 1.125rem;width:2.5rem!important}.chart-scale-btns[_ngcontent-%COMP%]   .plan-scale[_ngcontent-%COMP%]{font-weight:500;width:3.5rem;display:flex;align-items:center;justify-content:center}.info-container[_ngcontent-%COMP%]{position:absolute;background:#fff;top:40px;left:0;right:0;align-items:center;display:flex;padding:.75rem 1rem;font-weight:500;border-bottom:1px solid #dddddd}.info-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-weight:500}.loading[_ngcontent-%COMP%]{position:absolute;left:0;right:0;bottom:0;top:0;display:flex;align-items:center;justify-content:center;flex-direction:column}.loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:500;margin-top:1.25rem;font-size:1.25rem}.disabled-panel[_ngcontent-%COMP%]{opacity:.7;pointer-events:none}.disabled-chart[_ngcontent-%COMP%]{pointer-events:none}.type-picker[_ngcontent-%COMP%], .technologies-picker[_ngcontent-%COMP%], .statuses-picker[_ngcontent-%COMP%]{width:15rem}.vacation-day-sat[_ngcontent-%COMP%], .vacation-day-sun[_ngcontent-%COMP%]{position:relative;width:0!important}.vacation-day-sat[_ngcontent-%COMP%]:before{content:"";background:#f1716d;height:calc(100vh - 137px);width:1px;position:absolute;top:-5px;left:-2px}.vacation-day-sun[_ngcontent-%COMP%]:after, .vacation-day-sun[_ngcontent-%COMP%]:before{content:"";background:#f1716d;height:calc(100vh - 137px);width:1px;position:absolute;top:-5px}.vacation-day-sun[_ngcontent-%COMP%]:before{left:0}.vacation-day-sun[_ngcontent-%COMP%]:after{right:-42px}.display-picker[_ngcontent-%COMP%]{display:flex;align-items:center}.display-picker[_ngcontent-%COMP%]   p-dropdown[_ngcontent-%COMP%]{width:8rem}.vac-bord[_ngcontent-%COMP%]{background:#f1716d;height:calc(100vh - 137px);width:1px;position:absolute;top:-5px}.vac-bord_left[_ngcontent-%COMP%]{left:-2px}']}),k=(0,A.gn)([(0,C.c)()],k);const dr=[{path:"",component:kt,children:[{path:"",redirectTo:"plans",pathMatch:"full"},{path:"plans",children:[{path:"",title:"Plans",component:N},{path:"plan/:rootId",title:"Plan",component:(()=>{class i{constructor(e){this.route=e}ngOnInit(){this.route.paramMap.pipe((0,M.U)(e=>e.get("rootId")),(0,p.b)(e=>this.rootId=e)).subscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Z.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-plan"]],decls:2,vars:1,consts:[[1,"manufacturing-plan"],[3,"rootId",4,"ngIf"],[3,"rootId"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.YNc(1,lr,1,1,"pek-manufacturing-chart",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",o.rootId))},dependencies:[_.O5,k],styles:[".manufacturing-plan[_ngcontent-%COMP%]{background:#fff}"]}),i})()},{path:"all",title:"All Plans",component:(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-all-plans"]],decls:2,vars:1,consts:[[1,"manufacturing-all-plans"],[3,"isPlan"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"pek-manufacturing-chart",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("isPlan",!0))},dependencies:[k],styles:[".manufacturing-all-plans[_ngcontent-%COMP%]{background:#fff}"]}),i})()}]},{path:"orders",children:[{path:"",title:"Execution Orders",component:L},{path:"order/:id",title:"Order",component:F}]},{path:"slice-tasks",title:"Slice Tasks",component:J},{path:"employees",title:"Employees",component:D},{path:"positions",title:"Positions",component:E},{path:"machines",title:"Machines",component:Q},{path:"order-statuses",title:"Order Statuses",component:cn},{path:"production-calendar",title:"Production Calendar",component:(()=>{class i{constructor(e,o){this.calendar=e,this.adapterService=o,this.defaultDate=new Date,this.isSaving=!1}ngOnInit(){console.log(new Date),this.defaultDate=new Date,this.getDates()}getDates(){this.calendar.getDates().subscribe(e=>{e=e.sort((o,a)=>new Date(o.date).getTime()-new Date(a.date).getTime()),this.weekendDates=e.length>0?e.map(o=>{const a=new Date(o.date).setHours(0,0,0,0);return new Date(a)}):null,this.holidays=e.map(o=>(o.date=new Date(new Date(o.date).setHours(0,0,0,0)),o))})}save(){this.isSaving=!0;let e=[];const o=[];this.weekendDates&&this.weekendDates.forEach(a=>{this.holidays.find(s=>s.date.getTime()===a.getTime())||e.push(a)}),this.holidays.forEach(this.weekendDates?a=>{this.weekendDates.find(s=>s.getTime()===a.date.getTime())||o.push(a)}:a=>o.push(a)),e.length>0&&(e=e.map(a=>({date:this.adapterService.dateAdapter(a)})),this.calendar.saveDates(e).pipe((0,H.x)(()=>this.isSaving=!1)).subscribe(a=>{a.forEach(s=>{this.holidays.push({id:s.id,date:new Date(new Date(s.date).setHours(0,0,0,0))})})})),o.length>0&&this.calendar.deleteDates(o).pipe((0,H.x)(()=>this.isSaving=!1)).subscribe(()=>{o.forEach(a=>{const s=this.holidays.findIndex(r=>r.id===a.id);this.holidays.splice(s,1)})}),!o.length&&!e.length&&(this.isSaving=!1)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(Mt),t.Y36(I.v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-production-calendar"]],decls:12,vars:9,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-check","label","Save Calendar",1,"mr-2","p-button-icon",3,"loading","click"],[1,"page__content"],[1,"page__card"],[1,"production-calendar"],["selectionMode","multiple",3,"inline","numberOfMonths","showOtherMonths","ngModel","defaultDate","firstDayOfWeek","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"pek-module-icon",3),t.TgZ(4,"h1"),t._uU(5,"Production Calendar"),t.qZA()(),t.TgZ(6,"div",4)(7,"button",5),t.NdJ("click",function(){return o.save()}),t.qZA()()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-calendar",9),t.NdJ("ngModelChange",function(s){return o.weekendDates=s}),t.qZA()()()()),2&e&&(t.xp6(3),t.Q6J("module","manufacturing")("isActive",!0),t.xp6(4),t.Q6J("loading",o.isSaving),t.xp6(4),t.Q6J("inline",!0)("numberOfMonths",12)("showOtherMonths",!1)("ngModel",o.weekendDates)("defaultDate",o.defaultDate)("firstDayOfWeek",1))},dependencies:[f.Hq,u.JJ,u.On,w.D,rt.f],styles:[".production-calendar{padding-top:1rem}.production-calendar .p-datepicker.p-datepicker-multiple-month .p-datepicker-group:nth-child(4),.production-calendar .p-datepicker.p-datepicker-multiple-month .p-datepicker-group:nth-child(7),.production-calendar .p-datepicker.p-datepicker-multiple-month .p-datepicker-group:nth-child(10){border-left:none}.production-calendar .p-datepicker-group-container{display:grid!important;grid-template-columns:repeat(3,1fr)}.production-calendar .p-datepicker-group-container .p-datepicker-group:nth-child(3n){padding-right:0!important;border-right:none!important}.production-calendar .p-datepicker{max-width:inherit!important;width:100%}.production-calendar .p-datepicker tr:first-child .p-ripple{margin-top:5px}.production-calendar .p-datepicker tr td span{display:flex;align-items:center;justify-content:center;margin-bottom:5px}.production-calendar .p-datepicker tr td:nth-child(6) span{background:#ccc;font-weight:500}.production-calendar .p-datepicker tr td:nth-child(6) span.p-highlight{background:#55b157}.production-calendar .p-datepicker tr td:last-child span{background:#ccc;font-weight:500}.production-calendar .p-datepicker tr td:last-child span.p-highlight{background:#97c185}.production-calendar .p-datepicker .p-ripple{border-radius:0}.production-calendar .p-datepicker table td>span.p-highlight{color:#fff!important;font-weight:500;background-color:var(--theme-color-danger)}.production-calendar .p-datepicker .p-datepicker-today span{background:var(--theme-color-primary);color:#fff;font-weight:500}.production-calendar .p-datepicker .p-datepicker-today span:hover{color:#000}.production-calendar .p-datepicker-group-container{width:100%}\n"],encapsulation:2}),i})()}]}];let ur=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[Z.Bz.forChild(dr),Z.Bz]}),i})();var pr=l(7175),_r=l(6984),gr=l(8260),hr=l(630),G=l(8747),j=l(1206),Pt=l(3608);function mr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"input",20),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw(2);return t.KtG(s.production.isSelected=a)})("change",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.chart.changeAllProductsOnSelected())}),t.qZA()}if(2&i){const e=t.oxw(2);t.Q6J("ngModel",e.production.isSelected)}}function fr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.chart.addTasks(a.production))}),t.qZA()}}function xr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"i",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.chart.toggleProduction(a.production).subscribe())}),t.qZA()}if(2&i){const e=t.oxw(2);t.ekj("pi-minus",e.production.isExpanded)("pi-plus",!e.production.isExpanded)}}function Tr(i,n){if(1&i&&(t.TgZ(0,"b"),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hij(" (R-",e.production.reservedFromOtherTaskQuantity,")\xa0 ")}}function Cr(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(S)"),t.qZA())}function vr(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(T)"),t.qZA())}function Mr(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(RR)"),t.qZA())}function Zr(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(Reordered)"),t.qZA())}function br(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(RR)"),t.qZA())}function Pr(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(Reordered)"),t.qZA())}const yr=function(i,n){return{width:i,paddingLeft:n}};function kr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",4),t.YNc(1,mr,1,1,"input",5),t.YNc(2,fr,1,0,"button",6),t.TgZ(3,"div",7),t.YNc(4,xr,1,4,"i",8),t.qZA(),t.TgZ(5,"div",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleActiveProduction(a.production))}),t.TgZ(6,"div",10)(7,"span",11),t._uU(8),t.qZA(),t.TgZ(9,"span",12)(10,"span",13),t._uU(11),t.qZA()()(),t.TgZ(12,"div",14)(13,"span",15),t.YNc(14,Tr,2,1,"b",16),t.YNc(15,Cr,2,0,"b",16),t.YNc(16,vr,2,0,"b",16),t.YNc(17,Mr,2,0,"b",16),t.YNc(18,Zr,2,0,"b",16),t._uU(19),t.qZA(),t.TgZ(20,"span",17)(21,"span",13),t.YNc(22,br,2,0,"b",16),t.YNc(23,Pr,2,0,"b",16),t._uU(24),t.qZA()()(),t.TgZ(25,"div",18),t._uU(26),t.qZA(),t.TgZ(27,"div",19),t._uU(28),t.qZA()()()}if(2&i){const e=t.oxw();t.ekj("task-parent",null==e.production?null:e.production.hasChildren),t.xp6(1),t.Q6J("ngIf",(null==e.chart.selectedTechnologies?null:e.chart.selectedTechnologies.length)&&e.production.isFiltered&&"make-order"===e.chart.mode),t.xp6(1),t.Q6J("ngIf",(null==e.production?null:e.production.hasChildren)&&"add-items"===e.chart.mode),t.xp6(1),t.ekj("toggle-disable","add-items"===e.chart.mode),t.xp6(1),t.Q6J("ngIf",(null==e.production?null:e.production.hasChildren)&&!(null!=e.production&&e.production.isBlocked)),t.xp6(2),t.Q6J("ngStyle",t.WLB(25,yr,null!=e.production&&e.production.hasChildren?190-15*(null==e.production?null:e.production.product.level)+"px":"190px",!e.isLeftPanel||null!=e.production&&e.production.hasChildren?0:15*((null==e.production?null:e.production.product.level)-1)+"px")),t.xp6(2),t.Oqu(null==e.production?null:e.production.product.nomenclature.code),t.xp6(3),t.Oqu(null==e.production?null:e.production.product.nomenclature.code),t.xp6(2),t.Udp("width",e.productionNameWidth,"px"),t.xp6(1),t.Q6J("ngIf","1"===(null==e.production?null:e.production.product.nomenclature.bulk_or_serial)&&e.production.reservedFromOtherTaskQuantity>0),t.xp6(1),t.Q6J("ngIf","1"===(null==e.production?null:e.production.product.nomenclature.bulk_or_serial)),t.xp6(1),t.Q6J("ngIf",null==e.production?null:e.production.product.nomenclature.has_technical_equipment),t.xp6(1),t.Q6J("ngIf",e.production.task.refunded_orders.length>0&&!e.production.task.is_refunded),t.xp6(1),t.Q6J("ngIf",e.production.task.is_in_rma_process),t.xp6(1),t.hij(" ",null==e.production?null:e.production.product.nomenclature.name," "),t.xp6(1),t.Udp("width",e.productionNameWidth,"px"),t.xp6(2),t.Q6J("ngIf",e.production.task.refunded_orders.length>0&&!e.production.task.is_refunded),t.xp6(1),t.Q6J("ngIf",e.production.task.is_in_rma_process),t.xp6(1),t.hij(" ",null==e.production?null:e.production.product.nomenclature.name," "),t.xp6(2),t.hij(" ",(null==e.production?null:e.production.product.task_required_quantity)*(null==e.production?null:e.production.tasks[0].tasks.length)," "),t.xp6(2),t.hij(" ",null!=e.production&&null!=e.production.product.nomenclature.category&&null!=e.production.product.nomenclature.category.unit_of_measure&&e.production.product.nomenclature.category.unit_of_measure.symbol?null==e.production||null==e.production.product.nomenclature.category||null==e.production.product.nomenclature.category.unit_of_measure?null:e.production.product.nomenclature.category.unit_of_measure.symbol:"Pcs"," ")}}function wr(i,n){if(1&i&&(t.O4$(),t.TgZ(0,"svg",36)(1,"defs")(2,"pattern",37),t._UZ(3,"circle",38),t.qZA()(),t._UZ(4,"rect",39),t.qZA()),2&i){const e=t.oxw(2).$implicit;t.Udp("width",e.width),t.xp6(4),t.Udp("width",e.width)}}function Ar(i,n){if(1&i&&t._UZ(0,"div",40),2&i){const e=n.$implicit,o=t.oxw(4);t.Udp("width","days"===o.chart.selectedDisplay?o.chart.vacationCoords+"px":o.chart.weekWeekDayCoords+"px")("left",e.x,"px"),t.ekj("day_is-vac",e.isVac)}}function Or(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(RR)"),t.qZA())}function qr(i,n){1&i&&(t.TgZ(0,"b"),t._uU(1,"(Reordered)"),t.qZA())}const st=function(i,n){return{left:i,width:n}},Ir=function(i,n){return{left:i,right:n}},Sr=function(){return{right:!0}},Ur=function(){return{left:!0}};function Nr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",28),t.NdJ("mouseenter",function(){t.CHM(e);const a=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.mouseEntered(a))})("mouseleave",function(){t.CHM(e);const a=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.mouseLeave(a))})("cdkDragStarted",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.dragging=!0)})("cdkDragEnded",function(a){t.CHM(e);const s=t.oxw().$implicit,r=t.oxw(2);return t.KtG(r.move(s,a))})("resizeEnd",function(a){t.CHM(e);const s=t.oxw().$implicit,r=t.oxw(2);return t.KtG(r.resize(s,a))})("click",function(a){t.CHM(e);const s=t.oxw().$implicit,r=t.oxw(2);return t.KtG(r.onTaskClick(s,r.production,a))}),t.YNc(1,wr,5,4,"svg",29),t.TgZ(2,"div",30),t.YNc(3,Ar,1,6,"div",31),t.qZA(),t.TgZ(4,"div",32),t.YNc(5,Or,2,0,"b",16),t.YNc(6,qr,2,0,"b",16),t._uU(7),t.qZA(),t._UZ(8,"div",33)(9,"div",34)(10,"div",35),t.qZA()}if(2&i){const e=t.oxw().$implicit,o=t.oxw(2);let a;t.ekj("selected",o.chart.selectedTasks.has(e))("deselected","edit-tasks"===o.chart.mode&&!o.chart.selectedTasks.has(e))("disabled",o.chart.selectedTechnologies.length&&!o.chart.selectedTechnologies.includes(e.technology))("disabled_status","make-order"!==o.chart.mode&&o.chart.selectedStatuses.length&&!o.chart.selectedStatuses.includes(e.status)||o.chart.selectedFilterTechnologies.length&&!o.chart.selectedFilterTechnologies.includes(e.technology)||o.chart.selectedProductionTypes.length&&!o.chart.selectedProductionTypes.includes(e.production_type))("is-saved",e.isSaved)("small",e.width<=24&&"days"===o.chart.selectedDisplay)("not-planned",!e.is_planned)("planned",e.is_planned)("deficit_not-planned","Deficit"===e.status&&!e.is_planned)("deficit_planned","Deficit"===e.status&&e.is_planned)("ordered-own","Ordered"===e.status&&"1"===e.production_type)("ordered-own-p","Ordered"===e.status&&"0"===e.list_product.nomenclature.type)("ordered-outsource","Ordered"===e.status&&"0"===e.production_type)("on-stock","On stock"===e.status)("task-reserved","Reserved"===e.status)("rework","Rework"===e.status)("small-font","weeks"===o.chart.selectedDisplay),t.Q6J("ngStyle",t.WLB(55,st,e.left+"px",e.width+"px"))("id",o.production.product.id)("cdkDragDisabled",o.getIfDisabled(e))("enableGhostResize",!0)("resizeSnapGrid",t.WLB(58,Ir,o.chart.scaleHourWeekdayDay,o.chart.scaleHourWeekdayDay))("validateResize",o.validateResize)("pTooltip",(e.refunded_orders.length>0&&!e.is_refunded?"(RR) ":"")+(e.is_in_rma_process?"(Reordered) ":"")+(null!==(a=e.technology)&&void 0!==a?a:"Purchased")),t.xp6(1),t.Q6J("ngIf","Rework"===e.status),t.xp6(2),t.Q6J("ngForOf",e.days),t.xp6(1),t.ekj("tech-name_small",25===o.chart.planScale),t.xp6(1),t.Q6J("ngIf",e.refunded_orders.length>0&&!e.is_refunded),t.xp6(1),t.Q6J("ngIf",e.is_in_rma_process),t.xp6(1),t.hij(" ",e.technology?e.technology:o.type(e.list_product.nomenclature.type)," "),t.xp6(1),t.ekj("resize-handle-right_medium",e.width<=24),t.Q6J("resizeEdges",t.DdM(61,Sr)),t.xp6(1),t.ekj("resize-handle-left_medium",e.width<=24),t.Q6J("resizeEdges",t.DdM(62,Ur)),t.xp6(1),t.Q6J("cdkDragHandleDisabled",o.getIfDisabled(e))}}function Jr(i,n){if(1&i&&(t.TgZ(0,"div",41),t._uU(1," \xa0 "),t.qZA()),2&i){const e=t.oxw().$implicit;t.Q6J("ngStyle",t.WLB(1,st,e.left+"px",e.unconfirmedBiggerWidth+"px"))}}function Dr(i,n){if(1&i&&(t.TgZ(0,"div",42),t._uU(1," \xa0 "),t.qZA()),2&i){const e=t.oxw().$implicit;t.Q6J("ngStyle",t.WLB(1,st,e.unconfirmedLeft+"px",e.unconfirmedSmallerWidth+"px"))}}function Er(i,n){if(1&i&&(t.ynx(0),t.YNc(1,Nr,11,63,"div",25),t.YNc(2,Jr,2,4,"div",26),t.YNc(3,Dr,2,4,"div",27),t.BQk()),2&i){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.start_date),t.xp6(1),t.Q6J("ngIf",e.unconfirmedBiggerWidth),t.xp6(1),t.Q6J("ngIf",e.unconfirmedSmallerWidth)}}function Qr(i,n){if(1&i&&(t.TgZ(0,"div",23),t.YNc(1,Er,4,3,"ng-container",24),t.qZA()),2&i){const e=t.oxw();t.Udp("width",null==e.chart?null:e.chart.getX(null==e.production?null:e.production.getEnd()),"px"),t.xp6(1),t.Q6J("ngForOf",null==e.production?null:e.production.tasks)}}function Lr(i,n){if(1&i&&t._UZ(0,"pek-manufacturing-list-product-production",47),2&i){const e=n.$implicit,o=t.oxw(3);t.Q6J("rootTask",o.rootTask)("isLeftPanel",o.isLeftPanel)("productionNameWidth",o.productionNameWidth)("production",e)}}function Yr(i,n){if(1&i&&(t.TgZ(0,"div",45),t.YNc(1,Lr,1,4,"pek-manufacturing-list-product-production",46),t.qZA()),2&i){const e=n.$implicit,o=t.oxw(2);t.Udp("background",o.production.color),t.xp6(1),t.Q6J("ngForOf",e)}}function Fr(i,n){if(1&i&&(t.TgZ(0,"div",43),t.YNc(1,Yr,2,3,"div",44),t.qZA()),2&i){const e=t.oxw();t.ekj("highlighted-end",e.childrenEndHighlighted)("test",!e.isLeftPanel),t.xp6(1),t.Q6J("ngForOf",e.production.groups)}}let Rr=(()=>{class i{constructor(e,o,a,s,r,c){this.modalService=e,this.tasksService=o,this.adapterService=a,this.elementRef=s,this.chart=r,this.expandCollapseHeaderService=c,this.productionNameWidth=150,this.childrenEndHighlighted=!1,this.dragging=!1,this.validateResize=d=>(console.log("EVENT RESIZE VALIDATE",d),console.log("EVENT RESIZE VALIDATE this.taskHovered",this.taskHovered),!this.getIfDisabled(this.taskHovered))}ngOnInit(){this.production.product.nomenclature.bulk_or_serial===y.nH.SERIAL&&(this.production.reservedFromOtherTaskQuantity=0,this.production.tasks.forEach(e=>{e.tasks.forEach(o=>{o.serial_numbers?.forEach(a=>{a.reserved_for_root_production_list_info&&this.production.reservedFromOtherTaskQuantity++})})}),console.log("this.production.reservedFromOtherTaskQuantity",this.production.reservedFromOtherTaskQuantity)),"1"===this.production.product.nomenclature.type&&(this.elementRef.nativeElement.style.background=this.production.color,this.elementRef.nativeElement.style.zIndex=String(99999-this.production.index)),this.taskDeleteSub=this.tasksService.delete$.subscribe(()=>{this.production.updateGroups()}),this.expandCollapseHeaderService.expandCollapseSingle.subscribe(e=>{this.production.hasChildren&&this.production.isActive&&this.chart.expandCollapseSelected([this.production],e)})}edit(e){const o=this.getRootTaskInfo(this.production);this.tasksService.editTaskDialog(e,this.production.tasks,o).pipe((0,x.h)(a=>a)).subscribe(a=>{"reload"!==a?a&&this.applyPosition(e,a):location.reload()})}resize(e,o){if(e.list_product.nomenclature.type===y.BN.PURCHASED||this.getIfDisabled(e))return;const a={start:e.start_date,end:e.end_date};if(o.edges.left){let s=this.chart.getX(e.start_date);s+=o.edges.left,s<0&&(s=0),a.start=this.chart.getDate(s)}else if(o.edges.right){const s=this.chart.getX(e.end_date);a.end=this.chart.getDate(s+o.edges.right)}e.is_planned=!0,this.applyPosition(e,a)}getDuration(e){return(e.end_date.getTime()-e.start_date.getTime())/1e3/60/60}move(e,o){if(e.duration=this.getDuration(e),e.is_planned=!0,o.source.reset(),e.list_product.nomenclature.type===y.BN.PURCHASED)return;const s=this.chart.getX(e.start_date)+o.distance.x,r=this.chart.getDate(s<0?0:s),c=new Date(r.getTime()+60*e.duration*60*1e3);this.applyPosition(e,{start:r,end:c})}onTaskClick(e,o,a){switch(this.chart.mode){case"edit-tasks":const s=this.chart.selectedTasks;e.production=o,s.has(e)?s.delete(e):s.add(e);break;case"planning":case"make-order":this.dragging||(e.production=o,this.edit(e)),this.dragging=!1}}validateTest(){return!0}type(e){switch(e){case y.BN.PURCHASED:return"Purchased";case y.BN.ASSEMBLY:return"Assembly";case y.BN.MANUFACTURED:return"Manufactured"}}toggleActiveProduction(e){e.hasChildren&&(e.isActive=!e.isActive,this.chart.toggleSelectedListProducts(e.product.group_uid))}highlightChildrenEnd(){this.childrenEndHighlighted=!0,setTimeout(()=>this.childrenEndHighlighted=!1,2500)}applyPosition(e,o){const a=this.production.tasks.filter(r=>r.start_date.getTime()<e.start_date.getTime());if(a.length)a.forEach(r=>{r.end_date.getTime()>o.start.getTime()&&(o.start.setTime(r.end_date.getTime()),o.end.getTime()<e.end_date.getTime()&&o.end.setTime(o.start.getTime()+60*e.duration*6e4))});else{const r=this.production.getChildrenEnd();r.getTime()>o.start.getTime()&&(this.highlightChildrenEnd(),o.start.setTime(r.getTime()),o.end.getTime()<e.end_date.getTime()&&o.end.setTime(o.start.getTime()+60*e.duration*6e4))}this.production.tasks.filter(r=>r.start_date.getTime()>e.start_date.getTime()).reduce((r,c)=>(c.start_date.getTime()<r.getTime()&&(c.duration=(c.end_date.getTime()-c.start_date.getTime())/60/1e3,c.start_date.setTime(r.getTime()),c.end_date.setTime(c.start_date.getTime()+6e4*c.duration),this.chart.updateTaskDates(c)),c.end_date),o.end),e.start_date=o.start,e.end_date=o.end,e.duration=e.duration=this.getDuration(e),e.apply(),this.chart.updateTimeline(),this.chart.updateMargins(this.production),this.chart.updateParentMargins(this.production.parent),this.chart.update(),this.chart.updateTaskDates(e)}mouseoverFromTask(e){e.isHover=!0}getTaskWidth(e){return e*this.chart.vacationCoords/24}getTaskLeft(e){return e*this.chart.scaleHourWeekdayDay/12}mouseoutFromTask(e){e.isHover=!1}ngOnDestroy(){this.taskDeleteSub.unsubscribe()}getIfDisabled(e){const o=this.getRootTaskInfo(this.production),a=o.planning_status===z.U.WAITING_CONFIRMATION;return o.list_product.id!==e.list_product.id||a?a:o.planning_status===z.U.PLANNED}getRootTaskInfo(e){return e.parent?this.getRootTaskInfo(e.parent):e.tasks?.find(o=>!o.next_task&&!o.parent_task)}mouseEntered(e){this.taskHovered=e}mouseLeave(e){this.taskHovered=e}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.Z),t.Y36(W.M),t.Y36(I.v),t.Y36(t.SBq),t.Y36(k),t.Y36(nt))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-list-product-production"]],inputs:{production:"production",isLeftPanel:"isLeftPanel",productionNameWidth:"productionNameWidth",isRoot:"isRoot",rootTask:"rootTask"},features:[t._Bn([{provide:j.ni,useValue:{dragStartThreshold:12}}])],decls:4,vars:21,consts:[[1,"task",3,"mouseover","mouseout"],["class","d-flex task-content align-items-center",3,"task-parent",4,"ngIf"],["class","d-flex timeline-tasks ml-3",3,"width",4,"ngIf"],["class","children",3,"highlighted-end","test",4,"ngIf"],[1,"d-flex","task-content","align-items-center"],["type","checkbox","class","task-checkbox",3,"ngModel","ngModelChange","change",4,"ngIf"],["class","task-btn",3,"click",4,"ngIf"],[2,"width","30px"],["class","pi",3,"pi-minus","pi-plus","click",4,"ngIf"],[1,"d-flex",3,"click"],[1,"task-item","task-item-code",3,"ngStyle"],[1,"production-code"],[1,"production-code","production-code_hide"],[1,"text"],[1,"task-item","task-item-name"],[1,"production-name"],[4,"ngIf"],[1,"production-name","production-name_hide"],[1,"task-item","justify-content-center",2,"width","80px"],[1,"task-item","justify-content-center",2,"width","50px"],["type","checkbox",1,"task-checkbox",3,"ngModel","ngModelChange","change"],[1,"task-btn",3,"click"],[1,"pi",3,"click"],[1,"d-flex","timeline-tasks","ml-3"],[4,"ngFor","ngForOf"],["class","task-time","cdkDrag","","cdkDragLockAxis","x","mwlResizable","",3,"selected","deselected","disabled","disabled_status","is-saved","small","not-planned","planned","deficit_not-planned","deficit_planned","ordered-own","ordered-own-p","ordered-outsource","on-stock","task-reserved","rework","ngStyle","id","small-font","cdkDragDisabled","enableGhostResize","resizeSnapGrid","validateResize","pTooltip","mouseenter","mouseleave","cdkDragStarted","cdkDragEnded","resizeEnd","click",4,"ngIf"],["class","task-time new-date",3,"ngStyle",4,"ngIf"],["class","task-time new-date-smaller",3,"ngStyle",4,"ngIf"],["cdkDrag","","cdkDragLockAxis","x","mwlResizable","",1,"task-time",3,"ngStyle","id","cdkDragDisabled","enableGhostResize","resizeSnapGrid","validateResize","pTooltip","mouseenter","mouseleave","cdkDragStarted","cdkDragEnded","resizeEnd","click"],["height","22",3,"width",4,"ngIf"],[1,"days"],["class","day",3,"width","day_is-vac","left",4,"ngFor","ngForOf"],[1,"tech-name"],["mwlResizeHandle","",1,"resize-handle-right",3,"resizeEdges"],["mwlResizeHandle","",1,"resize-handle-left",3,"resizeEdges"],["cdkDragHandle","",1,"drag-handle",3,"cdkDragHandleDisabled"],["height","22"],["id","transformedPattern","x","0","y","0","width","1","height","20","patternUnits","userSpaceOnUse","patternTransform","rotate(45)"],["cx","1","cy","1","r","2",2,"stroke","none","fill","#000000"],["x","0","y","0","height","22",2,"stroke","#000000","fill","url(#transformedPattern)"],[1,"day"],[1,"task-time","new-date",3,"ngStyle"],[1,"task-time","new-date-smaller",3,"ngStyle"],[1,"children"],["class","child-group",3,"background",4,"ngFor","ngForOf"],[1,"child-group"],[3,"rootTask","isLeftPanel","productionNameWidth","production",4,"ngFor","ngForOf"],[3,"rootTask","isLeftPanel","productionNameWidth","production"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.NdJ("mouseover",function(){return o.mouseoverFromTask(o.production)})("mouseout",function(){return o.mouseoutFromTask(o.production)}),t.YNc(1,kr,29,28,"div",1),t.YNc(2,Qr,2,3,"div",2),t.qZA(),t.YNc(3,Fr,2,5,"div",3)),2&e&&(t.Udp("margin-left",o.isLeftPanel?-15*(null==o.production?null:o.production.product.level):0,"px"),t.ekj("m-0",null==o.production||null==o.production.children?null:o.production.children.length)("root",o.isRoot)("selected",null==o.production?null:o.production.isSelected)("filtered",null==o.production?null:o.production.isFiltered)("visible",null==o.production?null:o.production.isVisible)("parent",o.production.hasChildren)("task_hover",o.production.isHover)("task_active",o.production.isActive),t.xp6(1),t.Q6J("ngIf",o.isLeftPanel),t.xp6(1),t.Q6J("ngIf",!o.isLeftPanel),t.xp6(1),t.Q6J("ngIf",null==o.production?null:o.production.isExpanded))},dependencies:[u.Wl,u.JJ,Pt.u,u.On,_.sg,_.O5,_.PC,G.E$,G.mC,j.Zt,j.Bh,i],styles:['[_nghost-%COMP%]{display:block;float:left;clear:left}.disabled_status[_ngcontent-%COMP%]{opacity:.5;pointer-events:none}.disabled_status[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]{cursor:default!important}.small-font[_ngcontent-%COMP%]{font-size:.8125rem}.children[_ngcontent-%COMP%]{float:left;padding-left:15px}.children.highlighted-end[_ngcontent-%COMP%]{border-right:#ff253a dashed 1px}.child-group[_ngcontent-%COMP%]{float:left;clear:left;position:relative;display:flex;flex-direction:column;align-items:flex-start}.task[_ngcontent-%COMP%]{display:flex;clear:left;align-items:center;transition:0s!important;font-size:.9375rem;font-weight:500;color:var(--text-color)}.task[_ngcontent-%COMP%]   .task-checkbox[_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;left:0;position:absolute;z-index:2}.task.visible[_ngcontent-%COMP%]{height:auto}.task[_ngcontent-%COMP%]:not(.visible){display:none}.task.parent[_ngcontent-%COMP%]{cursor:pointer}.task_hover[_ngcontent-%COMP%]{background:#fff}.task_active[_ngcontent-%COMP%]{background:sandybrown;font-weight:500;transition:none!important}.task_active[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{background:sandybrown!important;transition:none!important}.task-content[_ngcontent-%COMP%]{z-index:10;min-height:30px;position:relative}.task-item[_ngcontent-%COMP%]   .production-name[_ngcontent-%COMP%], .task-item[_ngcontent-%COMP%]   .production-code[_ngcontent-%COMP%]{display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.task-item.task-item-name[_ngcontent-%COMP%]{position:relative;z-index:500;height:30px;line-height:30px}.task-item.task-item-name[_ngcontent-%COMP%]:hover   .production-name[_ngcontent-%COMP%]{display:none}.task-item.task-item-name[_ngcontent-%COMP%]:hover   .production-name_hide[_ngcontent-%COMP%]{display:flex}.task-item.task-item-code[_ngcontent-%COMP%]{position:relative;z-index:501;height:30px;line-height:30px}.task-item.task-item-code[_ngcontent-%COMP%]:hover   .production-code[_ngcontent-%COMP%]{display:none}.task-item.task-item-code[_ngcontent-%COMP%]:hover   .production-code_hide[_ngcontent-%COMP%]{display:flex}.task-item[_ngcontent-%COMP%]   .production-name_hide[_ngcontent-%COMP%], .task-item[_ngcontent-%COMP%]   .production-code_hide[_ngcontent-%COMP%]{display:none;white-space:inherit;overflow:auto;align-items:center}.task-item[_ngcontent-%COMP%]   .production-name_hide[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .task-item[_ngcontent-%COMP%]   .production-code_hide[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{width:max-content;position:absolute;height:30px;display:flex;align-items:center;padding-right:10px;z-index:501;background:#fff}.timeline-tasks[_ngcontent-%COMP%]{position:relative;min-height:30px;align-items:center;z-index:9}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]{display:flex;justify-content:space-between;position:absolute;z-index:800;cursor:pointer;transition:background-color .5s ease}.timeline-tasks[_ngcontent-%COMP%]   .task-time.small[_ngcontent-%COMP%]{width:24px!important}.timeline-tasks[_ngcontent-%COMP%]   .task-time.selected[_ngcontent-%COMP%]{box-shadow:#000 0 0 6px -2px,#000 0 -2px 10px -5px inset;font-weight:700}.timeline-tasks[_ngcontent-%COMP%]   .task-time.deselected[_ngcontent-%COMP%]{opacity:.7;filter:grayscale(1)}.timeline-tasks[_ngcontent-%COMP%]   .task-time.is-saved[_ngcontent-%COMP%], .timeline-tasks[_ngcontent-%COMP%]   .task-time.is-saved[_ngcontent-%COMP%]:hover{background-color:#c8e6c9}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]   .tech-name[_ngcontent-%COMP%]{padding:0 3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]   .tech-name_small[_ngcontent-%COMP%]{font-size:12px}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grab;position:absolute;left:10px;right:10px;top:0;bottom:0}.timeline-tasks[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]:hover{background:#ccc}.timeline-tasks[_ngcontent-%COMP%]   .task-time.disabled[_ngcontent-%COMP%]:not(:hover){filter:grayscale(0) opacity(.3)}.timeline-tasks[_ngcontent-%COMP%]   .task-time.disabled[_ngcontent-%COMP%]:not(:hover).selected{filter:grayscale(0) opacity(1)}.timeline-tasks[_ngcontent-%COMP%]   .task-time.disabled[_ngcontent-%COMP%]:not(:hover).deselected{filter:grayscale(1) opacity(1)}.task-inner[_ngcontent-%COMP%]{position:relative;z-index:2}.task-time[_ngcontent-%COMP%]{border:1px solid;position:relative}.task-time[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.task-time.new-date[_ngcontent-%COMP%]{border-left:none;z-index:-1!important;background:repeating-linear-gradient(45deg,#7f7f7f,#7f7f7f 10px,rgba(203,203,203,0) 10px,rgba(203,203,203,0) 16px)}.task-time.new-date-smaller[_ngcontent-%COMP%]{pointer-events:none;border:none;border-bottom:2px solid var(--text-color);border-left:3px dotted var(--text-color)}.pi-minus[_ngcontent-%COMP%], .pi-plus[_ngcontent-%COMP%]{cursor:pointer;width:30px;height:30px;display:flex;align-items:center;justify-content:center;font-size:.875rem;font-weight:700}.pi-plus[_ngcontent-%COMP%]{position:relative}.task-item[_ngcontent-%COMP%]{display:flex;align-items:center}.resize-handle-left[_ngcontent-%COMP%], .resize-handle-right[_ngcontent-%COMP%]{position:absolute;height:100%;cursor:col-resize;width:10px}.resize-handle-left[_ngcontent-%COMP%]{left:0}.resize-handle-left_medium[_ngcontent-%COMP%]{left:-6px}.resize-handle-left_small[_ngcontent-%COMP%]{left:-10px!important}.resize-handle-right[_ngcontent-%COMP%]{right:0}.resize-handle-right_medium[_ngcontent-%COMP%]{right:-6px}.resize-handle-right_small[_ngcontent-%COMP%]{right:-10px!important}.not-planned[_ngcontent-%COMP%]{border:1px solid #f1716d}.deficit_not-planned[_ngcontent-%COMP%]{background:#f1716d}.deficit_planned[_ngcontent-%COMP%]{background:#f1716d;border:1px solid #000}.ordered-own[_ngcontent-%COMP%], .ordered-own-p[_ngcontent-%COMP%]{background:#fecf2e;border:1px solid #000}.ordered-outsource[_ngcontent-%COMP%]{position:relative;background:#fecf2e;border:1px solid #000}.ordered-outsource[_ngcontent-%COMP%]:before{content:"";position:absolute;width:20px;height:20px;background:url(hand-shake.0639e9384ddd9d75.svg);right:5px;z-index:1}.on-stock[_ngcontent-%COMP%]{background:#b7d472;border:1px solid #000}.task-reserved[_ngcontent-%COMP%]{border:1px solid #000;background:#af89e7}.planned[_ngcontent-%COMP%]{border:1px solid #000}.days[_ngcontent-%COMP%]{width:100%;position:absolute;height:100%;overflow:hidden}.day[_ngcontent-%COMP%]{height:100%;position:absolute;width:24px}.day_is-vac[_ngcontent-%COMP%]{background:gray}.rework[_ngcontent-%COMP%]{background:linear-gradient(90deg,#b7d472 38%,#fecf2e 65%)!important}.rework[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;left:-1px;right:0;bottom:1px;top:-1px}.toggle-disable[_ngcontent-%COMP%]{pointer-events:none}.test[_ngcontent-%COMP%]{padding-left:0!important}.task-btn[_ngcontent-%COMP%]{position:absolute;width:20px;height:20px;left:5px;top:4px;cursor:pointer;background:#fff;border:1px solid var(--text-color);display:flex;align-items:center;justify-content:center}.task-btn[_ngcontent-%COMP%]:before, .task-btn[_ngcontent-%COMP%]:after{content:"";background:var(--text-color);width:12px;height:2px;position:absolute}.task-btn[_ngcontent-%COMP%]:after{transform:rotate(90deg)}']}),i})();var Hr=l(8721),zr=l(6382);function $r(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1," Search In Warehouse "),t.qZA())}function Br(i,n){1&i&&(t.TgZ(0,"span"),t._uU(1,"Change Material"),t.qZA())}function Gr(i,n){if(1&i&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.lnq(" ",e.warehouseProduct.nomenclature.name," (",e.warehouseProduct.nomenclature.code,") Quantity: ",e.warehouseProduct.total_locator_quantity," ")}}function jr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"button",19),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,s=t.oxw();return t.KtG(s.removeMaterial(a))}),t._UZ(1,"i",20),t.qZA()}}function Kr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",9)(1,"div",10)(2,"a",11),t.NdJ("click",function(){const s=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.warehouseSearch(s))}),t.YNc(3,$r,2,0,"span",12),t.YNc(4,Br,2,0,"span",12),t.qZA(),t.YNc(5,Gr,2,3,"span",13),t.qZA(),t.TgZ(6,"div",14)(7,"input",15),t.NdJ("ngModelChange",function(a){const r=t.CHM(e).$implicit;return t.KtG(r.quantity=a)}),t.qZA()(),t.TgZ(8,"div",16),t.YNc(9,jr,2,0,"button",17),t.qZA()()}if(2&i){const e=n.$implicit,o=n.index;t.xp6(3),t.Q6J("ngIf",!e.warehouseProduct),t.xp6(1),t.Q6J("ngIf",e.warehouseProduct),t.xp6(1),t.Q6J("ngIf",e.warehouseProduct),t.xp6(2),t.Q6J("ngModel",e.quantity),t.xp6(2),t.Q6J("ngIf",o)}}let Wr=(()=>{class i{constructor(e,o){this.modalService=e,this.warehouseProductService=o,this.materials=[],this.materialsChange=new t.vpe}ngOnInit(){this.materials.length||this.addMaterial()}addMaterial(){this.materials.push({warehouseProduct:null,quantity:1})}removeMaterial(e){const o=this.materials.indexOf(e);this.materials.splice(o,1)}warehouseSearch(e){this.warehouseProductService.openSearchInWarehouseModal().subscribe(o=>{o&&(e.warehouseProduct=o,this.materialsChange.emit(this.materials))})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(P.Z),t.Y36(zr.t))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-manufacturing-material-picker"]],inputs:{materials:"materials"},outputs:{materialsChange:"materialsChange"},decls:14,vars:1,consts:[[1,"row","header"],[1,"col-9"],[1,"col-2","pl-0",2,"margin-left","-7px"],[1,"row"],["class","col-12 row pt-3 align-items-center",4,"ngFor","ngForOf"],[1,"pl-3","row","mt-3"],[1,"btn-pick"],[1,"btn-picker","btn-picker-add",3,"click"],[1,"pi","pi-plus"],[1,"col-12","row","pt-3","align-items-center"],[1,"col-9","warehouse-product"],[1,"btn-picker",3,"click"],[4,"ngIf"],["class","material-name",4,"ngIf"],[1,"col-2"],["min","1","type","number","pInputText","",3,"ngModel","ngModelChange"],[1,"col-1"],["class","btn-picker btn-danger btn-picker-danger",3,"click",4,"ngIf"],[1,"material-name"],[1,"btn-picker","btn-danger","btn-picker-danger",3,"click"],[1,"fas","fa-minus"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label"),t._uU(3," Warehouse Product"),t.qZA()(),t.TgZ(4,"div",2)(5,"label"),t._uU(6," Quantity"),t.qZA()()(),t.TgZ(7,"div",3),t.YNc(8,Kr,10,5,"div",4),t.qZA(),t.TgZ(9,"div",5)(10,"div",6)(11,"a",7),t.NdJ("click",function(){return o.addMaterial()}),t._UZ(12,"i",8),t._uU(13," Add New Item"),t.qZA()()()),2&e&&(t.xp6(8),t.Q6J("ngForOf",o.materials))},dependencies:[V.o,u.Fj,u.wV,u.JJ,u.qQ,u.On,_.sg,_.O5],styles:["[_nghost-%COMP%]{display:block}.btn-search[_ngcontent-%COMP%]{height:32px;flex:0 0 162px;margin-right:10px}.header[_ngcontent-%COMP%]{font-weight:500}.col-2[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.form-control[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#495057;background-color:#fff;background-clip:padding-box;border:1px solid #ced4da;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;width:10rem}.warehouse-product[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:30px}.material-name[_ngcontent-%COMP%]{max-width:440px;padding:0 20px}.btn-picker[_ngcontent-%COMP%]{font-weight:500;cursor:pointer}.btn-picker[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-weight:700}.btn-pick[_ngcontent-%COMP%]{padding-left:27px}"]}),i})();var Vr=l(2174);function Xr(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"p-dropdown",3),t.NdJ("ngModelChange",function(a){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedPositionId=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onSelectCompany())}),t.qZA()}if(2&i){const e=t.oxw();t.Q6J("filter",!0)("options",e.positions)("ngModel",e.selectedPositionId)("showClear",!0)("disabled",e.isDisabled)}}function ts(i,n){1&i&&(t.TgZ(0,"div",4),t._UZ(1,"i",5),t.qZA())}let es=(()=>{class i{constructor(e){this.employeePositionService=e,this.selectPosition=new t.vpe,this.isDisabled=!1,this.isLoading=!0,this.positions=[]}ngOnInit(){this.employeePositionService.get().pipe().subscribe(e=>{this.positions=e,this.currentPositionId&&(this.selectedPositionId=this.currentPositionId),this.isLoading=!1})}onSelectCompany(){this.selectPosition.emit(this.selectedPositionId)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(at))},i.\u0275cmp=t.Xpm({type:i,selectors:[["pek-employee-position-picker"]],inputs:{currentPositionId:"currentPositionId",isDisabled:"isDisabled"},outputs:{selectPosition:"selectPosition"},decls:4,vars:2,consts:[[1,"company-picker"],["placeholder","Select Position","optionLabel","title","optionValue","id",3,"filter","options","ngModel","showClear","disabled","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["placeholder","Select Position","optionLabel","title","optionValue","id",3,"filter","options","ngModel","showClear","disabled","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.YNc(1,Xr,1,5,"p-dropdown",1),t.qZA(),t.YNc(2,ts,2,0,"ng-template",null,2,t.W1O)),2&e){const a=t.MAs(3);t.xp6(1),t.Q6J("ngIf",!o.isLoading)("ngIfElse",a)}},dependencies:[_.O5,u.JJ,$.Lt,u.On]}),i})(),ns=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[_r.m,_.ez,ur,pr.x,hr.GY,G.ym,j._t,Vr.fx]}),i})();t.B6R(gr.I,[f.Hq,V.o,u._Y,u.Fj,u.wV,u.JJ,u.JL,u.Fd,u.sg,u.u,b.ZT,b.xY,b.H8,rt.f,es],[]),t.B6R(k,[f.Hq,u.Wl,u.JJ,Pt.u,$.Lt,u.On,pt.NU,_.mk,_.sg,_.O5,_.RF,_.n9,_.ED,G.E$,G.mC,j.Bh,Rr],[_.uU,_.Nd]),t.B6R(Hr.F,[f.Hq,u.Fj,u._,u.JJ,b.ZT,b.xY,b.H8,u.On,xt.XZ,_.sg,_.O5,Wr],[])}}]);