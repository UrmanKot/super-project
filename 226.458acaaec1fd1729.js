"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[226],{8226:(z,Y,c)=>{c.r(Y),c.d(Y,{BusinessTripsModule:()=>Tn});var r=c(6895),F=c(4269),e=c(4650),P=c(9293);let H=(()=>{class n{constructor(){this.routes=[{label:"Business Trips",commands:["trips"]}],this.settingsRoutes=[{label:"Vehicles",commands:["vehicles"]},{label:"Expenses",commands:["expenses"]}]}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-business-trips-layout"]],decls:2,vars:3,consts:[[3,"module","routes","settingsRoutes"]],template:function(t,i){1&t&&e._UZ(0,"pek-header",0)(1,"router-outlet"),2&t&&e.Q6J("module","Business Trips")("routes",i.routes)("settingsRoutes",i.settingsRoutes)},dependencies:[F.lC,P.G]}),n})();var a=c(655),v=c(8505),V=c(3900),_=c(4004),g=(()=>{return(n=g||(g={})).NEW="0",n.VERIFIED="1",n.NEED_VERIFICATION="2",g;var n})(),f=c(1135),b=c(8382),C=c(4128),w=c(9933),d=c(4006),E=c(6978),A=c(7427),B=c(6767),J=c(384),q=c(5593),$=c(1740),Q=c(805),X=c(615),N=c(3608),O=c(5390),p=c(3237),h=c(1997),T=c(585),x=c(2083),I=c(2340),u=c(6319),m=c(5698);function k(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Add Vehicle"),e.qZA())}function R(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Edit Vehicle"),e.qZA())}function ee(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addVehicle())}),e.qZA()}2&n&&e.Q6J("label","Add")}function re(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.editVehicle())}),e.qZA()}2&n&&e.Q6J("label","Edit")}let Ee=(()=>{class n{constructor(t,i,s,o){this.dialogRef=t,this.vehiclesService=s,this.data=o,this.form=i.group({model:[null,[d.kI.required]],number:[null,[d.kI.required]]}),"edit"===this.data.type&&this.form.patchValue(this.data.entity)}ngOnInit(){}addVehicle(){this.form.valid&&this.vehiclesService.create(this.form.value).pipe((0,m.q)(1)).subscribe(t=>{this.dialogRef.close(t)})}editVehicle(){this.form.valid&&(this.form.value.id=this.data.entity.id,this.vehiclesService.update(this.form.value.id,this.form.value).pipe((0,m.q)(1)).subscribe(t=>{this.dialogRef.close(t)}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.so),e.Y36(d.qu),e.Y36(le),e.Y36(u.WI))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-create-update-vehicle"]],decls:18,vars:6,consts:[[1,"modal-header"],[1,"modal-header__title"],[4,"ngIf"],[3,"formGroup"],[1,"form-group"],["for","model"],["pInputText","","formControlName","model","type","text","id","model",1,"form-control"],["for","number"],["pInputText","","formControlName","number","type","text","id","number",1,"form-control"],[1,"justify-content-between"],["pButton","","label","Cancel","type","button",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button","class","p-button-success",3,"label","click",4,"ngIf"],["pButton","","type","button",1,"p-button-success",3,"label","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e.YNc(2,k,2,0,"span",2),e.YNc(3,R,2,0,"span",2),e.qZA()(),e.TgZ(4,"mat-dialog-content")(5,"form",3)(6,"div",4)(7,"label",5),e._uU(8," Model "),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"div",4)(11,"label",7),e._uU(12,"Vehicle Registration Plate "),e.qZA(),e._UZ(13,"input",8),e.qZA()()(),e.TgZ(14,"mat-dialog-actions",9),e._UZ(15,"button",10),e.YNc(16,ee,1,1,"button",11),e.YNc(17,re,1,1,"button",11),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngIf","add"===i.data.type),e.xp6(1),e.Q6J("ngIf","edit"===i.data.type),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(10),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("ngIf","add"===i.data.type),e.xp6(1),e.Q6J("ngIf","edit"===i.data.type))},dependencies:[r.O5,q.Hq,$.o,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,u.ZT,u.xY,u.H8]}),n})();var j=c(529);let le=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="vehicles/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}getPaginated(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}getById(t){return this.httpClient.get(this.API_URL+this.url+t+"/").pipe((0,_.U)(i=>i.data))}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}createChangeVehicle(t=null){return this.dialog.open(Ee,{width:"800px",data:{type:t?"edit":"add",entity:t},disableClose:!1}).afterClosed().pipe()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var ae=c(5722);function Ze(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"p-multiSelect",3),e.NdJ("ngModelChange",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.selectedVehicles=s)})("ngModelChange",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.onSelectVehicles(s))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("showClear",!0)("options",t.vehicles)("ngModel",t.selectedVehicles)}}function Ie(n,l){1&n&&(e.TgZ(0,"div",4),e._UZ(1,"i",5),e.qZA())}let Ae=(()=>{class n{constructor(t){this.vehicleService=t,this.currentVehiclesIds=[],this.selectVehicles=new e.vpe,this.isLoading=!0,this.vehicles=[],this.selectedVehicles=[]}ngOnInit(){this.vehicleService.get().pipe().subscribe(t=>{this.vehicles=t,this.prepareVehicles(),this.findVehicles(),this.isLoading=!1})}prepareVehicles(){this.vehicles=this.vehicles.map(t=>({...t,displayLabel:t.model+" "+t.number}))}onSelectVehicles(t){this.selectVehicles.emit(t||null)}findVehicles(){this.currentVehiclesIds.length>0&&this.currentVehiclesIds.forEach(t=>{const i=this.vehicles.find(s=>s.id===t);i&&this.selectedVehicles.push(i)})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(le))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-multi-vehicle-picker"]],inputs:{currentVehiclesIds:"currentVehiclesIds"},outputs:{selectVehicles:"selectVehicles"},decls:4,vars:2,consts:[[1,"multi-vehicle-picker"],["optionLabel","displayLabel","placeholder","Select Vehicles",3,"showClear","options","ngModel","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["optionLabel","displayLabel","placeholder","Select Vehicles",3,"showClear","options","ngModel","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ze,1,3,"p-multiSelect",1),e.YNc(2,Ie,2,0,"ng-template",null,2,e.W1O),e.qZA()),2&t){const s=e.MAs(3);e.xp6(1),e.Q6J("ngIf",!i.isLoading)("ngIfElse",s)}},dependencies:[ae.NU,r.O5,d.JJ,d.On]}),n})(),Me=(()=>{class n{constructor(){this.valueChange=new e.vpe,this.statuses=[{value:g.VERIFIED,title:"Verified"},{value:g.NEED_VERIFICATION,title:"Need Verified"},{value:g.NEW,title:"In Progress"}]}ngOnInit(){}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}registerOnTouched(t){}setValue(t){this.selectedStatuses=t,this.valueChange.emit(this.selectedStatuses)}writeValue(t){this.selectedStatuses=t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-business-trips-multi-status-picker"]],outputs:{valueChange:"valueChange"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}])],decls:1,vars:3,consts:[["optionValue","value","optionLabel","title",3,"options","ngModel","showClear","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"p-multiSelect",0),e.NdJ("ngModelChange",function(o){return i.selectedStatuses=o})("ngModelChange",function(o){return i.onChange(o)}),e.qZA()),2&t&&e.Q6J("options",i.statuses)("ngModel",i.selectedStatuses)("showClear",!0)},dependencies:[d.JJ,d.On,ae.NU]}),n})();var we=c(6451),me=c(9038);let Se=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="custom-employees/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function ke(n,l){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.AsE("",t.employee.first_name," ",t.employee.last_name,"")}}function Pe(n,l){if(1&n&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.AsE("",t.customEmployee.first_name," ",t.customEmployee.last_name," (C) ")}}function Ue(n,l){if(1&n&&(e.TgZ(0,"div",2),e.YNc(1,ke,2,2,"div",3),e.YNc(2,Pe,2,2,"div",3),e.qZA()),2&n){const t=l.$implicit;e.xp6(1),e.Q6J("ngIf",t.employee),e.xp6(1),e.Q6J("ngIf",t.customEmployee)}}let Fe=(()=>{class n{constructor(t,i){this.crmEmployeeService=t,this.customEmployeesService=i,this.valueChange=new e.vpe,this.customEmployees=[],this.employeeFilter=[{name:"by_user_trip_permissions",value:!0}]}ngOnInit(){this.getEmployees()}getContactPersons(){return this.crmEmployeeService.get(this.employeeFilter).pipe((0,_.U)(t=>t.map(i=>({employee:i,order:1,id:"e"+i.id}))))}getCustomEmployees(){return this.customEmployeesService.get().pipe((0,_.U)(t=>t.map(i=>(console.log(i),{customEmployee:i,order:2,id:"c"+i.id}))))}getEmployees(){(0,we.T)(this.getContactPersons(),this.getCustomEmployees()).subscribe(t=>{this.customEmployees.push(...t),console.log(this.customEmployees),this.customEmployees.sort((i,s)=>i.order-s.order)})}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}setValue(t){if(this.selectedEmployees=t,this.selectedEmployees){const i=this.customEmployees.filter(s=>this.selectedEmployees.findIndex(o=>s.id===o)>-1);this.valueChange.emit(i)}else this.valueChange.emit(null)}writeValue(t){this.selectedEmployees=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(me.R),e.Y36(Se))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-business-trips-multi-employee-with-custom"]],outputs:{valueChange:"valueChange"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}])],decls:2,vars:3,consts:[["optionValue","id","optionLabel","employee.fullName","placeholder","Choice Employees",3,"options","ngModel","showClear","ngModelChange"],["pTemplate","item"],[1,"contact-item"],[4,"ngIf"]],template:function(t,i){1&t&&(e.TgZ(0,"p-multiSelect",0),e.NdJ("ngModelChange",function(o){return i.selectedEmployees=o})("ngModelChange",function(o){return i.onChange(o)}),e.YNc(1,Ue,3,2,"ng-template",1),e.qZA()),2&t&&e.Q6J("options",i.customEmployees)("ngModel",i.selectedEmployees)("showClear",!0)},dependencies:[r.O5,Q.jx,d.JJ,d.On,ae.NU]}),n})();const Be=["paginator"];function He(n,l){1&n&&e.GkF(0)}function Ve(n,l){1&n&&e.GkF(0)}function Ne(n,l){1&n&&(e.TgZ(0,"tr")(1,"th",38),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",39),e._uU(4,"Employee"),e.qZA(),e.TgZ(5,"th",40),e._uU(6,"Created"),e.qZA(),e.TgZ(7,"th",39),e._uU(8,"Trip Start"),e.qZA(),e.TgZ(9,"th",39),e._uU(10,"Trip End"),e.qZA(),e.TgZ(11,"th",39),e._uU(12,"Status"),e.qZA()())}function Oe(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.employee?t.employee.first_name+" "+t.employee.last_name:t.custom_employee.first_name+" "+t.custom_employee.last_name," ")}}function De(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1," Verified "),e.qZA())}function Je(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1," Need To Be Verified "),e.qZA())}function Le(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1," In Progress "),e.qZA())}function qe(n,l){if(1&n&&(e.TgZ(0,"tr",41)(1,"td",38),e._uU(2),e.qZA(),e.TgZ(3,"td",39),e.YNc(4,Oe,2,1,"span",42),e.qZA(),e.TgZ(5,"td",40),e._uU(6),e.ALo(7,"date"),e.qZA(),e.TgZ(8,"td",39),e._uU(9),e.ALo(10,"date"),e.qZA(),e.TgZ(11,"td",39),e._uU(12),e.ALo(13,"date"),e.qZA(),e.TgZ(14,"td",39),e.YNc(15,De,2,0,"span",42),e.YNc(16,Je,2,0,"span",42),e.YNc(17,Le,2,0,"span",42),e.qZA()()),2&n){const t=l.$implicit,i=l.rowIndex,s=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(10*(s.currentPage-1)+i+1),e.xp6(2),e.Q6J("ngIf",t.employee||t.custom_employee),e.xp6(2),e.Oqu(e.xi3(7,9,t.created_at,"dd/MM/yyyy")),e.xp6(3),e.Oqu(e.xi3(10,12,t.trip_start,"dd/MM/yyyy HH:mm")),e.xp6(3),e.Oqu(e.xi3(13,15,t.trip_end,"dd/MM/yyyy HH:mm")),e.xp6(3),e.Q6J("ngIf",t.status===s.tripStatus.VERIFIED),e.xp6(1),e.Q6J("ngIf",t.status===s.tripStatus.NEED_VERIFICATION),e.xp6(1),e.Q6J("ngIf",t.status===s.tripStatus.NEW)}}function Re(n,l){1&n&&e._UZ(0,"i",45)}function Ye(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function Qe(n,l){if(1&n&&(e.TgZ(0,"tr")(1,"td",43),e.YNc(2,Re,1,0,"i",44),e.YNc(3,Ye,2,0,"span",42),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.uIk("colspan",12),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function Ge(n,l){1&n&&(e.TgZ(0,"div",46),e._UZ(1,"i",45),e.qZA())}function Ke(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",47)(1,"p-paginator",48,49),e.NdJ("onPageChange",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.paginate(s))}),e.qZA(),e.TgZ(3,"p-button",50),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowAll(!0))}),e._uU(4," All "),e.qZA()()}if(2&n){const t=e.oxw();e.ekj("paginator-wrapper_hide",0===t.count),e.xp6(1),e.Q6J("rows",10)("totalRecords",t.count)}}function $e(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",51)(1,"p-button",52),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowAll(!1))}),e._uU(2," Return pagination "),e.qZA()()}}function je(n,l){if(1&n&&e._UZ(0,"p-menubar",55),2&n){const t=e.oxw(2);e.ekj("disabled",!t.selectedBusinessTrips),e.Q6J("model",t.menuItems)}}function We(n,l){if(1&n&&e._UZ(0,"p-menubar",55),2&n){const t=e.oxw(2);e.ekj("disabled",!t.selectedBusinessTrips),e.Q6J("model",t.menuItemsMultiple)}}function ze(n,l){if(1&n&&(e.TgZ(0,"div",53),e.YNc(1,je,1,3,"p-menubar",54),e.YNc(2,We,1,3,"p-menubar",54),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.selectedBusinessTrips||1===(null==t.selectedBusinessTrips?null:t.selectedBusinessTrips.length)),e.xp6(1),e.Q6J("ngIf",(null==t.selectedBusinessTrips?null:t.selectedBusinessTrips.length)>1)}}let te=class{constructor(l,t,i,s,o,y){this.router=l,this.fb=t,this.businessTripService=i,this.modalService=s,this.adapterService=o,this.auth=y,this.isLoading=!1,this.tripStatus=g,this.count=0,this.search$=new f.X(null),this.isHideFilters=!1,this.businessTrips$=this.search$.pipe((0,v.b)(()=>this.prepareForSearch()),(0,V.w)(()=>(0,b.s)(()=>!this.isShowAll,this.businessTripService.get(this.query).pipe((0,v.b)(Z=>this.count=Z.count),(0,_.U)(Z=>Z.results)),this.businessTripService.getAll(this.query).pipe((0,v.b)(Z=>this.count=Z.length),(0,_.U)(Z=>Z)))),(0,v.b)(()=>this.paginateToFistPage()),(0,v.b)(()=>this.isLoading=!1),(0,w.t)(this)),this.isStartFirstPage=!1,this.currentPage=1,this.isShowAll=!1,this.searchForm=this.fb.group({employees:[null],trip_start:[null],trip_end:[null],created_at:[null],statuses:[null],duration_more_than:[null],duration:["other"],durationOther:[0],location_countries_ids:[null],vehicle_ids:[null]}),this.queryKey=this.adapterService.generateQueryKey(this.searchForm),this.query=[],this.menuItems=[{label:"Selected Business Trip",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.editExpenseBusinessTrip()},{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteBusinessTrip()},{label:"Export To XLS",icon:"pi pi-file-excel",command:()=>this.exportToXls()}]}],this.menuItemsMultiple=[{label:"Selected Business Trips",items:[{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteBusinessTrip()},{label:"Export To XLS",icon:"pi pi-file-excel",command:()=>this.exportToXls()}]}],this.tableScrollHeight="29.625rem",y.user.can_verify_expenses&&this.menuItems[0].items.splice(1,0,{label:"Verify BT",icon:"pi pi-check",command:()=>this.verifyBt()})}ngOnInit(){}createBusinessTrip(){this.businessTripService.createChangeBusinessTrip().pipe((0,w.t)(this)).subscribe(l=>{l&&this.search$.next()})}editExpenseBusinessTrip(){this.router.navigate(["/business-trips/trip/edit/",this.selectedBusinessTrips[0].id])}verifyBt(){this.router.navigate(["/business-trips/trip/verify/",this.selectedBusinessTrips[0].id])}deleteBusinessTrip(){this.modalService.confirm("danger","Confirm").subscribe(l=>{if(l){const t=[];this.selectedBusinessTrips.forEach(i=>{t.push(this.businessTripService.delete(i).pipe((0,w.t)(this)))}),(0,C.D)([...t]).subscribe(()=>{this.search$.next()})}})}exportToXls(){const l=this.selectedBusinessTrips.map(t=>t.id);this.businessTripService.getBtForExport([{name:"ids",value:l}]).subscribe(t=>{t.forEach(i=>{this.businessTripService.exportToExcel(i).then()})})}paginate(l){this.isStartFirstPage||(this.currentPage=l.page+1,this.search$.next())}paginateToFistPage(){this.isStartFirstPage&&this.paginator?.changePage(0),this.isStartFirstPage=!1}onShowAll(l){this.isShowAll=l,this.isShowAll||(this.currentPage=1),this.search$.next()}prepareForSearch(){this.isLoading=!0,this.selectedBusinessTrips=null;const l=this.adapterService.generateQueryKey(this.searchForm);l!==this.queryKey&&(this.currentPage=1,this.queryKey=l,this.isStartFirstPage=!0),this.query=[{name:"page",value:this.currentPage},{name:"by_user_trip_permissions",value:!0}],this.isShowAll||this.query.push({name:"paginated",value:!0});for(const t in this.searchForm.controls)null!==this.searchForm.controls[t].value&&"duration"!==t&&"durationOther"!==t&&(this.searchForm.controls[t].value instanceof Date?this.query.push({name:t,value:this.adapterService.dateAdapter(this.searchForm.controls[t].value)}):this.query.push({name:t,value:this.searchForm.controls[t].value}))}onSelectEmployees(l){this.searchForm.get("employees").patchValue(l),this.search$.next()}onSelectStatuses(l){this.searchForm.get("statuses").patchValue(l),this.search$.next()}onSelectDuration(){switch(this.searchForm.get("duration").value){case"hour":this.searchForm.get("duration_more_than").patchValue(3600);break;case"day":this.searchForm.get("duration_more_than").patchValue(86400);break;case"month":this.searchForm.get("duration_more_than").patchValue(2678400);break;case"other":this.searchForm.get("duration_more_than").patchValue(3600*this.searchForm.get("durationOther").value)}this.search$.next()}changeOtherDuration(){"other"===this.searchForm.get("duration").value&&(this.searchForm.get("duration_more_than").patchValue(3600*this.searchForm.get("durationOther").value),this.search$.next())}onSelectCountries(l){this.searchForm.get("location_countries_ids").patchValue(l?.map(t=>t.alpha2_code).join(",")??null),console.log(this.searchForm.get("location_countries_ids").value),this.search$.next()}onSelectVehicles(l){this.searchForm.get("vehicle_ids").patchValue(l?.map(t=>t.id).join(",")??null),console.log(this.searchForm.get("vehicle_ids").value),this.search$.next()}toggleFilterVisibility(){this.isHideFilters=!this.isHideFilters,this.setTableScrollHeight()}setTableScrollHeight(){!this.isHideFilters||this.isShowAll?this.isHideFilters&&this.isShowAll?this.tableScrollHeight="18.75rem":this.isHideFilters||!this.isShowAll?this.isHideFilters||this.isShowAll||(this.tableScrollHeight="29.625rem"):this.tableScrollHeight="27.5rem":this.tableScrollHeight="20.875rem"}};te.\u0275fac=function(l){return new(l||te)(e.Y36(F.F0),e.Y36(d.qu),e.Y36(E.v),e.Y36(A.Z),e.Y36(B.v),e.Y36(J.e8))},te.\u0275cmp=e.Xpm({type:te,selectors:[["pek-business-trips"]],viewQuery:function(l,t){if(1&l&&e.Gf(Be,5),2&l){let i;e.iGM(i=e.CRH())&&(t.paginator=i.first)}},decls:76,vars:27,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","Create Business Trip",3,"click"],[1,"page__content"],[1,"page__card"],[1,"filters-visibility"],[1,"filters-visibility__header"],[4,"ngTemplateOutlet"],["tooltipPosition","left",1,"icon","pi",3,"pTooltip","click"],[1,"form","mb-3",3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],[3,"valueChange"],["formControlName","trip_start","dataType","date","dateFormat","dd/mm/yy",3,"showButtonBar","readonlyInput","ngModelChange"],["formControlName","trip_end","dataType","date","dateFormat","dd/mm/yy",3,"showButtonBar","readonlyInput","ngModelChange"],["formControlName","created_at","dataType","date","dateFormat","dd/mm/yy",3,"showButtonBar","readonlyInput","ngModelChange"],[3,"selectCountries"],[3,"selectVehicles"],[1,"duration"],[1,"d-flex"],[1,"other-duration"],[1,"other-duration-row"],["type","number","pInputText","","formControlName","durationOther","placeholder","Number in hours",3,"ngModelChange"],[1,"col-3",2,"margin","auto"],[1,"page__table"],[1,"table-pagination-preloader"],["selectionMode","multiple","scrollHeight","calc(100vh - 27.375rem)",3,"scrollable","rows","value","selection","selectionChange"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","pagination-preloader pagination-preloader_bord",4,"ngIf"],["class","paginator-wrapper",3,"paginator-wrapper_hide",4,"ngIf"],["class","paginator-return-pagination",4,"ngIf"],["actionButtons",""],[1,"text-center",2,"width","5%"],[1,"text-center",2,"width","20%"],[1,"text-center",2,"width","15%"],[3,"pSelectableRow"],[4,"ngIf"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"pagination-preloader","pagination-preloader_bord"],[1,"paginator-wrapper"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["type","button","styleClass","p-button-text",1,"paginator-all",3,"click"],[1,"paginator-return-pagination"],["type","button","styleClass","p-button-text",3,"click"],[1,"action-buttons"],["class","ml-auto",3,"model","disabled",4,"ngIf"],[1,"ml-auto",3,"model"]],template:function(l,t){if(1&l&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5,"Business Trips"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return t.createBusinessTrip()}),e.qZA()()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),e.YNc(12,He,1,0,"ng-container",10),e.qZA(),e.TgZ(13,"button",11),e.NdJ("click",function(){return t.toggleFilterVisibility()}),e.qZA(),e.TgZ(14,"form",12)(15,"div",13)(16,"div",14)(17,"div",15)(18,"label"),e._uU(19,"Employees"),e.qZA(),e.TgZ(20,"pek-business-trips-multi-employee-with-custom",16),e.NdJ("valueChange",function(s){return t.onSelectEmployees(s)}),e.qZA()()(),e.TgZ(21,"div",14)(22,"div",15)(23,"label"),e._uU(24,"Date Trip Start"),e.qZA(),e.TgZ(25,"p-calendar",17),e.NdJ("ngModelChange",function(){return t.search$.next()}),e.qZA()()(),e.TgZ(26,"div",14)(27,"div",15)(28,"label"),e._uU(29,"Date Trip End"),e.qZA(),e.TgZ(30,"p-calendar",18),e.NdJ("ngModelChange",function(){return t.search$.next()}),e.qZA()()(),e.TgZ(31,"div",14)(32,"div",15)(33,"label"),e._uU(34,"Date Trip Created"),e.qZA(),e.TgZ(35,"p-calendar",19),e.NdJ("ngModelChange",function(){return t.search$.next()}),e.qZA()()(),e.TgZ(36,"div",14)(37,"div",15)(38,"label"),e._uU(39,"Statuses"),e.qZA(),e.TgZ(40,"pek-business-trips-multi-status-picker",16),e.NdJ("valueChange",function(s){return t.onSelectStatuses(s)}),e.qZA()()(),e.TgZ(41,"div",14)(42,"div",15)(43,"label"),e._uU(44,"Countries"),e.qZA(),e.TgZ(45,"pek-multi-countries-picker",20),e.NdJ("selectCountries",function(s){return t.onSelectCountries(s)}),e.qZA()()(),e.TgZ(46,"div",14)(47,"div",15)(48,"label"),e._uU(49,"Vehicles"),e.qZA(),e.TgZ(50,"pek-multi-vehicle-picker",21),e.NdJ("selectVehicles",function(s){return t.onSelectVehicles(s)}),e.qZA()()(),e.TgZ(51,"div",14)(52,"div",22)(53,"p"),e._uU(54,"Duration Is Longer Than"),e.qZA(),e.TgZ(55,"div",23)(56,"div",24)(57,"div",25)(58,"input",26),e.NdJ("ngModelChange",function(){return t.changeOtherDuration()}),e.qZA(),e.TgZ(59,"p"),e._uU(60,"Hour(s)"),e.qZA()()()()()(),e._UZ(61,"div",14),e.TgZ(62,"div",27),e.YNc(63,Ve,1,0,"ng-container",10),e.qZA()()()(),e.TgZ(64,"div",28)(65,"div",29)(66,"p-table",30),e.NdJ("selectionChange",function(s){return t.selectedBusinessTrips=s}),e.ALo(67,"async"),e.YNc(68,Ne,13,0,"ng-template",31),e.YNc(69,qe,18,18,"ng-template",32),e.YNc(70,Qe,4,3,"ng-template",33),e.qZA(),e.YNc(71,Ge,2,0,"div",34),e.YNc(72,Ke,5,4,"div",35),e.qZA(),e.YNc(73,$e,3,0,"div",36),e.qZA()()(),e.YNc(74,ze,3,2,"ng-template",null,37,e.W1O)),2&l){const i=e.MAs(75);e.xp6(3),e.Q6J("module","business-trip")("isActive",!0),e.xp6(7),e.ekj("filters-visibility_hide",t.isHideFilters),e.xp6(2),e.Q6J("ngTemplateOutlet",i),e.xp6(1),e.ekj("pi-angle-double-up",!t.isHideFilters)("pi-angle-double-down",t.isHideFilters),e.Q6J("pTooltip",t.isHideFilters?"Expand Filters":"Collapse Filters"),e.xp6(1),e.Q6J("formGroup",t.searchForm),e.xp6(11),e.Q6J("showButtonBar",!0)("readonlyInput",!0),e.xp6(5),e.Q6J("showButtonBar",!0)("readonlyInput",!0),e.xp6(5),e.Q6J("showButtonBar",!0)("readonlyInput",!0),e.xp6(28),e.Q6J("ngTemplateOutlet",i),e.xp6(3),e.Q6J("scrollable",!0)("rows",10)("value",e.lcZ(67,25,t.businessTrips$))("selection",t.selectedBusinessTrips),e.xp6(5),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isShowAll),e.xp6(1),e.Q6J("ngIf",t.isShowAll)}},dependencies:[r.O5,r.tP,q.Hq,q.zx,$.o,Q.jx,d._Y,d.Fj,d.wV,d.JJ,d.JL,d.sg,d.u,X.nm,N.u,O.iA,O.Ei,p.D,h.D,T.f,x.D,Ae,Me,Fe,r.Ov,r.uU],styles:[".form[_ngcontent-%COMP%]{margin-top:-.25rem}.col-3[_ngcontent-%COMP%]{width:20%}.action-buttons[_ngcontent-%COMP%]{margin-top:.25rem}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.input-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute;bottom:0;background:transparent;cursor:pointer;color:#6c757d;right:.6rem;top:.275rem}.other-duration[_ngcontent-%COMP%]{display:flex}.col-actions[_ngcontent-%COMP%]{width:30%}.duration[_ngcontent-%COMP%]{padding:.5rem 0}.duration[_ngcontent-%COMP%] > p[_ngcontent-%COMP%]{margin-bottom:.6875rem;font-weight:500}.other-duration-row[_ngcontent-%COMP%]{display:flex;align-items:center}.other-duration-row[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-left:.5rem}"]}),te=(0,a.gn)([(0,w.c)()],te);var K=c(9856),ie=c(8372),G=c(7579),M=c(2722),ce=c(9646),_e=c(5303),W=c(8604);let Xe=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-vehicles/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}getById(t){return this.httpClient.get(this.API_URL+this.url+t+"/").pipe((0,_.U)(i=>i.data))}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update_vehicle(t,i){return this.httpClient.post(this.API_URL+this.url+"update_business_trip_vehicle/",i)}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var ge=c(4189),et=c(9558);function tt(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Add Evidence"),e.qZA())}function it(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Edit Evidence"),e.qZA())}function nt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",27)(1,"div",10)(2,"div",6)(3,"label",28),e._uU(4," Evidence Title "),e.qZA(),e.TgZ(5,"input",29),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.changedField())}),e.qZA()()(),e.TgZ(6,"div",10)(7,"div",6)(8,"label",30),e._uU(9," Evidence Description "),e.qZA(),e.TgZ(10,"input",31),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.changedField())}),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(5),e.uIk("disabled",t.isEditDisabled?"":null),e.xp6(5),e.uIk("disabled",t.isEditDisabled?"":null)}}function st(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",32)(1,"div",10)(2,"div",6)(3,"label"),e._uU(4,"Evidence Title"),e.qZA(),e.TgZ(5,"pek-expense-picker",33),e.NdJ("valueChange",function(s){e.CHM(t);const o=e.oxw();return o.expenseChanged(s),e.KtG(o.changedField())}),e.qZA()()(),e.TgZ(6,"div",10)(7,"div",6)(8,"label",34),e._uU(9," Evidence Description "),e.qZA(),e._UZ(10,"input",35),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("isDisabled",t.isEditDisabled)("expense",t._expense.get("id").value),e.xp6(5),e.uIk("disabled",!0)}}function ot(n,l){1&n&&(e.TgZ(0,"tr")(1,"th",36),e._uU(2,"Name"),e.qZA(),e.TgZ(3,"th",37),e._uU(4,"Actions"),e.qZA()())}function rt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr",39)(1,"td",37)(2,"a",40),e._uU(3),e.qZA()(),e.TgZ(4,"td",41)(5,"div",42)(6,"button",43),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().$implicit,o=e.oxw();return e.KtG(o.deleteExpensesFile(s.id))}),e.qZA()()()()}if(2&n){const t=e.oxw().$implicit,i=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Q6J("href",t.file,e.LSH),e.xp6(1),e.hij(" ",i.getName(t.file)," ")}}function lt(n,l){if(1&n&&e.YNc(0,rt,7,3,"tr",38),2&n){const t=l.$implicit,i=e.oxw();e.Q6J("ngIf",i.isFileToBeDisplayed(t.id))}}function at(n,l){1&n&&(e.TgZ(0,"tr",44)(1,"td",45)(2,"span"),e._uU(3," No Files Found "),e.qZA()()()),2&n&&(e.xp6(1),e.uIk("colspan",3))}function pt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addExpanse())}),e.qZA()}2&n&&e.Q6J("label","Add")}function ct(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.editExpanse())}),e.qZA()}2&n&&e.Q6J("label","Edit")}const ut=function(){return{standalone:!0}};let fe=(()=>{class n{constructor(t,i,s,o,y,Z,U,D,S,L,ne){this.dialogRef=t,this.fb=i,this.crmPositionService=s,this.data=o,this.expensesService=y,this.adapterService=Z,this.businessService=U,this.auth=D,this.messageService=S,this.businessTripService=L,this.modalService=ne,this.form=this.fb.group({id:[null],is_verified:[null],isOther:[!1],expense:this.fb.group({id:[null],name:[null],description:[null]}),custom_expense:this.fb.group({id:[null],name:[null],description:[null]}),currency:this.fb.group({code:[null,[d.kI.required]],name:[null],symbol:[null],is_active:[null]}),sum:[0,[d.kI.required]],file:[null],type:["0"],uploaded_file:[null],clear_file:[!1],base64File:[null],deleteImagesIds:[[]],files:[[]],uploadedFiles:[[]]}),this.types=[{name:"Corporate",value:"0"},{name:"Own",value:"1"}],this.isEditDisabled=!1,this.canVerify=!1,this.destroy$=new G.x,this.link=I.N.image_path,this.selectedType=this.types[0],this.filesIdsToDelete=[]}ngOnInit(){"edit"===this.data.type&&(this.form.patchValue(this.data.entity),this.data.entity.expense?.id?this.form.get("isOther").setValue(!1):this.form.get("isOther").setValue(!0),this.expensesFiles=this.data.entity.files,this.selectedType=this.types.find(t=>t.value===this.data.entity.type)),this.canVerify=this.data.canVerify}addExpanse(){if(this.form.get("isOther").value){const t=this.form.get("custom_expense").value.name,i=this.form.get("custom_expense").value.description;if(!t||!i)return void this.messageService.add({severity:"error",summary:"Validation Error",detail:"Fill Expense Info"})}else if(!this.form.get("expense").value.id)return void this.messageService.add({severity:"error",summary:"Validation Error",detail:"Select Expense"});this.form.get("currency").value.code?this.form.valid&&this.dialogRef.close(this.form.value):this.messageService.add({severity:"error",summary:"Validation Error",detail:"Select Currency"})}editExpanse(){if(this.form.get("isOther").value){this.form.get("expense").reset();const t=this.form.get("custom_expense").value.name,i=this.form.get("custom_expense").value.description;if(!t||!i)return void this.messageService.add({severity:"error",summary:"Validation Error",detail:"Fill Expense Info"})}else if(this.form.get("custom_expense").reset(),!this.form.get("expense").value.id)return void this.messageService.add({severity:"error",summary:"Validation Error",detail:"Select Expense"});this.form.get("currency").value.code?(this.filesIdsToDelete.length>0&&this.form.get("deleteImagesIds").setValue(this.filesIdsToDelete),this.form.valid&&this.dialogRef.close(this.form)):this.messageService.add({severity:"error",summary:"Validation Error",detail:"Select Currency"})}get _expense(){return this.form.get("expense")}get _currency(){return this.form.get("currency")}test(){}expenseChanged(t){this.form.get("expense").setValue(t)}getById(t){this.expensesService.getById(t).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.selectedExpense=i})}changed(){this.form.get("expense").value&&this.form.get("expense").reset(),this.form.get("custom_expense").value&&this.form.get("custom_expense").reset()}currencyChanged(t){this.form.get("currency").setValue(t)}imageManipulation(t,i){const o=Array.from(i.files)[0];this.form.get("uploaded_file").reset(),this.form.get("base64File").reset(),this.form.get("uploaded_file").setValue(o),this.fileToBase64(o),this.form.get("clear_file").setValue(!1),this.changedField()}fileToBase64(t){const i=new FileReader;i.onload=s=>{const o=s.target.result;this.form.get("base64File").setValue(o)},i.readAsDataURL(t)}getName(t){const i=t.split("/");return i[i.length-1]}changedField(){this.auth.user.can_verify_expenses||this.form.get("is_verified").patchValue(!1)}clearFile(){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&(this.file=null,this.form.get("file").value&&this.form.get("clear_file").setValue(!0),this.form.get("file").setValue(null),this.form.get("uploaded_file").setValue(null),this.form.get("base64File").setValue(null))})}viewFile(){const t=[],i=[];this.form.get("base64File").value&&i.push({file:this.form.get("base64File").value}),"string"==typeof this.form.get("file").value&&!this.form.get("base64File").value&&t.push({file:this.form.get("file").value}),this.businessTripService.viewBusinessTripFiles({links:t,files:i})}takePhoto(){this.businessService.takePhotoModal().pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&(this.form.get("uploaded_file").reset(),this.form.get("base64File").reset(),this.form.get("uploaded_file").setValue(t),this.fileToBase64(t),this.form.get("clear_file").setValue(!1),this.changedField())})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}typeChanged(t){this.form.get("type").setValue(t.value)}filesChanged(t){this.form.get("uploadedFiles").setValue(t)}isFileToBeDisplayed(t){return this.filesIdsToDelete.findIndex(i=>i===t)<0}downloadFile(t){}deleteExpensesFile(t){this.modalService.confirm("danger","Confirm").subscribe(i=>{if(i){const s=this.expensesFiles.findIndex(o=>o.id===t);this.expensesFiles.splice(s,1),this.filesIdsToDelete.push(t)}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.so),e.Y36(d.qu),e.Y36(ge.q),e.Y36(u.WI),e.Y36(oe),e.Y36(B.v),e.Y36(E.v),e.Y36(J.e8),e.Y36(Q.ez),e.Y36(E.v),e.Y36(A.Z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-create-edit-expense"]],decls:45,vars:20,consts:[[1,"modal-header"],[1,"modal-header__title"],[4,"ngIf"],[3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],["for","other",2,"display","block"],["id","other","formControlName","isOther",3,"disabled","binary","onChange"],[3,"ngIf"],[1,"col-6"],["formGroupName","expense",1,"form-group"],[3,"isDisabled","currency","valueChange"],["for","price"],["pInputText","","id","price","formControlName","sum","type","number","step","0.01","min","0",1,"form-control",3,"ngModelChange"],["for","is_verified"],["optionLabel","name",3,"options","ngModel","ngModelOptions","ngModelChange"],[1,"col-12"],[3,"fileChanged"],["filePicker",""],["selectionMode","single",1,"table-full-loading","adaptive-table","adaptive-table_filters",3,"rows","paginator","value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"justify-content-between"],["pButton","","label","Cancel","type","button",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button","class","p-button-success",3,"label","click",4,"ngIf"],["formGroupName","custom_expense",1,"row"],["for","name"],["pInputText","","formControlName","name","type","text","id","name",1,"form-control",3,"ngModelChange"],["for","custom_description"],["pInputText","","formControlName","description","type","text","id","custom_description",1,"form-control",3,"ngModelChange"],["formGroupName","expense",1,"row"],[3,"isDisabled","expense","valueChange"],["for","description"],["pInputText","","formControlName","description","type","text","id","description",1,"form-control"],[2,"width","80%"],[2,"width","20%"],[3,"pSelectableRow",4,"ngIf"],[3,"pSelectableRow"],[3,"href"],[2,"width","30%"],[1,"d-flex","justify-content-center"],["pButton","","type","button","icon","pi pi-trash",1,"p-button-danger","p-button-rounded","p-button-outlined","p-button-rounded_small",3,"click"],[1,"no-content"],[1,"text-center","p-4",2,"width","100%"],["pButton","","type","button",1,"p-button-success",3,"label","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e.YNc(2,tt,2,0,"span",2),e.YNc(3,it,2,0,"span",2),e.qZA()(),e.TgZ(4,"mat-dialog-content")(5,"form",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),e._uU(10,"Not Listed Evidences"),e.qZA(),e.TgZ(11,"p-checkbox",8),e.NdJ("onChange",function(){return i.changed()}),e.qZA()()()(),e.YNc(12,nt,11,2,"ng-template",9),e.YNc(13,st,11,3,"ng-template",9),e.TgZ(14,"div",4)(15,"div",10)(16,"div",11)(17,"label"),e._uU(18,"Currency"),e.qZA(),e.TgZ(19,"pek-currency-picker",12),e.NdJ("valueChange",function(o){return i.currencyChanged(o),i.changedField()}),e.qZA()()(),e.TgZ(20,"div",10)(21,"div",6)(22,"label",13),e._uU(23," Sum "),e.qZA(),e.TgZ(24,"input",14),e.NdJ("ngModelChange",function(){return i.changedField()}),e.qZA()()()(),e.TgZ(25,"div",4)(26,"div",10)(27,"div",6)(28,"label",15),e._uU(29,"Evidence type"),e.qZA(),e.TgZ(30,"p-dropdown",16),e.NdJ("ngModelChange",function(o){return i.selectedType=o})("ngModelChange",function(o){return i.typeChanged(o)}),e.qZA()()()(),e.TgZ(31,"div",4)(32,"div",17)(33,"div",6)(34,"pek-upload-file-picker",18,19),e.NdJ("fileChanged",function(o){return i.filesChanged(o)}),e.qZA()()()(),e.TgZ(36,"div",4)(37,"p-table",20),e.YNc(38,ot,5,0,"ng-template",21),e.YNc(39,lt,1,1,"ng-template",22),e.YNc(40,at,4,1,"ng-template",23),e.qZA()()()(),e.TgZ(41,"mat-dialog-actions",24),e._UZ(42,"button",25),e.YNc(43,pt,1,1,"button",26),e.YNc(44,ct,1,1,"button",26),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngIf","add"===i.data.type),e.xp6(1),e.Q6J("ngIf","edit"===i.data.type),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(6),e.Q6J("disabled",i.isEditDisabled)("binary",!0),e.xp6(1),e.Q6J("ngIf",i.form.get("isOther").value),e.xp6(1),e.Q6J("ngIf",!i.form.get("isOther").value),e.xp6(6),e.Q6J("isDisabled",i.isEditDisabled)("currency",i._currency.get("code").value),e.xp6(5),e.uIk("disabled",i.isEditDisabled?"":null),e.xp6(6),e.Q6J("options",i.types)("ngModel",i.selectedType)("ngModelOptions",e.DdM(19,ut)),e.xp6(7),e.Q6J("rows",5)("paginator",!0)("value",i.expensesFiles),e.xp6(5),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("ngIf","add"===i.data.type),e.xp6(1),e.Q6J("ngIf","edit"===i.data.type))},styles:["pek-upload-file-picker div.p-fileupload-content{max-height:15.875rem;overflow:auto;padding:.5rem 1rem!important}  .dark-disabled input{opacity:1!important}  .dark-disabled.highlight input{font-weight:500}.modal-overflow-visible[_ngcontent-%COMP%]   mat-dialog-content[_ngcontent-%COMP%]{overflow:auto!important}.input-file[_ngcontent-%COMP%]{cursor:pointer;margin-top:10px;width:-moz-fit-content;width:fit-content}.input-file[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0;overflow:hidden}.input-file[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:inline-block;margin-right:5px;color:#002e72}.input-file[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;font-weight:500;color:#002e72}.input-file[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{text-decoration:underline}.delete-image[_ngcontent-%COMP%]{background:transparent;border:none;color:#dc3545;padding:0;position:relative;top:2px}.delete-image[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px;font-size:16px;position:relative;top:1px}.delete-image[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.delete-image[_ngcontent-%COMP%]:hover{text-decoration:underline}.remove[_ngcontent-%COMP%]{cursor:pointer;font:inherit;right:-15.375rem;bottom:.25rem;font-weight:500;padding:.375rem 1.125rem;color:var(--theme-color-danger);border-radius:.625rem;width:9.875rem;background:rgba(255,237,237,.4588235294);margin-left:.5rem}.remove[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:relative;top:1px;margin-right:.5rem}"]}),n})();function dt(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Add Expense"),e.qZA())}function ht(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"Edit Expense"),e.qZA())}function mt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addExpense())}),e.qZA()}2&n&&e.Q6J("label","Add")}function _t(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.editExpense())}),e.qZA()}2&n&&e.Q6J("label","Edit")}let gt=(()=>{class n{constructor(t,i,s,o){this.dialogRef=t,this.expensesService=s,this.data=o,this.form=i.group({name:[null,[d.kI.required]],description:[""]}),"edit"===this.data.type&&this.form.patchValue(this.data.entity)}ngOnInit(){}addExpense(){this.form.valid&&this.expensesService.create(this.form.value).pipe((0,m.q)(1)).subscribe(t=>{this.dialogRef.close(t)})}editExpense(){this.form.valid&&(this.form.value.id=this.data.entity.id,this.expensesService.update(this.form.value.id,this.form.value).pipe((0,m.q)(1)).subscribe(t=>{this.dialogRef.close(t)}))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.so),e.Y36(d.qu),e.Y36(oe),e.Y36(u.WI))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-create-update-expense"]],decls:18,vars:6,consts:[[1,"modal-header"],[1,"modal-header__title"],[4,"ngIf"],[3,"formGroup"],[1,"form-group"],["for","name"],["pInputText","","formControlName","name","type","text","id","name",1,"form-control"],["for","description"],["pInputText","","formControlName","description","type","text","id","description",1,"form-control"],[1,"justify-content-between"],["pButton","","label","Cancel","type","button",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button","class","p-button-success",3,"label","click",4,"ngIf"],["pButton","","type","button",1,"p-button-success",3,"label","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e.YNc(2,dt,2,0,"span",2),e.YNc(3,ht,2,0,"span",2),e.qZA()(),e.TgZ(4,"mat-dialog-content")(5,"form",3)(6,"div",4)(7,"label",5),e._uU(8," Name "),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"div",4)(11,"label",7),e._uU(12," Description "),e.qZA(),e._UZ(13,"input",8),e.qZA()()(),e.TgZ(14,"mat-dialog-actions",9),e._UZ(15,"button",10),e.YNc(16,mt,1,1,"button",11),e.YNc(17,_t,1,1,"button",11),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngIf","add"===i.data.type),e.xp6(1),e.Q6J("ngIf","edit"===i.data.type),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(10),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("ngIf","add"===i.data.type),e.xp6(1),e.Q6J("ngIf","edit"===i.data.type))},dependencies:[r.O5,q.Hq,$.o,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,u.ZT,u.xY,u.H8]}),n})(),oe=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="expenses/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}getPaginated(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}getById(t){return this.httpClient.get(this.API_URL+this.url+t+"/").pipe((0,_.U)(i=>i.data))}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}createChangeExpanseItem(t=null,i=!1){return this.dialog.open(fe,{width:"800px",data:{type:t?"edit":"add",entity:t,canVerify:i},disableClose:!0}).afterClosed().pipe()}createChangeExpense(t=null){return this.dialog.open(gt,{width:"800px",data:{type:t?"edit":"add",entity:t},disableClose:!0}).afterClosed().pipe()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ft=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-locations/"}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ve=(()=>{class n{constructor(t){this.httpClient=t,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-hotel-files/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}add_hotel_files(t){return this.httpClient.post(this.API_URL+this.url+"add_business_trip_hotel_files/",t).pipe((0,_.U)(i=>i.data))}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const vt=["filePicker"],Ct=["hotelsList"];function Tt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",24)(3,"div",20)(4,"label"),e._uU(5,"First Name"),e.qZA(),e.TgZ(6,"input",25),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.employeeChangedEmit.next())}),e.qZA()()(),e.TgZ(7,"div",24)(8,"div",20)(9,"label"),e._uU(10,"Last Name"),e.qZA(),e.TgZ(11,"input",26),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.employeeChangedEmit.next())}),e.qZA()()(),e.TgZ(12,"div",24)(13,"div",20)(14,"label"),e._uU(15,"Position"),e.qZA(),e.TgZ(16,"app-crm-position-picker",27),e.NdJ("valueChange",function(s){e.CHM(t);const o=e.oxw(2);return o.form.get("employee_position").setValue(s),e.KtG(o.employeeChangedEmit.next())}),e.qZA()()()()()}if(2&n){const t=e.oxw(2);e.xp6(16),e.Q6J("position",t.form.get("employee_position").value)}}const yt=function(){return{standalone:!0}};function xt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",28)(1,"div",18)(2,"div",24)(3,"div",20)(4,"label"),e._uU(5,"First Name"),e.qZA(),e.TgZ(6,"pek-crm-single-employee-picker",29),e.NdJ("valueChange",function(s){e.CHM(t);const o=e.oxw(2);return o._employee.setValue(s),e.KtG(o.employeeChangedEmit.next())}),e.qZA()()(),e.TgZ(7,"div",24)(8,"div",20)(9,"label"),e._uU(10,"Last Name"),e.qZA(),e._UZ(11,"input",30),e.qZA()(),e.TgZ(12,"div",24)(13,"div",20)(14,"label"),e._uU(15,"Position"),e.qZA(),e._UZ(16,"input",31),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(6),e.Q6J("filters",t.employeeFilter)("showProfession",!0)("employee",t._employee.get("id").value),e.xp6(5),e.Q6J("disabled",!0),e.xp6(5),e.Q6J("ngModel",t._employee.get("position").value?t._employee.get("position").value.title:null)("ngModelOptions",e.DdM(6,yt))}}function bt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",19)(3,"div",20)(4,"label",21),e._uU(5,"Not Listed Employee"),e.qZA(),e.TgZ(6,"p-checkbox",22),e.NdJ("onChange",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.employeeChanged())}),e.qZA()()()(),e.YNc(7,Tt,17,1,"div",11),e.YNc(8,xt,17,7,"ng-template",null,23,e.W1O),e.qZA()}if(2&n){const t=e.MAs(9),i=e.oxw();e.xp6(6),e.Q6J("binary",!0),e.xp6(1),e.Q6J("ngIf",i.form.get("isOtherEmployee").value)("ngIfElse",t)}}function Et(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",32)(3,"div",20)(4,"label"),e._uU(5,"Start Date an time"),e.qZA(),e.TgZ(6,"pek-date-time-picker",33),e.NdJ("setDate",function(s){e.CHM(t);const o=e.oxw();return o.setStartValue(s),e.KtG(o.infoChangedEmit.next(!1))}),e.qZA()()(),e.TgZ(7,"div",32)(8,"div",20)(9,"label"),e._uU(10,"End Date"),e.qZA(),e.TgZ(11,"pek-date-time-picker",34),e.NdJ("setDate",function(s){e.CHM(t);const o=e.oxw();return o.setEndValue(s),e.KtG(o.infoChangedEmit.next(!1))}),e.qZA()()()()()}if(2&n){const t=e.oxw();let i,s,o,y;e.xp6(6),e.Q6J("maxDate",null==(i=t.form.get("trip_end"))?null:i.value)("date",null==(s=t.form.get("trip_start"))?null:s.value),e.xp6(5),e.Q6J("minDate",null==(o=t.form.get("trip_start"))?null:o.value)("date",null==(y=t.form.get("trip_end"))?null:y.value)}}function Zt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",19)(3,"div",20)(4,"h2")(5,"b"),e._uU(6,"Starting Point"),e.qZA()()()()(),e.TgZ(7,"pek-location-input",35),e.NdJ("countryChanged",function(s){e.CHM(t);const o=e.oxw();return o.form.get("start_location_country").setValue(s),e.KtG(o.locationChanged.next({type:o.locationStatus.FIRST,locationIndex:null}))})("addressChanged",function(s){e.CHM(t);const o=e.oxw();return o.form.get("start_location_address").setValue(s),e.KtG(o.locationChanged.next({type:o.locationStatus.FIRST,locationIndex:null}))}),e.qZA(),e.TgZ(8,"div",18)(9,"div",19)(10,"div",20)(11,"h2")(12,"b"),e._uU(13,"Arrival Point"),e.qZA()()()()(),e.TgZ(14,"pek-location-input",36),e.NdJ("meetingsChanged",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.lastPointMeetingChanged(s))})("countryChanged",function(s){e.CHM(t);const o=e.oxw();return o.form.get("last_location_country").setValue(s),e.KtG(o.locationChanged.next({type:o.locationStatus.LAST,locationIndex:null}))})("addressChanged",function(s){e.CHM(t);const o=e.oxw();return o.form.get("last_location_address").setValue(s),e.KtG(o.locationChanged.next({type:o.locationStatus.LAST,locationIndex:null}))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("country",t.form.get("start_location_country").value)("address",t.form.get("start_location_address").value)("locationId",t.form.get("start_location_id").value)("type",t.locationStatus.FIRST)("showHr",!1),e.xp6(7),e.Q6J("country",t.form.get("last_location_country").value)("address",t.form.get("last_location_address").value)("locationId",t.form.get("last_location_id").value)("type",t.locationStatus.LAST)("showHr",!1)("companiesFilters",t.companiesFilters)("showAddMeetings",!0)}}function It(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"pek-location-input",38),e.NdJ("emitDeletePoint",function(){const s=e.CHM(t),o=s.$implicit,y=s.index,Z=e.oxw(2);return e.KtG(Z.removePoint(o,y))})("meetingsChanged",function(s){const y=e.CHM(t).$implicit,Z=e.oxw(2);return e.KtG(Z.meetingChanged(y,s))})("countryChanged",function(s){const o=e.CHM(t),y=o.$implicit,Z=o.index,U=e.oxw(2);return y.get("country").setValue(s),e.KtG(U.locationChanged.next({type:U.locationStatus.INTERMEDIATE,locationIndex:Z}))})("addressChanged",function(s){const o=e.CHM(t),y=o.$implicit,Z=o.index,U=e.oxw(2);return y.get("address").setValue(s),e.KtG(U.locationChanged.next({type:U.locationStatus.INTERMEDIATE,locationIndex:Z}))}),e.qZA()}if(2&n){const t=l.$implicit,i=l.last,s=e.oxw(2);e.ekj("last",i),e.Q6J("country",t.get("country").value)("address",t.get("address").value)("locationId",t.get("id").value)("showHr",!i)("showDelete",!0)("companiesFilters",s.companiesFilters)("type",s.locationStatus.INTERMEDIATE)("showAddMeetings",!0)}}function At(n,l){1&n&&(e.TgZ(0,"div",39)(1,"h2"),e._uU(2," No Intermediate Points "),e.qZA()())}function Mt(n,l){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,It,1,10,"pek-location-input",37),e.YNc(2,At,3,0,"div",16),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t._intermediatePoints),e.xp6(1),e.Q6J("ngIf",0===t._intermediatePoints.length)}}function wt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",19)(3,"div",20)(4,"label"),e._uU(5,"Purpose short"),e.qZA(),e.TgZ(6,"input",40),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.infoChangedEmit.next(!1))}),e.qZA()()()(),e.TgZ(7,"div",18)(8,"div",19)(9,"div",20)(10,"label"),e._uU(11,"Purpose Description"),e.qZA(),e.TgZ(12,"textarea",41),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.infoChangedEmit.next(!1))}),e.qZA()()()()()}}function St(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"pek-hotels-list",42,43),e.NdJ("currentBusinessTripHotels",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.updateHotels(s))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("businessTripId",t.tripId)}}function kt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",24)(1,"div",20)(2,"label"),e._uU(3,"Vehicle Model"),e.qZA(),e.TgZ(4,"input",47),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.vehicleChangedEmit.next())}),e.qZA()()(),e.TgZ(5,"div",24)(6,"div",20)(7,"label"),e._uU(8,"Vehicle Registration Plate"),e.qZA(),e.TgZ(9,"input",48),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.vehicleChangedEmit.next())}),e.qZA()()()}}function Pt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",49)(1,"div",20)(2,"label"),e._uU(3,"Vehicle"),e.qZA(),e.TgZ(4,"pek-vehicle-picker",50),e.NdJ("valueChange",function(s){e.CHM(t);const o=e.oxw(2);return o._vehicle.setValue(s),e.KtG(o.vehicleChangedEmit.next())}),e.qZA()()(),e.TgZ(5,"div",49)(6,"div",20)(7,"label"),e._uU(8,"Vehicle Registration Plate"),e.qZA(),e._UZ(9,"input",51),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("placeholder","Vehicle Model")("vehicle",t._vehicle.get("id").value),e.xp6(5),e.uIk("disabled",!0)}}function Ut(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",18)(1,"div",32)(2,"div",20)(3,"label"),e._uU(4,"Start Mileage"),e.qZA(),e.TgZ(5,"input",52),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.vehicleChangedEmit.next())}),e.qZA()()(),e.TgZ(6,"div",32)(7,"div",20)(8,"label"),e._uU(9,"End Mileage"),e.qZA(),e.TgZ(10,"input",53),e.NdJ("ngModelChange",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.vehicleChangedEmit.next())}),e.qZA()()()()}}function Ft(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"a",64),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.viewFile())}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("href",t.form.get("start_mileage_file").value,e.LSH),e.xp6(1),e.hij(" ",t.getName(t.form.get("start_mileage_file").value)," ")}}function Bt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.removeMileageFile("start_mileage_file"))}),e._UZ(1,"i",66),e._uU(2," Remove File "),e.qZA()}}function Ht(n,l){if(1&n&&(e.TgZ(0,"a",67),e._uU(1),e.qZA()),2&n){const t=e.oxw(3);e.Q6J("href",t.form.get("end_mileage_file").value,e.LSH),e.xp6(1),e.hij(" ",t.getName(t.form.get("end_mileage_file").value)," ")}}function Vt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.removeMileageFile("end_mileage_file"))}),e._UZ(1,"i",66),e._uU(2," Remove File "),e.qZA()}}function Nt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",18)(1,"div",32)(2,"div",54)(3,"label",55)(4,"input",56,57),e.NdJ("input",function(s){e.CHM(t);const o=e.oxw(2);return e.KtG(o.imageManipulation(s,s.target,"start_mileage_file"))}),e.qZA(),e.TgZ(6,"span"),e._UZ(7,"i",58),e._uU(8,"Choose File"),e.qZA()(),e.TgZ(9,"span"),e.YNc(10,Ft,2,2,"a",59),e.YNc(11,Bt,3,0,"button",60),e.qZA()()(),e.TgZ(12,"div",32)(13,"div",54)(14,"label",61)(15,"input",62,57),e.NdJ("input",function(s){e.CHM(t);const o=e.oxw(2);return e.KtG(o.imageManipulation(s,s.target,"end_mileage_file"))}),e.qZA(),e.TgZ(17,"span"),e._UZ(18,"i",58),e._uU(19,"Choose File"),e.qZA()(),e.TgZ(20,"span"),e.YNc(21,Ht,2,2,"a",63),e.YNc(22,Vt,3,0,"button",60),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(10),e.Q6J("ngIf",t.form.get("start_mileage_file").value),e.xp6(1),e.Q6J("ngIf",t.form.get("start_mileage_file").value),e.xp6(10),e.Q6J("ngIf",t.form.get("end_mileage_file").value),e.xp6(1),e.Q6J("ngIf",t.form.get("end_mileage_file").value)}}function Ot(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",24)(3,"div",20)(4,"label"),e._uU(5,"Vehicle Type"),e.qZA(),e.TgZ(6,"pek-vehicle-type-picker",44),e.NdJ("valueChange",function(s){e.CHM(t);const o=e.oxw();return o.changedVehicleType(s),e.KtG(o.vehicleChangedEmit.next())}),e.qZA()()(),e.YNc(7,kt,10,0,"ng-template",45),e.YNc(8,Pt,10,3,"ng-template",45),e.YNc(9,Ut,11,0,"div",46),e.YNc(10,Nt,23,4,"ng-template",45),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(6),e.Q6J("type",t.form.get("vehicle_type").value),e.xp6(1),e.Q6J("ngIf",t.form.get("vehicle_type").value===t.BusinessTripVehicleType.PRIVATE||t.form.get("vehicle_type").value===t.BusinessTripVehicleType.RENT),e.xp6(1),e.Q6J("ngIf",t.form.get("vehicle_type").value===t.BusinessTripVehicleType.COMPANY_CAR),e.xp6(1),e.Q6J("ngIf",t.form.get("vehicle_type").value!==t.BusinessTripVehicleType.WITHOUT),e.xp6(1),e.Q6J("ngIf",t.form.get("vehicle_type").value!==t.BusinessTripVehicleType.WITHOUT)}}function Dt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",18)(2,"div",19)(3,"div",20)(4,"label"),e._uU(5,"Initiator"),e.qZA(),e.TgZ(6,"pek-crm-single-employee-picker",68),e.NdJ("valueChange",function(s){e.CHM(t);const o=e.oxw();return o.form.get("initiator").setValue(s.id),e.KtG(o.infoChangedEmit.next(!1))}),e.qZA()()()()()}if(2&n){const t=e.oxw();e.xp6(6),e.Q6J("employee",t.form.get("initiator").value)}}function Jt(n,l){1&n&&(e.TgZ(0,"div",39)(1,"h2"),e._uU(2," No Evidences "),e.qZA()())}function Lt(n,l){1&n&&(e.TgZ(0,"div",69),e._UZ(1,"i",70),e.qZA())}let de=(()=>{class n{constructor(t,i,s,o,y,Z,U,D,S,L,ne,he,yn,xn){this.crmEmployeeService=t,this.fb=i,this.businessService=s,this.modalService=o,this.adapterService=y,this.businessTripVehicleService=Z,this.route=U,this.messageService=D,this.employeePositionService=S,this.vehicleService=L,this.companiesService=ne,this.expenseService=he,this.businessLocationService=yn,this.businessTripHotelFilesService=xn,this.tripExpenses=[],this.tripHotels=[],this.tripStatuses=g,this.endDate=null,this.startDate=null,this.locationStatus=K.$,this.hotelEndDate=null,this.hotelStartDate=null,this.isExpensesRefreshing=!1,this.formData=new FormData,this.isDataPrepared=!1,this.hotelFilesToDeleteIds=[],this.pointsToDeleteIds=[],this.expensesToDeleteIds=[],this.employeeFilter=[{name:"by_user_trip_permissions",value:!0}],this.isVerify=!1,this.isExportView=!1,this.BusinessTripVehicleType=W.a,this.menuItems=[{label:"Selected Hotel Files",items:[{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteFile()}]}],this.locationChanged=new G.x,this.employeeChangedEmit=new G.x,this.infoChangedEmit=new G.x,this.hotelChanged=new G.x,this.vehicleChangedEmit=new G.x,this.showFilePicker=!0,this.destroy$=new G.x,this.link=I.N.image_path,this.route.data.subscribe(se=>{this.isVerify=se.isVerify}),this.route.paramMap.pipe((0,_.U)(se=>Number(se.get("tripId")))).pipe((0,M.R)(this.destroy$)).subscribe(se=>{this.tripId=se,this.getBusinessTrip(this.tripId)}),this.employeeChangedEmit.pipe((0,ie.b)(400),(0,M.R)(this.destroy$)).subscribe(()=>{this.employeeUpdate(),this.infoChangedEmit.next(!1)}),this.infoChangedEmit.pipe((0,ie.b)(400),(0,M.R)(this.destroy$)).subscribe(se=>{this.isDataPrepared&&this.infoChanged(se)}),this.hotelChanged.pipe((0,ie.b)(1e3),(0,M.R)(this.destroy$)).subscribe(()=>{this.updateHotelInfo(),this.infoChangedEmit.next(!1)}),this.vehicleChangedEmit.pipe((0,ie.b)(1e3),(0,M.R)(this.destroy$)).subscribe(()=>{this.vehicleUpdate(),this.infoChangedEmit.next(!1)})}ngOnInit(){this.loadCompanies(),this.locationChanged.pipe((0,ie.b)(1e3),(0,M.R)(this.destroy$)).subscribe(t=>{this.isDataPrepared&&this.updateLocationDefault(t.type,t.locationIndex)})}getBusinessTripVehicle(){this.businessTripVehicleService.get([{name:"business_trip",value:this.tripId}]).subscribe(t=>{if(t.length>0){if(this.form.get("business_trip_vehicle_id").setValue(t[0].id),this.form.get("vehicle_type").setValue(t[0].vehicle_type),this.form.get("start_mileage").setValue(t[0].start_mileage),this.form.get("end_mileage").setValue(t[0].end_mileage),this.form.get("end_mileage").setValue(t[0].end_mileage),this.form.get("start_mileage_file").setValue(t[0].start_mileage_file),this.form.get("end_mileage_file").setValue(t[0].end_mileage_file),t[0].custom_vehicle){const i=t[0].custom_vehicle;this.form.get("isOtherVehicle").setValue(!0),this.form.get("vehicle_model").setValue(i.model),this.form.get("vehicle_number").setValue(i.number),this.form.get("vehicle_id").setValue(i.id)}t[0].vehicle&&(this.form.get("isOtherVehicle").setValue(!1),this.form.get("vehicle").setValue(t[0].vehicle))}})}loadCompanies(){this.companiesService.get([{name:"by_user",value:!0}]).pipe((0,M.R)(this.destroy$)).subscribe(t=>{this.companiesFilters=t})}prepareForm(){return this.fb.group({isOtherEmployee:[!1],employee:this.fb.group({id:[null],first_name:[null],last_name:[null],position:[null]}),employee_first_name:[""],employee_last_name:[""],employee_position:[null],employee_id:[null],initiator:[null],trip_start:[null],trip_end:[null],start_location_id:[null],start_location_country:[null],start_location_address:[null],last_location_id:[null],vehicle_type:[W.a.WITHOUT],business_trip_vehicle_id:[null],last_location_country:[null],last_location_address:[null],last_location_meetings:this.fb.array([]),intermediatePoints:this.fb.array([]),purpose_short:[""],purpose_full:[""],isOtherVehicle:[!1],vehicle:this.fb.group({id:[null],model:[null],number:[null]}),vehicle_model:[""],vehicle_number:[""],start_mileage:[0],end_mileage:[0],start_mileage_file:[""],end_mileage_file:[""],vehicle_id:[null],showHotel:[!1],expenses:this.fb.array([]),hotels:this.fb.array([]),hotel:this.fb.group({id:[null],residence_start:[null],residence_end:[null],files:[null],hotel_name:[null],hotel_country:[null],hotel_address:[null],base64Files:this.fb.array([])})})}getBusinessTrip(t){this.form=this.prepareForm(),this.businessService.getDetailed(t).pipe((0,M.R)(this.destroy$)).subscribe(i=>{if(this.businessTrip=i,this.businessTrip.custom_employee){const s=this.businessTrip.custom_employee;this.form.get("isOtherEmployee").setValue(!0),this.form.get("employee_first_name").setValue(s.first_name),this.form.get("employee_last_name").setValue(s.last_name),s.position&&this.form.get("employee_position").setValue(s.position.id),this.form.get("employee_id").setValue(s.id)}if(this.businessTrip.employee){const s=this.businessTrip.employee;this.form.get("employee").setValue(s)}this.businessTrip.trip_end&&this.form.get("trip_end").setValue(new Date(this.businessTrip.trip_end)),this.businessTrip.trip_start&&this.form.get("trip_start").setValue(new Date(this.businessTrip.trip_start)),this.form.get("purpose_full").setValue(this.businessTrip.purpose_full),this.form.get("purpose_short").setValue(this.businessTrip.purpose_short),this.businessTrip.locations.forEach(s=>{s.type===K.$.FIRST&&(this.form.get("start_location_country").setValue(s.country),this.form.get("start_location_address").setValue(s.address),this.form.get("start_location_id").setValue(s.id)),s.type===K.$.LAST&&(this.form.get("last_location_country").setValue(s.country),this.form.get("last_location_address").setValue(s.address),this.form.get("last_location_id").setValue(s.id),s.location_meetings.forEach(o=>{this.form.get("last_location_meetings").push(this.fb.group({id:o.id,location_id:o.location_id,company:o.company,contacts:this.fb.array(o.contacts)}))},{emitEvent:!1})),s.type===K.$.INTERMEDIATE&&this.form.get("intermediatePoints").push(this.fb.group({id:s.id,country:s.country,address:s.address,location_meetings:this.fb.array(s.location_meetings)}))}),this.form.get("initiator").setValue(this.businessTrip.initiator),this.getBusinessTripVehicle(),this.isDataPrepared=!0})}updateExpenses(t){t&&t.length>0&&(this.form.removeControl("expenses"),this.form.addControl("expenses",this.fb.array([])),t.forEach(i=>{let s={id:null,name:null,description:null},o={id:null,name:null,description:null};i.expense&&(s=i.expense),i.custom_expense&&(o=i.custom_expense),this.form.get("expenses").push(this.fb.group({base64File:null,currency:i.currency,custom_expense:o,expense:s,id:i.id,sum:i.sum,isOther:!!o.id,is_verified:i.is_verified,type:i.type,file:i.file,uploaded_file:null,clear_file:!1}))}),this.tripExpenses=[],this.form.get("expenses").controls.forEach(i=>{this.tripExpenses.push(i.value)}))}updateHotels(t){t.length>0&&(this.form.get("showHotel").setValue(!0),this.form.removeControl("hotels"),this.form.addControl("hotels",this.fb.array([])),t.forEach(i=>{this.form.get("hotels").push(this.fb.group({id:i.id,residence_start:i.residence_start?new Date(i.residence_start):null,residence_end:i.residence_end?new Date(i.residence_end):null,files:[],hotel_name:i.name,hotel_country:i.country,hotel_address:i.address,base64Files:this.fb.array([])}))}),this.tripHotels=[],this.form.get("hotels").controls.forEach(i=>{this.tripHotels.push(i.value)}))}setStartValue(t){t&&(this.form.get("trip_start").patchValue(t),this.startDate=t,this.form.get("trip_end").value&&this.form.get("trip_end").value<this.form.get("trip_start").value&&this.setEndValue(this.form.get("trip_end").value))}setEndValue(t){t&&(this.form.get("trip_end").patchValue(t),this.endDate=t)}addIntermediatePoint(){this.form.get("intermediatePoints").push(this.fb.group({id:[],country:[],address:[],location_meetings:this.fb.array([])}))}get _intermediatePoints(){return this.form.get("intermediatePoints").controls}removePoint(t,i){t.value.id?this.businessLocationService.delete(t.value).pipe((0,M.R)(this.destroy$)).subscribe(()=>{this.form.get("intermediatePoints").removeAt(i)}):this.form.get("intermediatePoints").removeAt(i)}get _hotel(){return this.form.get("hotel")}editTripExpense(t){const i=this.form.get("expenses").controls[t].value;this.expenseService.createChangeExpanseItem(i,this.isVerify).pipe((0,m.q)(1),(0,M.R)(this.destroy$)).subscribe(s=>{s&&(this.form.get("expenses").controls[t].setValue(s.value),this.tripExpenses=[],this.form.get("expenses").controls.forEach(o=>{this.tripExpenses.push(o.value)}))})}setHotelEndValue(t){t&&(this._hotel.get("residence_end").patchValue(t),this.hotelEndDate=t)}get _employee(){return this.form.get("employee")}get _vehicle(){return this.form.get("vehicle")}editBusinessTrip(t){if(this.form.valid){if(this.form.valid){const i=this.prepareDataToSend(t),s=this.obj2FormData(i);this.businessService.update(this.tripId,s).pipe((0,m.q)(1),(0,M.R)(this.destroy$)).subscribe(o=>{this.isDataPrepared=!1,this.form.reset(),this.hotelFilesToDeleteIds=[],this.preparedFiles=[],this.selectedHotelFile=null,this.businessTrip=null,this.tripExpenses=[],this.getBusinessTrip(this.tripId)})}}else this.messageService.add({severity:"error",summary:"Validation Error",detail:"Fill all required field"})}prepareDataToSend(t,i=!1){const s=[];let o;o=i?(0,_e.p$)(this.form.value):this.form.value,o.start_location_country&&s.push({id:o.start_location_id,type:K.$.FIRST,address:o.start_location_address,fullCountry:o.start_location_country,country:o.start_location_country?.code}),o.last_location_country&&s.push({id:o.last_location_id,type:K.$.LAST,address:o.last_location_address,fullCountry:o.last_location_country,country:o.last_location_country?.code,location_meetings:o.last_location_meetings});const y=o.intermediatePoints;y.forEach(S=>{S.type=K.$.INTERMEDIATE,S.fullCountry=S.country,S.country=S.country?.code}),s.push(...y),s.forEach(S=>{S.location_meetings&&S.location_meetings.forEach(L=>{L.fullCompany=L.company,L.fullContacts=L.contacts,L.company=L.company?.id,L.contacts=L.contacts.map(ne=>ne.id)})});const Z=o.trip_start?this.adapterService.dateTimeAdapter(new Date(o.trip_start)):null,U=o.trip_end?this.adapterService.dateTimeAdapter(new Date(o.trip_end)):null,D={initiator:o.initiator,locations:s,purpose_full:o.purpose_full?o.purpose_full:null,purpose_short:o.purpose_short?o.purpose_short:null,vehicle_type:o.vehicle_type,trip_end:U||null,trip_start:Z||null,expenses:[],hotels:[],start_mileage:o.start_mileage,end_mileage:o.end_mileage,status:t};return o.hotels.forEach(S=>{if(S.hotel_name){const L=S.residence_start?this.adapterService.dateAdapter(new Date(S.residence_start)):null,ne=S.residence_end?this.adapterService.dateAdapter(new Date(S.residence_end)):null,he={residence_start:L?new Date(S.residence_start):null,residence_end:ne?new Date(S.residence_end):null,address:S.hotel_address,country:S.hotel_country.code,fullCountry:S.hotel_country,name:S.hotel_name,id:S.id,files:S.files};D.hotels.push(he)}}),o.employee.id?(D.employee=o.employee.id,D.full_employee=o.employee):(D.custom_employee={id:o.employee_id,first_name:o.employee_first_name,last_name:o.employee_last_name,position:o.employee_position},D.full_employee=D.custom_employee),o.vehicle_type!==W.a.WITHOUT?o.vehicle.id&&o.vehicle_type===W.a.COMPANY_CAR?D.vehicle=o.vehicle.id:o.vehicle_type!==W.a.PRIVATE&&o.vehicle_type!==W.a.RENT||!o.vehicle_model?(D.vehicle=null,D.custom_vehicle=null):D.custom_vehicle={id:o.vehicle_id,model:o.vehicle_model,number:o.vehicle_number}:(D.vehicle=null,D.custom_vehicle=null),o.expenses&&o.expenses.forEach(S=>{const L={currency:S.currency,id:S.id,sum:S.sum,is_verified:S.is_verified,clear_file:S.clear_file,type:S.type};S.expense.name&&(L.expense=S.expense.id,L.currency=S.currency.code,L.fullExpense=S.expense),S.custom_expense.name&&(L.custom_expense=S.custom_expense,L.currency=S.currency.code,L.fullExpense=S.custom_expense),S.base64File&&(L.file=S.uploaded_file),D.expenses.push(L)}),D.delete_hotel_files_ids=this.hotelFilesToDeleteIds,D.delete_location_ids=this.pointsToDeleteIds,D.delete_expenses_ids=this.expensesToDeleteIds,D}employeeUpdate(){const t={};if(this.form.value.employee.id)t.employee=this.form.value.employee.id,t.custom_employee=null;else{const o=this.form.value.employee_last_name;if(!this.form.value.employee_first_name||!o)return;t.custom_employee={id:this.form.value.employee_id,first_name:this.form.value.employee_first_name,last_name:this.form.value.employee_last_name,position:this.form.value.employee_position||null},t.employee=null}this.businessService.updateBusinessTripEmployee(this.tripId,t).pipe((0,m.q)(1),(0,M.R)(this.destroy$)).subscribe(i=>{if(i.custom_employee){const s=i.custom_employee;s.position&&this.form.get("employee_position").setValue(s.position.id),this.form.get("employee_id").setValue(s.id)}if(i.employee){const s=i.employee;this.form.get("employee").setValue(s)}})}vehicleUpdate(){const t={},i=this.form.value;if(t.vehicle_type=i.vehicle_type,t.business_trip=this.tripId,t.start_mileage=i.start_mileage,t.end_mileage=i.end_mileage,i.vehicle_type!==W.a.WITHOUT)if(i.vehicle.id&&i.vehicle_type===W.a.COMPANY_CAR)t.vehicle=i.vehicle.id,t.custom_vehicle=null;else if(i.vehicle_type!==W.a.PRIVATE&&i.vehicle_type!==W.a.RENT||!i.vehicle_model)t.vehicle=null,t.custom_vehicle=null;else{const o=i.vehicle_model,y=i.vehicle_number;if(!o||!y)return;t.custom_vehicle={id:i.vehicle_id,model:o,number:y},t.vehicle=null}else t.vehicle=null,t.custom_vehicle=null;const s=this.form.get("business_trip_vehicle_id").value;this.businessTripVehicleService.update_vehicle(s,t).subscribe(o=>{this.form.get("business_trip_vehicle_id").setValue(o.data.id)})}obj2FormData(t,i=new FormData){return this.formData=i,this.createFormData(t),this.formData}createFormData(t,i=""){for(const s in t){const o=t[s],y=i?i+"["+s+"]":s;"string"==typeof o||"number"==typeof o||"boolean"==typeof o?this.formData.append(y,o):"object"==typeof o&&(o instanceof File?this.formData.append(y,o):this.createFormData(o,y))}}employeeChanged(){this.form.get("employee").reset(),this.form.get("employee_first_name").reset(),this.form.get("employee_last_name").reset(),this.form.get("employee_position").reset()}vehicleChanged(){this.form.get("vehicle").reset(),this.form.get("vehicle_model").reset(),this.form.get("vehicle_number").reset()}filesChanged(t){t.length>0&&(this._hotel.get("files").setValue(t),setTimeout(()=>{this.updateFiles()},1e3))}fileToBase64(t){const i=new FileReader;i.onload=s=>{const o=s.target.result;this._hotel.get("base64Files").push(this.fb.group({file:o}))},i.readAsDataURL(t)}deleteFile(){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&this.businessTripHotelFilesService.delete(this.selectedHotelFile).pipe((0,M.R)(this.destroy$)).subscribe(()=>{this.selectedHotelFile=null,this.loadHotelFiles(this._hotel.get("id").value)})})}downloadHotelFile(t){this.businessService.download_hotel_file(t.id).pipe((0,M.R)(this.destroy$)).subscribe(i=>{const s=this.getName(t.file);this.adapterService.downloadFile(s,i)})}getName(t){const i=t.split("/");return i[i.length-1]}deleteExpense(t){const i=this.tripExpenses.findIndex(s=>s===t);i>-1&&(this.tripExpenses[i].id&&this.expensesToDeleteIds.push(this.tripExpenses[i].id),this.tripExpenses.splice(i,1),this.form.get("expenses").removeAt(i))}loadEmployeePositionData(t){if(t.custom_employee){let i;return i=t.custom_employee.position,i?this.employeePositionService.getById(i).pipe((0,_.U)(s=>(t.fullPosition=s,t))):(0,ce.of)(t)}return t.full_employee.position&&(t.fullPosition=t.full_employee.position),(0,ce.of)(t)}loadInitiatorData(t){const i=t.initiator;return i?this.crmEmployeeService.getById(i).pipe((0,_.U)(s=>(t.fullInitiator=s,t))):(0,ce.of)(t)}loadVehicleData(t){return t.vehicle?this.vehicleService.getById(t.vehicle).pipe((0,_.U)(s=>(t.fullVehicle=s,t))):(t.custom_vehicle&&(t.fullVehicle=t.custom_vehicle),(0,ce.of)(t))}export(){const t=this.prepareDataToSend(this.businessTrip.status,!0);this.loadEmployeePositionData(t).pipe((0,V.w)(i=>this.loadInitiatorData(i)),(0,V.w)(i=>this.loadVehicleData(i))).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.businessService.exportToExcel(i).then()})}meetingChanged(t,i){}lastPointMeetingChanged(t){}changedVehicleType(t){this.form.get("vehicle_type").setValue(t)}viewHotelFiles(){const t=this.form.get("hotel").value;this.businessService.viewBusinessTripFiles({links:this.preparedFiles,files:t.base64Files})}updateLocationDefault(t,i){let s,o,y,Z;if(t===K.$.FIRST){if(s=this.form.get("start_location_country").value?.code,o=this.form.get("start_location_address").value,!s||!o)return;y=this.form.get("start_location_id").value,Z={id:y,country:s,address:o,type:t,business_trip_id:this.businessTrip.id}}else if(t===K.$.LAST){if(s=this.form.get("last_location_country").value.code,o=this.form.get("last_location_address").value,y=this.form.get("last_location_id").value,!s||!o)return;Z={id:y,country:s,address:o,business_trip_id:this.businessTrip.id,type:t}}else{const U=this.form.get("intermediatePoints").value.at(i);if(s=U.country?.code,o=U.address,y=U.id,!s||!o)return;Z={id:y,country:s,address:o,business_trip_id:this.businessTrip.id,type:t}}Z.id?this.businessLocationService.update(Z.id,Z).subscribe(U=>{t===K.$.FIRST&&(this.form.get("start_location_country").setValue(U.data.country),this.form.get("start_location_address").setValue(U.data.address),this.form.get("start_location_id").setValue(U.data.id)),t===K.$.LAST&&(this.form.get("last_location_country").setValue(U.data.country),this.form.get("last_location_address").setValue(U.data.address),this.form.get("last_location_id").setValue(U.data.id)),t===K.$.INTERMEDIATE&&this.form.get("intermediatePoints").value.at(i).patchValue(U.data)}):this.businessLocationService.create(Z).subscribe(U=>{t===K.$.FIRST&&(this.form.get("start_location_country").setValue(U.country),this.form.get("start_location_address").setValue(U.address),this.form.get("start_location_id").setValue(U.id)),t===K.$.LAST&&(this.form.get("last_location_country").setValue(U.country),this.form.get("last_location_address").setValue(U.address),this.form.get("last_location_id").setValue(U.id)),t===K.$.INTERMEDIATE&&this.form.get("intermediatePoints").at(i).patchValue(U)})}infoChanged(t=!1){const i=this.form.get("trip_start").value?this.adapterService.dateTimeAdapter(new Date(this.form.get("trip_start").value)):null,o={trip_end:(this.form.get("trip_end").value?this.adapterService.dateTimeAdapter(new Date(this.form.get("trip_end").value)):null)||null,trip_start:i||null,initiator:this.form.get("initiator").value,purpose_full:this.form.get("purpose_full").value?this.form.get("purpose_full").value:"",purpose_short:this.form.get("purpose_short").value?this.form.get("purpose_short").value:"",start_mileage:this.form.get("start_mileage").value,end_mileage:this.form.get("end_mileage").value,status:t?g.VERIFIED:g.NEED_VERIFICATION};this.businessService.update(this.tripId,o).pipe((0,m.q)(1),(0,M.R)(this.destroy$)).subscribe()}updateHotelInfo(){const t=(0,_e.p$)(this.form.value);if(t.hotel.hotel_name){const o={residence_start:(t.hotel.residence_start?this.adapterService.dateAdapter(new Date(t.hotel.residence_start)):null)||null,residence_end:(t.hotel.residence_end?this.adapterService.dateAdapter(new Date(t.hotel.residence_end)):null)||null,address:t.hotel.hotel_address,country:t.hotel.hotel_country?.code,name:t.hotel.hotel_name,id:t.hotel.id};if(!(o.residence_start&&o.residence_end&&o.address&&o.country&&o.name))return}}loadHotelFiles(t){this.businessTripHotelFilesService.get([{name:"business_trip_hotel_id",value:t}]).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.preparedFiles=i})}updateFiles(){this.showFilePicker=!1;const t=[];this._hotel.get("files").value.forEach(o=>{t.push({file:o,business_trip_id:this._hotel.get("id").value})});const i={files:this._hotel.get("files").value,id:this._hotel.get("id").value},s=this.obj2FormData(i);this.businessTripHotelFilesService.add_hotel_files(s).pipe((0,M.R)(this.destroy$)).subscribe(o=>{this.loadHotelFiles(this._hotel.get("id").value),this.filePicker.clearFiles()})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}fileAdded(t){this._hotel.get("files").setValue([t]),setTimeout(()=>{this.updateFiles()},1e3)}addHotels(){this.hotelsList.addHotel()}imageManipulation(t,i,s){const o=Array.from(i.files),y=this.form.get("business_trip_vehicle_id").value;if("start_mileage_file"===s){this.start_mileage_file=o[0];const U=this.obj2FormData({start_mileage_file:o[0]});this.businessTripVehicleService.update(y,U).subscribe(D=>{"start_mileage_file"===s&&this.form.get("start_mileage_file").setValue(D.data.start_mileage_file)})}if("end_mileage_file"===s){this.end_mileage_file=o[0];const U=this.obj2FormData({end_mileage_file:o[0]});this.businessTripVehicleService.update(y,U).subscribe(D=>{"end_mileage_file"===s&&this.form.get("end_mileage_file").setValue(D.data.end_mileage_file)})}this.vehicleChangedEmit.next()}removeMileageFile(t){let i;const s=this.form.get("business_trip_vehicle_id").value;"start_mileage_file"===t&&(i={start_mileage_file:null}),"end_mileage_file"===t&&(i={end_mileage_file:null}),this.businessTripVehicleService.update(s,i).subscribe(o=>{"start_mileage_file"===t&&this.form.get("start_mileage_file").setValue(o.data.start_mileage_file),"end_mileage_file"===t&&this.form.get("end_mileage_file").setValue(o.data.end_mileage_file)})}takePhoto(t){this.businessService.takePhotoModal().pipe((0,M.R)(this.destroy$)).subscribe(i=>{i&&this.vehicleChangedEmit.next()})}viewFile(){}getBtForExport(){this.businessService.getBtForExport([{name:"ids",value:[this.tripId]}]).subscribe(t=>{t&&this.businessService.exportToExcel(t[0]).then()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(me.R),e.Y36(d.qu),e.Y36(E.v),e.Y36(A.Z),e.Y36(B.v),e.Y36(Xe),e.Y36(F.gz),e.Y36(Q.ez),e.Y36(ge.q),e.Y36(le),e.Y36(et.J),e.Y36(oe),e.Y36(ft),e.Y36(ve))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-edit-business-trip"]],viewQuery:function(t,i){if(1&t&&(e.Gf(vt,5),e.Gf(Ct,5)),2&t){let s;e.iGM(s=e.CRH())&&(i.filePicker=s.first),e.iGM(s=e.CRH())&&(i.hotelsList=s.first)}},decls:57,vars:22,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-file-excel","label","Export to xls",1,"p-button-secondary","mr-2",3,"click"],["pButton","","type","button","icon","pi pi-plus","label","Save",3,"click"],[3,"formGroup"],[1,"page__content"],[1,"mb-4"],[1,"page__card"],[4,"ngIf","ngIfElse"],[1,"mb-4","d-flex","justify-content-between"],["pButton","","type","button","icon","pi pi-plus","label","Add Intermediate Point",3,"click"],["pButton","","type","button","icon","pi pi-plus","label","Add Hotel",3,"click"],[3,"businessTripId","isVerify","verifyBusinessTrip","currentBusinessTripExpenses","deleteExpense","editExpense","unverifyTrip","expenseSumEmit"],["class","d-flex justify-content-center",4,"ngIf"],["infoLoading",""],[1,"row"],[1,"col-12"],[1,"form-group"],["for","other"],["id","other","formControlName","isOtherEmployee",3,"binary","onChange"],["predefinedEmployee",""],[1,"col-4"],["pInputText","","formControlName","employee_first_name",1,"form-control",3,"ngModelChange"],["pInputText","","formControlName","employee_last_name",1,"form-control",3,"ngModelChange"],[3,"position","valueChange"],["formGroupName","employee"],[3,"filters","showProfession","employee","valueChange"],["pInputText","","formControlName","last_name",1,"form-control",3,"disabled"],["pInputText","","disabled","",1,"form-control",3,"ngModel","ngModelOptions"],[1,"col-6"],["placeholder","Choice Start Date and Time",3,"maxDate","date","setDate"],["placeholder","Choice End Date and Time",3,"minDate","date","setDate"],[3,"country","address","locationId","type","showHr","countryChanged","addressChanged"],[3,"country","address","locationId","type","showHr","companiesFilters","showAddMeetings","meetingsChanged","countryChanged","addressChanged"],["class","location",3,"country","address","locationId","showHr","last","showDelete","companiesFilters","type","showAddMeetings","emitDeletePoint","meetingsChanged","countryChanged","addressChanged",4,"ngFor","ngForOf"],[1,"location",3,"country","address","locationId","showHr","showDelete","companiesFilters","type","showAddMeetings","emitDeletePoint","meetingsChanged","countryChanged","addressChanged"],[1,"d-flex","justify-content-center"],["pInputText","","formControlName","purpose_short",1,"form-control",3,"ngModelChange"],["pInputTextarea","","formControlName","purpose_full","id","comment",1,"form-control",3,"ngModelChange"],[3,"businessTripId","currentBusinessTripHotels"],["hotelsList",""],[3,"type","valueChange"],[3,"ngIf"],["class","row",4,"ngIf"],["pInputText","","formControlName","vehicle_model",1,"form-control",3,"ngModelChange"],["pInputText","","formControlName","vehicle_number",1,"form-control",3,"ngModelChange"],["formGroupName","vehicle",1,"col-4"],[3,"placeholder","vehicle","valueChange"],["pInputText","","formControlName","number",1,"form-control"],["pInputText","","formControlName","start_mileage",1,"form-control",3,"ngModelChange"],["pInputText","","formControlName","end_mileage",1,"form-control",3,"ngModelChange"],[1,"form-group","vehicle-file-selector"],["for","vehicleMileageStartFile",1,"input-file","d-flex","align-items-center"],["type","file","id","vehicleMileageStartFile",3,"input"],["inputFile",""],[1,"fa","fa-download"],[3,"href","click",4,"ngIf"],["class","remove",3,"click",4,"ngIf"],["for","vehicleMileageEndFile",1,"input-file","d-flex","align-items-center"],["type","file","id","vehicleMileageEndFile",3,"input"],[3,"href",4,"ngIf"],[3,"href","click"],[1,"remove",3,"click"],[1,"pi","pi-times"],[3,"href"],[3,"employee","valueChange"],[1,"info-loading"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5,"Edit Business Trip"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return i.getBtForExport()}),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return i.editBusinessTrip(i.tripStatuses.NEED_VERIFICATION)}),e.qZA()()()(),e.TgZ(9,"form",7)(10,"div",8)(11,"h2",9),e._uU(12,"Employee"),e.qZA(),e.TgZ(13,"div",10),e.YNc(14,bt,10,3,"div",11),e.qZA()(),e.TgZ(15,"div",8)(16,"h2",9),e._uU(17,"Date Trip Start/End"),e.qZA(),e.TgZ(18,"div",10),e.YNc(19,Et,12,4,"div",11),e.qZA()(),e.TgZ(20,"div",8)(21,"h2",9),e._uU(22,"Points Start/Arrival"),e.qZA(),e.TgZ(23,"div",10),e.YNc(24,Zt,15,12,"div",11),e.qZA()(),e.TgZ(25,"div",8)(26,"h2",12),e._uU(27,"Intermediate Points "),e.TgZ(28,"button",13),e.NdJ("click",function(){return i.addIntermediatePoint()}),e.qZA()(),e.TgZ(29,"div",10),e.YNc(30,Mt,3,2,"div",11),e.qZA()(),e.TgZ(31,"div",8)(32,"h2",9),e._uU(33,"Purpose"),e.qZA(),e.TgZ(34,"div",10),e.YNc(35,wt,13,0,"div",11),e.qZA()(),e.TgZ(36,"div",8)(37,"h2",12),e._uU(38," Hotel "),e.TgZ(39,"button",14),e.NdJ("click",function(){return i.addHotels()}),e.qZA()(),e.TgZ(40,"div",10),e.YNc(41,St,3,1,"div",11),e.qZA()(),e.TgZ(42,"div",8)(43,"h2",9),e._uU(44,"Vehicle"),e.qZA(),e.TgZ(45,"div",10),e.YNc(46,Ot,11,5,"div",11),e.qZA()(),e.TgZ(47,"div",8)(48,"h2",9),e._uU(49,"Initiator"),e.qZA(),e.TgZ(50,"div",10),e.YNc(51,Dt,7,1,"div",11),e.qZA()(),e.TgZ(52,"div",8)(53,"pek-trip-expenses-table",15),e.NdJ("verifyBusinessTrip",function(){return i.infoChangedEmit.next(!0)})("currentBusinessTripExpenses",function(o){return i.updateExpenses(o)})("deleteExpense",function(o){return i.deleteExpense(o)})("editExpense",function(o){return i.editTripExpense(o)})("unverifyTrip",function(){return i.infoChangedEmit.next(!1)})("expenseSumEmit",function(o){return i.expensesSum=o}),e.qZA(),e.YNc(54,Jt,3,0,"div",16),e.qZA()(),e.YNc(55,Lt,2,0,"ng-template",null,17,e.W1O)),2&t){const s=e.MAs(56);e.xp6(3),e.Q6J("module","business-trip")("isActive",!0),e.xp6(6),e.Q6J("formGroup",i.form),e.xp6(5),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(6),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(6),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(5),e.Q6J("ngIf",i.isDataPrepared)("ngIfElse",s),e.xp6(2),e.Q6J("businessTripId",i.tripId)("isVerify",i.isVerify),e.xp6(1),e.Q6J("ngIf",0===i.tripExpenses.length)}},styles:["h2[_ngcontent-%COMP%]{font-size:1.1875rem;font-weight:600}.info-loading[_ngcontent-%COMP%]{width:100%;height:16.267rem;display:flex;align-items:center;justify-content:center}.icons[_ngcontent-%COMP%]{position:relative;top:1px}.location[_ngcontent-%COMP%]{display:block;margin-bottom:1rem}.location.last[_ngcontent-%COMP%]{margin-bottom:0}.input-file[_ngcontent-%COMP%]{cursor:pointer;margin-top:10px;width:-moz-fit-content;width:fit-content}.input-file[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0;overflow:hidden}.input-file[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:inline-block;margin-right:5px;color:#002e72}.input-file[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;font-weight:500;color:#002e72}.input-file[_ngcontent-%COMP%]:hover   span[_ngcontent-%COMP%]{text-decoration:underline}.delete-image[_ngcontent-%COMP%]{background:transparent;border:none;color:#dc3545;padding:0;position:relative;top:2px}.delete-image[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px;font-size:16px;position:relative;top:1px}.delete-image[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;font-size:16px}.delete-image[_ngcontent-%COMP%]:hover{text-decoration:underline}.remove[_ngcontent-%COMP%]{cursor:pointer;font:inherit;right:-15.375rem;bottom:.25rem;font-weight:500;padding:.375rem 1.125rem;color:var(--theme-color-danger);border-radius:.625rem;width:9.875rem;background:rgba(255,237,237,.4588235294);margin-left:.5rem}.remove[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:relative;top:1px;margin-right:.5rem}.vehicle-file-selector[_ngcontent-%COMP%]{display:flex;flex-direction:revert;align-items:center;justify-content:space-between}"]}),n})();const qt=["paginator"];function Rt(n,l){1&n&&(e.TgZ(0,"p",23),e._uU(1,"Choose the Vehicle to edit"),e.qZA())}function Yt(n,l){1&n&&(e.TgZ(0,"colgroup"),e._UZ(1,"col",24),e.qZA())}function Qt(n,l){1&n&&(e.TgZ(0,"tr")(1,"th",24),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Model"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Vehicle Registration Plate"),e.qZA()())}function Gt(n,l){if(1&n&&(e.TgZ(0,"tr",25)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&n){const t=l.$implicit,i=l.rowIndex,s=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(10*(s.searchForm.get("page").value-1)+i+1),e.xp6(2),e.Oqu(t.model),e.xp6(2),e.Oqu(t.number)}}function Kt(n,l){1&n&&(e.TgZ(0,"tr")(1,"td",26)(2,"span"),e._uU(3,"No Records Found"),e.qZA()()()),2&n&&(e.xp6(1),e.uIk("colspan",3))}function $t(n,l){1&n&&(e.TgZ(0,"div",27),e._UZ(1,"i",28),e.qZA())}function jt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",29)(1,"p-paginator",30,31),e.NdJ("onPageChange",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.paginate(s))}),e.qZA(),e.TgZ(3,"p-button",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowAll())}),e._uU(4," All "),e.qZA()()}if(2&n){const t=e.oxw();e.ekj("paginator-wrapper_hide",0===t.vehicles.length),e.xp6(1),e.Q6J("rows",10)("totalRecords",t.count)}}function Wt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",33)(1,"p-button",34),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowPartial())}),e._uU(2," Return pagination "),e.qZA()()}}const Xt=["paginator"];function ei(n,l){1&n&&(e.TgZ(0,"p",22),e._uU(1,"Choose the Expense to edit"),e.qZA())}function ti(n,l){1&n&&(e.TgZ(0,"tr")(1,"th",23),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th",24),e._uU(4,"Name"),e.qZA(),e.TgZ(5,"th",25),e._uU(6,"Description"),e.qZA()())}function ii(n,l){if(1&n&&(e.TgZ(0,"tr",26)(1,"td",23),e._uU(2),e.qZA(),e.TgZ(3,"td",24),e._uU(4),e.qZA(),e.TgZ(5,"td",25),e._uU(6),e.qZA()()),2&n){const t=l.$implicit,i=l.rowIndex,s=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(10*(s.searchForm.get("page").value-1)+i+1),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function ni(n,l){1&n&&e._UZ(0,"i",30)}function si(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function oi(n,l){if(1&n&&(e.TgZ(0,"tr")(1,"td",27),e.YNc(2,ni,1,0,"i",28),e.YNc(3,si,2,0,"span",29),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.uIk("colspan",6),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function ri(n,l){1&n&&(e.TgZ(0,"div",31),e._UZ(1,"i",30),e.qZA())}function li(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",32)(1,"p-paginator",33,34),e.NdJ("onPageChange",function(s){e.CHM(t);const o=e.oxw();return e.KtG(o.paginate(s))}),e.qZA(),e.TgZ(3,"p-button",35),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowAll())}),e._uU(4," All "),e.qZA()()}if(2&n){const t=e.oxw();e.ekj("paginator-wrapper_hide",0===t.expenses.length),e.xp6(1),e.Q6J("rows",10)("totalRecords",t.count)}}function ai(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",36)(1,"p-button",37),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onShowPartial())}),e._uU(2," Return pagination "),e.qZA()()}}function pi(n,l){if(1&n&&(e.TgZ(0,"div",38),e._UZ(1,"p-menubar",11),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.ekj("disabled",!t.selectedExpense),e.Q6J("model",t.menuItems)}}const ci=[{path:"",component:H,children:[{path:"trips",title:"Business Trips",component:te},{path:"trip/edit/:tripId",data:{isVerify:!1},title:"Edit Business Trip",component:de},{path:"trip/verify/:tripId",data:{isVerify:!0},title:"Verify Business Trip",component:de},{path:"vehicles",title:"Business Trip Vehicles",component:(()=>{class n{constructor(t,i,s){this.vehicleService=t,this.modalService=i,this.fb=s,this.isLoading=!0,this.vehicles=[],this.searchForm=this.fb.group({page:[1]}),this.query=[{name:"paginated",value:!0},{name:"page",value:this.searchForm.get("page").value}],this.menuItems=[{label:"Selected Vehicle",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.editVehicle()},{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteVehicle()}]}],this.count=0,this.isShowAll=!1,this.isStartOnePage=!1,this.searchVehicles()}ngOnInit(){}prepareQuery(){this.query=[],this.isShowAll||(this.query=[{name:"paginated",value:"true"},{name:"page",value:this.searchForm.get("page").value}])}searchVehicles(){this.prepareQuery(),this.isShowAll?(this.searchForm.get("page").patchValue(1),this.getAll()):this.getPaginated()}getPaginated(){this.isLoading=!0,this.vehicleService.getPaginated(this.query).pipe((0,m.q)(1)).subscribe(t=>{this.vehicles=t.results,this.count=t.count,this.selectedVehicle=null,this.isLoading=!1})}getAll(){this.isLoading=!0,this.vehicleService.get().pipe((0,m.q)(1)).subscribe(t=>{this.vehicles=t,this.selectedVehicle=null,this.isLoading=!1,this.isStartOnePage&&this.paginator?.changePage(0)})}addVehicle(){this.vehicleService.createChangeVehicle().pipe((0,m.q)(1)).subscribe(t=>{t&&this.getAll()})}editVehicle(){this.vehicleService.createChangeVehicle(this.selectedVehicle).pipe((0,m.q)(1)).subscribe(t=>{t&&this.getAll()})}deleteVehicle(){this.modalService.confirm("danger","Confirm").pipe((0,m.q)(1)).subscribe(t=>{t&&this.vehicleService.delete(this.selectedVehicle).pipe((0,m.q)(1)).subscribe(i=>{this.getAll()})})}paginate(t){this.isStartOnePage||(this.searchForm.get("page").patchValue(t.page+1),this.searchVehicles())}onShowAll(){this.isShowAll=!0,this.searchVehicles()}onShowPartial(){this.isShowAll=!1,this.searchVehicles()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(le),e.Y36(A.Z),e.Y36(d.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-vehicles"]],viewQuery:function(t,i){if(1&t&&e.Gf(qt,5),2&t){let s;e.iGM(s=e.CRH())&&(i.paginator=s.first)}},decls:25,vars:13,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","Add Vehicle",3,"click"],[1,"page__content"],[1,"page__card"],[1,"filters-visibility"],[1,"d-flex","align-items-center"],["class","mt-0 mb-0 subtitle",4,"ngIf"],[1,"ml-auto","mr-2",3,"model"],[1,"page__table"],[1,"table-pagination-preloader"],["selectionMode","single","scrollHeight","calc(100vh - 335px)",3,"rows","selection","scrollable","value","selectionChange"],["dt",""],["pTemplate","colgroup"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","pagination-preloader pagination-preloader_bord",4,"ngIf"],["class","paginator-wrapper",3,"paginator-wrapper_hide",4,"ngIf"],["class","paginator-return-pagination",4,"ngIf"],[1,"mt-0","mb-0","subtitle"],[1,"index-header"],[3,"pSelectableRow"],[1,"text-center","p-5"],[1,"pagination-preloader","pagination-preloader_bord"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"paginator-wrapper"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["type","button","styleClass","p-button-text",1,"paginator-all",3,"click"],[1,"paginator-return-pagination"],["type","button","styleClass","p-button-text",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5,"Vehicles"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return i.addVehicle()}),e.qZA()()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),e.YNc(12,Rt,2,0,"p",10),e._UZ(13,"p-menubar",11),e.qZA()(),e.TgZ(14,"div",12)(15,"div",13)(16,"p-table",14,15),e.NdJ("selectionChange",function(o){return i.selectedVehicle=o}),e.YNc(18,Yt,2,0,"ng-template",16),e.YNc(19,Qt,7,0,"ng-template",17),e.YNc(20,Gt,7,4,"ng-template",18),e.YNc(21,Kt,4,1,"ng-template",19),e.qZA(),e.YNc(22,$t,2,0,"div",20),e.qZA(),e.YNc(23,jt,5,4,"div",21),e.YNc(24,Wt,3,0,"div",22),e.qZA()()()),2&t&&(e.xp6(3),e.Q6J("module","business-trip")("isActive",!0),e.xp6(9),e.Q6J("ngIf",!i.selectedVehicle),e.xp6(1),e.ekj("disabled",!i.selectedVehicle),e.Q6J("model",i.menuItems),e.xp6(3),e.Q6J("rows",10)("selection",i.selectedVehicle)("scrollable",!0)("value",i.vehicles),e.xp6(6),e.Q6J("ngIf",i.isLoading),e.xp6(1),e.Q6J("ngIf",!i.isShowAll),e.xp6(1),e.Q6J("ngIf",i.isShowAll))},dependencies:[r.O5,q.Hq,q.zx,Q.jx,X.nm,O.iA,O.Ei,p.D,h.D],styles:[".filters-visibility[_ngcontent-%COMP%]{margin-bottom:.75rem}"]}),n})()},{title:"Business Trip Expenses",path:"expenses",component:(()=>{class n{constructor(t,i,s){this.expenseService=t,this.modalService=i,this.fb=s,this.isLoading=!0,this.expenses=[],this.menuItems=[{label:"Selected Expense",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.editExpense()},{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteExpense()}]}],this.count=0,this.isShowAll=!1,this.isStartOnePage=!1,this.searchForm=this.fb.group({page:[1]}),this.query=[{name:"paginated",value:!0},{name:"page",value:this.searchForm.get("page").value}],this.tableScrollHeight="24.125rem",this.isHideFilters=!1,this.getPaginated()}ngOnInit(){}toggleFilterVisibility(){this.isHideFilters=!this.isHideFilters,this.setTableScrollHeight()}setTableScrollHeight(){!this.isHideFilters||this.isShowAll?this.isHideFilters&&this.isShowAll?this.tableScrollHeight="18.75rem":this.isHideFilters||!this.isShowAll?this.isHideFilters||this.isShowAll||(this.tableScrollHeight="24.125rem"):this.tableScrollHeight="21.875rem":this.tableScrollHeight="20.875rem"}prepareQuery(){this.query=[],this.isShowAll||(this.query=[{name:"paginated",value:"true"},{name:"page",value:this.searchForm.get("page").value}])}searchExpenses(){this.prepareQuery(),this.isShowAll?(this.searchForm.get("page").patchValue(1),this.getAll()):this.getPaginated()}getPaginated(){this.isLoading=!0,this.expenseService.getPaginated(this.query).subscribe(t=>{this.expenses=t.results,this.count=t.count,this.selectedExpense=null,this.isLoading=!1})}getAll(){this.isLoading=!0,this.expenseService.get().subscribe(t=>{this.expenses=t,this.selectedExpense=null,this.isLoading=!1,this.isStartOnePage&&this.paginator?.changePage(0)})}addExpanse(){this.expenseService.createChangeExpense().pipe((0,m.q)(1)).subscribe(t=>{t&&this.getAll()})}editExpense(){this.expenseService.createChangeExpense(this.selectedExpense).pipe((0,m.q)(1)).subscribe(t=>{t&&this.getAll()})}deleteExpense(){this.modalService.confirm("danger","Confirm").pipe((0,m.q)(1)).subscribe(t=>{t&&this.expenseService.delete(this.selectedExpense).pipe((0,m.q)(1)).subscribe(i=>{this.getAll()})})}paginate(t){this.isStartOnePage||(this.searchForm.get("page").patchValue(t.page+1),this.searchExpenses())}onShowAll(){this.isShowAll=!0,this.searchExpenses()}onShowPartial(){this.isShowAll=!1,this.searchExpenses()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(oe),e.Y36(A.Z),e.Y36(d.qu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-expanses"]],viewQuery:function(t,i){if(1&t&&e.Gf(Xt,5),2&t){let s;e.iGM(s=e.CRH())&&(i.paginator=s.first)}},decls:25,vars:13,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","Add Expense",3,"click"],[1,"page__content"],[1,"page__card"],[1,"filters-visibility"],[1,"action-buttons","align-items-center"],["class","mt-0 mb-0 subtitle",4,"ngIf"],[1,"ml-auto",3,"model"],[1,"table-pagination-preloader"],["selectionMode","single","scrollHeight","calc(100vh - 335px)",3,"scrollable","rows","selection","value","selectionChange"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["class","pagination-preloader pagination-preloader_bord",4,"ngIf"],["class","paginator-wrapper",3,"paginator-wrapper_hide",4,"ngIf"],["class","paginator-return-pagination",4,"ngIf"],["actionButtons",""],[1,"mt-0","mb-0","subtitle"],[1,"text-center",2,"width","5%"],[1,"text-center",2,"width","50%"],[1,"text-center",2,"width","45%"],[1,"table-row",3,"pSelectableRow"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"],[1,"pagination-preloader","pagination-preloader_bord"],[1,"paginator-wrapper"],[3,"rows","totalRecords","onPageChange"],["paginator",""],["type","button","styleClass","p-button-text",1,"paginator-all",3,"click"],[1,"paginator-return-pagination"],["type","button","styleClass","p-button-text",3,"click"],[1,"action-buttons"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5,"Expanses"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return i.addExpanse()}),e.qZA()()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),e.YNc(12,ei,2,0,"p",10),e._UZ(13,"p-menubar",11),e.qZA()(),e.TgZ(14,"div",12)(15,"p-table",13,14),e.NdJ("selectionChange",function(o){return i.selectedExpense=o}),e.YNc(17,ti,7,0,"ng-template",15),e.YNc(18,ii,7,4,"ng-template",16),e.YNc(19,oi,4,3,"ng-template",17),e.qZA(),e.YNc(20,ri,2,0,"div",18),e.qZA(),e.YNc(21,li,5,4,"div",19),e.YNc(22,ai,3,0,"div",20),e.qZA()(),e.YNc(23,pi,2,3,"ng-template",null,21,e.W1O)),2&t&&(e.xp6(3),e.Q6J("module","business-trip")("isActive",!0),e.xp6(9),e.Q6J("ngIf",!i.selectedExpense),e.xp6(1),e.ekj("disabled",!i.selectedExpense),e.Q6J("model",i.menuItems),e.xp6(2),e.Q6J("scrollable",!0)("rows",10)("selection",i.selectedExpense)("value",i.expenses),e.xp6(5),e.Q6J("ngIf",i.isLoading),e.xp6(1),e.Q6J("ngIf",!i.isShowAll),e.xp6(1),e.Q6J("ngIf",i.isShowAll))},dependencies:[r.O5,q.Hq,q.zx,Q.jx,X.nm,O.iA,O.Ei,p.D,h.D],styles:[".form[_ngcontent-%COMP%]{margin-top:-.25rem}.filters-visibility[_ngcontent-%COMP%]{margin-bottom:.25rem}.page__card[_ngcontent-%COMP%]{position:relative}"]}),n})()},{path:"**",redirectTo:"trips"}]}];let ui=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[F.Bz.forChild(ci),F.Bz]}),n})();var di=c(7175),hi=c(6984),mi=c(2062);let _i=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-locations-meetings/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var gi=c(6242),fi=c(3973);function vi(n,l){if(1&n&&(e.TgZ(0,"div",2)(1,"div"),e._uU(2),e.qZA()()),2&n){const t=l.$implicit;e.xp6(2),e.AsE("",t.first_name," ",t.last_name,"")}}let Ci=(()=>{class n{constructor(t){this.contactPersonsService=t,this.valueChange=new e.vpe,this.valueChangeFull=new e.vpe,this.searchByCompany=!1}ngOnChanges(t){"companyId"in t&&this.companyId&&this.search(),"contactsListFull"in t&&(this.contactsList=this.contactsListFull.map(i=>i.id))}ngOnInit(){}search(){this.searchByCompany||this.getContactPersons(null),this.searchByCompany&&this.companyId&&this.getContactPersons([{name:"company",value:this.companyId}])}getContactPersons(t){this.contactPersonsService.getForce(t).subscribe(i=>{if(this.contacts=i,this.contactsList){const s=this.contacts.filter(o=>this.contactsList.findIndex(y=>y===o.id)>=0).map(o=>o.id);this.setValue(s)}})}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}registerOnTouched(t){}setValue(t){this.contactsList=t,this.valueChange.emit(this.contactsList);const i=this.contacts.filter(s=>t.findIndex(o=>o===s.id)>-1);this.valueChangeFull.emit(i)}writeValue(t){this.contactsList=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(fi._))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-multi-contacts-picker"]],inputs:{contactsList:"contactsList",contactsListFull:"contactsListFull",searchByCompany:"searchByCompany",companyId:"companyId"},outputs:{valueChange:"valueChange",valueChangeFull:"valueChangeFull"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}]),e.TTD],decls:2,vars:2,consts:[["optionValue","id","optionLabel","first_name",3,"options","ngModel","ngModelChange"],["pTemplate","item"],[1,"contact-item"]],template:function(t,i){1&t&&(e.TgZ(0,"p-multiSelect",0),e.NdJ("ngModelChange",function(o){return i.contactsList=o})("ngModelChange",function(o){return i.onChange(o)}),e.YNc(1,vi,3,2,"ng-template",1),e.qZA()),2&t&&e.Q6J("options",i.contacts)("ngModel",i.contactsList)},dependencies:[ae.NU,Q.jx,d.JJ,d.On]}),n})();var Ti=c(4707);let yi=(()=>{class n{constructor(t){this.httpClient=t,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-countries/",this.countriesResult=new Ti.t,this.isLoadingCountries=!1}get(t){return this.isLoadingCountries?this.countriesResult:(this.isLoadingCountries=!0,this.load(t))}load(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>(this.countriesResult.next(s.data),s.data)))}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var pe=c(666);let Ce=(()=>{class n{constructor(t){this.businessCountryService=t,this.valueChange=new e.vpe,this.valueChangeFull=new e.vpe}ngOnInit(){this.getCompaniesFilters()}getCompaniesFilters(){this.preloadedCountries||this.businessCountryService.get().subscribe(t=>{this.countries=t})}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}registerOnTouched(t){}setValue(t){this.country=t,this.valueChange.emit(this.country),this.countrySelected=this.countries.find(i=>i.code===this.country),this.valueChangeFull.emit(this.countrySelected)}writeValue(t){this.country=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(yi))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-business-trip-country-picker"]],inputs:{countries:"countries",country:"country",countrySelected:"countrySelected",preloadedCountries:"preloadedCountries"},outputs:{valueChange:"valueChange",valueChangeFull:"valueChangeFull"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!1}])],decls:1,vars:3,consts:[["optionValue","code","optionLabel","name","placeholder","No Country Selected",3,"filter","options","ngModel","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"p-dropdown",0),e.NdJ("ngModelChange",function(o){return i.country=o})("ngModelChange",function(o){return i.onChange(o)}),e.qZA()),2&t&&e.Q6J("filter",!0)("options",i.countries)("ngModel",i.country)},dependencies:[d.JJ,pe.Lt,d.On]}),n})();function xi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.delete())}),e.qZA()}}function bi(n,l){1&n&&(e.TgZ(0,"div",1)(1,"div",2)(2,"label"),e._uU(3,"Company"),e.qZA()()(),e.TgZ(4,"div",1)(5,"div",2)(6,"label"),e._uU(7,"Contacts"),e.qZA()()())}function Ei(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"pek-company-picker",12),e.NdJ("selectCompanyFull",function(s){const y=e.CHM(t).$implicit,Z=e.oxw();return e.KtG(Z.updateMeeting(y,s))}),e.qZA()()(),e.TgZ(3,"div",1)(4,"div",2)(5,"pek-multi-contacts-picker",13),e.NdJ("valueChangeFull",function(s){const y=e.CHM(t).$implicit,Z=e.oxw();return e.KtG(Z.employeeChanged.next({meeting:y,contacts:s}))}),e.qZA()()(),e.TgZ(6,"div",6)(7,"div",2)(8,"button",11),e.NdJ("click",function(){const s=e.CHM(t),o=s.$implicit,y=s.index,Z=e.oxw();return e.KtG(Z.deleteMeeting(o,y))}),e.qZA()()()}if(2&n){const t=l.$implicit;e.xp6(2),e.Q6J("currentCompanyId",null==t.company?null:t.company.id),e.xp6(3),e.Q6J("contactsListFull",t.contacts)("searchByCompany",!0)("companyId",null==t.company?null:t.company.id)}}function Zi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addMeeting())}),e.qZA()}}let Ii=(()=>{class n{constructor(t,i){this.modalService=t,this.locationMeetingService=i,this.locationMeetings=[],this.showHr=!1,this.countryChanged=new e.vpe,this.addressChanged=new e.vpe,this.meetingsChanged=new e.vpe,this.emitDeletePoint=new e.vpe,this.employeeChanged=new G.x,this.locationLoaded=!1,this.destroy$=new G.x}ngOnChanges(t){"locationId"in t&&this.locationId&&this.getMeetings()}getMeetings(){this.locationLoaded=!1,this.locationMeetingService.get([{name:"location_id",value:this.locationId}]).pipe((0,M.R)(this.destroy$)).subscribe(t=>{this.locationMeetings=t,this.meetingsChanged.emit(this.locationMeetings)})}ngOnInit(){this.employeeChanged.pipe((0,ie.b)(500)).pipe((0,M.R)(this.destroy$)).subscribe(t=>{this.updateMeetingPerson(t.meeting,t.contacts)})}delete(){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&this.emitDeletePoint.emit(this.type)})}addMeeting(){this.locationId&&this.locationMeetings.push({company:null,id:null,location_id:this.locationId,contacts:[]})}updateMeeting(t,i){(!t.company||t.company.id!==i)&&(t.company=i,this.createUpdateMeeting(t))}deleteMeeting(t,i){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(s=>{s&&t.id&&this.locationMeetingService.delete(t).pipe((0,M.R)(this.destroy$)).subscribe(o=>{this.getMeetings()})})}createUpdateMeeting(t){if(this.locationId)if(t.id){const i={company:t.company.id,location_id:this.locationId,contacts:t.contacts.map(s=>s.id)};this.locationMeetingService.update(t.id,i).pipe((0,M.R)(this.destroy$)).subscribe(s=>{this.getMeetings()})}else{const i={company:t.company.id,location_id:this.locationId,contacts:t.contacts.map(s=>s.id)};this.locationMeetingService.create(i).pipe((0,M.R)(this.destroy$)).subscribe(s=>{this.getMeetings()})}}getContactsIds(t){return t.contacts.map(i=>i.id)}updateMeetingPerson(t,i){const s=t.contacts.map(y=>y.id).filter(y=>!i.map(Z=>Z.id).includes(y)),o=i.map(y=>y.id).filter(y=>!t.contacts.map(Z=>Z.id).includes(y));(s.length>0||o.length>0)&&(t.contacts=i,this.createUpdateMeeting(t))}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(A.Z),e.Y36(_i))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-location-input"]],inputs:{country:"country",locationId:"locationId",address:"address",showDelete:"showDelete",showAddMeetings:"showAddMeetings",companiesFilters:"companiesFilters",showHr:"showHr",type:"type"},outputs:{countryChanged:"countryChanged",addressChanged:"addressChanged",meetingsChanged:"meetingsChanged",emitDeletePoint:"emitDeletePoint"},features:[e.TTD],decls:19,vars:6,consts:[[1,"row"],[1,"col-5"],[1,"form-group"],[3,"country","valueChangeFull"],["for","address"],["pInputText","","type","text","id","address",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-2"],["pButton","","type","button","icon","pi pi-trash","class","p-button-danger p-button-rounded p-button-outlined p-button-rounded_small mr-2 mt-1",3,"click",4,"ngIf"],[3,"ngIf"],["ngFor","",3,"ngForOf"],["pButton","","icon","pi pi-plus","label","Add Meeting",3,"click",4,"ngIf"],["pButton","","type","button","icon","pi pi-trash",1,"p-button-danger","p-button-rounded","p-button-outlined","p-button-rounded_small","mr-2","mt-1",3,"click"],[3,"currentCompanyId","selectCompanyFull"],[3,"contactsListFull","searchByCompany","companyId","valueChangeFull"],["pButton","","icon","pi pi-plus","label","Add Meeting",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"label"),e._uU(4,"Country"),e.qZA(),e.TgZ(5,"pek-business-trip-country-picker",3),e.NdJ("valueChangeFull",function(o){return i.countryChanged.emit(o)}),e.qZA()()(),e.TgZ(6,"div",1)(7,"div",2)(8,"label",4),e._uU(9,"Address"),e.qZA(),e.TgZ(10,"input",5),e.NdJ("ngModelChange",function(o){return i.address=o})("ngModelChange",function(o){return i.addressChanged.emit(o)}),e.qZA()()(),e.TgZ(11,"div",6)(12,"div",2)(13,"label"),e._uU(14,"\xa0 "),e.qZA(),e.YNc(15,xi,1,0,"button",7),e.qZA()(),e.YNc(16,bi,8,0,"ng-template",8),e.YNc(17,Ei,9,4,"ng-template",9),e.qZA(),e.YNc(18,Zi,1,0,"button",10)),2&t&&(e.xp6(5),e.Q6J("country",null==i.country?null:i.country.code),e.xp6(5),e.Q6J("ngModel",i.address),e.xp6(5),e.Q6J("ngIf",i.showDelete),e.xp6(1),e.Q6J("ngIf",i.locationMeetings.length>0),e.xp6(1),e.Q6J("ngForOf",i.locationMeetings),e.xp6(1),e.Q6J("ngIf",i.showAddMeetings))},dependencies:[r.sg,r.O5,q.Hq,$.o,d.Fj,d.JJ,d.On,gi.i,Ci,Ce]}),n})();var ue=(()=>{return(n=ue||(ue={})).NON_VERIFIED="0",n.VERIFIED="1",ue;var n})(),Ai=c(1824);let Mi=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-expenses/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}uploadImage(t,i){const s=new FormData;for(const o in t)null!==t[o]&&s.append(o,t[o]);return this.httpClient.post(this.API_URL+this.url+i+"/add_file_to_expense/",s).pipe()}uploadFiles(t){const i=new FormData;for(const s in t)null!==t[s]&&i.append(s,t[s]);return this.httpClient.post(this.API_URL+"business-trips-expense-files/",i).pipe((0,_.U)(s=>s.data))}deleteFiles(t){return this.httpClient.delete(this.API_URL+"business-trips-expense-files/"+t+"/")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var wi=c(5079);function Si(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.verifyBusinessTrip.next())}),e.qZA()}}function ki(n,l){1&n&&(e.TgZ(0,"p",20),e._uU(1,"Choose the Evidences to edit"),e.qZA())}function Pi(n,l){1&n&&e._UZ(0,"p")}function Ui(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.updateVerifyStatusOfExpense(!0))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!1===t.selectedTripExpense.is_verified||!0===t.selectedTripExpense.is_verified)}}function Fi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.updateVerifyStatusOfExpense(!1))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",!1===t.selectedTripExpense.is_verified||!0===t.selectedTripExpense.is_verified)}}function Bi(n,l){if(1&n&&(e.TgZ(0,"div",15),e.YNc(1,ki,2,0,"p",16),e.YNc(2,Pi,1,0,"p",13),e.TgZ(3,"div",1),e.YNc(4,Ui,1,1,"button",17),e.YNc(5,Fi,1,1,"button",18),e._UZ(6,"p-menubar",19),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.selectedTripExpense),e.xp6(1),e.Q6J("ngIf",t.selectedTripExpense),e.xp6(2),e.Q6J("ngIf",t.isVerify&&t.selectedTripExpense),e.xp6(1),e.Q6J("ngIf",t.isVerify&&t.selectedTripExpense),e.xp6(1),e.ekj("disabled",!t.selectedTripExpense||t.selectedTripExpense&&(t.selectedTripExpense.is_verified||!1===t.selectedTripExpense.is_verified)),e.Q6J("model",t.menuItems)}}function Hi(n,l){1&n&&(e.TgZ(0,"tr")(1,"th",23),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Name"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Description"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Sum"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Currency"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"File"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Evidence Type"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Status"),e.qZA()())}function Vi(n,l){if(1&n&&(e.TgZ(0,"span")(1,"a",27),e._uU(2),e.qZA()()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(1),e.Q6J("href",t.files[0].file,e.LSH),e.xp6(1),e.AsE(" ",i.getName(t.files[0].file)," (F ",t.files.length,") ")}}function Ni(n,l){if(1&n&&(e.TgZ(0,"span")(1,"a",27),e._uU(2),e.qZA()()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(1),e.Q6J("href",t.files[0].file,e.LSH),e.xp6(1),e.hij(" ",i.getName(t.files[0].file)," ")}}function Oi(n,l){if(1&n&&(e.TgZ(0,"span")(1,"a",27),e._uU(2),e.qZA(),e._UZ(3,"br"),e.qZA()),2&n){const t=l.$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("href",t.file,e.LSH),e.xp6(1),e.hij(" ",i.getName(t.file)," ")}}function Di(n,l){if(1&n&&(e.TgZ(0,"div",28),e.YNc(1,Oi,4,2,"span",29),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngForOf",t.files)}}function Ji(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1," Canceled "),e.qZA())}function Li(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1," Need To Be Verified "),e.qZA())}function qi(n,l){1&n&&(e.TgZ(0,"span"),e._uU(1," Verified "),e.qZA())}function Ri(n,l){if(1&n&&(e.TgZ(0,"tr",24)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"moneyFormat"),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td",25),e.YNc(13,Vi,3,3,"span",13),e.YNc(14,Ni,3,2,"span",13),e.YNc(15,Di,2,1,"div",26),e.qZA(),e.TgZ(16,"td"),e._uU(17),e.qZA(),e.TgZ(18,"td"),e.YNc(19,Ji,2,0,"span",13),e.YNc(20,Li,2,0,"span",13),e.YNc(21,qi,2,0,"span",13),e.qZA()()),2&n){const t=l.$implicit,i=l.rowIndex,s=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(i+1),e.xp6(2),e.Oqu(t.expense&&t.expense.name?t.expense.name:t.custom_expense.name),e.xp6(2),e.Oqu(t.expense&&t.expense.name?t.expense.description:t.custom_expense.description),e.xp6(2),e.Oqu(e.lcZ(9,13,t.sum)),e.xp6(3),e.Oqu(t.currency.name),e.xp6(2),e.Q6J("ngIf",t.files.length>1),e.xp6(1),e.Q6J("ngIf",1===t.files.length),e.xp6(1),e.Q6J("ngIf",t.files.length>1),e.xp6(2),e.hij(" ",t.type===s.BusinessTripExpensesType.CORPORATE?"Corporate":"Own"," "),e.xp6(2),e.Q6J("ngIf",!1===t.is_verified),e.xp6(1),e.Q6J("ngIf",!t.is_verified&&!1!==t.is_verified),e.xp6(1),e.Q6J("ngIf",!0===t.is_verified)}}function Yi(n,l){if(1&n&&(e.TgZ(0,"div")(1,"p")(2,"span",30),e._uU(3),e.qZA(),e.TgZ(4,"span",31),e._uU(5),e.qZA()()()),2&n){const t=l.$implicit;e.xp6(3),e.hij("",t.currency.name,":"),e.xp6(2),e.AsE("",t.sum,"",t.currency.symbol,"")}}function Qi(n,l){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,Yi,6,3,"div",29),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.sumOfVerifiedExpenses)}}function Gi(n,l){1&n&&(e.TgZ(0,"div")(1,"h3"),e._uU(2," No Verified Evidences "),e.qZA()())}let Ki=(()=>{class n{constructor(t,i,s,o,y){this.fb=t,this.modalService=i,this.businessService=s,this.businessTripsExpensesService=o,this.expenseService=y,this.tripExpenses=[],this.editExpense=new e.vpe,this.verifyBusinessTrip=new e.vpe,this.currentBusinessTripExpenses=new e.vpe,this.deleteExpense=new e.vpe,this.expenseSumEmit=new e.vpe,this.unverifyTrip=new G.x,this.BusinessTripExpensesType=Ai.b,this.statuses=ue,this.sumOfVerifiedExpenses=[],this.menuItems=[{label:"Selected Evidence",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.editTripExpense()},{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteTripExpense()}]}],this.formData=new FormData,this.destroy$=new G.x,this.link=I.N.image_path}ngOnInit(){this.getBusinessTripsExpenses()}getBusinessTripsExpenses(){this.businessTripsExpensesService.get([{name:"business_trip_id",value:this.businessTripId}]).pipe((0,M.R)(this.destroy$)).subscribe(t=>{this.tripExpenses=t,this.currentBusinessTripExpenses.emit(this.tripExpenses),this.recalculateExpenses()})}ngOnChanges(t){this.recalculateExpenses()}recalculateExpenses(){this.sumOfVerifiedExpenses=[],this.tripExpenses.forEach(t=>{if(t.is_verified){const i=this.sumOfVerifiedExpenses.find(s=>s.currencyCode===t.currency.code);i?i.sum=+i.sum+ +t.sum:this.sumOfVerifiedExpenses.push({currency:t.currency,sum:t.sum,currencyCode:t.currency.code})}}),this.expenseSumEmit.emit(this.sumOfVerifiedExpenses)}getName(t){const i=t.split("/");return i[i.length-1]}deleteTripExpense(){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&this.businessTripsExpensesService.delete(this.selectedTripExpense).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.getBusinessTripsExpenses(),this.selectedTripExpense=null})})}addTripExpanses(){this.expenseService.createChangeExpanseItem(null,!1).pipe((0,m.q)(1),(0,M.R)(this.destroy$)).subscribe(i=>{const s=this.prepareExpense(i);this.businessTripsExpensesService.create(s).pipe((0,M.R)(this.destroy$)).subscribe(o=>{if(i.uploadedFiles.length>0){let y=[];i.uploadedFiles.forEach(Z=>{const U=this.businessTripsExpensesService.uploadFiles({business_trip_expense:o.id,file:Z});y.push(U)}),(0,C.D)([...y]).pipe((0,M.R)(this.destroy$)).subscribe(Z=>{this.getBusinessTripsExpenses(),this.unverifyTrip.next()})}else this.getBusinessTripsExpenses(),this.unverifyTrip.next()})})}prepareExpense(t){t.business_trip=this.businessTripId;const i={currency:t.currency,id:t.id,sum:t.sum,type:t.type,business_trip:this.businessTripId,is_verified:t.is_verified,clear_file:t.clear_file};return t.expense?.name&&(i.expense=t.expense.id,i.currency=t.currency.code,i.fullExpense=t.expense),t.custom_expense?.name&&(i.custom_expense=t.custom_expense,i.currency=t.currency.code,i.fullExpense=t.custom_expense),i}viewFile(t,i){const s=[],o=[];t.base64File&&o.push({file:t.base64File}),"string"==typeof t.file&&!t.base64File&&s.push({file:i}),this.businessService.viewBusinessTripFiles({links:s,files:o})}editTripExpense(){this.expenseService.createChangeExpanseItem(this.selectedTripExpense,this.isVerify).pipe((0,m.q)(1),(0,M.R)(this.destroy$)).subscribe(t=>{const i=this.prepareExpense(t.value);this.businessTripsExpensesService.update(t.value.id,i).pipe((0,M.R)(this.destroy$)).subscribe(s=>{if(t.value.deleteImagesIds.length>0||t.value.uploadedFiles.length>0){let o=[],y=[];t.value.uploadedFiles.length>0&&t.value.uploadedFiles.forEach(Z=>{const U=this.businessTripsExpensesService.uploadFiles({business_trip_expense:s.data.id,file:Z});o.push(U)}),t.value.deleteImagesIds.length>0&&t.value.deleteImagesIds.forEach(Z=>{const U=this.businessTripsExpensesService.deleteFiles(Z);y.push(U)}),(0,C.D)([...o,...y]).pipe((0,M.R)(this.destroy$)).subscribe(()=>{this.getBusinessTripsExpenses(),this.unverifyTrip.next()})}else this.getBusinessTripsExpenses(),this.unverifyTrip.next()})})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}updateVerifyStatusOfExpense(t){this.selectedTripExpense.is_verified=t;const i=this.prepareExpense(this.selectedTripExpense);this.businessTripsExpensesService.create(i).pipe((0,M.R)(this.destroy$)).subscribe(s=>{this.getBusinessTripsExpenses()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.qu),e.Y36(A.Z),e.Y36(E.v),e.Y36(Mi),e.Y36(oe))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-trip-expenses-table"]],inputs:{businessTripId:"businessTripId",isVerify:"isVerify"},outputs:{editExpense:"editExpense",verifyBusinessTrip:"verifyBusinessTrip",currentBusinessTripExpenses:"currentBusinessTripExpenses",deleteExpense:"deleteExpense",expenseSumEmit:"expenseSumEmit",unverifyTrip:"unverifyTrip"},features:[e.TTD],decls:21,vars:8,consts:[[1,"mb-4","d-flex","justify-content-between"],[1,"d-flex","align-items-center"],["pButton","","type","button","icon","pi pi-check","label","Verify Business Trip","class","mr-2",3,"click",4,"ngIf"],["pButton","","type","button","icon","pi pi-plus","label","Add Evidence",3,"click"],[1,"page__card"],[1,"content"],[1,"card"],[1,"card-body"],["selectionMode","single",3,"paginator","rows","value","scrollable","selection","selectionChange"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"pt-2","pl-2","card-body"],[4,"ngIf"],["pButton","","type","button","icon","pi pi-check","label","Verify Business Trip",1,"mr-2",3,"click"],[1,"d-flex","align-items-center","justify-content-between"],["class","subtitle ml-1 mr-2",4,"ngIf"],["pButton","","type","button","icon","pi pi-check","class","mr-3","label","Verify Evidence",3,"disabled","click",4,"ngIf"],["pButton","","type","button","icon","pi pi-times","class","p-button-danger mr-3","label","Cancel Evidence",3,"disabled","click",4,"ngIf"],[1,"ml-auto","mr-2",3,"model"],[1,"subtitle","ml-1","mr-2"],["pButton","","type","button","icon","pi pi-check","label","Verify Evidence",1,"mr-3",3,"disabled","click"],["pButton","","type","button","icon","pi pi-times","label","Cancel Evidence",1,"p-button-danger","mr-3",3,"disabled","click"],[1,"index-header"],[3,"pSelectableRow"],[1,"files-cont"],["class","files-list",4,"ngIf"],[3,"href"],[1,"files-list"],[4,"ngFor","ngForOf"],[1,"currency-name"],[1,"currency-value"]],template:function(t,i){1&t&&(e.TgZ(0,"h2",0),e._uU(1," Evidences "),e.TgZ(2,"div",1),e.YNc(3,Si,1,0,"button",2),e.TgZ(4,"button",3),e.NdJ("click",function(){return i.addTripExpanses()}),e.qZA()()(),e.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7)(9,"p-table",8),e.NdJ("selectionChange",function(o){return i.selectedTripExpense=o}),e.YNc(10,Bi,7,7,"ng-template",9),e.YNc(11,Hi,17,0,"ng-template",10),e.YNc(12,Ri,22,15,"ng-template",11),e.qZA()()()(),e.TgZ(13,"h3"),e._uU(14,"Sum"),e.qZA(),e.TgZ(15,"div",5)(16,"div",6)(17,"div",7)(18,"div",12),e.YNc(19,Qi,2,1,"div",13),e.YNc(20,Gi,3,0,"div",13),e.qZA()()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",i.isVerify),e.xp6(6),e.Q6J("paginator",!0)("rows",10)("value",i.tripExpenses)("scrollable",!1)("selection",i.selectedTripExpense),e.xp6(10),e.Q6J("ngIf",i.sumOfVerifiedExpenses.length>0),e.xp6(1),e.Q6J("ngIf",0===i.sumOfVerifiedExpenses.length))},dependencies:[r.sg,r.O5,q.Hq,Q.jx,X.nm,O.iA,O.Ei,wi.U],styles:["h2[_ngcontent-%COMP%]{font-size:1.1875rem;font-weight:600}.currency-name[_ngcontent-%COMP%]{display:inline-block;width:8rem}.currency-value[_ngcontent-%COMP%]{display:inline-block}.files-cont[_ngcontent-%COMP%]{position:relative}.files-cont[_ngcontent-%COMP%]   .files-list[_ngcontent-%COMP%]{padding:.5rem 1rem;opacity:0;pointer-events:none;position:absolute;top:0;right:0;width:26.25rem;background-color:#fff;border-radius:.625rem;box-shadow:0 0 6px 5px #00000026;z-index:100}.files-cont[_ngcontent-%COMP%]   .files-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:.5rem}.files-cont[_ngcontent-%COMP%]   .files-list[_ngcontent-%COMP%]:hover, .files-cont[_ngcontent-%COMP%]:hover   .files-list[_ngcontent-%COMP%]{opacity:1;pointer-events:initial}"]}),n})(),$i=(()=>{class n{constructor(){this.valueChange=new e.vpe,this.types=[{id:"0",value:"Without"},{id:"1",value:"Private"},{id:"2",value:"Rent"},{id:"3",value:"Company Car"}]}ngOnInit(){}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}registerOnTouched(t){}setValue(t){this.type=t,this.valueChange.emit(this.type)}writeValue(t){this.type=t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-vehicle-type-picker"]],inputs:{type:"type"},outputs:{valueChange:"valueChange"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!1}])],decls:1,vars:3,consts:[["optionValue","id","optionLabel","value","placeholder","Choose Vehicle Type",3,"filter","ngModel","options","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"p-dropdown",0),e.NdJ("ngModelChange",function(o){return i.type=o})("ngModelChange",function(o){return i.onChange(o)}),e.qZA()),2&t&&e.Q6J("filter",!0)("ngModel",i.type)("options",i.types)},dependencies:[d.JJ,pe.Lt,d.On]}),n})();function ji(n,l){if(1&n&&(e.TgZ(0,"div",4)(1,"div"),e._uU(2),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.Oqu(t.selectedVehicle.model)}}function Wi(n,l){if(1&n&&e.YNc(0,ji,3,1,"div",3),2&n){const t=e.oxw();e.Q6J("ngIf",t.vehicle)}}function zi(n,l){if(1&n&&(e.TgZ(0,"div",5)(1,"div"),e._uU(2),e.qZA()()),2&n){const t=l.$implicit;e.xp6(2),e.AsE("",t.model," (",t.number,")")}}let Xi=(()=>{class n{constructor(t){this.vehicleService=t,this.valueChange=new e.vpe,this.placeholder="Vehicle",this.isLoading=!0}ngOnInit(){this.getAll()}getAll(){this.vehicleService.get().pipe((0,m.q)(1)).subscribe(t=>{this.vehicles=t,this.vehicle&&(this.selectedVehicle=this.vehicles.find(i=>i.id===this.vehicle)),this.isLoading=!1})}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}registerOnTouched(t){}setValue(t){this.vehicle=t,this.selectedVehicle=this.vehicles.find(i=>i.id===this.vehicle),this.valueChange.emit(this.selectedVehicle)}writeValue(t){this.vehicle=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(le))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-vehicle-picker"]],inputs:{vehicle:"vehicle",selectedVehicle:"selectedVehicle",placeholder:"placeholder",showClear:"showClear"},outputs:{valueChange:"valueChange"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}])],decls:3,vars:5,consts:[["optionValue","id","optionLabel","model","placeholder","Choose Vehicle",3,"filter","showClear","ngModel","options","disabled","ngModelChange"],["pTemplate","selectedItem"],["pTemplate","item"],["class","country-item country-item-value",4,"ngIf"],[1,"country-item","country-item-value"],[1,"country-item"]],template:function(t,i){1&t&&(e.TgZ(0,"p-dropdown",0),e.NdJ("ngModelChange",function(o){return i.vehicle=o})("ngModelChange",function(o){return i.onChange(o)}),e.YNc(1,Wi,1,1,"ng-template",1),e.YNc(2,zi,3,2,"ng-template",2),e.qZA()),2&t&&e.Q6J("filter",!0)("showClear",i.showClear)("ngModel",i.vehicle)("options",i.vehicles)("disabled",i.isLoading)},dependencies:[r.O5,Q.jx,d.JJ,pe.Lt,d.On]}),n})(),en=(()=>{class n{constructor(t){this.expensesService=t,this.valueChange=new e.vpe,this.isLoading=!0}ngOnInit(){this.getAll()}getAll(){this.expensesService.get().pipe((0,m.q)(1)).subscribe(t=>{this.expenses=t,this.isLoading=!1})}onChange(t){this.setValue(t)}registerOnChange(t){this.valueChange.subscribe(t)}registerOnTouched(t){}setValue(t){this.expense=t,this.valueChange.emit(this.expenses.find(i=>i.id===this.expense))}writeValue(t){this.expense=t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(oe))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-expense-picker"]],inputs:{expense:"expense",showClear:"showClear",isDisabled:"isDisabled"},outputs:{valueChange:"valueChange"},features:[e._Bn([{provide:d.JU,useExisting:(0,e.Gpc)(()=>n),multi:!0}])],decls:1,vars:5,consts:[["optionValue","id","optionLabel","name","placeholder","Choose Expanse",3,"filter","showClear","ngModel","options","disabled","ngModelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"p-dropdown",0),e.NdJ("ngModelChange",function(o){return i.expense=o})("ngModelChange",function(o){return i.onChange(o)}),e.qZA()),2&t&&e.Q6J("filter",!0)("showClear",i.showClear)("ngModel",i.expense)("options",i.expenses)("disabled",i.isLoading||i.isDisabled)},dependencies:[d.JJ,pe.Lt,d.On]}),n})();var tn=c(9380),nn=c(2965);class sn{}let Te=(()=>{class n{constructor(t,i){this.httpClient=t,this.dialog=i,this.API_URL=I.N.base_url+I.N.business_trips_url,this.url="business-trips-hotels/"}get(t){let i="";return t&&t.forEach((s,o)=>{i+=o>0?"&"+s.name+"="+s.value:"?"+s.name+"="+s.value}),this.httpClient.get(this.API_URL+this.url+i).pipe((0,_.U)(s=>s.data))}getById(t){return this.httpClient.get(this.API_URL+this.url+t+"/").pipe((0,_.U)(i=>i.data))}create(t){return this.httpClient.post(this.API_URL+this.url,t).pipe((0,_.U)(i=>i.data))}update(t,i){return this.httpClient.patch(this.API_URL+this.url+t+"/",i)}delete(t){return this.httpClient.delete(this.API_URL+this.url+t.id+"/")}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(j.eN),e.LFG(u.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function on(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"pek-hotel-list-item",2),e.NdJ("hotelUpdated",function(s){const y=e.CHM(t).$implicit,Z=e.oxw();return e.KtG(Z.hotelUpdated(y,s))})("hotelDeleted",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.getBusinessTripHotels())}),e.qZA()()}if(2&n){const t=l.$implicit,i=l.first,s=e.oxw();e.xp6(1),e.ekj("space-up",!i),e.Q6J("businessTripId",s.businessTripId)("tripHotel",t)}}function rn(n,l){1&n&&(e.TgZ(0,"div",3)(1,"h2"),e._uU(2," No Hotels "),e.qZA()())}let ye=(()=>{class n{constructor(t,i){this.businessTripHotelService=t,this.messageService=i,this.tripHotels=[],this.currentBusinessTripHotels=new e.vpe,this.destroy$=new G.x}ngOnInit(){}ngOnChanges(t){this.businessTripId&&this.getBusinessTripHotels()}getBusinessTripHotels(){this.businessTripHotelService.get([{name:"business_trip",value:this.businessTripId}]).pipe((0,M.R)(this.destroy$)).subscribe(t=>{this.tripHotels=t,this.currentBusinessTripHotels.emit(this.tripHotels)})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}hotelUpdated(t,i){this.currentBusinessTripHotels.emit(this.tripHotels)}addHotel(){const t=new sn;this.tripHotels.push(t),this.messageService.add({severity:"success",summary:"Hotel Added",detail:"Hotel added to the list"})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Te),e.Y36(Q.ez))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-hotels-list"]],inputs:{tripHotels:"tripHotels",businessTripId:"businessTripId"},outputs:{currentBusinessTripHotels:"currentBusinessTripHotels"},features:[e.TTD],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],["class","d-flex justify-content-center",4,"ngIf"],[3,"businessTripId","tripHotel","hotelUpdated","hotelDeleted"],[1,"d-flex","justify-content-center"]],template:function(t,i){1&t&&(e.YNc(0,on,2,4,"div",0),e.YNc(1,rn,3,0,"div",1)),2&t&&(e.Q6J("ngForOf",i.tripHotels),e.xp6(1),e.Q6J("ngIf",0===i.tripHotels.length))},styles:[".space-up[_ngcontent-%COMP%]{display:block;margin-top:4rem}h2[_ngcontent-%COMP%]{font-size:1.1875rem;font-weight:600}"]}),n})();var xe=c(9673),ln=c(609);const an=["filePicker"];function pn(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"p-footer",25)(1,"button",26),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(),o=e.MAs(25);return s.setHotelStartValue(o.value),s.hotelChanged.next(),e.KtG(o.toggle())}),e._uU(2," Set Date "),e.qZA()()}}function cn(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"p-footer",25)(1,"button",26),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(),o=e.MAs(32);return s.setHotelEndValue(o.value),s.hotelChanged.next(),e.KtG(o.toggle())}),e._uU(2," Set Date "),e.qZA()()}}function un(n,l){1&n&&(e.TgZ(0,"p",30),e._uU(1,"Choose the Hotel Files to edit"),e.qZA())}function dn(n,l){if(1&n&&(e.TgZ(0,"div",27),e.YNc(1,un,2,0,"p",28),e._UZ(2,"p-menubar",29),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.selectedHotelFile),e.xp6(1),e.ekj("disabled",!t.selectedHotelFile),e.Q6J("model",t.menuItems)}}function hn(n,l){1&n&&(e.TgZ(0,"tr")(1,"th",31),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"File"),e.qZA()())}function mn(n,l){if(1&n&&(e.TgZ(0,"tr",32)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"a",33),e._uU(5),e.qZA()()()),2&n){const t=l.$implicit,i=l.rowIndex,s=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.Oqu(i+1),e.xp6(2),e.Q6J("href",t.file,e.LSH),e.xp6(1),e.hij(" ",s.getName(t.file)," ")}}let _n=(()=>{class n{constructor(t,i,s,o,y){this.businessService=t,this.businessTripHotelService=i,this.businessTripHotelFilesService=s,this.modalService=o,this.adapterService=y,this.hotelChanged=new G.x,this.destroy$=new G.x,this.showFilePicker=!0,this.hotelUpdated=new G.x,this.hotelDeleted=new G.x,this.menuItems=[{label:"Selected Hotel Files",items:[{label:"Remove",icon:"pi pi-trash",command:()=>this.deleteFile()}]}],this.hotelEndDate=null,this.hotelStartDate=null,this.startDate=null,this.endDate=null,this.formData=new FormData}ngOnInit(){this.tripHotel.residence_start&&(this.startDate=new Date(this.tripHotel.residence_start)),this.tripHotel.residence_end&&(this.endDate=new Date(this.tripHotel.residence_end)),this.tripHotel.id&&this.loadHotelFiles(this.tripHotel.id),this.hotelChanged.pipe((0,ie.b)(400),(0,M.R)(this.destroy$)).subscribe(()=>{this.updateHotel()})}updateHotel(){const t={residence_start:this.tripHotel.residence_start?this.tripHotel.residence_start:null,residence_end:this.tripHotel.residence_end?this.tripHotel.residence_end:null,address:this.tripHotel.address,country:this.tripHotel.country?.code,name:this.tripHotel.name,id:this.tripHotel.id,business_trip:this.businessTripId};!t.name||!t.country||(t.id?this.businessTripHotelService.update(t.id,t).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.hotelUpdated.next(this.tripHotel)}):this.businessTripHotelService.create(t).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.tripHotel.id=i.id,this.hotelUpdated.next(this.tripHotel)}))}get country(){return this.tripHotel.country?this.tripHotel.country.code:null}get start_date(){return this.tripHotel.residence_start?new Date(this.tripHotel.residence_start):null}get end_date(){return this.tripHotel.residence_end?new Date(this.tripHotel.residence_end):null}viewHotelFiles(){this.businessService.viewBusinessTripFiles({links:this.preparedFiles,files:[]})}loadHotelFiles(t){this.businessTripHotelFilesService.get([{name:"business_trip_hotel_id",value:t}]).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.preparedFiles=i})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}clickHotelOutside(t){this.endDate?.getTime()!==this.hotelStartDate?.getTime()&&(this.tripHotel.residence_end=this.hotelStartDate),this.endDate?.getTime()!==this.hotelEndDate?.getTime()&&(this.tripHotel.residence_end=this.hotelEndDate)}setHotelStartValue(t){this.tripHotel.residence_start=this.adapterService.dateAdapter(t),t&&(this.hotelStartDate=t,this.startDate=new Date(this.tripHotel.residence_start),this.tripHotel.residence_end&&this.tripHotel.residence_end<this.tripHotel.residence_start&&this.setHotelEndValue(this.tripHotel.residence_start))}setHotelEndValue(t){t&&(this.tripHotel.residence_end=this.adapterService.dateAdapter(t),this.hotelEndDate=t)}filesChanged(t){t.length>0&&(this.tripHotel.files=t,setTimeout(()=>{this.updateFiles()},1e3))}updateFiles(){this.showFilePicker=!1;const t=[];this.tripHotel.files.forEach(o=>{t.push({file:o,business_trip_id:this.tripHotel.id})});const s=this.obj2FormData({files:this.tripHotel.files,id:this.tripHotel.id});this.businessTripHotelFilesService.add_hotel_files(s).pipe((0,M.R)(this.destroy$)).subscribe(o=>{this.loadHotelFiles(this.tripHotel.id),this.filePicker.clearFiles()})}obj2FormData(t,i=new FormData){return this.formData=i,this.createFormData(t),this.formData}createFormData(t,i=""){for(const s in t){const o=t[s],y=i?i+"["+s+"]":s;"string"==typeof o||"number"==typeof o||"boolean"==typeof o?this.formData.append(y,o):"object"==typeof o&&(o instanceof File?this.formData.append(y,o):this.createFormData(o,y))}}getName(t){const i=t.split("/");return i[i.length-1]}deleteFile(){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&this.businessTripHotelFilesService.delete(this.selectedHotelFile).pipe((0,M.R)(this.destroy$)).subscribe(()=>{this.selectedHotelFile=null,this.loadHotelFiles(this.tripHotel.id)})})}fileAdded(t){this.tripHotel.files=[t],setTimeout(()=>{this.updateFiles()},1e3)}deleteHotel(){this.modalService.confirm("danger","Confirm").pipe((0,M.R)(this.destroy$)).subscribe(t=>{t&&(this.tripHotel.id?this.businessTripHotelService.delete(this.tripHotel).pipe((0,M.R)(this.destroy$)).subscribe(i=>{this.hotelDeleted.next()}):this.hotelDeleted.next())})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(E.v),e.Y36(Te),e.Y36(ve),e.Y36(A.Z),e.Y36(B.v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["pek-hotel-list-item"]],viewQuery:function(t,i){if(1&t&&e.Gf(an,5),2&t){let s;e.iGM(s=e.CRH())&&(i.filePicker=s.first)}},inputs:{tripHotel:"tripHotel",businessTripId:"businessTripId"},outputs:{hotelUpdated:"hotelUpdated",hotelDeleted:"hotelDeleted"},decls:54,vars:22,consts:[["pekPasteScreenImage","",1,"page__card",3,"imageAdded"],[1,"row"],[1,"col-4"],[1,"form-group"],["pInputText","",1,"form-control",3,"ngModel","ngModelChange"],[3,"country","valueChangeFull"],[1,"col-6"],["hourFormat","24","dataType","date","dateFormat","dd/mm/yy",3,"firstDayOfWeek","hideOnDateTimeSelect","showButtonBar","ngModel","readonlyInput","onClickOutside"],["startHotel",""],["class","d-flex justify-content-center align-items-center",4,"ngIf"],["hourFormat","24","dataType","date","dateFormat","dd/mm/yy",3,"firstDayOfWeek","minDate","disabled","hideOnDateTimeSelect","showButtonBar","ngModel","readonlyInput","onClickOutside"],["endHotel",""],[1,"col-12"],[3,"fileChanged"],["filePicker",""],[1,"col-11"],[1,"col-1"],["pButton","","type","button","icon","fa fa-eye","label","View files",3,"click"],["selectionMode","single",3,"paginator","rows","value","scrollable","selection","selectionChange"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"col-10"],[1,"col-2"],["pButton","","type","button","icon","fa fa-trash","label","Delete Hotel",1,"p-button-danger",3,"click"],[1,"d-flex","justify-content-center","align-items-center"],[1,"btn","btn-primary","position-absolute","mb-5",3,"click"],[1,"d-flex","align-items-center"],["class","subtitle ml-1 mr-2",4,"ngIf"],[1,"ml-auto","mr-2",3,"model"],[1,"subtitle","ml-1","mr-2"],[1,"index-header"],[3,"pSelectableRow"],[3,"href"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.NdJ("imageAdded",function(o){return i.fileAdded(o)}),e.TgZ(1,"div")(2,"div")(3,"div",1)(4,"div",2)(5,"div",3)(6,"label"),e._uU(7,"Name"),e.qZA(),e.TgZ(8,"input",4),e.NdJ("ngModelChange",function(){return i.hotelChanged.next()})("ngModelChange",function(o){return i.tripHotel.name=o}),e.qZA()()(),e.TgZ(9,"div",2)(10,"div",3)(11,"label"),e._uU(12,"Country"),e.qZA(),e.TgZ(13,"pek-business-trip-country-picker",5),e.NdJ("valueChangeFull",function(o){return i.tripHotel.country=o,i.hotelChanged.next()}),e.qZA()()(),e.TgZ(14,"div",2)(15,"div",3)(16,"label"),e._uU(17,"Address"),e.qZA(),e.TgZ(18,"input",4),e.NdJ("ngModelChange",function(){return i.hotelChanged.next()})("ngModelChange",function(o){return i.tripHotel.address=o}),e.qZA()()()(),e.TgZ(19,"div",1)(20,"div",6)(21,"div",3)(22,"label"),e._uU(23,"Residence Start Date"),e.qZA(),e.TgZ(24,"p-calendar",7,8),e.NdJ("onClickOutside",function(){return i.clickHotelOutside("start")}),e.YNc(26,pn,3,0,"p-footer",9),e.qZA()()(),e.TgZ(27,"div",6)(28,"div",3)(29,"label"),e._uU(30,"Residence End Date"),e.qZA(),e.TgZ(31,"p-calendar",10,11),e.NdJ("onClickOutside",function(){return i.clickHotelOutside("end")}),e.YNc(33,cn,3,0,"p-footer",9),e.qZA()()()(),e.TgZ(34,"div",1)(35,"div",12)(36,"div",3)(37,"pek-upload-file-picker",13,14),e.NdJ("fileChanged",function(o){return i.filesChanged(o)}),e.qZA()()()(),e.TgZ(39,"div",1)(40,"div",15),e._UZ(41,"div",3),e.qZA(),e.TgZ(42,"div",16)(43,"div",3)(44,"button",17),e.NdJ("click",function(){return i.viewHotelFiles()}),e.qZA()()()(),e.TgZ(45,"p-table",18),e.NdJ("selectionChange",function(o){return i.selectedHotelFile=o}),e.YNc(46,dn,3,4,"ng-template",19),e.YNc(47,hn,5,0,"ng-template",20),e.YNc(48,mn,6,4,"ng-template",21),e.qZA(),e.TgZ(49,"div",1),e._UZ(50,"div",22),e.TgZ(51,"div",23)(52,"div",3)(53,"button",24),e.NdJ("click",function(){return i.deleteHotel()}),e.qZA()()()()()()()),2&t){const s=e.MAs(25),o=e.MAs(32);e.xp6(8),e.Q6J("ngModel",i.tripHotel.name),e.xp6(5),e.Q6J("country",i.country),e.xp6(5),e.Q6J("ngModel",i.tripHotel.address),e.xp6(6),e.Q6J("firstDayOfWeek",1)("hideOnDateTimeSelect",!1)("showButtonBar",!0)("ngModel",i.startDate)("readonlyInput",!0),e.xp6(2),e.Q6J("ngIf",s.value),e.xp6(5),e.Q6J("firstDayOfWeek",1)("minDate",i.startDate)("disabled",!i.startDate)("hideOnDateTimeSelect",!1)("showButtonBar",!0)("ngModel",i.endDate)("readonlyInput",!0),e.xp6(2),e.Q6J("ngIf",o.value),e.xp6(12),e.Q6J("paginator",!0)("rows",10)("value",i.preparedFiles)("scrollable",!0)("selection",i.selectedHotelFile)}},dependencies:[r.O5,q.Hq,$.o,Q.$_,Q.jx,d.Fj,d.JJ,X.nm,d.On,O.iA,O.Ei,T.f,xe.y,ln.U,Ce]}),n})();var gn=c(3054),be=c(1989),fn=c(1424),vn=c(6297),Cn=c(2660);let Tn=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[r.uU],imports:[r.ez,ui,hi.m,di.x,tn.xC,ae.q4,nn.Tm]}),n})();e.B6R(de,[r.sg,r.O5,q.Hq,$.o,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,d.x0,gn.g,d.On,be.XZ,p.D,fn.J,vn.O,mi.n,Ii,Ki,$i,Xi,ye],[]),e.B6R(fe,[r.O5,q.Hq,$.o,Q.jx,d._Y,d.Fj,d.wV,d.JJ,d.JL,d.qQ,d.sg,d.u,d.x0,u.ZT,u.xY,u.H8,pe.Lt,d.On,be.XZ,O.iA,O.Ei,xe.y,Cn.Q,en],[]),e.B6R(ye,[r.sg,r.O5,_n],[])},8739:(z,Y,c)=>{c.d(Y,{g:()=>a});var r=c(4006),F=c(6319),e=c(4650),P=c(5151);function H(v,V){if(1&v){const _=e.EpF();e.TgZ(0,"div",17)(1,"div",18)(2,"div",4)(3,"label"),e._uU(4,"User Profiles*"),e.qZA(),e.TgZ(5,"pek-user-profile-picker",19),e.NdJ("selectUserProfile",function(f){const C=e.CHM(_).$implicit,w=e.oxw();return e.KtG(w.onSelectUserProfile(f,C))}),e.qZA()(),e.TgZ(6,"div",4)(7,"label"),e._uU(8,"Employees*"),e.qZA(),e.TgZ(9,"pek-crm-employee-picker",20),e.NdJ("selectEmployees",function(f){const C=e.CHM(_).$implicit,w=e.oxw();return e.KtG(w.onSelectEmployees(f,C))}),e.qZA()(),e.TgZ(10,"button",21),e.NdJ("click",function(){const b=e.CHM(_).index,C=e.oxw();return e.KtG(C.removeUser(b))}),e.qZA()()()}if(2&v){const _=V.$implicit;e.Q6J("formGroupName",V.index),e.xp6(5),e.Q6J("currentUserProfileId",_.get("profile_id").value),e.xp6(4),e.Q6J("currentEmployeeIds",_.get("employees_ids").value)}}let a=(()=>{class v{constructor(_,g,f,b){this.dialogRef=_,this.eventTypesService=g,this.fb=f,this.data=b,this.isSaving=!1,this.form=this.fb.group({name:[null,[r.kI.required]],description:[null,r.kI.required],google_calendar_id:[null],google_owner_first_name:[null],google_owner_last_name:[null],google_owner_gmail:[null],profiles_ids:this.fb.array([],r.kI.required),is_inner:[!0],color_hex:["#3788d8",r.kI.required]})}ngOnInit(){"edit"===this.data.type&&(this.data.eventType.color_hex=this.data.eventType.color_hex?this.data.eventType.color_hex:"#3788d8",this.form.addControl("id",new r.NI(this.data.eventType.id)),this.form.patchValue(this.data.eventType),this.data.eventType.access_users.length>0&&this.data.eventType.access_users.forEach(_=>{this.form.get("profiles_ids").push(this.fb.group({profile_id:[_.user_profile.id,r.kI.required],employees_ids:[_.access_users_employees.map(g=>g.employee.id),r.kI.required]}))})),"create"===this.data.type&&this.form.get("profiles_ids").push(this.fb.group({profile_id:[null,r.kI.required],employees_ids:[[],r.kI.required]}))}get users(){return this.form.get("profiles_ids")}addUser(){this.form.get("profiles_ids").push(this.fb.group({profile_id:[null,r.kI.required],employees_ids:[[],r.kI.required]}))}removeUser(_){this.form.get("profiles_ids").removeAt(_)}onSave(){switch(this.isSaving=!0,this.data.type){case"create":this.createEventType();break;case"edit":this.editEventType()}}createEventType(){this.eventTypesService.create(this.form.value).subscribe({next:g=>this.dialogRef.close(g),error:()=>this.isSaving=!1})}editEventType(){this.eventTypesService.update(this.form.value).subscribe({next:g=>this.dialogRef.close(g),error:()=>this.isSaving=!1})}onSelectUserProfile(_,g){g.get("profile_id").patchValue(_)}onSelectEmployees(_,g){_?g.get("employees_ids").patchValue(_):g.get("employees_ids").patchValue(null)}}return v.\u0275fac=function(_){return new(_||v)(e.Y36(F.so),e.Y36(P.B),e.Y36(r.qu),e.Y36(F.WI))},v.\u0275cmp=e.Xpm({type:v,selectors:[["pek-create-edit-event-type"]],decls:24,vars:9,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"row-1"],[1,"form-group"],["for","name"],["pInputText","","formControlName","name","type","text","id","name",1,"form-control"],[1,"form-group","ml-3","form-group_color"],["formControlName","color_hex"],["formArrayName","profiles_ids",1,"employees"],["class","employees-row",3,"formGroupName",4,"ngFor","ngForOf"],["pButton","","type","button","icon","pi pi-plus","label","Add User",1,"add-button","mt-2","mb-2",3,"click"],["for","description"],["id","description","pInputTextarea","","formControlName","description",3,"rows","autoResize"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"],[1,"employees-row",3,"formGroupName"],[1,"employees-col"],[3,"currentUserProfileId","selectUserProfile"],[3,"currentEmployeeIds","selectEmployees"],["pButton","","type","button","icon","pi pi-times",1,"p-button-rounded","p-button-danger","mr-2",3,"click"]],template:function(_,g){1&_&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.qZA()(),e.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"div",4)(7,"label",5),e._uU(8,"Name*"),e.qZA(),e._UZ(9,"input",6),e.qZA(),e.TgZ(10,"div",7)(11,"label",5),e._uU(12," Color "),e.qZA(),e._UZ(13,"p-colorPicker",8),e.qZA()(),e.TgZ(14,"div",9),e.YNc(15,H,11,3,"div",10),e.qZA(),e.TgZ(16,"button",11),e.NdJ("click",function(){return g.addUser()}),e.qZA(),e.TgZ(17,"div",4)(18,"label",12),e._uU(19,"Description*"),e.qZA(),e._UZ(20,"textarea",13),e.qZA()()(),e.TgZ(21,"mat-dialog-actions",14),e._UZ(22,"button",15),e.TgZ(23,"button",16),e.NdJ("click",function(){return g.onSave()}),e.qZA()()),2&_&&(e.xp6(2),e.hij(" ",g.data.type," Company Category "),e.xp6(2),e.Q6J("formGroup",g.form),e.xp6(11),e.Q6J("ngForOf",g.users.controls),e.xp6(5),e.Q6J("rows",2)("autoResize",!1),e.xp6(2),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("label",g.data.type)("loading",g.isSaving)("disabled",g.form.invalid))},styles:[".row-1[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.row-1[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]:first-child{width:100%}.employees-col[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.employees-col[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{width:45%}.employees-col[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:.6875rem}.add-button[_ngcontent-%COMP%]{font-weight:600;padding:.5rem 1.125rem;color:var(--theme-color-primary);background:rgba(59,130,246,.04);cursor:pointer;width:-moz-fit-content;width:fit-content;border-radius:.625rem;border:none}.add-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}"]}),v})()},4361:(z,Y,c)=>{c.d(Y,{Q:()=>v});var r=c(4006),F=c(6319),e=c(4650),P=c(3973);function H(V,_){if(1&V){const g=e.EpF();e.ynx(0),e.TgZ(1,"pek-crm-contact-person-picker",9),e.NdJ("selectContactPerson",function(b){e.CHM(g);const C=e.oxw();return e.KtG(C.onSelectContactPerson(b))}),e.qZA(),e.BQk()}if(2&V){const g=e.oxw();e.xp6(1),e.Q6J("currentContactPersonId",g.form.get("to_contact").value)}}function a(V,_){if(1&V){const g=e.EpF();e.ynx(0),e.TgZ(1,"pek-crm-contact-person-picker",9),e.NdJ("selectContactPerson",function(b){e.CHM(g);const C=e.oxw();return e.KtG(C.onSelectContactPersonFromContact(b))}),e.qZA(),e.BQk()}if(2&V){const g=e.oxw();e.xp6(1),e.Q6J("currentContactPersonId",g.form.get("from_contact").value)}}let v=(()=>{class V{constructor(g,f,b,C){this.fb=g,this.dialogRef=f,this.contactPersonService=b,this.data=C,this.isSaving=!1,this.form=this.fb.group({to_contact:[null,[r.kI.required]],link_weight:[0,[r.kI.required]]})}ngOnInit(){"edit"===this.data.type&&(this.form.get("link_weight").patchValue(this.data.contactPerson.link_weight),this.form.get("to_contact").patchValue(this.data.contactPerson.to_contact),this.form.addControl("from_contact",new r.NI(this.data.contactPerson.from_contact.id)))}onSave(){switch(this.isSaving=!0,this.data.type){case"create":this.createLinkedContact();break;case"edit":this.editLinkedContact()}}createLinkedContact(){this.contactPersonService.linkContact(this.data.person.id,this.form.value).subscribe({next:f=>this.dialogRef.close(f),error:()=>this.isSaving=!1})}editLinkedContact(){this.contactPersonService.linkContact(this.data.person.id,this.form.value).subscribe({next:f=>this.dialogRef.close(f),error:()=>this.isSaving=!1})}onSelectContactPerson(g){this.form.get("to_contact").patchValue(g)}onSelectContactPersonFromContact(g){this.form.get("from_contact").patchValue(g)}}return V.\u0275fac=function(g){return new(g||V)(e.Y36(r.qu),e.Y36(F.so),e.Y36(P._),e.Y36(F.WI))},V.\u0275cmp=e.Xpm({type:V,selectors:[["pek-create-edit-linked-contact"]],decls:18,vars:11,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"form-group"],[4,"ngIf"],["formControlName","link_weight",3,"min","max"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"],[3,"currentContactPersonId","selectContactPerson"]],template:function(g,f){1&g&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2),e.qZA()(),e.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"label"),e._uU(7," Contact Person* "),e.qZA(),e.YNc(8,H,2,1,"ng-container",4),e.YNc(9,a,2,1,"ng-container",4),e.qZA(),e.TgZ(10,"div",3)(11,"div",3)(12,"label"),e._uU(13),e.qZA(),e._UZ(14,"p-slider",5),e.qZA()()()(),e.TgZ(15,"mat-dialog-actions",6),e._UZ(16,"button",7),e.TgZ(17,"button",8),e.NdJ("click",function(){return f.onSave()}),e.qZA()()),2&g&&(e.xp6(2),e.hij(" ",f.data.type," Linked Company "),e.xp6(2),e.Q6J("formGroup",f.form),e.xp6(4),e.Q6J("ngIf","create"===f.data.type),e.xp6(1),e.Q6J("ngIf","edit"===f.data.type),e.xp6(4),e.hij("Connection Weight*: ",f.form.get("link_weight").value,""),e.xp6(1),e.Q6J("min",0)("max",10),e.xp6(2),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("label",f.data.type)("loading",f.isSaving)("disabled",f.form.invalid))}}),V})()},9290:(z,Y,c)=>{c.d(Y,{F:()=>g});var r=c(4650),F=c(7579),e=c(2722),P=c(9038),H=c(6895),a=c(4006),v=c(5722);function V(f,b){if(1&f){const C=r.EpF();r.TgZ(0,"p-multiSelect",3),r.NdJ("ngModelChange",function(d){r.CHM(C);const E=r.oxw();return r.KtG(E.selectedEmployees=d)})("ngModelChange",function(d){r.CHM(C);const E=r.oxw();return r.KtG(E.onSelectEmployees(d))}),r.qZA()}if(2&f){const C=r.oxw();r.Q6J("options",C.employees)("ngModel",C.selectedEmployees)("showClear",!0)}}function _(f,b){1&f&&(r.TgZ(0,"div",4),r._UZ(1,"i",5),r.qZA())}let g=(()=>{class f{constructor(C){this.crmEmployeeService=C,this.currentEmployeeIds=[],this.selectEmployees=new r.vpe,this.isLoading=!0,this.employees=[],this.selectedEmployees=[],this.destroy$=new F.x}ngOnInit(){this.crmEmployeeService.get().pipe((0,e.R)(this.destroy$)).subscribe(C=>{this.employees=C,this.findEmployees(),this.isLoading=!1})}ngOnChanges(C){"currentEmployeeIds"in C&&(this.selectedEmployees=[],this.findEmployees())}onSelectEmployees(C){this.selectEmployees.emit(C?C.map(w=>w.id):null)}findEmployees(){this.currentEmployeeIds?.length>0&&this.currentEmployeeIds.forEach(C=>{const w=this.employees.find(d=>d.id===C);w&&this.selectedEmployees.push(w)})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}}return f.\u0275fac=function(C){return new(C||f)(r.Y36(P.R))},f.\u0275cmp=r.Xpm({type:f,selectors:[["pek-crm-employee-picker"]],inputs:{currentEmployeeIds:"currentEmployeeIds"},outputs:{selectEmployees:"selectEmployees"},features:[r.TTD],decls:4,vars:2,consts:[[1,"crm-employee-picker"],["optionLabel","fullName","placeholder","Select Employees",3,"options","ngModel","showClear","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["optionLabel","fullName","placeholder","Select Employees",3,"options","ngModel","showClear","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(C,w){if(1&C&&(r.TgZ(0,"div",0),r.YNc(1,V,1,3,"p-multiSelect",1),r.YNc(2,_,2,0,"ng-template",null,2,r.W1O),r.qZA()),2&C){const d=r.MAs(3);r.xp6(1),r.Q6J("ngIf",!w.isLoading)("ngIfElse",d)}},dependencies:[H.O5,a.JJ,a.On,v.NU]}),f})()},2665:(z,Y,c)=>{c.d(Y,{O:()=>g});var r=c(4650),F=c(7579),e=c(2722),P=c(5151),H=c(6895),a=c(4006),v=c(666);function V(f,b){if(1&f){const C=r.EpF();r.TgZ(0,"p-dropdown",3),r.NdJ("ngModelChange",function(d){r.CHM(C);const E=r.oxw();return r.KtG(E.selectedEventTypeId=d)})("ngModelChange",function(){r.CHM(C);const d=r.oxw();return r.KtG(d.onSelectEventType())}),r.qZA()}if(2&f){const C=r.oxw();r.Q6J("options",C.eventTypes)("ngModel",C.selectedEventTypeId)("showClear",!0)}}function _(f,b){1&f&&(r.TgZ(0,"div",4),r._UZ(1,"i",5),r.qZA())}let g=(()=>{class f{constructor(C){this.eventTypeService=C,this.selectEventType=new r.vpe,this.filters=[],this.isLoading=!0,this.eventTypes=[],this.destroy$=new F.x}ngOnInit(){this.filters.length>0?this.eventTypeService.getByFilters(this.filters).pipe((0,e.R)(this.destroy$)).subscribe(C=>{this.eventTypes=C,this.currentEventTypeId&&(this.selectedEventTypeId=this.currentEventTypeId),this.isLoading=!1}):this.eventTypeService.get().pipe((0,e.R)(this.destroy$)).subscribe(C=>{this.eventTypes=C,this.currentEventTypeId&&(this.selectedEventTypeId=this.currentEventTypeId),this.isLoading=!1})}onSelectEventType(){this.selectEventType.emit(this.selectedEventTypeId)}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}}return f.\u0275fac=function(C){return new(C||f)(r.Y36(P.B))},f.\u0275cmp=r.Xpm({type:f,selectors:[["pek-crm-event-type-picker"]],inputs:{currentEventTypeId:"currentEventTypeId",filters:"filters"},outputs:{selectEventType:"selectEventType"},decls:4,vars:2,consts:[[1,"crm-event-type-picker"],["placeholder","Select Event Type","optionLabel","name","optionValue","id",3,"options","ngModel","showClear","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["placeholder","Select Event Type","optionLabel","name","optionValue","id",3,"options","ngModel","showClear","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(C,w){if(1&C&&(r.TgZ(0,"div",0),r.YNc(1,V,1,3,"p-dropdown",1),r.qZA(),r.YNc(2,_,2,0,"ng-template",null,2,r.W1O)),2&C){const d=r.MAs(3);r.xp6(1),r.Q6J("ngIf",!w.isLoading)("ngIfElse",d)}},dependencies:[H.O5,a.JJ,v.Lt,a.On]}),f})()},3973:(z,Y,c)=>{c.d(Y,{_:()=>T});var r=c(2340),F=c(9646),e=c(4004),P=c(4006),H=c(6319),a=c(4650),v=c(5593),V=c(1740),_=c(3054);let g=(()=>{class x{constructor(u,m,k,R){this.fb=u,this.contactPersonService=m,this.dialogRef=k,this.data=R,this.isSaving=!1,this.form=this.fb.group({first_name:[null,[P.kI.required]],last_name:[null,[P.kI.required]],email:["",[P.kI.email]],position:[""],phone_number:[""],comment:[""],company:[this.data.companyId]})}ngOnInit(){"edit"===this.data.type&&(this.form.addControl("id",new P.NI(this.data.contactPerson.id)),this.form.patchValue(this.data.contactPerson))}onSave(){switch(this.isSaving=!0,this.data.type){case"create":this.createContactPerson();break;case"edit":this.editContactPerson()}}createContactPerson(){this.contactPersonService.create(this.form.value).subscribe({next:m=>this.dialogRef.close(m),error:()=>this.isSaving=!1})}editContactPerson(){this.contactPersonService.update(this.form.value).subscribe({next:m=>this.dialogRef.close(m),error:()=>this.isSaving=!1})}}return x.\u0275fac=function(u){return new(u||x)(a.Y36(P.qu),a.Y36(T),a.Y36(H.so),a.Y36(H.WI))},x.\u0275cmp=a.Xpm({type:x,selectors:[["pek-create-edit-contact-person"]],decls:35,vars:8,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"row"],[1,"col-6"],[1,"form-group"],["for","first_name"],["pInputText","","formControlName","first_name","type","text","id","first_name","required","required",1,"form-control"],["for","last_name"],["pInputText","","formControlName","last_name","type","text","id","last_name","required","required",1,"form-control"],["for","email"],["pInputText","","formControlName","email","type","text","id","email",1,"form-control"],["for","position"],["pInputText","","formControlName","position","type","text","id","position",1,"form-control"],["for","phone_number"],["pInputText","","formControlName","phone_number","type","text","id","phone_number",1,"form-control"],["for","comment"],["id","comment","pInputTextarea","","formControlName","comment",3,"rows","autoResize"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"]],template:function(u,m){1&u&&(a.TgZ(0,"div",0)(1,"h2",1),a._uU(2),a.qZA()(),a.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"label",6),a._uU(9,"First Name*"),a.qZA(),a._UZ(10,"input",7),a.qZA()(),a.TgZ(11,"div",4)(12,"div",5)(13,"label",8),a._uU(14,"Last Name*"),a.qZA(),a._UZ(15,"input",9),a.qZA()()(),a.TgZ(16,"div",5)(17,"label",10),a._uU(18," Email "),a.qZA(),a._UZ(19,"input",11),a.qZA(),a.TgZ(20,"div",5)(21,"label",12),a._uU(22," Position "),a.qZA(),a._UZ(23,"input",13),a.qZA(),a.TgZ(24,"div",5)(25,"label",14),a._uU(26," Phone"),a.qZA(),a._UZ(27,"input",15),a.qZA(),a.TgZ(28,"div",5)(29,"label",16),a._uU(30," Comment "),a.qZA(),a._UZ(31,"textarea",17),a.qZA()()(),a.TgZ(32,"mat-dialog-actions",18),a._UZ(33,"button",19),a.TgZ(34,"button",20),a.NdJ("click",function(){return m.onSave()}),a.qZA()()),2&u&&(a.xp6(2),a.hij(" ",m.data.type," Contact Person "),a.xp6(2),a.Q6J("formGroup",m.form),a.xp6(27),a.Q6J("rows",2)("autoResize",!1),a.xp6(2),a.Q6J("mat-dialog-close",!1),a.xp6(1),a.Q6J("label",m.data.type)("loading",m.isSaving)("disabled",m.form.invalid))},dependencies:[v.Hq,V.o,P._Y,P.Fj,P.JJ,P.JL,P.Q7,P.sg,P.u,H.ZT,H.xY,H.H8,_.g]}),x})();var f=c(4361),b=c(8746),C=c(1814),w=c(6767),d=c(6895),E=c(585),A=c(1424),B=c(9290),J=c(2665);function q(x,I){if(1&x){const u=a.EpF();a.TgZ(0,"div",3)(1,"label"),a._uU(2,"Employees*"),a.qZA(),a.TgZ(3,"pek-crm-employee-picker",12),a.NdJ("selectEmployees",function(k){a.CHM(u);const R=a.oxw();return a.KtG(R.onSelectEmployees(k))}),a.qZA()()}}function $(x,I){if(1&x){const u=a.EpF();a.ynx(0),a.TgZ(1,"div",13)(2,"div",14)(3,"div",3)(4,"label"),a._uU(5,"Start Date and Time*"),a.qZA(),a.TgZ(6,"pek-date-time-picker",15),a.NdJ("clearDate",function(){a.CHM(u);const k=a.oxw();return a.KtG(k.onClearStartDate())})("setDate",function(k){a.CHM(u);const R=a.oxw();return a.KtG(R.onSetStartDate(k))}),a.qZA()()(),a.TgZ(7,"div",14)(8,"div",3)(9,"label"),a._uU(10,"End Date and Time*"),a.qZA(),a.TgZ(11,"pek-date-time-picker",16),a.NdJ("clearDate",function(){a.CHM(u);const k=a.oxw();return a.KtG(k.onClearEndDate())})("setDate",function(k){a.CHM(u);const R=a.oxw();return a.KtG(R.onSetEndDate(k))}),a.qZA()()()(),a.BQk()}if(2&x){const u=a.oxw();let m,k;a.xp6(6),a.Q6J("maxDate",null==(m=u.form.get("end"))?null:m.value),a.xp6(5),a.Q6J("minDate",null==(k=u.form.get("start"))?null:k.value)}}function Q(x,I){if(1&x){const u=a.EpF();a.ynx(0),a.TgZ(1,"div",17),a.NdJ("click",function(){a.CHM(u);const k=a.oxw();return a.KtG(k.onOpenDatesEmployees())}),a.TgZ(2,"div",14)(3,"div",3)(4,"label"),a._uU(5,"Start Date and Time*"),a.qZA(),a._UZ(6,"p-calendar",18),a.qZA()(),a.TgZ(7,"div",14)(8,"div",3)(9,"label"),a._uU(10,"End Date and Time*"),a.qZA(),a._UZ(11,"p-calendar",19),a.qZA()()(),a.BQk()}if(2&x){const u=a.oxw();let m,k;a.xp6(1),a.ekj("disabled",0===u.form.get("employee_ids").value.length),a.xp6(5),a.Q6J("minDate",null==(m=u.form.get("end"))?null:m.value)("showTime",!0)("showClear",!0)("showButtonBar",!0),a.xp6(5),a.Q6J("minDate",null==(k=u.form.get("start"))?null:k.value)("showTime",!0)("showClear",!0)("showButtonBar",!0)}}const X=function(){return{name:"is_inner",value:!0}},N=function(){return{name:"is_auto",value:!1}},O=function(x,I){return[x,I]};let p=(()=>{class x{constructor(u,m,k,R,ee){this.dialogRef=u,this.fb=m,this.eventListService=k,this.adapterService=R,this.data=ee,this.isSaving=!1,this.form=this.fb.group({event_type:[null,[P.kI.required]],start:[null,P.kI.required],end:[null,P.kI.required],contact_person_ids:[[this.data.contactPerson.id]],description:[""],company_ids:[[]],contact_ids:[[this.data.contactPerson.id]],employee_ids:[[]],canOverlap:[!1]})}ngOnInit(){}onSave(){if(this.form.valid){this.isSaving=!0;const u=this.form.value;u.start=this.adapterService.dateTimeAdapter(this.form.value.start),u.end=this.adapterService.dateTimeAdapter(this.form.value.end),this.eventListService.create(u).pipe((0,b.x)(()=>this.isSaving=!1)).subscribe(m=>this.dialogRef.close(m))}}onSelectEventType(u){this.form.get("event_type").patchValue(u)}onSelectEmployees(u){u?this.form.get("employee_ids").patchValue(u):this.form.get("employee_ids").patchValue([])}onOpenDatesEmployees(){this.eventListService.openEditEmployeeEventDatesModal(this.form.get("employee_ids").value,this.form.value).subscribe(u=>{u&&this.form.patchValue(u)})}onSetStartDate(u){this.form.get("start").patchValue(u)}onSetEndDate(u){this.form.get("end").patchValue(u)}onClearStartDate(){this.form.get("start").patchValue(null)}onClearEndDate(){this.form.get("end").patchValue(null)}}return x.\u0275fac=function(u){return new(u||x)(a.Y36(H.so),a.Y36(P.qu),a.Y36(C.T),a.Y36(w.v),a.Y36(H.WI))},x.\u0275cmp=a.Xpm({type:x,selectors:[["pek-add-event-to-contact-person"]],decls:19,vars:17,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"form-group"],[3,"filters","selectEventType"],["class","form-group",4,"ngIf"],[4,"ngIf"],["for","description"],["id","description","pInputTextarea","","formControlName","description",3,"rows","autoResize"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"],[3,"selectEmployees"],[1,"row"],[1,"col-6"],["placeholder","Choice Start Date and Time",3,"maxDate","clearDate","setDate"],["placeholder","Choice End Date and Time",3,"minDate","clearDate","setDate"],[1,"row","select-date",3,"click"],["dateFormat","dd/mm/yy","hourFormat","24","formControlName","start","placeholder","Choice Start Date and Time",3,"minDate","showTime","showClear","showButtonBar"],["dateFormat","dd/mm/yy","hourFormat","24","formControlName","end","placeholder","Choice End Date and Time",3,"minDate","showTime","showClear","showButtonBar"]],template:function(u,m){1&u&&(a.TgZ(0,"div",0)(1,"h2",1),a._uU(2),a.qZA()(),a.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"label"),a._uU(7,"Event Type*"),a.qZA(),a.TgZ(8,"pek-crm-event-type-picker",4),a.NdJ("selectEventType",function(R){return m.onSelectEventType(R)}),a.qZA()(),a.YNc(9,q,4,0,"div",5),a.YNc(10,$,12,2,"ng-container",6),a.YNc(11,Q,12,10,"ng-container",6),a.TgZ(12,"div",3)(13,"label",7),a._uU(14,"Description"),a.qZA(),a._UZ(15,"textarea",8),a.qZA()()(),a.TgZ(16,"mat-dialog-actions",9),a._UZ(17,"button",10),a.TgZ(18,"button",11),a.NdJ("click",function(){return m.onSave()}),a.qZA()()),2&u&&(a.xp6(2),a.hij(" Add Event to Contact ","withEmployee"===m.data.type?"with":"without"," Employee "),a.xp6(2),a.Q6J("formGroup",m.form),a.xp6(4),a.Q6J("filters",a.WLB(14,O,a.DdM(12,X),a.DdM(13,N))),a.xp6(1),a.Q6J("ngIf","withEmployee"===m.data.type),a.xp6(1),a.Q6J("ngIf","withoutEmployee"===m.data.type),a.xp6(1),a.Q6J("ngIf","withEmployee"===m.data.type),a.xp6(4),a.Q6J("rows",2)("autoResize",!0),a.xp6(2),a.Q6J("mat-dialog-close",!1),a.xp6(1),a.Q6J("label","Add")("loading",m.isSaving)("disabled",m.form.invalid))},dependencies:[d.O5,v.Hq,P._Y,P.Fj,P.JJ,P.JL,P.sg,P.u,H.ZT,H.xY,H.H8,_.g,E.f,A.J,B.F,J.O],styles:[".select-date[_ngcontent-%COMP%], .select-date[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer}.select-date[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   p-calendar[_ngcontent-%COMP%]{pointer-events:none}.disabled[_ngcontent-%COMP%]{pointer-events:none;cursor:default}.disabled[_ngcontent-%COMP%]   p-calendar[_ngcontent-%COMP%]{opacity:.7}"]}),x})();var h=c(529);let T=(()=>{class x{constructor(u,m){this.httpClient=u,this.dialog=m,this.API_URL=r.N.base_url+r.N.business_partners_url,this.url="contact_persons/"}get(u){return this.contactPersons?(0,F.of)(this.contactPersons):this.getForce(u,!0)}getForce(u,m=!1){let k="";return u&&u.forEach((R,ee)=>{k+=ee>0?"&"+R.name+"="+R.value:"?"+R.name+"="+R.value}),this.httpClient.get(this.API_URL+this.url+"all/"+k).pipe((0,e.U)(R=>{const ee=R.data.map(re=>({...re,fullName:`${re.first_name} ${re.last_name}`}));return m&&(this.contactPersons=ee),ee}))}getById(u){return this.httpClient.get(this.API_URL+this.url+u+"/").pipe((0,e.U)(m=>m.data))}create(u){return this.httpClient.post(this.API_URL+this.url,u).pipe((0,e.U)(m=>m.data))}update(u){return this.httpClient.put(this.API_URL+this.url+u.id+"/",u).pipe((0,e.U)(m=>m.data))}delete(u){return this.httpClient.delete(this.API_URL+this.url+u+"/")}linkContact(u,m){return this.httpClient.post(this.API_URL+this.url+u+"/link_contact/",m).pipe((0,e.U)(k=>k.data))}deleteLinkedContact(u){return this.httpClient.delete(this.API_URL+"linked_contacts/"+u.id+"/")}openCreateEditLinkedContactModal(u,m,k){return this.dialog.open(f.Q,{width:"35rem",height:"auto",panelClass:"modal-overflow-visible",data:{type:u,person:m,contactPerson:k},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}createEditContactPersonModal(u,m,k){return this.dialog.open(g,{width:"50rem",height:"auto",data:{companyId:u,type:m,contactPerson:k},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}openAddEventToContactPersonModal(u,m){return this.dialog.open(p,{width:"50rem",height:"auto",panelClass:"modal-overflow-visible",data:{type:u,contactPerson:m},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}}return x.\u0275fac=function(u){return new(u||x)(a.LFG(h.eN),a.LFG(H.uw))},x.\u0275prov=a.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},5151:(z,Y,c)=>{c.d(Y,{B:()=>C});var r=c(9646),F=c(4004),e=c(2340),P=c(8739),H=c(6319),a=c(4006),v=c(4650),V=c(5593),_=c(1740),g=c(5369);let f=(()=>{class w{constructor(E,A,B,J){this.dialogRef=E,this.eventTypesService=A,this.fb=B,this.data=J,this.isSaving=!1,this.form=this.fb.group({google_calendar_id:[null,[a.kI.required]],google_owner_first_name:[null],google_owner_last_name:[null],color_hex:["#3788d8"],profiles_ids:[[]],google_owner_gmail:[null,[a.kI.email]]})}ngOnInit(){"edit"===this.data.type&&(this.data.eventType.color_hex=this.data.eventType.color_hex?this.data.eventType.color_hex:"#3788d8",this.form.addControl("id",new a.NI(this.data.eventType.id)),this.form.patchValue(this.data.eventType))}onSave(){switch(this.isSaving=!0,this.data.type){case"create":this.createEventType();break;case"edit":this.editEventType()}}createEventType(){this.eventTypesService.addCalendarFromGoogle(this.form.value).subscribe({next:A=>this.dialogRef.close(A),error:()=>this.isSaving=!1})}editEventType(){this.eventTypesService.update(this.form.value).subscribe({next:A=>this.dialogRef.close(A),error:()=>this.isSaving=!1})}}return w.\u0275fac=function(E){return new(E||w)(v.Y36(H.so),v.Y36(C),v.Y36(a.qu),v.Y36(H.WI))},w.\u0275cmp=v.Xpm({type:w,selectors:[["pek-create-edit-external-event-type"]],decls:28,vars:6,consts:[[1,"modal-header"],[1,"modal-header__title"],[3,"formGroup"],[1,"form-group"],["for","calendar"],["pInputText","","formControlName","google_calendar_id","type","text","id","calendar",1,"form-control"],["for","first-name"],["pInputText","","formControlName","google_owner_first_name","type","text","id","first-name",1,"form-control"],["for","last-name"],["pInputText","","formControlName","google_owner_last_name","type","text","id","last-name",1,"form-control"],["for","gmail"],["pInputText","","formControlName","google_owner_gmail","type","text","id","gmail",1,"form-control"],[1,"form-group","form-group_color"],["formControlName","color_hex"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"]],template:function(E,A){1&E&&(v.TgZ(0,"div",0)(1,"h2",1),v._uU(2),v.qZA()(),v.TgZ(3,"mat-dialog-content")(4,"form",2)(5,"div",3)(6,"label",4),v._uU(7,"Google Calendar ID*"),v.qZA(),v._UZ(8,"input",5),v.qZA(),v.TgZ(9,"div",3)(10,"label",6),v._uU(11,"First Name"),v.qZA(),v._UZ(12,"input",7),v.qZA(),v.TgZ(13,"div",3)(14,"label",8),v._uU(15,"Last Name"),v.qZA(),v._UZ(16,"input",9),v.qZA(),v.TgZ(17,"div",3)(18,"label",10),v._uU(19,"Gmail"),v.qZA(),v._UZ(20,"input",11),v.qZA(),v.TgZ(21,"div",12)(22,"label"),v._uU(23," Color "),v.qZA(),v._UZ(24,"p-colorPicker",13),v.qZA()()(),v.TgZ(25,"mat-dialog-actions",14),v._UZ(26,"button",15),v.TgZ(27,"button",16),v.NdJ("click",function(){return A.onSave()}),v.qZA()()),2&E&&(v.xp6(2),v.hij(" ",A.data.type," Company Category "),v.xp6(2),v.Q6J("formGroup",A.form),v.xp6(22),v.Q6J("mat-dialog-close",!1),v.xp6(1),v.Q6J("label",A.data.type)("loading",A.isSaving)("disabled",A.form.invalid))},dependencies:[V.Hq,_.o,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,H.ZT,H.xY,H.H8,g.zH]}),w})();var b=c(529);let C=(()=>{class w{constructor(E,A){this.httpClient=E,this.dialog=A,this.API_URL=e.N.base_url+e.N.business_partners_url,this.url="event_types/"}get(E=[],A=!0){A&&E.push({name:"is_inner",value:!0});let B="";return E&&E.forEach((J,q)=>{B+=q>0?"&"+J.name+"="+J.value:"?"+J.name+"="+J.value}),this.httpClient.get(this.API_URL+this.url+B).pipe((0,F.U)(J=>{const q=J.data;return this.eventTypes=q,q}))}getNoneCache(E=[]){let A="";return E&&E.forEach((B,J)=>{A+=J>0?"&"+B.name+"="+B.value:"?"+B.name+"="+B.value}),this.httpClient.get(this.API_URL+this.url+A).pipe((0,F.U)(B=>B.data))}getExternalEventTypes(E=[]){if(this.externalEventTypes)return(0,r.of)(this.externalEventTypes);E.push({name:"is_inner",value:!1});let A="";return E&&E.forEach((B,J)=>{A+=J>0?"&"+B.name+"="+B.value:"?"+B.name+"="+B.value}),this.httpClient.get(this.API_URL+this.url+A).pipe((0,F.U)(B=>{const J=B.data;return this.externalEventTypes=J,J}))}getByFilters(E){let A="";return E&&E.forEach((B,J)=>{A+=J>0?"&"+B.name+"="+B.value:"?"+B.name+"="+B.value}),this.httpClient.get(this.API_URL+this.url+A).pipe((0,F.U)(B=>B.data))}create(E){return this.httpClient.post(this.API_URL+this.url,E).pipe((0,F.U)(A=>A.data))}update(E){return this.httpClient.patch(this.API_URL+this.url+E.id+"/",E).pipe((0,F.U)(A=>A.data))}delete(E){return this.httpClient.delete(this.API_URL+this.url+E.id+"/")}addCalendarFromGoogle(E){return this.httpClient.post(this.API_URL+this.url+"add_calendar_from_google/",E).pipe((0,F.U)(A=>A.data))}createEditEventType(E,A){return this.dialog.open(P.g,{width:"50rem",height:"auto",panelClass:"modal-overflow-visible",data:{type:E,eventType:A},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}createEditExternalEventType(E,A){return this.dialog.open(f,{width:"50rem",height:"auto",panelClass:"modal-overflow-visible",data:{type:E,eventType:A},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}}return w.\u0275fac=function(E){return new(E||w)(v.LFG(b.eN),v.LFG(H.uw))},w.\u0275prov=v.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"}),w})()},2660:(z,Y,c)=>{c.d(Y,{Q:()=>_});var r=c(4650),F=c(4006),e=c(5698),P=c(855),H=c(6895),a=c(666);function v(g,f){if(1&g){const b=r.EpF();r.TgZ(0,"p-dropdown",2),r.NdJ("ngModelChange",function(w){r.CHM(b);const d=r.oxw();return r.KtG(d.currency=w)})("ngModelChange",function(w){r.CHM(b);const d=r.oxw();return r.KtG(d.onChange(w))}),r.qZA()}if(2&g){const b=r.oxw();r.Q6J("filter",!0)("showClear",b.showClear)("ngModel",b.currency)("options",b.currencies)("disabled",b.isLoading||b.isDisabled)}}function V(g,f){1&g&&(r.TgZ(0,"div",3),r._UZ(1,"i",4),r.qZA())}let _=(()=>{class g{constructor(b){this.currencyService=b,this.valueChange=new r.vpe,this.isLoading=!0}ngOnInit(){this.getAll()}getAll(){this.currencyService.get().pipe((0,e.q)(1)).subscribe(b=>{this.currencies=b,this.isLoading=!1})}onChange(b){this.setValue(b)}registerOnChange(b){this.valueChange.subscribe(b)}registerOnTouched(b){}setValue(b){this.currency=b,this.valueChange.emit(this.currencies.find(C=>C.code===this.currency))}writeValue(b){this.currency=b}}return g.\u0275fac=function(b){return new(b||g)(r.Y36(P.t))},g.\u0275cmp=r.Xpm({type:g,selectors:[["pek-currency-picker"]],inputs:{currency:"currency",showClear:"showClear",isDisabled:"isDisabled"},outputs:{valueChange:"valueChange"},features:[r._Bn([{provide:F.JU,useExisting:(0,r.Gpc)(()=>g),multi:!0}])],decls:3,vars:2,consts:[["optionValue","code","optionLabel","name","placeholder","Choose Currency",3,"filter","showClear","ngModel","options","disabled","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["optionValue","code","optionLabel","name","placeholder","Choose Currency",3,"filter","showClear","ngModel","options","disabled","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(b,C){if(1&b&&(r.YNc(0,v,1,5,"p-dropdown",0),r.YNc(1,V,2,0,"ng-template",null,1,r.W1O)),2&b){const w=r.MAs(2);r.Q6J("ngIf",!C.isLoading)("ngIfElse",w)}},dependencies:[H.O5,F.JJ,a.Lt,F.On]}),g})()},2083:(z,Y,c)=>{c.d(Y,{D:()=>V});var r=c(4650),F=c(2334),e=c(5722),P=c(6895),H=c(4006);function a(_,g){if(1&_){const f=r.EpF();r.TgZ(0,"p-multiSelect",3),r.NdJ("ngModelChange",function(C){r.CHM(f);const w=r.oxw();return r.KtG(w.selectedCountries=C)})("ngModelChange",function(C){r.CHM(f);const w=r.oxw();return r.KtG(w.onSelectCountries(C))}),r.qZA()}if(2&_){const f=r.oxw();r.Q6J("showClear",f.showClear)("options",f.countries)("ngModel",f.selectedCountries)}}function v(_,g){1&_&&(r.TgZ(0,"div",4),r._UZ(1,"i",5),r.qZA())}let V=(()=>{class _{constructor(f){this.countryService=f,this.currentCountriesIds=[],this.currentCountries=[],this.showClear=!0,this.selectCountries=new r.vpe,this.isLoading=!0,this.countries=[],this.selectedCountries=[]}ngOnInit(){this.countryService.get().pipe().subscribe(f=>{this.countries=f,this.findCountries(),this.isLoading=!1})}ngOnChanges(f){("currentTechnologiesIds"in f||"currentCountries"in f)&&(this.selectedCountries=[],this.findCountries())}onSelectCountries(f){this.selectCountries.emit(f||null)}findCountries(){this.currentCountriesIds?.length>0&&this.currentCountriesIds.forEach(f=>{const b=this.countries.find(C=>C.id===f);b&&this.selectedCountries.push(b)}),this.currentCountries?.length>0&&this.selectedCountries.push(...this.currentCountries)}panelShow(f){console.log("panelShow",f)}}return _.\u0275fac=function(f){return new(f||_)(r.Y36(F.T))},_.\u0275cmp=r.Xpm({type:_,selectors:[["pek-multi-countries-picker"]],inputs:{currentCountriesIds:"currentCountriesIds",currentCountries:"currentCountries",showClear:"showClear"},outputs:{selectCountries:"selectCountries"},features:[r.TTD],decls:4,vars:2,consts:[[1,"multi-countries-picker"],["optionLabel","name","placeholder","Select Countries",3,"showClear","options","ngModel","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["optionLabel","name","placeholder","Select Countries",3,"showClear","options","ngModel","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(f,b){if(1&f&&(r.TgZ(0,"div",0),r.YNc(1,a,1,3,"p-multiSelect",1),r.YNc(2,v,2,0,"ng-template",null,2,r.W1O),r.qZA()),2&f){const C=r.MAs(3);r.xp6(1),r.Q6J("ngIf",!b.isLoading)("ngIfElse",C)}},dependencies:[e.NU,P.O5,H.JJ,H.On]}),_})()},5369:(z,Y,c)=>{c.d(Y,{e4:()=>X,zH:()=>Q});var r=c(4650),F=c(7340),e=c(6895),P=c(9592),H=c(4006),a=c(982),v=c(805);const V=["container"],_=["input"],g=["colorSelector"],f=["colorHandle"],b=["hue"],C=["hueHandle"],w=function(N){return{"p-disabled":N}};function d(N,O){if(1&N){const p=r.EpF();r.TgZ(0,"input",4,5),r.NdJ("focus",function(){r.CHM(p);const T=r.oxw();return r.KtG(T.onInputFocus())})("click",function(){r.CHM(p);const T=r.oxw();return r.KtG(T.onInputClick())})("keydown",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onInputKeydown(T))}),r.qZA()}if(2&N){const p=r.oxw();r.Udp("background-color",p.inputBgColor),r.Q6J("ngClass",r.VKq(6,w,p.disabled))("disabled",p.disabled),r.uIk("id",p.inputId)("tabindex",p.tabindex)}}const E=function(N,O){return{"p-colorpicker-panel":!0,"p-colorpicker-overlay-panel":N,"p-disabled":O}},A=function(N,O){return{showTransitionParams:N,hideTransitionParams:O}},B=function(N){return{value:"visible",params:N}};function J(N,O){if(1&N){const p=r.EpF();r.TgZ(0,"div",6),r.NdJ("click",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onOverlayClick(T))})("@overlayAnimation.start",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onOverlayAnimationStart(T))})("@overlayAnimation.done",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onOverlayAnimationEnd(T))}),r.TgZ(1,"div",7)(2,"div",8,9),r.NdJ("touchstart",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onColorTouchStart(T))})("touchmove",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onMove(T))})("touchend",function(){r.CHM(p);const T=r.oxw();return r.KtG(T.onDragEnd())})("mousedown",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onColorMousedown(T))}),r.TgZ(4,"div",10),r._UZ(5,"div",11,12),r.qZA()(),r.TgZ(7,"div",13,14),r.NdJ("mousedown",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onHueMousedown(T))})("touchstart",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onHueTouchStart(T))})("touchmove",function(T){r.CHM(p);const x=r.oxw();return r.KtG(x.onMove(T))})("touchend",function(){r.CHM(p);const T=r.oxw();return r.KtG(T.onDragEnd())}),r._UZ(9,"div",15,16),r.qZA()()()}if(2&N){const p=r.oxw();r.Q6J("ngClass",r.WLB(3,E,!p.inline,p.disabled))("@overlayAnimation",r.VKq(9,B,r.WLB(6,A,p.showTransitionOptions,p.hideTransitionOptions)))("@.disabled",!0===p.inline)}}const q=function(N,O){return{"p-colorpicker p-component":!0,"p-colorpicker-overlay":N,"p-colorpicker-dragging":O}},$={provide:H.JU,useExisting:(0,r.Gpc)(()=>Q),multi:!0};let Q=(()=>{class N{constructor(p,h,T,x,I){this.el=p,this.renderer=h,this.cd=T,this.config=x,this.overlayService=I,this.format="hex",this.autoZIndex=!0,this.baseZIndex=0,this.showTransitionOptions=".12s cubic-bezier(0, 0, 0.2, 1)",this.hideTransitionOptions=".1s linear",this.onChange=new r.vpe,this.onShow=new r.vpe,this.onHide=new r.vpe,this.value={h:0,s:100,b:100},this.defaultColor="ff0000",this.onModelChange=()=>{},this.onModelTouched=()=>{}}set colorSelector(p){this.colorSelectorViewChild=p}set colorHandle(p){this.colorHandleViewChild=p}set hue(p){this.hueViewChild=p}set hueHandle(p){this.hueHandleViewChild=p}onHueMousedown(p){this.disabled||(this.bindDocumentMousemoveListener(),this.bindDocumentMouseupListener(),this.hueDragging=!0,this.pickHue(p))}onHueTouchStart(p){this.disabled||(this.hueDragging=!0,this.pickHue(p,p.changedTouches[0]))}onColorTouchStart(p){this.disabled||(this.colorDragging=!0,this.pickColor(p,p.changedTouches[0]))}pickHue(p,h){let T=h?h.pageY:p.pageY,x=this.hueViewChild.nativeElement.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);this.value=this.validateHSB({h:Math.floor(360*(150-Math.max(0,Math.min(150,T-x)))/150),s:this.value.s,b:this.value.b}),this.updateColorSelector(),this.updateUI(),this.updateModel(),this.onChange.emit({originalEvent:p,value:this.getValueToUpdate()})}onColorMousedown(p){this.disabled||(this.bindDocumentMousemoveListener(),this.bindDocumentMouseupListener(),this.colorDragging=!0,this.pickColor(p))}onMove(p){this.colorDragging&&(this.pickColor(p,p.changedTouches[0]),p.preventDefault()),this.hueDragging&&(this.pickHue(p,p.changedTouches[0]),p.preventDefault())}onDragEnd(){this.colorDragging=!1,this.hueDragging=!1,this.unbindDocumentMousemoveListener(),this.unbindDocumentMouseupListener()}pickColor(p,h){let T=h?h.pageX:p.pageX,x=h?h.pageY:p.pageY,I=this.colorSelectorViewChild.nativeElement.getBoundingClientRect(),u=I.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),m=I.left+document.body.scrollLeft,k=Math.floor(100*Math.max(0,Math.min(150,T-m))/150),R=Math.floor(100*(150-Math.max(0,Math.min(150,x-u)))/150);this.value=this.validateHSB({h:this.value.h,s:k,b:R}),this.updateUI(),this.updateModel(),this.onChange.emit({originalEvent:p,value:this.getValueToUpdate()})}getValueToUpdate(){let p;switch(this.format){case"hex":p="#"+this.HSBtoHEX(this.value);break;case"rgb":p=this.HSBtoRGB(this.value);break;case"hsb":p=this.value}return p}updateModel(){this.onModelChange(this.getValueToUpdate())}writeValue(p){if(p)switch(this.format){case"hex":this.value=this.HEXtoHSB(p);break;case"rgb":this.value=this.RGBtoHSB(p);break;case"hsb":this.value=p}else this.value=this.HEXtoHSB(this.defaultColor);this.updateColorSelector(),this.updateUI(),this.cd.markForCheck()}updateColorSelector(){if(this.colorSelectorViewChild){const p={s:100,b:100};p.h=this.value.h,this.colorSelectorViewChild.nativeElement.style.backgroundColor="#"+this.HSBtoHEX(p)}}updateUI(){this.colorHandleViewChild&&this.hueHandleViewChild.nativeElement&&(this.colorHandleViewChild.nativeElement.style.left=Math.floor(150*this.value.s/100)+"px",this.colorHandleViewChild.nativeElement.style.top=Math.floor(150*(100-this.value.b)/100)+"px",this.hueHandleViewChild.nativeElement.style.top=Math.floor(150-150*this.value.h/360)+"px"),this.inputBgColor="#"+this.HSBtoHEX(this.value)}onInputFocus(){this.onModelTouched()}show(){this.overlayVisible=!0,this.cd.markForCheck()}onOverlayAnimationStart(p){switch(p.toState){case"visible":this.inline||(this.overlay=p.element,this.appendOverlay(),this.autoZIndex&&a.P9.set("overlay",this.overlay,this.config.zIndex.overlay),this.alignOverlay(),this.bindDocumentClickListener(),this.bindDocumentResizeListener(),this.bindScrollListener(),this.updateColorSelector(),this.updateUI());break;case"void":this.onOverlayHide()}}onOverlayAnimationEnd(p){switch(p.toState){case"visible":this.inline||this.onShow.emit({});break;case"void":this.autoZIndex&&a.P9.clear(p.element),this.onHide.emit({})}}appendOverlay(){this.appendTo&&("body"===this.appendTo?document.body.appendChild(this.overlay):P.p.appendChild(this.overlay,this.appendTo))}restoreOverlayAppend(){this.overlay&&this.appendTo&&this.el.nativeElement.appendChild(this.overlay)}alignOverlay(){this.appendTo?P.p.absolutePosition(this.overlay,this.inputViewChild.nativeElement):P.p.relativePosition(this.overlay,this.inputViewChild.nativeElement)}hide(){this.overlayVisible=!1,this.cd.markForCheck()}onInputClick(){this.selfClick=!0,this.togglePanel()}togglePanel(){this.overlayVisible?this.hide():this.show()}onInputKeydown(p){switch(p.which){case 32:this.togglePanel(),p.preventDefault();break;case 27:case 9:this.hide()}}onOverlayClick(p){this.overlayService.add({originalEvent:p,target:this.el.nativeElement}),this.selfClick=!0}registerOnChange(p){this.onModelChange=p}registerOnTouched(p){this.onModelTouched=p}setDisabledState(p){this.disabled=p,this.cd.markForCheck()}bindDocumentClickListener(){this.documentClickListener||(this.documentClickListener=this.renderer.listen(this.el?this.el.nativeElement.ownerDocument:"document","click",()=>{this.selfClick||(this.overlayVisible=!1,this.unbindDocumentClickListener()),this.selfClick=!1,this.cd.markForCheck()}))}unbindDocumentClickListener(){this.documentClickListener&&(this.documentClickListener(),this.documentClickListener=null)}bindDocumentMousemoveListener(){this.documentMousemoveListener||(this.documentMousemoveListener=this.renderer.listen(this.el?this.el.nativeElement.ownerDocument:"document","mousemove",h=>{this.colorDragging&&this.pickColor(h),this.hueDragging&&this.pickHue(h)}))}unbindDocumentMousemoveListener(){this.documentMousemoveListener&&(this.documentMousemoveListener(),this.documentMousemoveListener=null)}bindDocumentMouseupListener(){this.documentMouseupListener||(this.documentMouseupListener=this.renderer.listen(this.el?this.el.nativeElement.ownerDocument:"document","mouseup",()=>{this.colorDragging=!1,this.hueDragging=!1,this.unbindDocumentMousemoveListener(),this.unbindDocumentMouseupListener()}))}unbindDocumentMouseupListener(){this.documentMouseupListener&&(this.documentMouseupListener(),this.documentMouseupListener=null)}bindDocumentResizeListener(){this.documentResizeListener=this.onWindowResize.bind(this),window.addEventListener("resize",this.documentResizeListener)}unbindDocumentResizeListener(){this.documentResizeListener&&(window.removeEventListener("resize",this.documentResizeListener),this.documentResizeListener=null)}onWindowResize(){this.overlayVisible&&!P.p.isTouchDevice()&&this.hide()}bindScrollListener(){this.scrollHandler||(this.scrollHandler=new P.V(this.containerViewChild.nativeElement,()=>{this.overlayVisible&&this.hide()})),this.scrollHandler.bindScrollListener()}unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()}validateHSB(p){return{h:Math.min(360,Math.max(0,p.h)),s:Math.min(100,Math.max(0,p.s)),b:Math.min(100,Math.max(0,p.b))}}validateRGB(p){return{r:Math.min(255,Math.max(0,p.r)),g:Math.min(255,Math.max(0,p.g)),b:Math.min(255,Math.max(0,p.b))}}validateHEX(p){var h=6-p.length;if(h>0){for(var T=[],x=0;x<h;x++)T.push("0");T.push(p),p=T.join("")}return p}HEXtoRGB(p){let h=parseInt(p.indexOf("#")>-1?p.substring(1):p,16);return{r:h>>16,g:(65280&h)>>8,b:255&h}}HEXtoHSB(p){return this.RGBtoHSB(this.HEXtoRGB(p))}RGBtoHSB(p){var h={h:0,s:0,b:0},T=Math.min(p.r,p.g,p.b),x=Math.max(p.r,p.g,p.b),I=x-T;return h.b=x,h.s=0!=x?255*I/x:0,h.h=0!=h.s?p.r==x?(p.g-p.b)/I:p.g==x?2+(p.b-p.r)/I:4+(p.r-p.g)/I:-1,h.h*=60,h.h<0&&(h.h+=360),h.s*=100/255,h.b*=100/255,h}HSBtoRGB(p){var h={r:null,g:null,b:null};let T=p.h,x=255*p.s/100,I=255*p.b/100;if(0==x)h={r:I,g:I,b:I};else{let u=I,m=(255-x)*I/255,k=T%60*(u-m)/60;360==T&&(T=0),T<60?(h.r=u,h.b=m,h.g=m+k):T<120?(h.g=u,h.b=m,h.r=u-k):T<180?(h.g=u,h.r=m,h.b=m+k):T<240?(h.b=u,h.r=m,h.g=u-k):T<300?(h.b=u,h.g=m,h.r=m+k):T<360?(h.r=u,h.g=m,h.b=u-k):(h.r=0,h.g=0,h.b=0)}return{r:Math.round(h.r),g:Math.round(h.g),b:Math.round(h.b)}}RGBtoHEX(p){var h=[p.r.toString(16),p.g.toString(16),p.b.toString(16)];for(var T in h)1==h[T].length&&(h[T]="0"+h[T]);return h.join("")}HSBtoHEX(p){return this.RGBtoHEX(this.HSBtoRGB(p))}onOverlayHide(){this.unbindScrollListener(),this.unbindDocumentResizeListener(),this.unbindDocumentClickListener(),this.overlay=null}ngOnDestroy(){this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.overlay&&this.autoZIndex&&a.P9.clear(this.overlay),this.restoreOverlayAppend(),this.onOverlayHide()}}return N.\u0275fac=function(p){return new(p||N)(r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(r.sBO),r.Y36(v.b4),r.Y36(v.F0))},N.\u0275cmp=r.Xpm({type:N,selectors:[["p-colorPicker"]],viewQuery:function(p,h){if(1&p&&(r.Gf(V,5),r.Gf(_,5),r.Gf(g,5),r.Gf(f,5),r.Gf(b,5),r.Gf(C,5)),2&p){let T;r.iGM(T=r.CRH())&&(h.containerViewChild=T.first),r.iGM(T=r.CRH())&&(h.inputViewChild=T.first),r.iGM(T=r.CRH())&&(h.colorSelector=T.first),r.iGM(T=r.CRH())&&(h.colorHandle=T.first),r.iGM(T=r.CRH())&&(h.hue=T.first),r.iGM(T=r.CRH())&&(h.hueHandle=T.first)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass",inline:"inline",format:"format",appendTo:"appendTo",disabled:"disabled",tabindex:"tabindex",inputId:"inputId",autoZIndex:"autoZIndex",baseZIndex:"baseZIndex",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onChange:"onChange",onShow:"onShow",onHide:"onHide"},features:[r._Bn([$])],decls:4,vars:9,consts:[[3,"ngStyle","ngClass"],["container",""],["type","text","class","p-colorpicker-preview p-inputtext","readonly","readonly",3,"ngClass","disabled","backgroundColor","focus","click","keydown",4,"ngIf"],[3,"ngClass","click",4,"ngIf"],["type","text","readonly","readonly",1,"p-colorpicker-preview","p-inputtext",3,"ngClass","disabled","focus","click","keydown"],["input",""],[3,"ngClass","click"],[1,"p-colorpicker-content"],[1,"p-colorpicker-color-selector",3,"touchstart","touchmove","touchend","mousedown"],["colorSelector",""],[1,"p-colorpicker-color"],[1,"p-colorpicker-color-handle"],["colorHandle",""],[1,"p-colorpicker-hue",3,"mousedown","touchstart","touchmove","touchend"],["hue",""],[1,"p-colorpicker-hue-handle"],["hueHandle",""]],template:function(p,h){1&p&&(r.TgZ(0,"div",0,1),r.YNc(2,d,2,8,"input",2),r.YNc(3,J,11,11,"div",3),r.qZA()),2&p&&(r.Tol(h.styleClass),r.Q6J("ngStyle",h.style)("ngClass",r.WLB(6,q,!h.inline,h.colorDragging||h.hueDragging)),r.xp6(2),r.Q6J("ngIf",!h.inline),r.xp6(1),r.Q6J("ngIf",h.inline||h.overlayVisible))},dependencies:[e.mk,e.O5,e.PC],styles:[".p-colorpicker{display:inline-block}.p-colorpicker-dragging{cursor:pointer}.p-colorpicker-overlay{position:relative}.p-colorpicker-panel{position:relative;width:193px;height:166px}.p-colorpicker-overlay-panel{position:absolute;top:0;left:0}.p-colorpicker-preview{cursor:pointer}.p-colorpicker-panel .p-colorpicker-content{position:relative}.p-colorpicker-panel .p-colorpicker-color-selector{width:150px;height:150px;top:8px;left:8px;position:absolute}.p-colorpicker-panel .p-colorpicker-color{width:150px;height:150px}.p-colorpicker-panel .p-colorpicker-color-handle{position:absolute;top:0;left:150px;border-radius:100%;width:10px;height:10px;border-width:1px;border-style:solid;margin:-5px 0 0 -5px;cursor:pointer;opacity:.85}.p-colorpicker-panel .p-colorpicker-hue{width:17px;height:150px;top:8px;left:167px;position:absolute;opacity:.85}.p-colorpicker-panel .p-colorpicker-hue-handle{position:absolute;top:150px;left:0;width:21px;margin-left:-2px;margin-top:-5px;height:10px;border-width:2px;border-style:solid;opacity:.85;cursor:pointer}\n"],encapsulation:2,data:{animation:[(0,F.X$)("overlayAnimation",[(0,F.eR)(":enter",[(0,F.oB)({opacity:0,transform:"scaleY(0.8)"}),(0,F.jt)("{{showTransitionParams}}")]),(0,F.eR)(":leave",[(0,F.jt)("{{hideTransitionParams}}",(0,F.oB)({opacity:0}))])])]},changeDetection:0}),N})(),X=(()=>{class N{}return N.\u0275fac=function(p){return new(p||N)},N.\u0275mod=r.oAB({type:N}),N.\u0275inj=r.cJS({imports:[e.ez]}),N})()}}]);