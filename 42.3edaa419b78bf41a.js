"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[42],{8042:(Ke,F,a)=>{a.r(F),a.d(F,{CorrespondentModule:()=>Be});var g=a(6895),f=a(4269),e=a(4650),G=a(9293);let Y=(()=>{class o{constructor(){this.routes=[{label:"Incoming Correspondents",commands:["incoming-correspondent"]},{label:"Outgoing Correspondents",commands:["outgoing-correspondent"]}],this.settingsRoutes=[{label:"Incoming Categories",commands:["incoming-categories"]},{label:"Outgoing Categories",commands:["outgoing-categories"]}]}ngOnInit(){}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["pek-correspondent-layout"]],decls:2,vars:3,consts:[[3,"module","routes","settingsRoutes"]],template:function(t,i){1&t&&e._UZ(0,"pek-header",0)(1,"router-outlet"),2&t&&e.Q6J("module","Correspondent")("routes",i.routes)("settingsRoutes",i.settingsRoutes)},dependencies:[f.lC,G.G]}),o})();var h=a(4047),u=a(5698),_=a(7579),c=a(2722),M=a(2340),l=a(4006),Z=a(7427),C=a(4004),m=a(6319),S=a(6767),y=a(5593),N=a(1740),v=a(805),U=a(3054),T=a(5390),L=a(585),Q=a(9673),H=a(609),J=a(384),I=a(2899),A=a(6186);function $(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"p-treeSelect",3),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedCategory=n)})("ngModelChange",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onChoiceCategory())}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("options",t.categoriesTree)("ngModel",t.selectedCategory)("showClear",!0)("disabled",t.isDisabled)}}function V(o,s){1&o&&(e.TgZ(0,"div",4),e._UZ(1,"i",5),e.qZA())}let k=(()=>{class o{constructor(t,i){this.auth=t,this.categoryService=i,this.choiceCategory=new e.vpe,this.choiceCategoryFolAllIds=new e.vpe,this.isAllIds=!1,this.isDisabled=!1,this.isLoading=!0,this.categories=[],this.categoriesTree=[],this.selectedCategory=null,this.destroy$=new _.x}ngOnInit(){this.categoryService.get([{name:"type",value:this.correspondentType}]).pipe((0,c.R)(this.destroy$)).subscribe(t=>{this.categories=t,this.ignoredCategoryId&&(this.categories=this.categories.filter(i=>i.id!==this.ignoredCategoryId)),this.createTree(),this.findCategory(),this.isLoading=!1})}findCategory(){const t=i=>{i.forEach(n=>{n.data.id!==this.currentCategoryId?n.children.length>0&&t(n.children):this.selectedCategory=n})};t(this.categoriesTree)}createTree(){const t=n=>{n.forEach(r=>{const p=this.categories.filter(d=>d.parent?.id===r.data.id);p.length>0&&(r.children=p.map(d=>({label:d.name,data:d,selectable:this.hasAccessToCategory(d.id),children:[]})),t(r.children))})},i=this.categories.filter(n=>!n.parent).map(n=>({label:n.name,data:n,selectable:this.hasAccessToCategory(n.id),children:[]}));t(i),this.categoriesTree=[...i]}hasAccessToCategory(t){const i=this.auth.user.correspondent_category_permissions.map(n=>n.id);return this.auth.user.is_superuser||i.some(n=>n===t)}onChoiceCategory(){this.isAllIds?this.choiceProductForAllIds():this.choiceCategory.emit(this.selectedCategory?.data?this.selectedCategory.data:null)}choiceProductForAllIds(){if(!this.selectedCategory)return void this.choiceCategoryFolAllIds.emit(null);const t=[];t.push(this.selectedCategory.data.id);const i=n=>{n.forEach(r=>{t.push(r.data.id),r.children.length>0&&i(r.children)})};i(this.selectedCategory.children),this.choiceCategoryFolAllIds.emit(t)}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(J.e8),e.Y36(I.n))},o.\u0275cmp=e.Xpm({type:o,selectors:[["pek-correspondnet-categories-picker"]],inputs:{isAllIds:"isAllIds",currentCategoryId:"currentCategoryId",ignoredCategoryId:"ignoredCategoryId",isDisabled:"isDisabled",correspondentType:"correspondentType"},outputs:{choiceCategory:"choiceCategory",choiceCategoryFolAllIds:"choiceCategoryFolAllIds"},decls:4,vars:2,consts:[[1,"product-root-category-picker","correspondent-picker"],["placeholder","Select Category",3,"options","ngModel","showClear","disabled","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["placeholder","Select Category",3,"options","ngModel","showClear","disabled","ngModelChange"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,$,1,4,"p-treeSelect",1),e.YNc(2,V,2,0,"ng-template",null,2,e.W1O),e.qZA()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",!i.isLoading)("ngIfElse",n)}},dependencies:[g.O5,l.JJ,l.On,A.mP],styles:[".correspondent-picker div.p-treenode-content:not(.p-treenode-selectable) .p-treenode-label{opacity:.5}"]}),o})();const j=["filePicker"];function B(o,s){1&o&&(e.TgZ(0,"div",11)(1,"label"),e._uU(2,"External date *"),e.qZA(),e._UZ(3,"p-calendar",29),e.qZA()),2&o&&(e.xp6(3),e.Q6J("readonlyInput",!0))}function K(o,s){1&o&&(e.TgZ(0,"div",11)(1,"label",30),e._uU(2,"ExternalID *"),e.qZA(),e._UZ(3,"input",31),e.qZA())}function z(o,s){1&o&&(e.TgZ(0,"tr")(1,"th",32),e._uU(2,"Name"),e.qZA(),e.TgZ(3,"th",33),e._uU(4,"Actions"),e.qZA()())}function X(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"tr",35)(1,"td",33),e._uU(2),e.qZA(),e.TgZ(3,"td",36)(4,"div",37)(5,"button",38),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,r=e.oxw();return e.KtG(r.downloadFile(n))}),e.qZA(),e.TgZ(6,"button",39),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,r=e.oxw();return e.KtG(r.deleteCorrespondentFile(n.id))}),e.qZA()()()()}if(2&o){const t=e.oxw().$implicit,i=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.hij(" ",i.getName(t.file)," ")}}function W(o,s){if(1&o&&e.YNc(0,X,7,2,"tr",34),2&o){const t=s.$implicit,i=e.oxw();e.Q6J("ngIf",i.isFileToBeDisplayed(t.id))}}function ee(o,s){1&o&&(e.TgZ(0,"tr",40)(1,"td",41)(2,"span"),e._uU(3," No Files Found "),e.qZA()()()),2&o&&(e.xp6(1),e.uIk("colspan",3))}let te=(()=>{class o{constructor(t,i,n,r,p,d){this.fb=t,this.correspondentService=i,this.dialogRef=n,this.adapterService=r,this.modalService=p,this.data=d,this.types=h.c,this.isSaving=!1,this.startDate=null,this.filesIdsToDelete=[],this.files=[],this.isCreatedNow=!1,this.type=this.data.correspondentType,this.form=t.group({date_received:[{value:null,disabled:!0},[l.kI.required]],description:[""],origin:[""],category:[null]}),this.type===this.types.INCOMING&&(this.form.addControl("external_id",new l.NI(null,[l.kI.required])),this.form.addControl("external_date",new l.NI(null,[l.kI.required]))),this.form.addControl("letter_registration_number",new l.NI("")),"edit"===this.data.type?(this.correspondentFiles=[...this.data.correspondent.files],this.form.addControl("id",new l.NI(null)),this.form.get("date_received").patchValue(new Date(this.data.correspondent.date_received)),this.form.get("id").patchValue(this.data.correspondent.id),this.form.get("description").patchValue(this.data.correspondent.description),this.form.get("origin").patchValue(this.data.correspondent.origin),this.data.correspondent.category&&this.form.get("category").patchValue(this.data.correspondent.category.id),this.type===this.types.INCOMING&&(this.form.get("external_id").patchValue(this.data.correspondent.external_id),this.data.correspondent.external_date&&this.form.get("external_date").patchValue(new Date(this.data.correspondent.external_date))),this.form.get("letter_registration_number").patchValue(this.data.correspondent.letter_registration_number)):(this.form.get("date_received").setValue(new Date),this.type===this.types.OUTGOING&&this.createEmptyOutgoing(),this.type===this.types.INCOMING&&this.createEmptyIncoming()),this.form.get("letter_registration_number").disable()}ngOnDestroy(){this.isCreatedNow&&this.correspondentService.delete(this.type,this.form.value).subscribe(()=>{})}ngOnInit(){}onSelectCategory(t){t?this.form.get("category").patchValue(t.id):this.form.get("category").patchValue(null)}deleteFiles(){this.filesIdsToDelete.forEach(t=>{this.correspondentService.delete_file(this.type,t).subscribe()})}filesSelected(t){this.files=t}getName(t){const i=t.split("/");return i[i.length-1]}downloadFile(t){this.correspondentService.download_file(this.type,t.id).subscribe(i=>{const n=this.getName(t.file);this.adapterService.downloadFile(n,i)})}isFileToBeDisplayed(t){return this.filesIdsToDelete.findIndex(i=>i===t)<0}deleteCorrespondentFile(t){this.modalService.confirm("danger","Confirm").subscribe(i=>{if(i){const n=this.correspondentFiles.findIndex(r=>r.id===t);this.correspondentFiles.splice(n,1),this.filesIdsToDelete.push(t)}})}trim(t){this.form.get(t).value&&this.form.get(t).patchValue(this.form.get(t).value.trim())}attachFiles(t){this.files.forEach(i=>{const n=new FormData;n.append("file",i),n.append("correspondent",t.toString()),this.correspondentService.attach(this.type,n).subscribe(r=>{})})}createEmptyOutgoing(){this.form.get("date_received").enable(),this.form.get("date_received").setValue(this.adapterService.dateAdapter(new Date(this.form.get("date_received").value))),this.form.get("letter_registration_number").enable(),this.form.get("external_id")&&this.trim("external_id"),this.correspondentService.create(this.type,this.form.value).subscribe(t=>{this.correspondentService.getById(this.type,t.data.id).subscribe(i=>{this.isCreatedNow=!0,this.form.addControl("id",new l.NI(null)),this.form.get("id").patchValue(i.id),this.form.get("date_received").setValue(new Date(i.date_received)),this.form.get("letter_registration_number").patchValue(i.letter_registration_number),this.form.get("date_received").disable(),this.form.get("letter_registration_number").disable()})})}createEmptyIncoming(){this.form.get("date_received").enable(),this.form.get("date_received").setValue(this.adapterService.dateAdapter(new Date(this.form.get("date_received").value))),this.form.get("letter_registration_number").enable(),this.form.get("external_id").setValue(""),this.correspondentService.create(this.type,this.form.value).subscribe(t=>{this.correspondentService.getById(this.type,t.data.id).subscribe(i=>{this.isCreatedNow=!0,this.form.addControl("id",new l.NI(null)),this.form.get("id").patchValue(i.id),this.form.get("date_received").setValue(new Date(i.date_received)),this.form.get("letter_registration_number").patchValue(i.letter_registration_number),this.form.get("date_received").disable(),this.form.get("letter_registration_number").disable()})})}add(){this.form.get("external_id")&&this.trim("external_id"),this.correspondentService.create(this.type,this.form.value).subscribe(t=>{this.deleteFiles(),this.attachFiles(t.data.id),this.dialogRef.close(t)},t=>{this.form.get("date_received").setValue(new Date(this.form.get("date_received").value)),this.form.get("external_date").setValue(new Date(this.form.get("external_date").value)),this.form.get("date_received").disable()})}change(){this.form.get("external_id")&&this.trim("external_id"),this.correspondentService.update(this.type,this.form.value).subscribe(t=>{this.isCreatedNow=!1,this.deleteFiles(),this.attachFiles(t.data.id),this.dialogRef.close(t)},t=>{this.form.get("date_received").setValue(new Date(this.form.get("date_received").value)),this.form.get("external_date").setValue(new Date(this.form.get("external_date").value)),this.form.get("date_received").disable()})}onSave(){if(this.form.valid){if(this.form.get("date_received").enable(),this.type===this.types.INCOMING){const t=this.form.get("external_date").value;this.form.get("external_date").setValue(this.adapterService.dateAdapter(new Date(t)))}this.form.get("date_received").setValue(this.adapterService.dateAdapter(new Date(this.form.get("date_received").value))),this.type===this.types.OUTGOING&&this.form.get("letter_registration_number").enable(),this.change()}}viewFiles(){this.correspondentService.viewFiles({links:this.correspondentFiles,files:[]})}fileAdded(t){this.filePicker.addPhotoToList(t)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.qu),e.Y36(D),e.Y36(m.so),e.Y36(S.v),e.Y36(Z.Z),e.Y36(m.WI))},o.\u0275cmp=e.Xpm({type:o,selectors:[["pek-create-edit-correspondent"]],viewQuery:function(t,i){if(1&t&&e.Gf(j,5),2&t){let n;e.iGM(n=e.CRH())&&(i.filePicker=n.first)}},decls:46,vars:20,consts:[["pekPasteScreenImage","",1,"create-edit-product-structure-category",3,"imageAdded"],[1,"modal-header"],[1,"modal-header__title"],[1,"d-flex","justify-content-around","pb-4",3,"formGroup"],[2,"width","48%"],[1,"form-group","dark-disabled"],["formControlName","date_received","inputId","basic","dateFormat","dd/mm/yy","id","date_received",1,"position-relative",3,"readonlyInput"],["class","form-group",4,"ngIf"],[1,"form-group","dark-disabled","highlight"],["for","letter_registration_number"],["type","text","id","letter_registration_number","pInputText","","formControlName","letter_registration_number",3,"disabled"],[1,"form-group"],["for","origin"],["type","text","id","origin","pInputText","","formControlName","origin"],["for","description"],["id","description","pInputTextarea","","formControlName","description",3,"rows","autoResize"],[3,"correspondentType","currentCategoryId","choiceCategory"],[1,"col-3"],["pButton","","type","button","icon","pi pi-eye","label","View files",3,"click"],[1,"files",3,"files","showLabel","fileChanged"],["filePicker",""],[1,"row"],["selectionMode","single",1,"table-full-loading","adaptive-table","adaptive-table_filters",3,"rows","paginator","value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"justify-content-between"],["pButton","","type","button","label","Cancel",1,"p-button-danger",3,"mat-dialog-close"],["pButton","","type","button",1,"p-button-success",3,"label","loading","disabled","click"],["formControlName","external_date","inputId","basic","dateFormat","dd/mm/yy","id","external_date",1,"position-relative",3,"readonlyInput"],["for","external_id"],["type","text","id","external_id","pInputText","","formControlName","external_id"],[2,"width","80%"],[2,"width","20%"],[3,"pSelectableRow",4,"ngIf"],[3,"pSelectableRow"],[2,"width","30%"],[1,"d-flex","justify-content-center"],["pButton","","type","button","icon","pi pi-download",1,"p-button-primary","p-button-rounded","p-button-outlined","p-button-rounded_small","mr-2",3,"click"],["pButton","","type","button","icon","pi pi-trash",1,"p-button-danger","p-button-rounded","p-button-outlined","p-button-rounded_small",3,"click"],[1,"no-content"],[1,"text-center","p-4",2,"width","100%"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.NdJ("imageAdded",function(r){return i.fileAdded(r)}),e.TgZ(1,"div",1)(2,"h2",2),e._uU(3),e.qZA()(),e.TgZ(4,"mat-dialog-content")(5,"form",3)(6,"div",4)(7,"div",5)(8,"label"),e._uU(9,"Letter Registration Date"),e.qZA(),e._UZ(10,"p-calendar",6),e.qZA(),e.YNc(11,B,4,1,"div",7),e.YNc(12,K,4,0,"div",7),e.TgZ(13,"div",8)(14,"label",9),e._uU(15,"Letter Registration Number"),e.qZA(),e._UZ(16,"input",10),e.qZA(),e.TgZ(17,"div",11)(18,"label",12),e._uU(19),e.qZA(),e._UZ(20,"input",13),e.qZA(),e.TgZ(21,"div",11)(22,"label",14),e._uU(23,"Description"),e.qZA(),e._UZ(24,"textarea",15),e.qZA(),e.TgZ(25,"div",11)(26,"label"),e._uU(27,"Category"),e.qZA(),e.TgZ(28,"pek-correspondnet-categories-picker",16),e.NdJ("choiceCategory",function(r){return i.onSelectCategory(r)}),e.qZA()(),e.TgZ(29,"div",17)(30,"div",11)(31,"button",18),e.NdJ("click",function(){return i.viewFiles()}),e.qZA()()()(),e.TgZ(32,"div",4)(33,"div",11)(34,"label"),e._uU(35,"Files"),e.qZA(),e.TgZ(36,"pek-upload-file-picker",19,20),e.NdJ("fileChanged",function(r){return i.filesSelected(r)}),e.qZA()()()(),e.TgZ(38,"div",21)(39,"p-table",22),e.YNc(40,z,5,0,"ng-template",23),e.YNc(41,W,1,1,"ng-template",24),e.YNc(42,ee,4,1,"ng-template",25),e.qZA()()(),e.TgZ(43,"mat-dialog-actions",26),e._UZ(44,"button",27),e.TgZ(45,"button",28),e.NdJ("click",function(){return i.onSave()}),e.qZA()()()),2&t&&(e.xp6(3),e.hij(" ",i.data.type," Correspondent "),e.xp6(2),e.Q6J("formGroup",i.form),e.xp6(5),e.Q6J("readonlyInput",!0),e.xp6(1),e.Q6J("ngIf",i.type===i.types.INCOMING),e.xp6(1),e.Q6J("ngIf",i.type===i.types.INCOMING),e.xp6(4),e.Q6J("disabled",!0),e.xp6(3),e.Oqu(i.type===i.types.OUTGOING?"To":"From"),e.xp6(5),e.Q6J("rows",2)("autoResize",!0),e.xp6(4),e.Q6J("correspondentType",i.type)("currentCategoryId",i.form.get("category").value),e.xp6(8),e.Q6J("files",i.files)("showLabel",!1),e.xp6(3),e.Q6J("rows",5)("paginator",!0)("value",i.correspondentFiles),e.xp6(5),e.Q6J("mat-dialog-close",!1),e.xp6(1),e.Q6J("label",i.data.type)("loading",i.isSaving)("disabled",i.form.invalid))},dependencies:[g.O5,y.Hq,N.o,v.jx,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,m.ZT,m.xY,m.H8,U.g,T.iA,T.Ei,L.f,Q.y,H.U,k],styles:["pek-upload-file-picker div.p-fileupload-content{max-height:15.875rem;overflow:auto;padding:.5rem 1rem!important}  .dark-disabled input{opacity:1!important}  .dark-disabled.highlight input{font-weight:500}"]}),o})();var ie=a(3574),ne=a(529);let D=(()=>{class o{constructor(t,i){this.httpClient=t,this.dialog=i,this.clearSelectedCategories$=new _.x,this.selectNomenclatureCategories$=new _.x,this.API_URL=M.N.base_url,this.url="correspondent/",this.typeUrl="",this.typeFilesUrl=""}get(t,i){this.setTypeUrl(t);let n="";return i&&i.forEach((r,p)=>{n+=p>0?"&"+r.name+"="+r.value:"?"+r.name+"="+r.value}),this.httpClient.get(this.API_URL+this.url+this.typeUrl+n).pipe((0,C.U)(r=>r.data))}getById(t,i){return this.setTypeUrl(t),this.httpClient.get(this.API_URL+this.url+this.typeUrl+i+"/").pipe((0,C.U)(n=>n.data))}create(t,i){return this.setTypeUrl(t),this.httpClient.post(this.API_URL+this.url+this.typeUrl,i)}update(t,i){return this.setTypeUrl(t),this.httpClient.put(this.API_URL+this.url+this.typeUrl+i.id+"/",i)}delete(t,i){return this.setTypeUrl(t),this.httpClient.delete(this.API_URL+this.url+this.typeUrl+i.id+"/")}get_files(t,i){return this.setTypeUrl(t),this.httpClient.get(this.API_URL+this.url+this.typeFilesUrl+i+"/").pipe((0,C.U)(n=>n.data))}attach(t,i){return this.setTypeUrl(t),this.httpClient.post(this.API_URL+this.url+this.typeFilesUrl,i).pipe((0,C.U)(n=>n.data))}delete_file(t,i){return this.setTypeUrl(t),this.httpClient.delete(this.API_URL+this.url+this.typeFilesUrl+i+"/")}download_file(t,i){return this.setTypeUrl(t),this.httpClient.get(this.API_URL+this.url+this.typeFilesUrl+i+"/download/",{responseType:"blob"}).pipe((0,C.U)(n=>n))}setTypeUrl(t){this.typeUrl=t===h.c.INCOMING?"incoming_correspondents/":"outgoing_correspondents/",this.typeFilesUrl=t===h.c.INCOMING?"incoming_correspondent_files/":"outgoing_correspondent_files/"}createEditCorrespondent(t,i,n){return this.dialog.open(te,{width:"80rem",height:"auto",data:{type:t,correspondent:n,correspondentType:i},autoFocus:!1,enterAnimationDuration:"250ms"}).afterClosed()}viewFiles(t){return this.dialog.open(ie.L,{width:"auto",height:"auto",data:t,panelClass:"gallery-modal",autoFocus:!1}).afterClosed().pipe()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(ne.eN),e.LFG(m.uw))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var O=a(615),oe=a(3608),E=a(3237),re=a(1997),se=a(8666);function ae(o,s){1&o&&e._uU(0," Empty ")}function le(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"p-treeSelect",3),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedCategories=n)})("ngModelChange",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.selectionChanged())}),e.YNc(1,ae,1,0,"ng-template",4),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("metaKeySelection",!0)("filter",!0)("ngModel",t.selectedCategories)("options",t.categoriesTree)}}function de(o,s){1&o&&(e.TgZ(0,"div",5),e._UZ(1,"i",6),e.qZA())}let pe=(()=>{class o{constructor(t){this.categoryService=t,this.emitSelectedCategories=new e.vpe,this.isLoading=!0,this.categories=[],this.categoriesTree=[],this.selectedCategories=null,this.destroy$=new _.x}ngOnInit(){this.categoryService.get([{name:"type",value:this.correspondentType}]).pipe((0,c.R)(this.destroy$)).subscribe(t=>{this.categories=t,this.createTree(),this.isLoading=!1})}createTree(){const t=n=>{n.forEach(r=>{const p=this.categories.filter(d=>d.parent?.id===r.data.id);p.length>0&&(r.children=p.map(d=>({label:d.name,data:d,expandedIcon:"pi pi-folder-open",collapsedIcon:"pi pi-folder",children:[]})),t(r.children))})},i=this.categories.filter(n=>!n.parent).map(n=>({label:n.name,data:n,expandedIcon:"pi pi-folder-open",collapsedIcon:"pi pi-folder",children:[]}));t(i),this.categoriesTree=[...i]}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}selectionChanged(){this.emitSelectedCategories.emit(this.selectedCategories.map(t=>t.data.id))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(I.n))},o.\u0275cmp=e.Xpm({type:o,selectors:[["pek-correspondetn-multi-category-picker"]],inputs:{correspondentType:"correspondentType"},outputs:{emitSelectedCategories:"emitSelectedCategories"},decls:4,vars:2,consts:[[1,"company-categorized-multi-picker"],["selectionMode","checkbox","placeholder","Select Categories",3,"metaKeySelection","filter","ngModel","options","ngModelChange",4,"ngIf","ngIfElse"],["spinner",""],["selectionMode","checkbox","placeholder","Select Categories",3,"metaKeySelection","filter","ngModel","options","ngModelChange"],["pTemplate","empty"],[1,"spinner-input"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.25rem"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,le,2,4,"p-treeSelect",1),e.YNc(2,de,2,0,"ng-template",null,2,e.W1O),e.qZA()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",!i.isLoading)("ngIfElse",n)}},dependencies:[g.O5,v.jx,l.JJ,l.On,A.mP]}),o})();const ce=["paginator"];function ge(o,s){1&o&&e.GkF(0)}function he(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"label"),e._uU(3,"External Date"),e.qZA(),e.TgZ(4,"p-calendar",33),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.setExternalDate(n))}),e.qZA()()()}2&o&&(e.xp6(4),e.Q6J("showClear",!0)("readonlyInput",!0))}function ue(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"label"),e._uU(3,"External ID"),e.qZA(),e.TgZ(4,"input",34),e.NdJ("ngModelChange",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.search())}),e.qZA()()()}}function me(o,s){1&o&&e.GkF(0)}function _e(o,s){1&o&&(e.TgZ(0,"th",40),e._uU(1," ExternalID "),e.qZA())}function fe(o,s){1&o&&(e.TgZ(0,"th",36),e._uU(1,"External Date"),e.qZA())}function Ce(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"th",35),e._uU(2,"ID"),e.qZA(),e.TgZ(3,"th",36),e._uU(4,"Letter Registration Date"),e.qZA(),e.TgZ(5,"th",37),e._uU(6,"Letter Registration Number"),e.qZA(),e.YNc(7,_e,2,0,"th",38),e.YNc(8,fe,2,0,"th",39),e.TgZ(9,"th",40),e._uU(10),e.qZA(),e.TgZ(11,"th",40),e._uU(12,"Category"),e.qZA(),e.TgZ(13,"th",40),e._uU(14,"Description"),e.qZA(),e.TgZ(15,"th",40),e._uU(16,"Files"),e.qZA()()),2&o){const t=e.oxw();e.xp6(7),e.Q6J("ngIf",t.type===t.types.INCOMING),e.xp6(1),e.Q6J("ngIf",t.type===t.types.INCOMING),e.xp6(2),e.Oqu(t.type===t.types.INCOMING?"From":"To")}}function ye(o,s){if(1&o&&(e.TgZ(0,"td",40),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.external_id," ")}}function ve(o,s){if(1&o&&(e.TgZ(0,"td",36),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.external_date,"dd/MM/yyyy")," ")}}function Te(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"span")(1,"a",48),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,r=e.oxw();return e.KtG(r.downloadFile(n.files[0],n))}),e._uU(2),e.qZA()()}if(2&o){const t=e.oxw().$implicit,i=e.oxw();e.xp6(2),e.AsE(" ",i.getName(t.files[0].file)," (F ",t.files.length,") ")}}function xe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"span")(1,"a",48),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,r=e.oxw();return e.KtG(r.downloadFile(n.files[0],n))}),e._uU(2),e.qZA()()}if(2&o){const t=e.oxw().$implicit,i=e.oxw();e.xp6(2),e.hij(" ",i.getName(t.files[0].file)," ")}}function be(o,s){if(1&o&&(e.TgZ(0,"span")(1,"a",51),e._uU(2),e.qZA(),e._UZ(3,"br"),e.qZA()),2&o){const t=s.$implicit,i=e.oxw(2).$implicit,n=e.oxw();e.xp6(1),e.Q6J("href",n.getFileLink(t.file,i),e.LSH),e.xp6(1),e.hij(" ",n.getName(t.file)," ")}}function Ze(o,s){if(1&o&&(e.TgZ(0,"pek-hover-detailed-info-component",49),e.YNc(1,be,4,2,"span",50),e.qZA()),2&o){const t=e.oxw().$implicit;e.Q6J("moveLeft",500),e.xp6(1),e.Q6J("ngForOf",t.files)}}function Ne(o,s){1&o&&(e.TgZ(0,"tr",52)(1,"div"),e._UZ(2,"i",53),e.qZA()())}function Ie(o,s){if(1&o&&(e.TgZ(0,"tr",41)(1,"td",42),e._uU(2),e.qZA(),e.TgZ(3,"td",36),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"td",42),e._uU(7),e.qZA(),e.YNc(8,ye,2,1,"td",38),e.YNc(9,ve,3,4,"td",39),e.TgZ(10,"td",36),e._uU(11),e.qZA(),e.TgZ(12,"td",36),e._uU(13),e.qZA(),e.TgZ(14,"td",43),e._uU(15),e.qZA(),e.TgZ(16,"td",44),e.YNc(17,Te,3,2,"span",45),e.YNc(18,xe,3,1,"span",45),e.YNc(19,Ze,2,2,"pek-hover-detailed-info-component",46),e.qZA()(),e.YNc(20,Ne,3,0,"tr",47)),2&o){const t=s.$implicit,i=e.oxw();e.Q6J("pSelectableRow",t),e.xp6(2),e.hij(" ",t.id," "),e.xp6(2),e.hij(" ",e.xi3(5,13,t.date_received,"dd/MM/yyyy")," "),e.xp6(3),e.hij(" ",t.letter_registration_number," "),e.xp6(1),e.Q6J("ngIf",i.type===i.types.INCOMING),e.xp6(1),e.Q6J("ngIf",i.type===i.types.INCOMING),e.xp6(2),e.hij(" ",t.origin," "),e.xp6(2),e.hij(" ",t.categoryPath," "),e.xp6(2),e.hij(" ",t.description," "),e.xp6(2),e.Q6J("ngIf",t.files.length>1),e.xp6(1),e.Q6J("ngIf",1===t.files.length),e.xp6(1),e.Q6J("ngIf",t.files.length>1),e.xp6(1),e.Q6J("ngIf",i.isLoading)}}function Ae(o,s){1&o&&e._UZ(0,"i",53)}function we(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1," No Records Found "),e.qZA())}function Fe(o,s){if(1&o&&(e.TgZ(0,"tr",54)(1,"td",55),e.YNc(2,Ae,1,0,"i",56),e.YNc(3,we,2,0,"span",45),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.uIk("colspan",t.type===t.types.INCOMING?8:7),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}function Me(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"p-button",57),e.NdJ("click",function(){e.CHM(t),e.oxw();const n=e.MAs(57);return n.paginator=!1,e.KtG(n.scrollable=!0)}),e._uU(1,"All "),e.qZA()}}function Se(o,s){}function Ue(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",58)(1,"p-paginator",59,60),e.NdJ("onPageChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.paginate(n))}),e.qZA()()}if(2&o){const t=e.oxw();e.ekj("paginator-wrap",t.isLoading),e.xp6(1),e.Q6J("rows",10)("totalRecords",t.countCorrespondents)}}function Le(o,s){if(1&o&&(e.TgZ(0,"div",61),e._UZ(1,"p-menubar",62),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.ekj("disabled",!t.selectedNode),e.Q6J("model",t.menuItems)}}const Je=function(){return["name"]};let q=(()=>{class o{constructor(t,i,n,r,p,d,w){this.fb=t,this.activatedRouter=i,this.modalService=n,this.correspondentService=r,this.adapterService=p,this.auth=d,this.messageService=w,this.types=h.c,this.countCorrespondents=0,this.searchForm=this.fb.group({id:[null],externalId:[null],date_received_after:[null],date_received_before:[null],letter_registration_number:[null],external_date:[null],categories:[null],origin:[null],page:[1]}),this.correspondents=[],this.isStartOnePage=!1,this.minDate=null,this.maxDate=null,this.rangeCalendar=[new Date,new Date],this.isHideFilters=!1,this.tableScrollHeight="29.625rem",this.destroy$=new _.x,this.menuItems=[{label:"Selected Correspondent",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.edit()},{label:"Remove",icon:"pi pi-trash",command:()=>this.delete()}]}],this.link=M.N.image_path}ngOnInit(){this.activatedRouter.data.pipe((0,c.R)(this.destroy$)).subscribe(t=>{this.type=t.type,this.search()})}search(){const t=[];t.push({name:"paginated",value:!0}),t.push({name:"page",value:this.searchForm.get("page").value});const i=this.searchForm.get("date_received_after").value,n=this.searchForm.get("date_received_before").value;if(i&&n&&(t.push({name:"date_received_after",value:this.adapterService.dateAdapter(new Date(i))}),t.push({name:"date_received_before",value:this.adapterService.dateAdapter(new Date(n))})),this.searchForm.get("id").value&&t.push({name:"id",value:this.searchForm.get("id").value}),this.searchForm.get("externalId").value&&t.push({name:"external_id",value:this.searchForm.get("externalId").value}),this.searchForm.get("external_date").value){const r=this.searchForm.get("external_date").value;t.push({name:"external_date",value:this.adapterService.dateAdapter(new Date(r))})}this.searchForm.get("categories").value&&t.push({name:"categories",value:this.searchForm.get("categories").value}),this.searchForm.get("letter_registration_number").value&&t.push({name:"letter_registration_number",value:this.searchForm.get("letter_registration_number").value}),this.searchForm.get("origin").value&&t.push({name:"origin",value:this.searchForm.get("origin").value}),this.searchCorrespondents(t)}searchCorrespondents(t){this.correspondentService.get(this.type,t).pipe((0,c.R)(this.destroy$)).subscribe(i=>{i.results.forEach(n=>{n.categoryPath="";const r=[];n.category&&(this.formPath(n.category,r),n.categoryPath=r.reverse().join(" > "))}),this.correspondents=i.results,this.countCorrespondents=i.count,this.isStartOnePage&&this.paginator.changePage(0),this.isStartOnePage=!1,this.isLoading=!1})}formPath(t,i){return i.push(t.name),t.parent?this.formPath(t.parent,i):i}paginate(t){this.searchForm.get("page").patchValue(t.page+1),this.search()}showAll(){}closeShowAll(){}add(){this.correspondentService.createEditCorrespondent("create",this.type).pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(t=>{t&&(this.correspondents=[],this.search())})}edit(){!this.selectedNode.category||this.haveAccessToCorrespondent(this.selectedNode.category.id)?this.correspondentService.createEditCorrespondent("edit",this.type,this.selectedNode).pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(t=>{t&&(this.correspondents=[],this.search())}):this.messageService.add({severity:"error",summary:"Has no permissions",detail:"Has no permissions to edit Correspondent with given category"})}haveAccessToCorrespondent(t){return this.auth.user.is_superuser||this.auth.user.correspondent_category_permissions.some(n=>n.id===t)}delete(){const t=this.selectedNode;this.modalService.confirm("danger","Confirm").pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(i=>{i&&this.correspondentService.delete(this.type,t).pipe((0,u.q)(1)).subscribe(n=>{this.selectedNode=null,this.correspondents=[],this.search()})})}getName(t){const i=t.split("/");return i[i.length-1]}downloadFile(t,i){!i.category||this.haveAccessToCorrespondent(i.category.id)?this.correspondentService.download_file(this.type,t.id).pipe((0,c.R)(this.destroy$)).subscribe(n=>{const r=this.getName(t.file);this.adapterService.downloadFile(r,n)}):this.messageService.add({severity:"error",summary:"Has no permissions",detail:"Has no permissions to download Correspondent files with given category"})}changeCorrespondentStart(t){this.minDate=t,this.searchByDate()}changeCorrespondentEnd(t){this.maxDate=t,this.searchByDate()}searchByDate(){const t=this.searchForm.get("date_received_after").value,i=this.searchForm.get("date_received_before").value;t&&i&&(this.paginator.changePage(0),this.searchForm.get("page").patchValue(1),this.rangeCalendar=[this.searchForm.get("date_received_after").value,this.searchForm.get("date_received_before").value],this.search())}toggleFilterVisibility(){this.isHideFilters=!this.isHideFilters,this.setTableScrollHeight()}setTableScrollHeight(){!this.isHideFilters||this.isShowAll?this.isHideFilters&&this.isShowAll?this.tableScrollHeight="18.75rem":this.isHideFilters||!this.isShowAll?this.isHideFilters||this.isShowAll||(this.tableScrollHeight="29.625rem"):this.tableScrollHeight="27.5rem":this.tableScrollHeight="20.9125rem"}searchByCategories(t){t.length>0?this.searchForm.get("categories").patchValue(t):this.searchForm.get("categories").patchValue(null),this.search()}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}externalDateChanged(t){}setExternalDate(t){this.paginator.changePage(0),this.searchForm.get("page").patchValue(1),this.search()}getFileLink(t,i){return i.category&&!this.haveAccessToCorrespondent(i.category.id)?"javascript:void(0)":this.link+t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.qu),e.Y36(f.gz),e.Y36(Z.Z),e.Y36(D),e.Y36(S.v),e.Y36(J.e8),e.Y36(v.ez))},o.\u0275cmp=e.Xpm({type:o,selectors:[["pek-correspondent-list"]],viewQuery:function(t,i){if(1&t&&e.Gf(ce,5),2&t){let n;e.iGM(n=e.CRH())&&(i.paginator=n.first)}},decls:66,vars:29,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","New Correspondent",3,"click"],[1,"page__content"],[1,"page__card"],[1,"filters-visibility"],[1,"filters-visibility__header"],[4,"ngTemplateOutlet"],["tooltipPosition","left",1,"icon","pi",3,"pTooltip","click"],[1,"form","mb-3",3,"formGroup"],[1,"row"],[1,"col-3"],[1,"form-group"],["inputId","basic","dateFormat","dd/mm/yy","formControlName","date_received_after",3,"readonlyInput","ngModelChange"],["inputId","basic","dateFormat","dd/mm/yy","formControlName","date_received_before",3,"readonlyInput","ngModelChange"],["class","col-3",4,"ngIf"],["pInputText","","formControlName","id","type","number",1,"form-control",3,"ngModelChange"],["pInputText","","formControlName","letter_registration_number","type","text",1,"form-control",3,"ngModelChange"],["id","origin","type","text","pInputText","","formControlName","origin",1,"form-control",3,"ngModelChange"],[3,"correspondentType","emitSelectedCategories"],[1,"page__table"],["scrollHeight","calc(100vh - 450px)","selectionMode","single",1,"table-full-loading","adaptive-table","adaptive-table_filters",3,"rows","value","globalFilterFields","selection","selectionChange"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","paginatorright"],["pTemplate","paginatorleft"],["class","pagination-wrap",3,"paginator-wrap",4,"ngIf"],["actionButtons",""],["inputId","basic","dateFormat","dd/mm/yy","formControlName","external_date",3,"showClear","readonlyInput","ngModelChange"],["id","person-name","type","text","pInputText","","formControlName","externalId",1,"form-control",3,"ngModelChange"],[1,"index-header","text-center",2,"width","5%"],[2,"width","10%"],[1,"index-header","text-center",2,"width","15%"],["style","width: 15%",4,"ngIf"],["style","width: 10%",4,"ngIf"],[2,"width","15%"],[3,"pSelectableRow"],[1,"text-center",2,"width","5%"],[2,"width","20%"],[1,"files-cont","hovered-info",2,"width","30%"],[4,"ngIf"],[3,"moveLeft",4,"ngIf"],["class","table-pagination-preloader",4,"ngIf"],["href","javascript:void(0)",3,"click"],[3,"moveLeft"],[4,"ngFor","ngForOf"],[3,"href"],[1,"table-pagination-preloader"],[1,"fas","fa-circle-notch","fa-spin","fa-3x"],[1,"no-content"],[1,"text-center","p-4",2,"width","100%"],["class","fas fa-circle-notch fa-spin fa-3x ",4,"ngIf"],["type","button","pTooltip","Remove Pagination","styleClass","p-button-text",3,"click"],[1,"pagination-wrap"],[3,"rows","totalRecords","onPageChange"],["paginator",""],[1,"action-buttons"],[1,"ml-auto",3,"model"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return i.add()}),e.qZA()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9),e.YNc(12,ge,1,0,"ng-container",10),e.qZA(),e.TgZ(13,"button",11),e.NdJ("click",function(){return i.toggleFilterVisibility()}),e.qZA(),e.TgZ(14,"form",12)(15,"div",13)(16,"div",14)(17,"div",15)(18,"label"),e._uU(19,"Letter Registration Date From"),e.qZA(),e.TgZ(20,"p-calendar",16),e.NdJ("ngModelChange",function(r){return i.changeCorrespondentStart(r)}),e.qZA()()(),e.TgZ(21,"div",14)(22,"div",15)(23,"label"),e._uU(24,"Letter Registration Date To"),e.qZA(),e.TgZ(25,"p-calendar",17),e.NdJ("ngModelChange",function(r){return i.changeCorrespondentEnd(r)}),e.qZA()()(),e.YNc(26,he,5,2,"div",18),e.TgZ(27,"div",14)(28,"div",15)(29,"label"),e._uU(30,"ID"),e.qZA(),e.TgZ(31,"input",19),e.NdJ("ngModelChange",function(){return i.search()}),e.qZA()()(),e.TgZ(32,"div",14)(33,"div",15)(34,"label"),e._uU(35,"Letter Registration Number"),e.qZA(),e.TgZ(36,"input",20),e.NdJ("ngModelChange",function(){return i.search()}),e.qZA()()(),e.YNc(37,ue,5,0,"div",18),e.TgZ(38,"div",14)(39,"div",15)(40,"label"),e._uU(41),e.qZA(),e.TgZ(42,"input",21),e.NdJ("ngModelChange",function(){return i.search()}),e.qZA()()(),e.TgZ(43,"div",14)(44,"div",15)(45,"label"),e._uU(46,"Correspondent Categories"),e.qZA(),e.TgZ(47,"pek-correspondetn-multi-category-picker",22),e.NdJ("emitSelectedCategories",function(r){return i.searchByCategories(r)}),e.qZA()()(),e._UZ(48,"div",14)(49,"div")(50,"div",14)(51,"div",14)(52,"div",14),e.TgZ(53,"div",14),e.YNc(54,me,1,0,"ng-container",10),e.qZA()()()(),e.TgZ(55,"div",23)(56,"p-table",24,25),e.NdJ("selectionChange",function(r){return i.selectedNode=r}),e.YNc(58,Ce,17,3,"ng-template",26),e.YNc(59,Ie,21,16,"ng-template",27),e.YNc(60,Fe,4,3,"ng-template",28),e.YNc(61,Me,2,0,"ng-template",29),e.YNc(62,Se,0,0,"ng-template",30),e.qZA(),e.YNc(63,Ue,3,4,"div",31),e.qZA()()()(),e.YNc(64,Le,2,3,"ng-template",null,32,e.W1O)),2&t){const n=e.MAs(65);e.xp6(3),e.Q6J("module","correspondents")("isActive",!0),e.xp6(2),e.hij(" ",i.type===i.types.INCOMING?"Incoming":"Outgoing"," Correspondent"),e.xp6(5),e.ekj("filters-visibility_hide",i.isHideFilters),e.xp6(2),e.Q6J("ngTemplateOutlet",n),e.xp6(1),e.ekj("pi-angle-double-up",!i.isHideFilters)("pi-angle-double-down",i.isHideFilters),e.Q6J("pTooltip",i.isHideFilters?"Expand Filters":"Collapse Filters"),e.xp6(1),e.Q6J("formGroup",i.searchForm),e.xp6(6),e.Q6J("readonlyInput",!0),e.xp6(5),e.Q6J("readonlyInput",!0),e.xp6(1),e.Q6J("ngIf",i.type===i.types.INCOMING),e.xp6(11),e.Q6J("ngIf",i.type===i.types.INCOMING),e.xp6(4),e.Oqu(i.type===i.types.INCOMING?"From":"To"),e.xp6(6),e.Q6J("correspondentType",i.type),e.xp6(2),e.ekj("col-3",i.type===i.types.OUTGOING)("col-8",i.type===i.types.INCOMING),e.xp6(5),e.Q6J("ngTemplateOutlet",n),e.xp6(2),e.Q6J("rows",10)("value",i.correspondents)("globalFilterFields",e.DdM(28,Je))("selection",i.selectedNode),e.xp6(7),e.Q6J("ngIf",!i.isShowAll)}},dependencies:[g.sg,g.O5,g.tP,y.Hq,y.zx,N.o,v.jx,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.sg,l.u,O.nm,oe.u,T.iA,T.Ei,E.D,re.D,L.f,se.h,pe,g.uU],styles:[".files-cont[_ngcontent-%COMP%]{position:relative}.files-cont[_ngcontent-%COMP%]   .files-list[_ngcontent-%COMP%]{padding:.5rem 1rem;opacity:0;pointer-events:none;position:absolute;top:0;right:0;width:26.25rem;background-color:#fff;border-radius:.625rem;box-shadow:0 0 6px 5px #00000026;z-index:100}.files-cont[_ngcontent-%COMP%]   .files-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-bottom:.5rem}.files-cont[_ngcontent-%COMP%]   .files-list[_ngcontent-%COMP%]:hover, .files-cont[_ngcontent-%COMP%]:hover   .files-list[_ngcontent-%COMP%]{opacity:1;pointer-events:initial}"]}),o})();var ke=a(8505),R=a(733),x=a(6237),b=a(1206);function De(o,s){1&o&&(e.TgZ(0,"p",22),e._uU(1,"Choose the Category to edit"),e.qZA())}function Oe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.up())}),e.qZA(),e.TgZ(2,"button",17),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.down())}),e.qZA(),e.YNc(3,De,2,0,"p",18),e._UZ(4,"p-menubar",19),e.TgZ(5,"button",20),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.expandAll())}),e.qZA(),e.TgZ(6,"button",21),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.collapseAll())}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("disabled",null===(null==t.selectedNode?null:t.selectedNode.data.parent))("loading",t.isMovingUp),e.xp6(1),e.Q6J("disabled",null===(null==t.selectedNode?null:t.selectedNode.data.parent))("loading",t.isMovingDown),e.xp6(1),e.Q6J("ngIf",!t.selectedNode),e.xp6(1),e.ekj("disabled",!t.selectedNode),e.Q6J("model",t.menuItems)}}function Ee(o,s){1&o&&(e.TgZ(0,"tr")(1,"th",23),e._uU(2,"Name"),e.qZA(),e.TgZ(3,"th",24),e._uU(4,"Description"),e.qZA()())}const qe=function(o){return{"padding-left":o}};function Re(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"tr",25)(1,"td",26),e.NdJ("cdkDropListDropped",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.drop(n))}),e.TgZ(2,"div",27),e._UZ(3,"p-treeTableToggler",28),e.TgZ(4,"span",29),e._uU(5),e.qZA()()(),e.TgZ(6,"td",23),e._uU(7),e.qZA()()}if(2&o){const t=s.$implicit,i=s.rowData;e.Q6J("ttRow",t)("ttSelectableRow",t),e.xp6(1),e.Q6J("ngStyle",e.VKq(8,qe,.5*t.level+"rem"))("cdkDropListData",i.id),e.xp6(2),e.Q6J("rowNode",t),e.xp6(1),e.Q6J("cdkDragData",i.id),e.xp6(1),e.hij(" ",i.name," "),e.xp6(2),e.hij(" ",i.description,"")}}function Pe(o,s){1&o&&e._UZ(0,"i",33)}function Ge(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1,"No Records Found"),e.qZA())}function Ye(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td",30),e.YNc(2,Pe,1,0,"i",31),e.YNc(3,Ge,2,0,"span",32),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.uIk("colspan",2),e.xp6(1),e.Q6J("ngIf",t.isLoading),e.xp6(1),e.Q6J("ngIf",!t.isLoading)}}let P=(()=>{class o{constructor(t,i,n){this.activatedRouter=t,this.modalService=i,this.categoriesService=n,this.types=h.c,this.expanseMap={},this.isLoading=!0,this.destroy$=new _.x,this.isMovingUp=!1,this.isMovingDown=!1,this.menuItems=[{label:"Selected Category",items:[{label:"Edit",icon:"pi pi-pencil",command:()=>this.edit()},{label:"Remove",icon:"pi pi-trash",command:()=>this.delete()}]}]}ngOnInit(){this.activatedRouter.data.subscribe(t=>{this.type=t.type,this.getCategories()})}getCategories(){this.categories&&this.mapExpansion(),this.categoriesService.get([{name:"type",value:this.type}]).pipe((0,u.q)(1),(0,c.R)(this.destroy$),(0,ke.b)(t=>{this.createTree(t)})).subscribe()}mapExpansion(){this.categories.forEach(t=>{this.createExpanseMap(t)})}up(){const t=this.selectedNode;t.parent?this.upCategory(t):this.upRootCategory(t)}upCategory(t){let i;t.parent.children.forEach((n,r)=>{n.data.id===t.data.id&&(i=r)}),i>0&&this.categoriesService.move(t.data.id,{parent:t.parent.children[i-1].data.id,move_to:"left"}).subscribe(()=>{this.getCategories()})}upRootCategory(t){const i=this.categories.filter(r=>!r.parent),n=i.findIndex(r=>r.data.id===t.data.id);n>0&&this.categoriesService.move(t.data.id,{parent:i[n-1].data.id,move_to:"left"}).subscribe(()=>{this.getCategories()})}down(){const t=this.selectedNode;t.parent?this.downCategory(t):this.downRootCategory(t)}downCategory(t){let i;t.parent.children.forEach((n,r)=>{n.data.id===t.data.id&&(i=r)}),i<t.parent.children.length-1&&this.categoriesService.move(t.data.id,{parent:t.parent.children[i+1].data.id,move_to:"right"}).subscribe(()=>{this.getCategories()})}downRootCategory(t){const i=this.categories.filter(r=>!r.parent),n=i.findIndex(r=>r.data.id===t.data.id);n<i.length-1&&this.categoriesService.move(t.data.id,{parent:i[n+1].data.id,move_to:"right"}).subscribe(()=>{this.getCategories()})}add(){this.categoriesService.createEditCategory("create",this.type).pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(t=>{this.getCategories()})}createExpanseMap(t){this.expanseMap[t.data.id]=!!t.expanded&&t.expanded,t.children&&t.children.forEach(i=>{this.createExpanseMap(i)})}createTree(t){const i=[];t.forEach(p=>{const d={data:p,expanded:!1};this.expanseMap&&(d.expanded=this.expanseMap[p.id]),i.push(d)});const n=[],r=i.reduce((p,d,w)=>(p[d.data.id]=w,p),{});i.forEach(p=>{if(null===p.data.parent)return void n.push(p);const d=i[r[p.data.parent?.id]];d.children=[...d.children||[],p],0===d.children.length&&delete d.children}),this.categories=n,this.selectedNode&&this.getSelected(),this.isLoading=!1}getSelected(){let t=null;if(this.selectedNode.parent){let i=this.selectedNode.parent,n=[];for(;i;)n.push(i.data.id),i=i.parent;n=n.reverse();let r=this.categories.find(d=>d.data.id===n[0]),p=1;for(;r.data.id!==n[n.length-1];)r=r.children.find(d=>d.data.id===n[p]),p++;t=r.children.find(d=>d.data.id===this.selectedNode.data.id)}else t=this.categories.find(i=>i.data.id===this.selectedNode.data.id);this.selectedNode=t}edit(){this.categoriesService.createEditCategory("edit",this.type,this.selectedNode.data).pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(i=>{this.getCategories()})}delete(){const t=this.selectedNode.data;this.modalService.confirm("danger","Confirm").pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(i=>{i&&this.categoriesService.delete(t).pipe((0,u.q)(1),(0,c.R)(this.destroy$)).subscribe(()=>{this.selectedNode=null,this.getCategories()})})}expandAll(){const t=R(this.categories);t.forEach(i=>{this.expandCollapseRecursive(i,!0)}),this.categories=t}collapseAll(){const t=R(this.categories);t.forEach(i=>{this.expandCollapseRecursive(i,!1)}),this.categories=t}expandCollapseRecursive(t,i){t.expanded=i,t.children&&t.children.forEach(n=>{this.expandCollapseRecursive(n,i)})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}drop(t){}onSelectNode(){}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.gz),e.Y36(Z.Z),e.Y36(I.n))},o.\u0275cmp=e.Xpm({type:o,selectors:[["pek-correspondent-category-list"]],decls:17,vars:6,consts:[[1,"page"],[1,"page__header"],[1,"page__title"],[3,"module","isActive"],[1,"page__tools"],["pButton","","type","button","icon","pi pi-plus","label","New Category",3,"click"],[1,"page__content"],[1,"page__card"],[1,"page__table"],["selectionMode","single","scrollHeight","calc(100vh - 19.2rem)","cdkDropListGroup","",3,"value","selection","scrollable","selectionChange","onNodeSelect"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"d-flex","align-items-center"],["pButton","","type","button","icon","pi pi-arrow-up",1,"p-button-rounded","mr-2",3,"disabled","loading","click"],["pButton","","type","button","icon","pi pi-arrow-down",1,"p-button-rounded","mr-2",3,"disabled","loading","click"],["class","ml-1 subtitle",4,"ngIf"],[1,"product-structure-bar","ml-auto","mr-2",3,"model"],["pButton","","type","button","icon","pi pi-angle-down","label","Expand All",1,"mr-2",3,"click"],["pButton","","type","button","icon","pi pi-angle-up","label","Collapse All",3,"click"],[1,"ml-1","subtitle"],[2,"width","50%"],[1,"text-center",2,"width","50%"],[3,"ttRow","ttSelectableRow"],["cdkDropList","",2,"width","50%",3,"ngStyle","cdkDropListData","cdkDropListDropped"],[1,"table-toggle"],[3,"rowNode"],["cdkDrag","",1,"drag-cursor",3,"cdkDragData"],[1,"text-center","p-4"],["class","pi pi-spin pi-spinner","style","font-size: 2.25rem",4,"ngIf"],[4,"ngIf"],[1,"pi","pi-spin","pi-spinner",2,"font-size","2.25rem"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"pek-module-icon",3),e.TgZ(4,"h1"),e._uU(5),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return i.add()}),e.qZA()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"p-treeTable",9,10),e.NdJ("selectionChange",function(r){return i.selectedNode=r})("onNodeSelect",function(){return i.onSelectNode()}),e.YNc(13,Oe,7,8,"ng-template",11),e.YNc(14,Ee,5,0,"ng-template",12),e.YNc(15,Re,8,10,"ng-template",13),e.YNc(16,Ye,4,3,"ng-template",14),e.qZA()()()()()),2&t&&(e.xp6(3),e.Q6J("module","correspondents")("isActive",!0),e.xp6(2),e.hij("",i.type===i.types.INCOMING?"Incoming":"Outgoing"," Categories"),e.xp6(6),e.Q6J("value",i.categories)("selection",i.selectedNode)("scrollable",!0))},dependencies:[g.O5,g.PC,y.Hq,x.iw,v.jx,x.gc,x.V4,x.e2,O.nm,E.D,b.Wj,b.Fd,b.Zt]}),o})();const Qe=[{path:"",title:"Correspondents",component:Y,children:[{path:"incoming-correspondent",title:"Incoming Correspondent",data:{type:h.c.INCOMING},component:q},{path:"outgoing-correspondent",title:"Outgoing Correspondent",data:{type:h.c.OUTGOING},component:q},{path:"incoming-categories",title:"Incoming Categories",data:{type:h.c.INCOMING},component:P},{path:"outgoing-categories",title:"Outgoing Categories",data:{type:h.c.OUTGOING},component:P},{path:"",redirectTo:"incoming-correspondent",pathMatch:"full"},{path:"**",redirectTo:"incoming-correspondent",pathMatch:"full"}]}];let He=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[f.Bz.forChild(Qe),f.Bz]}),o})();var $e=a(7175),Ve=a(6984),je=a(5372);let Be=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[g.ez,He,$e.x,Ve.m,b._t,A.o6]}),o})();e.B6R(je.v,[y.Hq,N.o,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,m.ZT,m.xY,m.H8,U.g,k],[])}}]);